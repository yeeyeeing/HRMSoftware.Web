import{d as C}from"./chunk-T7MGTPAP.js";import{c as N,d as L}from"./chunk-U2RRK6JY.js";import{m as H}from"./chunk-NN5FEWI3.js";import{b as U}from"./chunk-MUCPV7IN.js";import{a as P}from"./chunk-DNINIZJD.js";import{c as a,g as u,h as O,k as I}from"./chunk-L3ECGIWB.js";var s=u(P(),1),w=u(I(),1);var b=class{};a(b,"SetEmployeeShiftColumns"),b.columnsKey="SetEmployeeShift.SetEmployeeShift";var p=u(P(),1);var A=u(I(),1);var S=class extends p.PrefixedContext{constructor(q){if(super(q),!S.init){S.init=!0;var e=p.LookupEditor,o=p.StringEditor,t=p.DateEditor;(0,A.initFormType)(S,["EmployeeRowId",e,"EmployeeName",o,"ShiftStartDate",t,"ShiftEndDate",t,"ShiftId",e,"EmployeeGroupId",e])}}},d=S;a(d,"SetEmployeeShiftForm"),d.formKey="SetEmployeeShift.SetEmployeeShift";var G=u(I(),1);var r=class{};a(r,"SetEmployeeShiftRow"),r.idProperty="Id",r.isActiveProperty="IsActive",r.nameProperty="EmployeeName",r.localTextPrefix="SetEmployeeShift.SetEmployeeShift",r.deletePermission="Administration:HumanResources",r.insertPermission="Administration:HumanResources",r.readPermission="*",r.updatePermission="Administration:HumanResources",r.Fields=(0,G.fieldsProxy)();var B=u(I(),1),x;(e=>(e.baseUrl="SetEmployeeShift/SetEmployeeShift",e.Methods={Create:"SetEmployeeShift/SetEmployeeShift/Create",Update:"SetEmployeeShift/SetEmployeeShift/Update",Delete:"SetEmployeeShift/SetEmployeeShift/Delete",Retrieve:"SetEmployeeShift/SetEmployeeShift/Retrieve",List:"SetEmployeeShift/SetEmployeeShift/List"},["Create","Update","Delete","Retrieve","List"].forEach(o=>{e[o]=function(t,m,n){return(0,B.serviceRequest)(e.baseUrl+"/"+o,t,m,n)}})))(x||(x={}));var h=class extends s.EntityDialog{constructor(e,o,t,m){super();this.form=new d(this.idPrefix);this.EmployeeRowID=e;var n=new Date(o);this.form.ShiftStartDate.set_value(o),this.form.ShiftEndDate.set_minDate(n),s.EditorUtils.setReadonly(this.form.ShiftStartDate.element,!0),this.cloneButton.remove(),t==1?this.saveAndCloseButton.remove():(this.localizationButton.remove(),this.applyChangesButton.remove(),this.undeleteButton.remove())}getFormKey(){return d.formKey}getRowDefinition(){return r}getService(){return x.baseUrl}dialogOpen(e){this.isNew()?(this.deleteButton.remove(),$(".EmployeeGroupId").hide()):(0,w.isEmptyOrNull)(this.form.EmployeeGroupId.value)?$(".EmployeeGroupId").hide():this.readOnly=!0,super.dialogOpen(e),console.log("haha");var o=this;N.List({},i=>{o.ShiftRowObject=i.Entities}),U.List({},i=>{for(var l in i.Entities)if(i.Entities[l].Id==this.EmployeeRowID){this.form.EmployeeRowId.value=i.Entities[l].Id.toString(),s.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),this.form.EmployeeName.value=i.Entities[l].EmployeeName.toString(),s.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);break}});var t=$(".fieldset").children().uniqueId(),m="",n=this.idPrefix+"PropertyGrid";for(var v in t)n==t[v].id&&(m=t[v].id.toString());var c="#"+m.replace("PropertyGrid","ShiftId");$(c).on("change",function(i){var l=new L;l.loadByIdAndOpenDialog($(c).val()),l.readOnly=!0})}save_submitHandler(e){var o,t=this,m=e;console.log("haha"),C.List({Criteria:s.Criteria.and(o,[[H.Fields.EmployeeRowId],"=",t.form.EmployeeRowId.value])},n=>{function v(i,l,k){let E=new Date(i),R=new Date(l);return k.filter(f=>{let D=new Date(f.ShiftStartDate),g=new Date(f.ShiftEndDate);return E>=D&&E<=g||R>=D&&R<=g||D>=E&&D<=R||g>=E&&g<=R}).map(f=>({ShiftStartDate:f.ShiftStartDate,ShiftEndDate:f.ShiftEndDate,ShiftId:f.ShiftId}))}a(v,"getClashingShifts");var c=v(t.form.ShiftStartDate.value,t.form.ShiftEndDate.value,n.Entities);c.length==0?super.save_submitHandler(m):(0,w.alertDialog)(`There is already a shift from ${c.map(i=>`${i.ShiftStartDate.substring(0,10)} to ${i.ShiftEndDate.substring(0,10)}`).join(`
`)}`),console.log(n.Entities)})}};a(h,"SetEmployeeShiftDialog"),h=O([s.Decorators.registerClass("HRMSoftware.SetEmployeeShift.SetEmployeeShiftDialog")],h);export{b as a,r as b,x as c,h as d};
//# sourceMappingURL=chunk-4KNAMXIO.js.map
