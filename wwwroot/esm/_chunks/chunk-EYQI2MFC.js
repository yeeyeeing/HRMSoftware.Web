import{b as T,f as N,g as _,h as K,m as U,o as j}from"./chunk-2372Z4UN.js";import{d as J}from"./chunk-T7MGTPAP.js";import{a as C,b as H}from"./chunk-MUCPV7IN.js";import{a as F}from"./chunk-DNINIZJD.js";import{c as d,g as I,h as A,j as v,k as B}from"./chunk-L3ECGIWB.js";var g=I(F(),1);var M=I(B(),1);var R=I(B(),1);var V=I(B(),1),O=I(F(),1);var P=class extends g.EntityDialog{constructor(){super();this.form=new T(this.idPrefix);this.EmployeeProfileTable=(0,M.getLookup)("EmployeeProfile.EmployeeProfile");var o;H.List({Criteria:O.Criteria.and(o,[[C.Fields.Retired],"=","0"],[[C.Fields.Terminated],"=","0"],[[C.Fields.Resigned],"=","0"])},n=>{console.log(n.Entities),this.EmployeeData=n.Entities}),N.List({},n=>{console.log(n.Entities),this.GroupingData=n.Entities})}getFormKey(){return T.formKey}getRowDefinition(){return _}getService(){return K.baseUrl}getDialogOptions(){let o=super.getDialogOptions();return o.height=800,o.width=1e3,o}SearchCallback(){var o=this,n=document.getElementById(this.idPrefix+"OccupationList"),i=document.getElementById(this.idPrefix+"DepartmentList"),a=document.getElementById(this.idPrefix+"DivisionList"),c=document.getElementById(this.idPrefix+"JobGradeList"),L=document.getElementById(this.idPrefix+"SectionList");function s(h){let D=$(h).val();return D.length?D.split(",").map(x=>parseInt(x,10)):[]}d(s,"parseListFromElement");let f=s(c),m=s(a),u=s(i),e=s(n),t=s(L),S=new Set(f),p=new Set(m),b=new Set(u),w=new Set(e),E=new Set(t);var r=o.form.EmployeeList.value?o.form.EmployeeList.value.split(",").map(Number):[];for(let h of o.EmployeeData){let{JobGradeID:D,DivisionID:x,DepartmentID:z,OccupationID:Q,SectionID:W,Id:k}=h,X=S.has(D)||p.has(x)||b.has(z)||w.has(Q)||E.has(W);console.log(r),X?r.includes(k)||r.push(k):r=r.filter(Y=>Y!==k)}let l=[];for(let h=0;h<r.length;h++){var y=o.GroupingData.find(D=>D.EmployeeRowId===r[h]);(0,V.isEmptyOrNull)(y)&&l.push(r[h])}o.form.EmployeeList.value=l.join(",")}save_submitHandler(o){var n=o,i=this;function a(e){return new Date(e)}d(a,"parseDate");function c(e,t,S,p){return e<p&&t>=S}d(c,"areShiftsOverlapping");function L(e){var t=!1;for(let r=0;r<e.length;r++){var S=a(e[r].ShiftStartDate),p=a(e[r].ShiftEndDate);for(let l=0;l<e.length;l++)if(r!=l){var b=a(e[l].ShiftStartDate),w=a(e[l].ShiftEndDate);if(c(S,p,b,w)){var E="There is a clash between "+e[r].Shift+" and "+e[l].Shift;(0,R.alertDialog)(E),t=!0;break}}if(t==!0)break}return t}d(L,"areAnyShiftsOverlapping");for(let e=0;e<i.form.Shifts.value.length;e++)for(let t=0;t<i.form.Shifts.value.length;t++)if(i.form.Shifts.value[e]!=i.form.Shifts.value[t]&&c(a(i.form.Shifts.value[e].ShiftStartDate),a(i.form.Shifts.value[e].ShiftEndDate),a(i.form.Shifts.value[t].ShiftStartDate),a(i.form.Shifts.value[t].ShiftEndDate))){var s=`There is a clash of date at ${i.form.Shifts.value[e].ShiftStartDate}-${i.form.Shifts.value[e].ShiftEndDate} and ${i.form.Shifts.value[t].ShiftStartDate}-${i.form.Shifts.value[t].ShiftEndDate} `;(0,R.alertDialog)(s)}var f=[],m=[];if(!L(this.form.Shifts.value)){for(let e=0;e<this.form.ActualShifts.value.length;e++)m.push(this.form.ActualShifts.value[e].Id);for(let e=0;e<this.form.EmployeeList.values.length;e++)for(let t=0;t<this.form.Shifts.value.length;t++){var u=new G;u.EmployeeRowId=parseInt(this.form.EmployeeList.values[e]),u.ShiftStartDate=this.form.Shifts.value[t].ShiftStartDate,u.ShiftEndDate=this.form.Shifts.value[t].ShiftEndDate,u.ShiftId=this.form.Shifts.value[t].ShiftId,f.push(u)}this.form.ActualShifts.value=f,this.form.ActualShifts.refresh(),J.List({Criteria:(0,O.Criteria)(j.Fields.EmployeeRowId).in(this.form.EmployeeList.values)},e=>{console.log(e.Entities);for(var t in e.Entities)if(m.indexOf(e.Entities[t].Id)==-1){var S=a(e.Entities[t].ShiftStartDate),p=a(e.Entities[t].ShiftEndDate);for(let y=0;y<i.form.Shifts.value.length;y++){var b=a(i.form.Shifts.value[y].ShiftStartDate),w=a(i.form.Shifts.value[y].ShiftEndDate);if(c(S,p,b,w)==!0){var E;for(var r in i.EmployeeProfileTable.items)if(i.EmployeeProfileTable.items[r].Id==e.Entities[t].EmployeeRowID){E=i.EmployeeProfileTable.items[r].EmployeeID;break}var l="Employee "+E+" Already has a Shift from "+e.Entities[t].ShiftStartDate.substring(0,10)+" until "+e.Entities[t].ShiftEndDate.substring(0,10);(0,R.alertDialog)(l);return}}}super.save_submitHandler(n)})}}onDialogOpen(){super.onDialogOpen();var o=this;this.isNew()||(this.form.Shifts.value=this.form.Shifts.value.sort((f,m)=>new Date(f.ShiftStartDate).getTime()-new Date(m.ShiftStartDate).getTime()),this.form.Shifts.refresh()),$(this.form.Shifts.value).on("change",function(){console.log("haha")}),g.EditorUtils.setReadonly(this.form.ShiftColor.element,!0),$(".ActualShifts").hide();var n=document.createElement("toolcool-color-picker");n.setAttribute("id","color-picker-1"),n.setAttribute("color","#e76ff1"),this.form.ShiftColor.element.after(n),n.addEventListener("change",f=>{let m=f;this.ColorCode=m.detail.hex,this.form.ShiftColor.value=this.ColorCode}),this.form.ShiftColor.element.click(function(){n.opened=!0});var i=document.getElementById(this.idPrefix+"SectionList"),a=document.getElementById(this.idPrefix+"OccupationList"),c=document.getElementById(this.idPrefix+"DepartmentList"),L=document.getElementById(this.idPrefix+"DivisionList"),s=document.getElementById(this.idPrefix+"JobGradeList");console.log(this.idPrefix),$(`#s2id_${this.idPrefix}EmployeeList`).on("click",function(f){return v(this,null,function*(){$(".select2-drop").hide()})}),$(a).on("change",function(){return v(this,null,function*(){o.SearchCallback()})}),$(L).on("change",function(){return v(this,null,function*(){o.SearchCallback()})}),$(s).on("change",function(){return v(this,null,function*(){o.SearchCallback()})}),$(c).on("change",function(){return v(this,null,function*(){o.SearchCallback()})}),$(i).on("change",function(){return v(this,null,function*(){o.SearchCallback()})})}};d(P,"EmployeeGroupDialog"),P=A([g.Decorators.registerClass("HRMSoftware.EmployeeGroup.EmployeeGroupDialog")],P);var G=class extends U{constructor(){super()}};d(G,"ConcreteEmployeeShiftPatternRow");export{P as a};
//# sourceMappingURL=chunk-EYQI2MFC.js.map
