import{b as H,f as V,g as j,h as q,m as z,o as J}from"./chunk-QV7MIW62.js";import{d as F}from"./chunk-T7MGTPAP.js";import{a as B,b as K}from"./chunk-J5PFZI4S.js";import{a as U}from"./chunk-DNINIZJD.js";import{c as O,g as b,h as _,j as g,k}from"./chunk-L3ECGIWB.js";var N=b(U(),1);var Q=b(k(),1);var M=b(k(),1);var W=b(k(),1),x=b(U(),1),T=b(k(),1);var P=class extends N.EntityDialog{constructor(){super();this.form=new H(this.idPrefix);this.EmployeeProfileTable=(0,Q.getLookup)("EmployeeProfile.EmployeeProfile");var e;K.List({Criteria:x.Criteria.and(e,[[B.Fields.Retired],"=","0"],[[B.Fields.Terminated],"=","0"],[[B.Fields.Resigned],"=","0"])},i=>{this.EmployeeData=i.Entities}),V.List({},i=>{this.GroupingData=i.Entities})}getFormKey(){return H.formKey}getRowDefinition(){return j}getService(){return q.baseUrl}getDialogOptions(){let e=super.getDialogOptions();return e.height=800,e.width=1e3,e}SearchCallback(){var e=this,i=document.getElementById(this.idPrefix+"OccupationList"),t=document.getElementById(this.idPrefix+"DepartmentList"),r=document.getElementById(this.idPrefix+"DivisionList"),m=document.getElementById(this.idPrefix+"JobGradeList"),l=document.getElementById(this.idPrefix+"SectionList");function f(n){let v=$(n).val();return v.length?v.split(",").map(c=>parseInt(c,10)):[]}O(f,"parseListFromElement");let o=f(m),a=f(r),u=f(t),h=f(i),A=f(l),C=new Set(o),R=new Set(a),L=new Set(u),w=new Set(h),I=new Set(A);var d;e.isNew()==!0?d=e.form.EmployeeList.value?e.form.EmployeeList.value.split(",").map(Number):[]:e.isNew()==!1&&(d=e.form.NewAddedEmployee.value?e.form.NewAddedEmployee.value.split(",").map(Number):[]);for(let n of e.EmployeeData){let{JobGradeID:v,DivisionID:c,DepartmentID:y,OccupationID:E,SectionID:D,Id:S}=n;C.has(v)||R.has(c)||L.has(y)||w.has(E)||I.has(D)?d.includes(S)||d.push(S):d=d.filter(Y=>Y!==S)}let s=[];for(let n=0;n<d.length;n++){var p=e.GroupingData.find(v=>v.EmployeeRowId===d[n]);s.push(d[n])}e.isNew()==!0?e.form.EmployeeList.value=s.join(","):e.isNew()==!1&&(e.form.NewAddedEmployee.value=s.join(","))}parseDate(e){return new Date(e)}areShiftsOverlapping(e,i,t,r){return e<r&&i>=t}areAnyShiftsOverlapping(e){var i=!1;for(let o=0;o<e.length;o++){var t=this.parseDate(e[o].ShiftStartDate),r=this.parseDate(e[o].ShiftEndDate);for(let a=0;a<e.length;a++)if(o!=a){var m=this.parseDate(e[a].ShiftStartDate),l=this.parseDate(e[a].ShiftEndDate);if(this.areShiftsOverlapping(t,r,m,l)){var f="There is a clash between "+e[o].Shift+" and "+e[a].Shift;(0,M.alertDialog)(f),i=!0;break}}if(i==!0)break}return i}save_submitHandler(e){var i=e,t=this,r=[];if(!this.areAnyShiftsOverlapping(this.form.Shifts.value)){var m=t.form.EmployeeList.values.concat(t.form.NewAddedEmployee.values);F.List({Criteria:(0,x.Criteria)(J.Fields.EmployeeRowId).in(m)},l=>{var f=[],o=[],a=[],u=[];for(var h in l.Entities)if(t.IdToBypass.indexOf(l.Entities[h].Id)==-1){var A=this.parseDate(l.Entities[h].ShiftStartDate),C=this.parseDate(l.Entities[h].ShiftEndDate);for(let p=0;p<t.form.Shifts.value.length;p++){var R=this.parseDate(t.form.Shifts.value[p].ShiftStartDate),L=this.parseDate(t.form.Shifts.value[p].ShiftEndDate);if(this.areShiftsOverlapping(A,C,R,L)==!0){var w;for(var I in t.EmployeeProfileTable.items)if(t.EmployeeProfileTable.items[I].Id==l.Entities[h].EmployeeRowID){w=t.EmployeeProfileTable.items[I].EmployeeID;break}f.push(w),o.push(l.Entities[h].EmployeeRowID.toString()),a.push(l.Entities[h].ShiftStartDate),u.push(l.Entities[h].ShiftEndDate)}}}if(f.length>0){let p=new Date(Math.min(...a.map(y=>Date.parse(y)))),n=new Date(Math.min(...u.map(y=>Date.parse(y)))),v=p.toISOString().substring(0,10),c=n.toISOString().substring(0,10);var d=f.join(",")+" Already has a Shift from "+v+" until "+c+" do you want to remove these employees?";(0,T.confirm)(d,()=>{let y=t.form.EmployeeList.values.filter(D=>!o.includes(D));if(console.log(y),console.log(o),console.log(t.form.EmployeeList.values),t.form.EmployeeList.values=y,t.form.EmployeeList.values.length==0){(0,M.alertDialog)("No employee in the list");return}for(let D=0;D<t.form.EmployeeList.values.length;D++)for(let S=0;S<t.form.Shifts.value.length;S++){var E=new G;E.EmployeeRowId=parseInt(t.form.EmployeeList.values[D]),E.ShiftStartDate=t.form.Shifts.value[S].ShiftStartDate,E.ShiftEndDate=t.form.Shifts.value[S].ShiftEndDate,E.ShiftId=t.form.Shifts.value[S].ShiftId,r.push(E)}t.form.ActualShifts.value=r,super.save_submitHandler(i)},{onNo:()=>{}});return}for(let p=0;p<this.form.EmployeeList.values.length;p++)for(let n=0;n<this.form.Shifts.value.length;n++){var s=new G;s.EmployeeRowId=parseInt(this.form.EmployeeList.values[p]),s.ShiftStartDate=this.form.Shifts.value[n].ShiftStartDate,s.ShiftEndDate=this.form.Shifts.value[n].ShiftEndDate,s.ShiftId=this.form.Shifts.value[n].ShiftId,r.push(s)}this.form.ActualShifts.value=r,super.save_submitHandler(i)})}}dialogOpen(){super.dialogOpen();var e=this,i=e.form.EmployeeList.values;e.form.NewAddedEmployee.items=e.form.NewAddedEmployee.items.filter(r=>!i.includes(r.id)),$(document).ready(function(){$("<button>Add Employee into Group</button>").insertAfter(`#${e.idPrefix}NewAddedEmployee`).on("click",function(){(0,W.isEmptyOrNull)(e.form.NewAddedEmployee.value)||(0,T.confirmDialog)(`Do you want to add these employees into ${e.form.Name.value} Group?`,()=>{var r=e.form.EmployeeList.values.concat(e.form.NewAddedEmployee.values);F.List({Criteria:(0,x.Criteria)(J.Fields.EmployeeRowId).in(r)},m=>{var l=[],f=[],o=[],a=[];for(var u in m.Entities)if(e.IdToBypass.indexOf(m.Entities[u].Id)==-1){var h=e.parseDate(m.Entities[u].ShiftStartDate),A=e.parseDate(m.Entities[u].ShiftEndDate);for(let s=0;s<e.form.Shifts.value.length;s++){var C=e.parseDate(e.form.Shifts.value[s].ShiftStartDate),R=e.parseDate(e.form.Shifts.value[s].ShiftEndDate);if(e.areShiftsOverlapping(h,A,C,R)==!0){var L;for(var w in e.EmployeeProfileTable.items)if(e.EmployeeProfileTable.items[w].Id==m.Entities[u].EmployeeRowID){L=e.EmployeeProfileTable.items[w].EmployeeID;break}l.push(L),f.push(m.Entities[u].EmployeeRowID.toString()),o.push(m.Entities[u].ShiftStartDate),a.push(m.Entities[u].ShiftEndDate)}}}if(l.length>0){let s=new Date(Math.min(...o.map(c=>Date.parse(c)))),p=new Date(Math.min(...a.map(c=>Date.parse(c)))),n=s.toISOString().substring(0,10),v=p.toISOString().substring(0,10);var I=l.join(",")+" Already has a Shift from "+n+" until "+v+" do you want to remove these employees?";(0,T.confirm)(I,()=>{let c=e.form.NewAddedEmployee.values.filter(E=>!f.includes(E));e.form.EmployeeList.value=`${e.form.EmployeeList.value},${c}`,e.form.NewAddedEmployee.value="";var y=e.form.EmployeeList.values;e.form.NewAddedEmployee.items=e.fullItems,e.form.NewAddedEmployee.items=e.form.NewAddedEmployee.items.filter(E=>!y.includes(E.id))},{onNo:()=>{}});return}e.form.EmployeeList.value=`${e.form.EmployeeList.value},${e.form.NewAddedEmployee.value}`,e.form.NewAddedEmployee.value="";var d=e.form.EmployeeList.values;e.form.NewAddedEmployee.items=e.fullItems,e.form.NewAddedEmployee.items=e.form.NewAddedEmployee.items.filter(s=>!d.includes(s.id))})},{onNo:()=>{console.log("User canceled")}})})}),$(".Shifts .add-button").on("click",function(){$(".s-HRMSoftware-EmployeeGroup-EmployeeGroupShiftEditDialog").on("dialogclose",function(){window.ShiftList=e.form.Shifts.value,window.CurrentEmployee=e.form.EmployeeList.values,window.NewEmployee=e.form.NewAddedEmployee.values})}),window.ShiftList=e.form.Shifts.value,window.CurrentEmployee=e.form.EmployeeList.values,window.NewEmployee=e.form.NewAddedEmployee.values;var t=[];for(let r=0;r<e.form.ActualShifts.value.length;r++)t.push(e.form.ActualShifts.value[r].Id);e.IdToBypass=t,window.idToBypass=e.IdToBypass}onDialogOpen(){super.onDialogOpen();var e=this;e.fullItems=e.form.NewAddedEmployee.items,this.isNew()||(this.form.Shifts.value=this.form.Shifts.value.sort((o,a)=>new Date(o.ShiftStartDate).getTime()-new Date(a.ShiftStartDate).getTime()),this.form.Shifts.refresh()),$(this.form.EmployeeList.element).on("change",function(){window.ShiftList=e.form.Shifts.value,window.CurrentEmployee=e.form.EmployeeList.values,window.NewEmployee=e.form.NewAddedEmployee.values;var o=e.form.EmployeeList.values;e.form.NewAddedEmployee.items=e.fullItems,e.form.NewAddedEmployee.items=e.form.NewAddedEmployee.items.filter(a=>!o.includes(a.id))}),$(this.form.NewAddedEmployee.element).on("change",function(){window.ShiftList=e.form.Shifts.value,window.CurrentEmployee=e.form.EmployeeList.values,window.NewEmployee=e.form.NewAddedEmployee.values}),N.EditorUtils.setReadonly(this.form.ShiftColor.element,!0),$(".ActualShifts").hide();var i=document.createElement("toolcool-color-picker");i.setAttribute("id","color-picker-1"),i.setAttribute("color","#e76ff1"),this.form.ShiftColor.element.after(i),i.addEventListener("change",o=>{let a=o;this.ColorCode=a.detail.hex,this.form.ShiftColor.value=this.ColorCode}),this.form.ShiftColor.element.click(function(){i.opened=!0});var t=document.getElementById(this.idPrefix+"SectionList"),r=document.getElementById(this.idPrefix+"OccupationList"),m=document.getElementById(this.idPrefix+"DepartmentList"),l=document.getElementById(this.idPrefix+"DivisionList"),f=document.getElementById(this.idPrefix+"JobGradeList");$(`#s2id_${this.idPrefix}EmployeeList`).on("click",function(o){return g(this,null,function*(){$(".select2-drop").hide()})}),$(r).on("change",function(){return g(this,null,function*(){e.SearchCallback()})}),$(l).on("change",function(){return g(this,null,function*(){e.SearchCallback()})}),$(f).on("change",function(){return g(this,null,function*(){e.SearchCallback()})}),$(m).on("change",function(){return g(this,null,function*(){e.SearchCallback()})}),$(t).on("change",function(){return g(this,null,function*(){e.SearchCallback()})}),window.ShiftList=e.form.Shifts.value,window.CurrentEmployee=e.form.EmployeeList.values,window.NewEmployee=e.form.NewAddedEmployee.values}};O(P,"EmployeeGroupDialog"),P=_([N.Decorators.registerClass("HRMSoftware.EmployeeGroup.EmployeeGroupDialog")],P);var G=class extends z{constructor(){super()}};O(G,"ConcreteEmployeeShiftPatternRow");export{P as a};
//# sourceMappingURL=chunk-W3BLPUIC.js.map
