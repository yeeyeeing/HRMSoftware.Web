import{G as ue}from"./chunk-FIJG4RKS.js";import{C as re,E as le,F as se,G as me}from"./chunk-62DEBFZW.js";import{b as Z}from"./chunk-XGDIBSP2.js";import{a as ye}from"./chunk-DNINIZJD.js";import{c as ie,g as ae,h as oe,j as N,k as ne}from"./chunk-L3ECGIWB.js";var Y=ae(ye(),1);var E=ae(ne(),1),H=ae(ne(),1);var Q=class extends Y.EntityDialog{constructor(e,c,g){super();this.form=new le(this.idPrefix);(0,H.serviceCall)({service:ue.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:r=>{console.log(r)}}),this.RunFromGenerateWiz=!1,(0,E.isEmptyOrNull)(e)||(this.EmployeeRowIdList=e,this.RunFromGenerateWiz=!0),(0,E.isEmptyOrNull)(c)||(this.PayMonth=c),(0,E.isEmptyOrNull)(g)||(this.PayYear=g),Z.List({},r=>{this.EmployeeData=r.Entities}),re.List({},r=>{this.PayrollData=r.Entities})}getFormKey(){return le.formKey}getRowDefinition(){return se}getService(){return me.baseUrl}SearchCallback(){var e=this,c=document.getElementById(this.idPrefix+"PayMonth"),g=document.getElementById(this.idPrefix+"OccupationList"),r=document.getElementById(this.idPrefix+"DepartmentList"),f=document.getElementById(this.idPrefix+"DivisionList"),I=document.getElementById(this.idPrefix+"JobGradeList"),p=document.getElementById(this.idPrefix+"SectionList");if((0,E.isEmptyOrNull)($(c).val()))return;var w=$(I).val();let b=[],i=w.split(",");w.length&&i.forEach(m=>{b.push(parseInt(m))});var S=$(p).val();let P=[];i=S.split(","),S.length&&i.forEach(m=>{P.push(parseInt(m))});var l=$(f).val();i=l.split(",");let a=[];l.length&&i.forEach(m=>{a.push(parseInt(m))});var t=$(r).val();i=t.split(",");let o=[];t.length&&i.forEach(m=>{o.push(parseInt(m))});var k=$(g).val();i=k.split(",");let u=[];k.length&&i.forEach(m=>{u.push(parseInt(m))});for(var s in e.EmployeeData){var n=0;for(var T in P)if(e.EmployeeData[s].SectionID==P[T]){n=1;break}for(var O in b)if(e.EmployeeData[s].JobGradeID==b[O]){n=1;break}for(var d in a)if(e.EmployeeData[s].DivisionID==a[d]){n=1;break}for(var v in o)if(e.EmployeeData[s].DepartmentID==o[v]){n=1;break}for(var R in u)if(e.EmployeeData[s].OccupationID==u[R]){n=1;break}if(n==0){let m=[];var M=e.form.EmployeeRowListBuffer.value;M!=""?(M.split(",").forEach(B=>{m.push(parseInt(B))}),m=m.filter(B=>B!==e.EmployeeData[s].Id),e.form.EmployeeRowListBuffer.value=m.join(",")):e.form.EmployeeRowListBuffer.value=""}else{let m=[];var M=e.form.EmployeeRowListBuffer.value;M!=""?M.includes(",")?(M.split(",").forEach(D=>{m.push(parseInt(D))}),m.indexOf(e.EmployeeData[s].Id)===-1&&(e.form.EmployeeRowListBuffer.value=e.form.EmployeeRowListBuffer.value+" , "+e.EmployeeData[s].Id.toString())):e.form.EmployeeRowListBuffer.value=e.form.EmployeeRowListBuffer.value+" , "+e.EmployeeData[s].Id.toString():e.form.EmployeeRowListBuffer.value=e.EmployeeData[s].Id.toString()}}e.form.EmployeeRowList.value=e.form.EmployeeRowListBuffer.value,e.PayslipSearchCallback()}PayslipSearchCallback(){var e=this,c=document.getElementById(this.idPrefix+"PayMonth");e.form.EmployeeRowListBuffer.value=e.form.EmployeeRowList.value;let g=["January","February","March","April","May","June","July","August","September","October","November","December"];var r=$(c).val().split("/"),f=r[1]-1,I=r[0];let p=[];var w=e.form.EmployeeRowList.value;w.split(",").forEach(R=>{p.push(parseInt(R))});let i=[],S=[];var P=0;if((0,E.isEmptyOrNull)(e.form.EmployeeRowListBuffer.value)){e.form.EmployeeRowList.value="";var l=document.getElementById(e.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length>0)for(;;){var o=t[0];o.remove();var a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length==0)break}return}else{let R=[],M=[];var l=document.getElementById(e.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");for(let D=0;D<t.length;D++){var o=t[D],k=parseInt(o.id);R.push(k)}for(var u in e.PayrollData){var s=e.PayrollData[u].Id,n=e.PayrollData[u].EmployeeRowId,T=e.PayrollData[u].PayYear,O=e.PayrollData[u].PayMonth,d=g[O],v=T.toString();if(p.indexOf(n)===-1&&M.indexOf(n)===-1){var l=document.getElementById(e.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");for(let x=0;x<t.length;x++){var o=t[x];parseInt(o.id)==s&&(o.remove(),M.push(n))}}else p.indexOf(n)!==-1&&T==parseInt(I)&&O==f&&(i.push(s),S.push(n),Z.Retrieve({EntityId:n},D=>{var j=S.indexOf(D.Entity.Id),q=D.Entity.EmployeeName.replace(/\s/g,""),x=i[j],ee="PayrollRowId="+encodeURIComponent(x),A=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+ee,F=new XMLHttpRequest;F.open("GET",A,!0),F.responseType="blob",F.onload=function(){if(F.status===200){var z=F.response;let X=window.URL.createObjectURL(z);var y=document.createElement("li");y.className="file-item file-binary",y.id=x.toString();var h=document.createElement("a");h.href=X,h.className="thumb",h.target="_blank",h.title=q+"Payslip"+d+v+".pdf",h.download=q+"Payslip"+d+v+".pdf",h.id=x.toString(),y.appendChild(h);var G=document.createElement("div");G.className="filename",G.title=q+"Payslip"+d+v+".pdf",G.textContent=q+"Payslip"+d+v+".pdf";var K=document.createElement("a");K.className="delete",K.addEventListener("click",function(J){J.preventDefault(),y.remove()}),G.appendChild(K);var W=document.getElementById(e.idPrefix+"PayslipList"),L=W.querySelector("ul"),U=L.getElementsByTagName("li");let C=[];for(let J=0;J<U.length;J++){var V=U[J],_=V.id;C.push(parseInt(_))}C.indexOf(x)===-1&&(y.appendChild(G),L.appendChild(y));var L=W.querySelector("ul"),U=L.getElementsByTagName("li");for(let J=0;J<U.length;J++){var V=U[J],te=parseInt(V.id);i.indexOf(te)===-1&&V.remove(),U=L.getElementsByTagName("li")}}else(0,H.notifyError)("Error encounter when downloading Payslip Pdf")},F.send(),P+=1}))}}}PartialSearchCallback(){var e=this;let c=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=document.getElementById(this.idPrefix+"PayMonth");this.counter=0;var r=$(g).val().split("/"),f=r[1]-1,I=r[0];let p=[];var w=e.form.EmployeeRowList.value;w.split(",").forEach(R=>{p.push(parseInt(R))});let i=[],S=[];var P=0;if((0,E.isEmptyOrNull)(e.form.EmployeeRowList.value)){e.form.EmployeeRowList.value="";var l=document.getElementById(e.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length>0)for(;;){var o=t[0];o.remove();var a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length==0)break}return}else{let R=[];var l=document.getElementById(e.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");for(let B=0;B<t.length;B++){var o=t[B],k=parseInt(o.id);R.push(k)}for(var u in e.PayrollData){var s=e.PayrollData[u].Id,n=e.PayrollData[u].EmployeeRowId,T=e.PayrollData[u].PayYear,O=e.PayrollData[u].PayMonth,d=c[O],v=T.toString();p.indexOf(n)!==-1&&T==I&&O==f&&(i.push(s),S.push(n),Z.Retrieve({EntityId:n},B=>{var D=S.indexOf(B.Entity.Id),j=B.Entity.EmployeeName.replace(/\s/g,""),q=i[D],x="PayrollRowId="+encodeURIComponent(q),ee=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+x,A=new XMLHttpRequest;A.open("GET",ee,!0),A.responseType="blob",A.onload=function(){if(A.status===200){var F=A.response;let te=window.URL.createObjectURL(F);var z=document.createElement("li");z.className="file-item file-binary",z.id=q.toString();var y=document.createElement("a");y.href=te,y.className="thumb",y.target="_blank",y.title=j+"Payslip"+d+v+".pdf",y.download=j+"Payslip"+d+v+".pdf",y.id=q.toString(),z.appendChild(y);var h=document.createElement("div");h.className="filename",h.title=j+"Payslip"+d+v+".pdf",h.textContent=j+"Payslip"+d+v+".pdf";var G=document.createElement("a");if(G.className="delete",G.addEventListener("click",function(X){X.preventDefault(),z.remove()}),h.appendChild(G),e.RunFromGenerateWiz==!1){var K=document.getElementById(e.idPrefix+"PayslipList"),_=K.querySelector("ul"),L=_.getElementsByTagName("li");let X=[];for(let C=0;C<L.length;C++){var W=L[C],V=W.id;X.push(parseInt(V))}X.indexOf(q)===-1&&(z.appendChild(h),_.appendChild(z));var _=K.querySelector("ul"),L=_.getElementsByTagName("li");for(let C=0;C<L.length;C++){var W=L[C],U=parseInt(W.id);i.indexOf(U)===-1&&W.remove(),L=_.getElementsByTagName("li")}}else y.click()}else(0,H.notifyError)("Error encounter when downloading Payslip Pdf")},A.send(),P+=1}))}}e.dialogClose()}dialogOpen(e){if(super.dialogOpen(),!(0,E.isEmptyOrNull)(this.PayYear)){let l=this.idPrefix,a=l.lastIndexOf("_"),t="#"+l.substring(0,a);$(t).parent().css("display","none")}var c=document.getElementById(this.idPrefix+"PayslipList"),g=c.querySelector("div");g.style.display="none",this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide(),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(l){return N(this,null,function*(){$(".select2-drop").hide()})});var r=this,f=document.getElementById(this.idPrefix+"PayMonth"),P=document.getElementById(this.idPrefix+"EmployeeRowList");let I=new Y.Select2Editor($(f));re.List({},l=>{let a=[];if(!(0,E.isEmptyOrNull)(this.PayYear)&&!(0,E.isEmptyOrNull)(this.PayMonth))var t=this.PayYear+"/"+(this.PayMonth+1).toString().padStart(2,"0");for(var o in l.Entities){var k=l.Entities[o].PayYear.toString()+"/"+(l.Entities[o].PayMonth+1).toString().padStart(2,"0");a.indexOf(k)===-1&&a.push(k)}a.sort((u,s)=>{let[n,T]=u.split("/").map(Number),[O,d]=s.split("/").map(Number),v=new Date(n,T-1);return new Date(O,d-1).getTime()-v.getTime()});for(var o in a)I.addItem({id:a[o].toString(),text:a[o].toString()});!(0,E.isEmptyOrNull)(this.PayYear)&&!(0,E.isEmptyOrNull)(this.PayMonth)&&(a.indexOf(t)===-1&&I.addItem({id:t.toString(),text:t.toString()}),$(f).val(t).trigger("change"),$(P).val(this.EmployeeRowIdList).trigger("change"))});var p=document.getElementById(this.idPrefix+"OccupationList"),w=document.getElementById(this.idPrefix+"DepartmentList"),b=document.getElementById(this.idPrefix+"SectionList"),i=document.getElementById(this.idPrefix+"DivisionList"),S=document.getElementById(this.idPrefix+"JobGradeList"),P=document.getElementById(this.idPrefix+"EmployeeRowList");this.RunFromGenerateWiz==!1?(console.log("haha"),$(f).on("change",function(){return N(this,null,function*(){if((0,E.isEmptyOrNull)($(f).val())){r.form.EmployeeRowList.value="";var l=document.getElementById(r.idPrefix+"PayslipList"),a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length>=0)for(;;){var o=t[0];o.remove();var a=l.querySelector("ul"),t=a.getElementsByTagName("li");if(t.length==0)break}return}r.SearchCallback()})}),$(p).on("change",function(){return N(this,null,function*(){r.SearchCallback()})}),$(i).on("change",function(){return N(this,null,function*(){r.SearchCallback()})}),$(S).on("change",function(){return N(this,null,function*(){r.SearchCallback()})}),$(w).on("change",function(){return N(this,null,function*(){r.SearchCallback()})}),$(b).on("change",function(){return N(this,null,function*(){r.SearchCallback()})}),$(P).on("change",function(){return N(this,null,function*(){r.PayslipSearchCallback()})})):$(P).on("change",function(){return N(this,null,function*(){r.PartialSearchCallback()})})}getToolbarButtons(){var e=this,c=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),c.push({title:"Click to Download",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{(0,H.confirm)("Are you sure to download these payslips?",()=>{var g=document.getElementById(e.idPrefix+"PayslipList"),r=g.querySelector("ul"),f=r.getElementsByTagName("li");for(let b=0;b<f.length;b++){var I=f[b],p=I.getElementsByClassName("thumb");for(let i=0;i<p.length;i++){var w=p[i];w.click()}}})}}),c}};ie(Q,"PayrollWizardDialog"),Q=oe([Y.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollWizardDialog")],Q);export{Q as a};
//# sourceMappingURL=chunk-H3GFL7W6.js.map
