import{n as N}from"./chunk-DA7Z2NN7.js";import{H as U,I as G,J}from"./chunk-TXZZYEY4.js";import{a as v,b as w}from"./chunk-J32UWVCU.js";import{a as V}from"./chunk-DNINIZJD.js";import{c as I,g as H,h as T,j as y,k as F}from"./chunk-L3ECGIWB.js";var h=H(V(),1);var C=H(F(),1),R=H(F(),1);var b=class extends h.EntityDialog{constructor(){super(...arguments);this.form=new U(this.idPrefix)}getFormKey(){return U.formKey}getRowDefinition(){return G}getService(){return J.baseUrl}SearchCallback(){var e=this;function p(t,D){return t.find(l=>l.id==D.toString())}I(p,"findEmployee"),e.form.AllEmployee.value==!0&&(e.form.AllEmployee.value=!1,e.form.EmployeeRowList.value="");var m=document.getElementById(this.idPrefix+"OccupationList"),i=document.getElementById(this.idPrefix+"DepartmentList"),d=document.getElementById(this.idPrefix+"DivisionList"),f=document.getElementById(this.idPrefix+"JobGradeList"),o=document.getElementById(this.idPrefix+"SectionList"),c=$(f).val();let u=[],s=c.split(",");c.length&&s.forEach(t=>{u.push(parseInt(t))});var S=$(o).val();let r=[];s=S.split(","),S.length&&s.forEach(t=>{r.push(parseInt(t))});var a=$(d).val();s=a.split(",");let n=[];a.length&&s.forEach(t=>{n.push(parseInt(t))});var P=$(i).val();s=P.split(",");let k=[];P.length&&s.forEach(t=>{k.push(parseInt(t))});var A=$(m).val();s=A.split(",");let O=[];A.length&&s.forEach(t=>{O.push(parseInt(t))});var x;w.List({Criteria:h.Criteria.and(x,[[v.Fields.Terminated],"=",0],[[v.Fields.Resigned],"=",0],[[v.Fields.Retired],"=",0])},t=>{let D=[];for(var l in t.Entities)if(t.Entities[l].CreateUser!=!0){var g=0;for(var z in u)if(t.Entities[l].JobGradeID==u[z]){g=1;break}for(var W in n)if(t.Entities[l].DivisionID==n[W]){g=1;break}for(var j in k)if(t.Entities[l].DepartmentID==k[j]){g=1;break}for(var K in O)if(t.Entities[l].OccupationID==O[K]){g=1;break}for(var M in r)if(t.Entities[l].SectionID==r[M]){g=1;break}if(g==0){let E=[];var L=e.form.EmployeeRowList.value;L!=""?(L.split(",").forEach(B=>{E.push(parseInt(B))}),E=E.filter(B=>B!==t.Entities[l].Id),e.form.EmployeeRowList.value=E.join(",")):e.form.EmployeeRowList.value=""}else{var q=p(e.originalItems,t.Entities[l].Id);D.push(q);let E=[];var L=e.form.EmployeeRowList.value;L!=""?L.includes(",")?(L.split(",").forEach(Q=>{E.push(parseInt(Q))}),E.indexOf(t.Entities[l].Id)===-1&&(e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+t.Entities[l].Id.toString())):e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+t.Entities[l].Id.toString():e.form.EmployeeRowList.value=t.Entities[l].Id.toString()}}$(e.form.EmployeeRowHrPriveledge).trigger("change"),e.form.EmployeeRowHrPriveledge.items=D,e.form.EmployeeRowHrPriveledge.values=e.form.EmployeeRowHrPriveledge.values.filter(E=>e.form.EmployeeRowList.values.includes(E))})}PartialSearchCallback(){var e=this;function p(f,o){return f.find(c=>c.id==o.toString())}I(p,"findEmployee");let m=[];for(var i in this.form.EmployeeRowList.values){var d=p(e.originalItems,this.form.EmployeeRowList.values[i]);m.push(d)}this.form.EmployeeRowHrPriveledge.values=this.form.EmployeeRowHrPriveledge.values.filter(f=>this.form.EmployeeRowList.values.includes(f)),e.form.EmployeeRowHrPriveledge.items=m}getToolbarButtons(){var e=this,p=super.getToolbarButtons();return $("#"+this.idPrefix+"Toolbar").addClass("ms-auto"),p.push({title:"Create Accounts",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if(e.form.EmployeeRowList.value.length==0){(0,C.alertDialog)("No employee account to create");return}(0,R.confirm)("Are you sure to create account for these employees?",()=>{if((0,C.isEmptyOrNull)(e.form.EmployeeRowList.value)){(0,R.notifyError)("No employee is selected");return}var m=e.form.EmployeeRowList.value;let i=[],d=m.split(",");m.length&&d.forEach(o=>{i.push(parseInt(o))});for(var f in i)w.Retrieve({EntityId:i[f]},o=>{var c="T"+o.Entity.EmployeeID,u="TSH"+o.Entity.EmployeeID;N.Create({Entity:{Username:c,DisplayName:o.Entity.EmployeeName,Password:u,PasswordConfirm:u,Email:o.Entity.EmployeeEmail,MobilePhoneNumber:o.Entity.TelNumber1,EmployeeRowID:o.Entity.Id}}),w.Update({EntityId:o.Entity.Id,Entity:{UserPassword:u,UserName:c}})});e.form.EmployeeRowList.value="",(0,R.notifySuccess)("Account creation success, the username will be same as password in format T{ID}")})}}),p}dialogOpen(e){super.dialogOpen();function p(r,a){return r.filter(n=>n.id!==a.toString())}I(p,"removeObjectById"),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var m;this.originalItems=Array.from(this.form.EmployeeRowHrPriveledge.items),this.form.EmployeeRowHrPriveledge.clearItems(),w.List({Criteria:h.Criteria.and(m,[[v.Fields.Terminated],"=",0],[[v.Fields.Resigned],"=",0],[[v.Fields.Retired],"=",0])},r=>{var a=this.form.EmployeeRowList.items;console.log(r.Entities);for(var n in r.Entities)r.Entities[n].CreateUser==!0&&(console.log(r.Entities[n]),a=p(a,r.Entities[n].Id));console.log(a),this.form.EmployeeRowList.items=a});var i=this,d=document.getElementById(this.idPrefix+"SectionList"),f=document.getElementById(this.idPrefix+"OccupationList"),o=document.getElementById(this.idPrefix+"DepartmentList"),c=document.getElementById(this.idPrefix+"DivisionList"),u=document.getElementById(this.idPrefix+"JobGradeList"),s=document.getElementById(this.idPrefix+"EmployeeRowList"),S=document.getElementById(this.idPrefix+"AllEmployee");$(d).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(f).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(c).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(u).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(o).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(s).on("change",function(){return y(this,null,function*(){i.PartialSearchCallback()})}),$(S).on("change",function(){return y(this,null,function*(){i.form.AllEmployee.value==!0?(i.form.DepartmentList.value="",i.form.SectionList.value="",i.form.DivisionList.value="",i.form.JobGradeList.value="",i.form.OccupationList.value="",i.form.EmployeeRowList.value="",w.List({},r=>{let a=[];for(var n in r.Entities){var P=r.Entities[n].Id;a.push(P)}i.form.EmployeeRowList.value=a.join(",")})):i.form.EmployeeRowList.value=""})})}};I(b,"UserCreationDialog"),b=T([h.Decorators.registerClass("HRMSoftware.EmployeeProfile.UserCreationDialog")],b);export{b as a};
//# sourceMappingURL=chunk-S7VZTVZU.js.map
