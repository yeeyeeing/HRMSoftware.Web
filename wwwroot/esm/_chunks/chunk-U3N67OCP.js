import{m as G}from"./chunk-3FMYFY2A.js";import{T as A,U as T,V as W}from"./chunk-F3ZQHHES.js";import{a as P,b as x}from"./chunk-J5PFZI4S.js";import{a as V}from"./chunk-DNINIZJD.js";import{c as U,g as H,h as F,j as y,k as J}from"./chunk-L3ECGIWB.js";var b=H(V(),1);var I=H(J(),1),B=H(J(),1);var O=class extends b.EntityDialog{constructor(){super(...arguments);this.form=new A(this.idPrefix)}getFormKey(){return A.formKey}getRowDefinition(){return T}getService(){return W.baseUrl}SearchCallback(){var t=this;function i(e,a){return e.find(r=>r.id==a.toString())}U(i,"findEmployee"),t.form.AllEmployee.value==!0&&(t.form.AllEmployee.value=!1,t.form.EmployeeRowList.value="");var u=document.getElementById(this.idPrefix+"OccupationList"),v=document.getElementById(this.idPrefix+"DepartmentList"),L=document.getElementById(this.idPrefix+"DivisionList"),c=document.getElementById(this.idPrefix+"JobGradeList"),m=document.getElementById(this.idPrefix+"SectionList"),h=$(c).val();let R=[],o=h.split(",");h.length&&o.forEach(e=>{R.push(parseInt(e))});var s=$(m).val();let f=[];o=s.split(","),s.length&&o.forEach(e=>{f.push(parseInt(e))});var n=$(L).val();o=n.split(",");let p=[];n.length&&o.forEach(e=>{p.push(parseInt(e))});var N=$(v).val();o=N.split(",");let C=[];N.length&&o.forEach(e=>{C.push(parseInt(e))});var d=$(u).val();o=d.split(",");let l=[];d.length&&o.forEach(e=>{l.push(parseInt(e))});var S;x.List({Criteria:b.Criteria.and(S,[[P.Fields.Terminated],"=",0],[[P.Fields.Resigned],"=",0],[[P.Fields.Retired],"=",0])},e=>{let a=[];for(var r in e.Entities)if(e.Entities[r].CreateUser!=!0){var g=0;for(var w in R)if(e.Entities[r].JobGradeID==R[w]){g=1;break}for(var z in p)if(e.Entities[r].DivisionID==p[z]){g=1;break}for(var K in C)if(e.Entities[r].DepartmentID==C[K]){g=1;break}for(var M in l)if(e.Entities[r].OccupationID==l[M]){g=1;break}for(var j in f)if(e.Entities[r].SectionID==f[j]){g=1;break}if(g==0){let E=[];var D=t.form.EmployeeRowList.value;D!=""?(D.split(",").forEach(k=>{E.push(parseInt(k))}),E=E.filter(k=>k!==e.Entities[r].Id),t.form.EmployeeRowList.value=E.join(",")):t.form.EmployeeRowList.value=""}else{var q=i(t.originalItems,e.Entities[r].Id);a.push(q);let E=[];var D=t.form.EmployeeRowList.value;D!=""?D.includes(",")?(D.split(",").forEach(Q=>{E.push(parseInt(Q))}),E.indexOf(e.Entities[r].Id)===-1&&(t.form.EmployeeRowList.value=t.form.EmployeeRowList.value+" , "+e.Entities[r].Id.toString())):t.form.EmployeeRowList.value=t.form.EmployeeRowList.value+" , "+e.Entities[r].Id.toString():t.form.EmployeeRowList.value=e.Entities[r].Id.toString()}}$(t.form.EmployeeRowHrPriveledge).trigger("change"),t.form.EmployeeRowHrPriveledge.items=a,t.form.EmployeeRowHrPriveledge.values=t.form.EmployeeRowHrPriveledge.values.filter(E=>t.form.EmployeeRowList.values.includes(E))})}PartialSearchCallback(){var t=this;function i(c,m){return c.find(h=>h.id==m.toString())}U(i,"findEmployee");let u=[];for(var v in this.form.EmployeeRowList.values){var L=i(t.originalItems,this.form.EmployeeRowList.values[v]);u.push(L)}this.form.EmployeeRowHrPriveledge.values=this.form.EmployeeRowHrPriveledge.values.filter(c=>this.form.EmployeeRowList.values.includes(c)),t.form.EmployeeRowHrPriveledge.items=u}getToolbarButtons(){var t=this,i=super.getToolbarButtons();return $("#"+this.idPrefix+"Toolbar").addClass("ms-auto"),i.push({title:"Create Accounts",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if(t.form.EmployeeRowList.value.length==0){(0,I.alertDialog)("No employee account to create");return}(0,B.confirm)("Are you sure to create account for these employees?",()=>{if((0,I.isEmptyOrNull)(t.form.EmployeeRowList.value)){(0,B.notifyError)("No employee is selected");return}var u=t.form.EmployeeRowList.value;let v=[],L=u.split(",");u.length&&L.forEach(m=>{v.push(parseInt(m))});var c=[];G.List({},m=>{console.log(m);for(var h in m.Entities)c.push(m.Entities[h].Username);function R(o){return y(this,null,function*(){let s=[],f=[],n=[],p=0,N=o.map(d=>new Promise((l,S)=>{x.Retrieve({EntityId:d},e=>{if(!(0,I.isEmptyOrNull)(e.Entity.EmployeeID)){let a=t.UserNamePrefix+e.Entity.EmployeeID,r=t.PasswordPrefix+e.Entity.EmployeeID;if(a.length<5||r.length<6){(0,I.alertDialog)(`Username must be at least 5 characters, Password must be at least 6 characters. Error in creating ${e.Entity.EmployeeID} ${e.Entity.EmployeeName}`),p=1,S();return}if(c.indexOf(a)!==-1){(0,I.alertDialog)(`Username ${a} for Employee ${e.Entity.EmployeeID} ${e.Entity.EmployeeName} already exists, create failed`),p=1,S();return}f.push(r),s.push(a),n.push(e.Entity)}l()})}));try{yield Promise.all(N)}catch(d){console.error("One or more retrievals failed.");return}if(p===1)return;let C=s.map((d,l)=>new Promise((S,e)=>{let a=f[l];G.Create({Entity:{Username:d,DisplayName:n[l].EmployeeName,Password:a,PasswordConfirm:a,Email:n[l].EmployeeEmail,MobilePhoneNumber:n[l].TelNumber1,EmployeeRowID:n[l].Id}},r=>{var g=r.EntityId;let w={};t.form.EmployeeRowHrPriveledge.values.indexOf(n[l].Id.toString())!==-1&&(w.GrantHRPrivilege=!0),w.UserPassword=a,w.UserName=d,w.CreateUser=!0,w.UserRowID=g,x.Update({EntityId:n[l].Id,Entity:w},()=>S(),()=>e())},()=>e())}));try{yield Promise.all(C),console.log("All users created and updated successfully."),(0,B.notifySuccess)(`Account creation success, username will be in format ${t.UserNamePrefix}{EmployeeID},
                                            default password will be in format ${t.PasswordPrefix}{EmployeeID}`),t.loadEntity({})}catch(d){console.error("Some user creations failed.")}})}U(R,"processEmployees"),R(v)})})}}),i}dialogOpen(t){super.dialogOpen();var i=this;$.ajax({type:"POST",url:"/GetUserNamePasswordPrefix",success:function(o){console.log(o);let s=o.split(",");i.UserNamePrefix=s[0],i.PasswordPrefix=s[1]},error:function(o,s,f){console.error("Error saving image:",f)}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide(),this.originalItems=Array.from(this.form.EmployeeRowHrPriveledge.items),this.form.EmployeeRowHrPriveledge.clearItems();var i=this,u=document.getElementById(this.idPrefix+"SectionList"),v=document.getElementById(this.idPrefix+"OccupationList"),L=document.getElementById(this.idPrefix+"DepartmentList"),c=document.getElementById(this.idPrefix+"DivisionList"),m=document.getElementById(this.idPrefix+"JobGradeList"),h=document.getElementById(this.idPrefix+"EmployeeRowList"),R=document.getElementById(this.idPrefix+"AllEmployee");$(u).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(v).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(c).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(m).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(L).on("change",function(){return y(this,null,function*(){i.SearchCallback()})}),$(h).on("change",function(){return y(this,null,function*(){i.PartialSearchCallback()})}),$(R).on("change",function(){return y(this,null,function*(){if(i.form.AllEmployee.value==!0){i.form.DepartmentList.value="",i.form.SectionList.value="",i.form.DivisionList.value="",i.form.JobGradeList.value="",i.form.OccupationList.value="",i.form.EmployeeRowList.value="";var o;x.List({Criteria:b.Criteria.and(o,[[P.Fields.Terminated],"=",0],[[P.Fields.Resigned],"=",0],[[P.Fields.Retired],"=",0],[[P.Fields.CreateUser],"=",0])},s=>{let f=[];for(var n in s.Entities){var p=s.Entities[n].Id;f.push(p)}i.form.EmployeeRowList.value=f.join(",")})}else i.form.EmployeeRowList.value=""})})}};U(O,"UserCreationDialog"),O=F([b.Decorators.registerClass("HRMSoftware.EmployeeProfile.UserCreationDialog")],O);export{O as a};
//# sourceMappingURL=chunk-U3N67OCP.js.map
