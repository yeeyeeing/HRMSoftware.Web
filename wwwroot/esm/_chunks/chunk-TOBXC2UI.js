import{f as D,g as m,h as n,o as f,p as l}from"./chunk-R2HZVO35.js";import{a as F}from"./chunk-DNINIZJD.js";import{c as I,g as w,h as b,j as c,k as R}from"./chunk-L3ECGIWB.js";var p=w(F(),1),h=w(R(),1);var y=class extends p.EntityDialog{constructor(){super(...arguments);this.form=new D(this.idPrefix)}getFormKey(){return D.formKey}getRowDefinition(){return m}getService(){return n.baseUrl}onDialogOpen(){super.onDialogOpen(),this.dialogTitle="Evaluation Form",this.cloneButton.hide(),this.undeleteButton.hide(),this.localizationButton.hide(),this.deleteButton.hide(),this.element.closest(".ui-dialog").css({position:"fixed",left:"2%",transform:"none",height:"730px",width:"800px"}),n.Retrieve({EntityId:this.entityId},a=>{console.log(a.Entity.HodSignDate);let e=a.Entity.HodSignDate}),n.List({Criteria:[[m.Fields.Id],"=",this.entityId]},a=>c(this,null,function*(){if(a.Entities.length>0){let e=a.Entities[0].FormId;yield l.List({Criteria:[[f.Fields.Id],"=",e]},i=>{if(i.Entities.length>0){let t=new Date,d=i.Entities[0].EvaluateEndDate,s=new Date(d),g=i.Entities[0].ApprovalEndDate,u=new Date(g);t>=s&&(this.form.EmployeeSignature.element.attr("readonly","readonly"),this.form.Evaluation.element.attr("readonly","readonly"),this.form.HodSignature.element.attr("readonly","readonly"),this.form.BonusRate.element.attr("readonly","readonly"),this.form.Goals.element.attr("readonly","readonly"),this.form.OverallRate.element.attr("readonly","readonly"),this.form.Summary.element.attr("readonly","readonly"),this.form.EmployeeSignature.element.find('input[type="file"]').attr("disabled","disabled"),this.form.HodSignature.element.find('input[type="file"]').attr("disabled","disabled")),t>=u&&(this.form.EmployeeSignature.element.attr("readonly","readonly"),this.form.Evaluation.element.attr("readonly","readonly"),this.form.HodSignature.element.attr("readonly","readonly"),this.form.BonusRate.element.attr("readonly","readonly"),this.form.Goals.element.attr("readonly","readonly"),this.form.OverallRate.element.attr("readonly","readonly"),this.form.Summary.element.attr("readonly","readonly"),this.form.GeneralManagerSignature.element.attr("readonly","readonly"),this.form.EmployeeSignature.element.find('input[type="file"]').attr("disabled","disabled"),this.form.HodSignature.element.find('input[type="file"]').attr("disabled","disabled"),this.form.GeneralManagerSignature.element.find('input[type="file"]').attr("disabled","disabled"),this.form.EmployeeSignature.element.find(".tool-button.delete-button").attr("disabled","disabled"),this.form.HodSignature.element.find(".tool-button.delete-button").attr("disabled","disabled"),this.form.GeneralManagerSignature.element.find(".tool-button.delete-button").attr("disabled","disabled"))}else console.error("No form found for the given FormId:",e)})}else console.error("No evaluation found for the given Id:",this.entityId)})),n.List({Criteria:[[m.Fields.Id],"=",this.entityId]},a=>c(this,null,function*(){if(a.Entities.length>0){let e=a.Entities[0].FormId;yield l.List({Criteria:[[f.Fields.Id],"=",e]},i=>{if(i.Entities.length>0){let d=new Date,s=i.Entities[0].EvaluateEndDate,g=new Date(s),u=i.Entities[0].ApprovalStartDate,E=new Date(u),v=i.Entities[0].ApprovalEndDate,S=new Date(v);for(var t of i.Entities)if(t.Id===e){let o=t.ReviewStatus;o===4&&($('div.field.EmployeeSignature > label[title="Employee Signature"]').parent().hide(),$('div.field.GeneralManagerSignature > label[title="General Manager Signature"]').parent().hide()),o===5&&$('div.field.GeneralManagerSignature > label[title="General Manager Signature"]').parent().hide(),o===6&&d<E&&$('div.field.GeneralManagerSignature > label[title="General Manager Signature"]').parent().hide()}}else console.error("No form found for the given FormId:",e)})}else console.error("No evaluation found for the given Id:",this.entityId)}))}onSaveSuccess(a){super.onSaveSuccess(a),n.List({Criteria:[[m.Fields.Id],"=",this.entityId]},e=>{let i=new Date,t=new Date(i.toLocaleString("en-US",{timeZone:"Asia/Kuala_Lumpur"})),d=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),E=String(t.getMinutes()).padStart(2,"0"),v=String(t.getSeconds()).padStart(2,"0"),S=`${d}-${s}-${g} ${u}:${E}:${v}`;l.List({Criteria:[[f.Fields.Id],"=",e.Entities[0].FormId]},o=>{e.Entities[0].HodSignature&&e.Entities[0].HodSignature.length>0&&o.Entities[0].ReviewStatus===4&&l.Update({EntityId:e.Entities[0].FormId,Entity:{ReviewStatus:5}}).then(r=>{n.Update({EntityId:this.entityId,Entity:{HodSignDate:S,HodSignID:h.Authorization.userDefinition.UserId}})}).catch(r=>{console.error("Error updating ReviewStatus:",r)}),e.Entities[0].EmployeeSignature&&e.Entities[0].EmployeeSignature.length>0&&o.Entities[0].ReviewStatus===5&&l.Update({EntityId:e.Entities[0].FormId,Entity:{ReviewStatus:6}}).then(r=>{n.Update({EntityId:this.entityId,Entity:{EmployeeSignDate:S,EmployeeSignID:h.Authorization.userDefinition.UserId}})}).catch(r=>{console.error("Error updating ReviewStatus:",r)}),e.Entities[0].GeneralManagerSignature&&e.Entities[0].GeneralManagerSignature.length>0&&o.Entities[0].ReviewStatus===6&&l.Update({EntityId:e.Entities[0].FormId,Entity:{ReviewStatus:7}}).then(r=>{n.Update({EntityId:this.entityId,Entity:{GeneralManagerSignDate:S,GeneralManagerSignID:h.Authorization.userDefinition.UserId}})}).catch(r=>{console.error("Error updating ReviewStatus:",r)})})})}};I(y,"PerformanceAppraisalEvaluationDialog"),y=b([p.Decorators.registerClass("HRMSoftware.PerformanceAppraisal.PerformanceAppraisalEvaluationDialog")],y);export{y as a};
//# sourceMappingURL=chunk-TOBXC2UI.js.map
