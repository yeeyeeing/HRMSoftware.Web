import{d as Q}from"./chunk-I3VQVPHQ.js";import{b as V,c as J,d as K,e as y}from"./chunk-GHIP3IPF.js";import{d as ae}from"./chunk-2YJXBIYS.js";import{d as X}from"./chunk-GYFJ4L6D.js";import{a as C}from"./chunk-OAOSE5IN.js";import{b as te}from"./chunk-J5PFZI4S.js";import{a as ee}from"./chunk-DNINIZJD.js";import{c as O,g as z,h as W,j as G,k as re}from"./chunk-L3ECGIWB.js";var R=z(ee(),1);var e=z(re(),1);var q=z(ee(),1);var T=class extends q.EntityDialog{constructor(){super();this.form=new J(this.idPrefix);this.cloneButton.remove();var r=this}getFormKey(){return J.formKey}getRowDefinition(){return K}getService(){return y.baseUrl}onDialogOpen(){super.onDialogOpen(),this.undeleteButton.remove(),this.applyChangesButton.remove(),this.deleteButton.remove(),this.localizationButton.remove()}save_submitHandler(r){window.rejectReason=this.form.RejectReason.value,this.dialogClose()}};O(T,"LeaveApplicationRejectDialog"),T=W([q.Decorators.registerClass("HRMSoftware.LeaveApplication.LeaveApplicationRejectDialog")],T);var B=class extends R.EntityDialog{constructor(){super();this.form=new V(this.idPrefix);this.ListOfLeave=[];this.PublicHolidayDateList=[];this.PublicHolidayEventList=[];this.cloneButton.remove();var r=this;R.EditorUtils.setReadonly(this.form.LeaveTaken.element,!0)}getFormKey(){return V.formKey}getRowDefinition(){return K}getService(){return y.baseUrl}onDialogOpen(){super.onDialogOpen(),$(".EmployeeUpdated").hide(),$(".HrUpdated").hide();var r=this;if((0,e.isEmptyOrNull)(this.form.EmployeeUpdatedName.value))$(".EmployeeUpdatedName").hide();else{var a=document.getElementById(this.idPrefix+"EmployeeUpdatedName");$(a).on("click",function(){return G(this,null,function*(){var l=new X(parseInt(r.form.EmployeeUpdated.value));l.loadByIdAndOpenDialog(parseInt(r.form.EmployeeUpdated.value))})}),(0,e.isEmptyOrNull)(r.form.SuperiorRejectReason.value)||$(".SuperiorRejectReason").show()}if((0,e.isEmptyOrNull)(this.form.HrUpdatedName.value))$(".HrUpdatedName").hide();else{var f=document.getElementById(this.idPrefix+"HrUpdatedName");$(f).on("click",function(){return G(this,null,function*(){var l=new X(parseInt(r.form.HrUpdated.value));l.loadByIdAndOpenDialog(parseInt(r.form.HrUpdated.value))})}),(0,e.isEmptyOrNull)(r.form.HrRejectReason.value)||$(".HrRejectReason").show()}R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0),$(".MorningSession").hide(),$(".AfternoonSession").hide();var n=".ApproveEmployeeName",o=".RejectedEmployeeName";if(this.isNew()){var u=document.querySelectorAll(".text-bg-success");u.forEach(function(l){$(l).hide()}),$(n).hide();var I=document.querySelectorAll(".text-bg-danger");I.forEach(function(l){$(l).hide()}),$(o).hide()}else if(!this.isNew()){if(!e.Authorization.userDefinition.Permissions[C.HumanResources]&&r.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&(this.readOnly=!0),r.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){R.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);return}y.Retrieve({EntityId:this.entityId},l=>{var D=l.Entity.EmployeeRowId,S=l.Entity.HrStatus,c=l.Entity.EmployeeStatus;r.EmployeeApproval=l.Entity.EmployeeStatus,r.HrApproval=l.Entity.HrStatus;var E=l.Entity.Status;E==0?(0,e.serviceCall)({service:ae.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:e.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:D},method:"GET",async:!1,onSuccess:L=>{var N=L;if(r.SuperiorPermission=L,r.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&this.set_readOnly(!0),$(".delete-button").removeClass("disabled"),S==0||c==0)N==!0&&!c&&$(".tool-button").removeClass("hidden"),e.Authorization.userDefinition.Permissions[C.HumanResources]&&!S&&$(".tool-button").removeClass("hidden");else if($(o).hide(),$(n).hide(),r.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){var t=document.querySelectorAll(".text-bg-success");t.forEach(function(d){$(d).hide()});var v=document.querySelectorAll(".text-bg-danger");v.forEach(function(d){$(d).hide()})}},onError:L=>{console.log(L.Error)}}):(this.set_readOnly(!0),$(".delete-button").removeClass("disabled"))})}}dialogOpen(r){super.dialogOpen(r);function a(v){let d=v.toString();if(d.includes(".")){let h=parseFloat(d.split(".")[1]),i=parseFloat(d.split(".")[0]);return h>.5?i+.5:i}else return v}O(a,"processValue");let f="#"+this.idPrefix+"HalfDay",n="#"+this.idPrefix+"EligibleDay",o="#"+this.idPrefix+"BalanceLeave",u="#"+this.idPrefix+"EmployeeID",I="#"+this.idPrefix+"MorningSession",l="#"+this.idPrefix+"AfternoonSession";var D=this.form.HalfDay;this.isNew()&&(this.form.HalfDay.value="0",$(f).prop("readonly",!0)),$(n).prop("readonly",!0),$(o).prop("readonly",!0);let S="#"+this.idPrefix+"LeaveReasonId",c="#"+this.idPrefix+"StartDate",E="#"+this.idPrefix+"EndDate";var L=document.getElementById(this.idPrefix+"EmployeeRowId"),t=this;if(this.isNew())if(e.Authorization.userDefinition.Permissions[C.HumanResources])$(L).on("change",function(){return G(this,null,function*(){t.form.EmployeeName.value="",t.form.StartDate.value="",t.form.EndDate.value="",t.form.LeaveReasonId.value="",$(n).val(""),$(o).val(""),!(0,e.isEmptyOrNull)($(this).val())&&(te.Retrieve({EntityId:$(L).val()},v=>{t.form.EmployeeName.value=v.Entity.EmployeeName}),Q.List({},v=>{var d=parseInt($(L).val());for(var h in v.Entities)v.Entities[h].EmployeeRowId==d&&t.ListOfLeave.push(v.Entities[h]);t.RowData=t.ListOfLeave[t.ListOfLeave.length-1];for(let s in t.RowData)if(s.includes("Entitled")){let g=s.replace("Entitled","");t.RowData[g]=t.RowData[s],delete t.RowData[s]}var i=t.RowData;console.log(i),i.MaternityLeave===void 0&&(i.MaternityLeave=0),i.PaternityLeave===void 0&&(i.PaternityLeave=0),console.log(t.ListOfLeave),console.log(i);var m=new Date(t.ListOfLeave[t.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),p=new Date(m);p.setFullYear(p.getFullYear()-1),$(S).on("change",function(s){var g=$(S).val(),b=(0,e.getLookup)("LeaveReason.LeaveReason"),U;for(var M in b.items)if(b.items[M].Id==g){U=b.items[M].LeaveReason.replace(/\s/g,"");break}var j=p.getFullYear(),A=(p.getMonth()+1).toString().padStart(2,"0"),H=p.getDate().toString().padStart(2,"0"),x=`${j}-${A}-${H}`;j=m.getFullYear(),A=(m.getMonth()+1).toString().padStart(2,"0"),H=m.getDate().toString().padStart(2,"0");var F=`${j}-${A}-${H}`,_=!1,P;for(console.log("hereee"),console.log(t.form.EmployeeRowId.value),console.log(x),console.log(F),console.log(g),(0,e.serviceCall)({service:y.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:x,EndingDate:F,TypeOfLeave:g},async:!1,onSuccess:Y=>{P=Y,(0,e.isEmptyOrNull)(P)&&(P=0),_=!0},onError:Y=>{}});_==!1;);var w=i[U];if(w===void 0&&(w=99999),$(n).val(a(w)),$(n).val()!="-"){$(o).prop("readonly",!1);var k=w-P;$(o).val(a(k)),$(o).prop("readonly",!0)}else $(o).prop("readonly",!1),$(o).val("-"),$(o).prop("readonly",!0)})}))})});else{var t=this;this.form.EmployeeRowId.value=e.Authorization.userDefinition.EmployeeRowID,this.form.EmployeeName.value=e.Authorization.userDefinition.DisplayName,console.log(e.Authorization.userDefinition.DisplayName),R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0),R.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),Q.List({},d=>{var h=parseInt(this.form.EmployeeRowId.value);for(var i in d.Entities)d.Entities[i].EmployeeRowId==h&&this.ListOfLeave.push(d.Entities[i]);this.RowData=this.ListOfLeave[this.ListOfLeave.length-1];for(let g in this.RowData)if(g.includes("Entitled")){let b=g.replace("Entitled","");this.RowData[b]=this.RowData[g],delete this.RowData[g]}var m=this.RowData;console.log(m),m.MaternityLeave===void 0&&(m.MaternityLeave=0),m.PaternityLeave===void 0&&(m.PaternityLeave=0);var p=new Date(this.ListOfLeave[this.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),s=new Date(p);s.setFullYear(s.getFullYear()-1),$(S).on("change",function(g){var b=$(S).val(),U=(0,e.getLookup)("LeaveReason.LeaveReason"),M;for(var j in U.items)if(U.items[j].Id==b){M=U.items[j].LeaveReason.replace(/\s/g,"");break}var A=s.getFullYear(),H=(s.getMonth()+1).toString().padStart(2,"0"),x=s.getDate().toString().padStart(2,"0"),F=`${A}-${H}-${x}`;A=p.getFullYear(),H=(p.getMonth()+1).toString().padStart(2,"0"),x=p.getDate().toString().padStart(2,"0");var _=`${A}-${H}-${x}`,P=!1,w;for(console.log("hereee"),(0,e.serviceCall)({service:y.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:F,EndingDate:_,TypeOfLeave:b},async:!1,onSuccess:Z=>{w=Z,(0,e.isEmptyOrNull)(w)&&(w=0),P=!0},onError:Z=>{}});P==!1;);var k=m[M];if(console.log(k),k===void 0&&(k=99999),$(n).val(a(k)),$(n).val()!="-"){$(o).prop("readonly",!1);var Y=k-w;$(o).val(a(Y)),$(o).prop("readonly",!0)}else $(o).prop("readonly",!1),$(o).val("-"),$(o).prop("readonly",!0)})})}let N=O(v=>{let[d,h,i]=v.split("/");return new Date(parseInt(i),parseInt(d)-1,parseInt(h))},"parseDate");var t=this;$(c).on("change",function(v){if($(E).val()!=""){var d=N($(c).val()),h=N($(E).val());if(d>h){(0,e.alertDialog)("the start date cannot be greater than end date"),$(c).val(null);return}if($(E).val()==$(c).val()){$(f).prop("readonly",!1);var i=!1;for((0,e.serviceCall)({service:y.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:p=>{t.WeekdaysList=p.Entities[0].WeekdaysList,console.log(p.Entities),this.form.LeaveTaken.value=p.Entities[0].LeaveToTake,i=!0},onError:p=>{}});i==!1;);$(f).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var i=!1;for((0,e.serviceCall)({service:y.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:s=>{t.WeekdaysList=s.Entities[0].WeekdaysList,console.log(s.Entities),this.form.LeaveTaken.value=s.Entities[0].LeaveToTake,i=!0},onError:s=>{}});i==!1;);D.value="0",$(f).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var m="No need to take leave in this period for holiday";(0,e.alertDialog)(m)}}}),$(E).on("change",function(v){if($(c).val()!=""){var d=N($(c).val()),h=N($(E).val());if(d>h){(0,e.alertDialog)("the start date cannot be greater than end date"),$(E).val(null);return}if($(E).val()==$(c).val()){$(f).prop("readonly",!1);var i=!1;for((0,e.serviceCall)({service:y.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:p=>{console.log(p.Entities),t.WeekdaysList=p.Entities[0].WeekdaysList,this.form.LeaveTaken.value=p.Entities[0].LeaveToTake,i=!0},onError:p=>{}});i==!1;);$(f).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var i=!1;for((0,e.serviceCall)({service:y.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:s=>{t.WeekdaysList=s.Entities[0].WeekdaysList,console.log(s.Entities),this.form.LeaveTaken.value=s.Entities[0].LeaveToTake,i=!0},onError:s=>{}});i==!1;);D.value="0",$(f).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var m="No need to take leave in this period for holiday";(0,e.alertDialog)(m)}}}),$(f).on("change",function(v){$(E).val()==$(c).val()&&($(f).val()==1?(this.form.LeaveTaken.value=.5,$(".MorningSession").show(),$(".AfternoonSession").show()):(this.form.LeaveTaken.value=1,t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1,$(".MorningSession").hide(),$(".AfternoonSession").hide()))}),$(I).on("change",function(v){t.form.MorningSession.value&&(t.form.AfternoonSession.value=!1)}),$(l).on("change",function(v){t.form.AfternoonSession.value&&(t.form.MorningSession.value=!1)})}save_submitHandler(r){if(this.form.LeaveTaken.value==0){var a="No need to take leave in this period for holiday";(0,e.alertDialog)(a);return}var f=$(".fieldset").children().uniqueId(),n=r;let o="#"+this.idPrefix+"StartDate",u="#"+this.idPrefix+"EndDate",I="#"+this.idPrefix+"HalfDay";if($(I).val()==1){if(this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please choose morning session or afternoon session";(0,e.alertDialog)(a);return}if(this.form.MorningSession.value==!0&&this.form.AfternoonSession.value==!0){var a="Please choose only morning session or afternoon session";(0,e.alertDialog)(a);return}}let l="#"+f[0].id.replace("PropertyGrid","BalanceLeave");var D=this.form.LeaveTaken.value,S=new Date($(o).val()),c=new Date($(u).val()),E=c.getTime()-S.getTime(),L=Math.floor(E/(1e3*60*60*24))+1;if(D==1&&$(I).val()==1&&(D=.5),$(l).val()-D>=0){var n=r;if(parseInt(this.form.HalfDay.value)==1&&this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please select whether is morning session or afternoon session";(0,e.alertDialog)(a);return}super.save_submitHandler(n)}else{var a="The applied leave exceed the available leave by "+(D-$(l).val()).toString()+" days.";(0,e.alertDialog)(a)}}getToolbarButtons(){var r=super.getToolbarButtons(),a=this,f=document.createElement("style");return f.textContent=`
        .hidden {
  display: none;
}
            `,document.head.appendChild(f),r.push({title:"Approve Application",cssClass:"text-bg-success p-2 hidden approveApplication",icon:"fa-check text-green",onClick:()=>{(0,e.confirm)("Do you want to approve this application?",()=>{let n={};e.Authorization.userDefinition.Permissions[C.HumanResources]?a.SuperiorPermission?a.EmployeeApproval===2||a.HrApproval===2?a.EmployeeApproval===2?n={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.HrApproval===2&&(n={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}):a.HrApproval===1?n={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.EmployeeApproval===1?n={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:n={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:n={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:n={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID},y.Update({EntityId:a.entityId,Entity:n},o=>{a.loadById(o.EntityId),$(".rejectApplication, .approveApplication").hide()})})}}),r.push({title:"Rejected Application",cssClass:"text-bg-danger p-2 hidden rejectApplication",icon:"fa-times text-red",onClick:()=>{(0,e.confirm)("Do you want to reject this application?",()=>{var n=new T;n.dialogOpen(),n.element.on("dialogclose",()=>{let o={};var u=window.rejectReason;e.Authorization.userDefinition.Permissions[C.HumanResources]?a.SuperiorPermission==!0?a.EmployeeApproval==2||a.HrApproval==2?a.EmployeeApproval==2?o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID,HrRejectReason:u}:a.HrApproval==2&&(o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:u}):a.HrApproval==0?o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID,HrRejectReason:u}:a.EmployeeApproval==0?o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:u}:o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID,HrRejectReason:u,SuperiorRejectReason:u}:o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID,HrRejectReason:u}:o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:u},y.Update({EntityId:a.entityId,Entity:o},I=>{a.loadById(I.EntityId,l=>{console.log(l),(0,e.isEmptyOrNull)(a.form.SuperiorRejectReason.value)||$(".SuperiorRejectReason").show(),(0,e.isEmptyOrNull)(a.form.HrRejectReason.value)||$(".HrRejectReason").show()}),$(".rejectApplication, .approveApplication").hide()})})})}}),r}};O(B,"LeaveApplicationDialog"),B=W([R.Decorators.registerClass("HRMSoftware.LeaveApplication.LeaveApplicationDialog")],B);export{T as a,B as b};
//# sourceMappingURL=chunk-U47JSUFM.js.map
