import{c as We,d as Bt}from"./chunk-YIP4GR2E.js";import{c as He,d as At}from"./chunk-B4PP3UR2.js";import{d as $e,e as Tt}from"./chunk-5TAMAFA5.js";import{a as $t}from"./chunk-H3GFL7W6.js";import{G as je}from"./chunk-FIJG4RKS.js";import{c as Le,d as mt}from"./chunk-XZKAQRVI.js";import{A as Pt,B as St,C as Pe,J as Dt,N as Ct,R as It,W as Ot,_ as Lt,d as yt,h as pt,l as vt,o as Ne,p as ft,r as Et,s as gt,w as tt,y as at,z as bt}from"./chunk-62DEBFZW.js";import{c as be,d as ht}from"./chunk-CICJSBLQ.js";import{d as Me}from"./chunk-2YAUIENJ.js";import{a as Xe,b as ut,k as et,l as ct}from"./chunk-2C2HJ25O.js";import{b as Oe}from"./chunk-XGDIBSP2.js";import{a as Qe}from"./chunk-DNINIZJD.js";import{c as z,g as ye,h as we,j as C,k as Re}from"./chunk-L3ECGIWB.js";var I=ye(Qe(),1);var Te=ye(Re(),1);var R=ye(Re(),1);var pe=class extends I.EntityDialog{constructor(t,e,a,o,n,s,r){super();this.form=new tt(this.idPrefix);this.ExternalEarnings=[];this.ExternalDeductions=[];this.EarningsString=[];this.DeductionsString=[];this.FinalEarnings=[];this.FinalDeductions=[];this.EmployerContributions=[];this.ListOfEpfSubjection=[];this.ListOfEisSubjection=[];this.ListOfHrdfSubjection=[];this.ListOfSocsoSubjection=[];this.ListOfPcbSubjection=[];this.ListOfCriteria=[];this.NoPaidLeaveId=[];this.MoneyClaimingId=[];this.OtPayId=[];this.LateArrivalId=[];this.EarlyLeavingId=[];this.listOfDicts=[];this.AllowanceId=[];this.DeductionId=[];this.Wiz=t,this.WizEmployeeRowId=e,this.PayYear=a,this.PayMonth=o,this.PayDateWiz=n,this.PayPeriodStart=s,this.PayPeriodEnd=r,this.ReadOnly=!1}getFormKey(){return tt.formKey}getRowDefinition(){return St}getService(){return Pe.baseUrl}dialogClose(){$("#NewEarningsCategory").remove(),super.dialogClose()}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+550,t}ResetTable(){console.log("reset  table"),$("#AllowanceDeductionBody, #EarningDeductionBody, #MoneyClaimingBody").empty(),$(`#EarlyLeavingRate, #LateArrivalRate, #EarlyLeavingSubtotal, #LateArrivalSubtotal,
        #NplDayRate, #totalOt, #NplHrRate, #AbsentDayRate`).text(0);var t=document.getElementById("Ot1.0x");t&&(t.textContent="0"),t=document.getElementById("Ot1.5x"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0x"),t&&(t.textContent="0"),t=document.getElementById("Ot1.0xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot1.5xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0xValueTotal"),t&&(t.textContent="0"),$(`#OtOnePointFiveTime, #OtTwoTime, #OtOneTime, #TotalSOCSO, #TotalEPF, #Deduction,
        #Allowance, #TotalEIS, #TotalHRD, #TotalTaxableWage, #GrossWage, #EmployerEPF, #EmployeeEPF,
        #EmployerSOCSO, #EmployeeSOCSO, #EmployerEIS, #EmployeeEIS, #HRD, #PCB, #TotalAllowance, #TotalDeduction,
        #EarlyLeavingMinutes,  #LateArrivalMinutes, #GrossWage, #NettWage, #GrossWage, #totalEmployerContribution,
        #totalEmployeeContribution`).val(0)}Setup(){var t=this,e=this.idPrefix+"PropertyGrid",a=document.getElementById(e);console.log(a);var o=document.createElement("DIV");o.classList.add("category-title"),o.setAttribute("id","PayRoll-Description"),o.style.display="flex",a.appendChild(o);var n=document.createElement("a");n.classList.add("category-anchor");var s=document.createTextNode("Employee Payroll");n.appendChild(s),document.getElementById("PayRoll-Description").append(n);var r=document.getElementById("PayRoll-Description");r.insertAdjacentHTML("afterend",'<div class="DataGrid" id="PayRollGrid"></div>');var d=document.getElementById("PayRollGrid");d.style.display="flex";var p=document.createElement("TABLE");p.style.width="66%",p.id="PayrollTable",p.className="table";var u=document.createElement("thead");u.className="thead-dark",u.id="PayrollTableHeader";var f=document.createElement("tbody");f.id="PayrollTableBody";var l=document.createElement("tr"),y=document.createElement("tfoot");y.id="PayrollTableFoot";var g=document.createElement("TH"),c=document.createElement("TH"),b=document.createElement("TH"),S=document.createElement("TH");g.style.width="25%",c.style.width="25%",b.style.width="25%",S.style.width="25%";var O=document.createTextNode("Description"),m=document.createTextNode("Earnings"),E=document.createTextNode("Description"),h=document.createTextNode("Deductions");g.appendChild(O),c.appendChild(m),b.appendChild(E),S.appendChild(h);var T=document.createElement("TABLE");T.style.height="55%",T.id="EmployerContributionsTable";var H=document.createElement("thead");H.className="thead-dark",H.id="EmployerContributionsHeader";var W=document.createElement("tbody");W.id="EmployerContributionsBody";var Y=document.createElement("tfoot");Y.id="EmployerContributionsFoot";var B=document.createElement("TR"),U=document.createElement("TH"),k=document.createElement("TH");U.style.width="50%",k.style.width="50%";var F=document.createTextNode("Description"),x=document.createTextNode("Employer Contributions");U.appendChild(F),k.appendChild(x),l.appendChild(g),l.appendChild(c),l.appendChild(b),l.appendChild(S),u.appendChild(l),p.appendChild(u),p.appendChild(f),p.appendChild(y),B.appendChild(U),B.appendChild(k),H.appendChild(B),T.appendChild(H),T.appendChild(W),T.appendChild(Y);var D=document.createElement("div");D.className="col-md-6",D.id="left";var M=document.createElement("div");M.id="NplAbsentTableContainer",D.appendChild(M);var A=document.createElement("div");A.id="OvertimeTableContainer",D.appendChild(A);var j=document.createElement("div");j.id="EarlyLeavingTableContainer",D.appendChild(j);var i=document.createElement("table");i.id="NplAbsentTable";var G=document.createElement("thead");G.innerHTML=`
      <tr>
        <th rowspan="2">NPL/Absent</th>
        <th colspan="3" id="totalNplAbsentDeduction">
            <span>Total:</span> <span id="totalNplAbsent">0</span>
        </th>
      </tr>
      `,i.appendChild(G);var fe=[{label:"NPL Day",id:"NplDayRate",inputId:"NplDay",valueId:"NplDayValue",value:0,total:0,adjustment:0},{label:"NPL Hourly",id:"NplHrRate",inputId:"NplHr",valueId:"NplHrValue",value:0,total:0,adjustment:0},{label:"Absent Day",id:"AbsentDayRate",inputId:"AbsentDay",valueId:"AbsentDayValue",value:0,total:0,adjustment:0}];let J=document.createElement("tbody");J.id="NplAbsentTableBody",fe.forEach(L=>{let te=document.createElement("tr");te.innerHTML=`
        <td class="Description">${L.label}</td>
        <td class="rates"> <span class="ratesValue" id = ${L.id} > ${L.value} </span> </td>
        <td class ="numberInputContainer"> <input id = ${L.inputId} min="0" class="nplDates numberInput" type="number" value="${L.total.toFixed(2)}" ></td>
        <td class ="subTotalContainer">  <span id = ${L.valueId} class="subTotal">0.00</span> </td>
      `,J.appendChild(te)}),i.appendChild(J),M.appendChild(i);var X=document.createElement("table");X.id="OvertimeTable";var le=document.createElement("thead");le.innerHTML=`
      <tr>
        <th rowspan="2">Overtime</th>
        <th colspan="3" id="OvertimeAddition">
            <span>Total:</span> <span id="totalOt">0</span>
        </th>
      </tr>
      `,X.appendChild(le);var ue=[{label:"OT1.0x",descId:"flatOtDesc",id:"Ot1.0x",valueId:"Ot1.0xValue",inputId:"OtOneTime",value:0,total:0,adjustment:0},{label:"OT1.5x",descId:"OnePointFiveOtDesc",id:"Ot1.5x",valueId:"Ot1.5xValue",inputId:"OtOnePointFiveTime",value:0,total:0,adjustment:0},{label:"OT2.0x",descId:"TwoOtDesc",id:"Ot2.0x",valueId:"Ot2.0xValue",inputId:"OtTwoTime",value:0,total:0,adjustment:0}];let oe=document.createElement("tbody");oe.id="OvertimeTableBody",ue.forEach(L=>{let te=document.createElement("tr");te.innerHTML=`
        <td class="Description" id=${L.descId}>${L.label}</td>
        <td class="rates"> <span class="ratesValue" id=${L.id}> ${L.value} </span> </td>
        <td class ="numberInputContainer"> <input id=${L.inputId} min="0" class="overtime numberInput" type="number" value="${L.total.toFixed(2)}" ></td>
        <td>  <span class="subTotal" id=${L.valueId}Total>0.00</span> </td>
      `,oe.appendChild(te)}),X.appendChild(oe),A.appendChild(X);var N=document.createElement("table");N.id="EarlyLeavingTable";var Se=document.createElement("thead");Se.innerHTML=`
      <tr>
        <th rowspan="2">Time Deduction</th>
        <th colspan="3" id="ShiftAddition">
            <span>Total:</span> <span id="totalTimeDeduction">0</span>
        </th>
      </tr>
      `,N.appendChild(Se);var Ve=[{label:"Early Leaving",Minutes:"EarlyLeavingMinutes",RateId:"EarlyLeavingRate",SubtotalId:"EarlyLeavingSubtotal",total:0,adjustment:0},{label:"Late Arrival",Minutes:"LateArrivalMinutes",RateId:"LateArrivalRate",SubtotalId:"LateArrivalSubtotal",total:0,adjustment:0}];let De=document.createElement("tbody");De.id="EarlyLeavingTableBody",Ve.forEach(L=>{let te=document.createElement("tr");te.innerHTML=`
        <td class="Description">${L.label}</td>
        <td class="rates"> <span id=${L.RateId} class="ratesValue">0</span> </td>
        <td class ="numberInputContainer"> <input min="0" id=${L.Minutes} class="time numberInput" type="number" value="${L.total.toString()}" ></td>
        <td>  <span class="subTotal"  id=${L.SubtotalId} >0.00</span> </td>
      `,De.appendChild(te)}),N.appendChild(De),j.appendChild(N);var w=document.createElement("div");w.className="col-md-4",w.id="center";var _=document.createElement("div");_.id="AllowanceDeductionContainer",w.appendChild(_);var ce=document.createElement("table");ce.id="AllowanceDeductionTable";var Be=document.createElement("thead");Be.innerHTML=`
      <tr>
        <th colspan="3">Allowance/Deduction</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,ce.appendChild(Be);let nt=document.createElement("tbody");nt.id="AllowanceDeductionBody",ce.appendChild(nt),_.appendChild(ce);var v=document.createElement("div");v.id="MoneyClaimingContainer",w.appendChild(v);var K=document.createElement("table");K.id="MoneyClaimingTable";var P=document.createElement("thead");P.innerHTML=`
      <tr>
        <th colspan="3">Money Claiming</th>
      </tr>
      <tr>
        <th>Category</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,K.appendChild(P);let Ee=document.createElement("tbody");Ee.id="MoneyClaimingBody",K.appendChild(Ee),v.appendChild(K);var Ce=document.createElement("div");Ce.id="EarningDeductionContainer",w.appendChild(Ce);var me=document.createElement("table");me.id="EarningDeductionTable";var ge=document.createElement("thead");ge.innerHTML=`
      <tr>
        <th colspan="3">Extra Earnings/Deductions</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,me.appendChild(ge);let Fe=document.createElement("tbody");Fe.id="EarningDeductionBody",me.appendChild(Fe),Ce.appendChild(me);var ee=document.createElement("div");ee.className="col-md-2 section",ee.id="right";let qe=`
      <h3>Statutory Contribution</h3>
      <table class = "StatutoryContribution">

        <tr>
          <td></td>
          <td>Employer</td>
          <td>Employee</td>
        </tr>

        <tr>
          <td>EPF</td>
          <td><input class="govPayment" id="EmployerEPF" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEPF" type="number" value="0.0" ></td>
        </tr>

        
        <tr>
          <td>SOCSO </td>
          <td><input class="govPayment" id="EmployerSOCSO" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeSOCSO" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>EIS </td>
          <td><input class="govPayment" id="EmployerEIS" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEIS" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>HRD</td>
          <td><input class="govPayment" id="HRD" type="number" value="0.0" ></td>
          <td></td>
        </tr>

        <tr>
          <td>PCB</td>
           <td></td>
          <td><input class="govPayment" id="PCB" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>Total</td>
          <td><input class="govPayment" id="totalEmployerContribution" type="number" value="0.0" readonly></td>
          <td><input class="govPayment" id="totalEmployeeContribution" type="number" value="0.0" readonly></td>
        </tr>


      </table>
    `,Je=`
      <h3>Total Wages</h3>
      <table class = "TotalWages" >
        <tr>
          <td>Total Allowance</td>
          <td><input id="TotalAllowance" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Deduction</td>
          <td><input id="TotalDeduction" type="number" value="0.00" readonly></td>
        </tr>
        <tr>
          <td>EPF Wage</td>
          <td><input id="TotalEPF" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>HRD Wage</td>
          <td><input id="TotalHRD" type="number" value="0.0" readonly></td>
        </tr>



        <tr>
          <td>SOCSO Wage</td>
          <td><input id="TotalSOCSO" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>EIS Wage</td>
          <td><input id="TotalEIS" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Taxable Wage</td>
          <td><input id="TotalTaxableWage" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Gross Wage</td>
          <td><input id="GrossWage"  type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Nett Wage</td>
          <td><input id="NettWage" type="number" value="0.0" readonly></td>
        </tr>
      </table>
    `;var _=document.createElement("div");_.id="AllowanceDeductionContainer",_.className="section",_.innerHTML=qe,ee.appendChild(_);var Z=document.createElement("div");Z.id="Container2",Z.className="section",Z.innerHTML=Je,ee.appendChild(Z),document.getElementById("PayRollGrid").append(D),document.getElementById("PayRollGrid").append(w),document.getElementById("PayRollGrid").append(ee);var re=document.getElementsByClassName("govPayment");$(re).on("change",function(L){return C(this,null,function*(){t.updateWages()})});var de=document.getElementsByClassName("numberInput");$(de).on("change",function(L){return C(this,null,function*(){t.updateTotals()})})}onDialogOpen(){super.onDialogOpen();var t=this;Ot.List({},e=>{for(var a in e.Entities)if(e.Entities[a].IsActive==1){for(var o=e.Entities[a],n=Object.keys(o),s=0;s<n.length;s++){var r=n[s];if(!(r.toLowerCase()=="id"||r.toLowerCase()=="isactive")&&!(o[r]!=!0&&o[r]!=!1&&o[r]!==void 0)){var d=r.replace(/([A-Z])/g," $1").trim();this.ListOfPcbSubjection.push({id:s,name:d,subjection:o[r]})}}break}pt.List({},p=>{for(var u in p.Entities)if(p.Entities[u].IsActive==1){for(var f=p.Entities[u],b=Object.keys(f),l=0;l<b.length;l++){var y=b[l];if(!(y.toLowerCase()=="id"||y.toLowerCase()=="isactive")&&!(f[y]!=!0&&f[y]!=!1&&f[y]!==void 0)){var g=y.replace(/([A-Z])/g," $1").trim();this.ListOfEpfSubjection.push({id:l,name:g,subjection:f[y]})}}break}for(var c=this.ListOfEpfSubjection,b=Object.keys(c),l=0;l<b.length;l++){var y=b[l];this.ListOfCriteria.push(c[y].name)}yt.List({},S=>{for(var O in S.Entities)if(S.Entities[O].IsActive==1){for(var m=S.Entities[O],E=Object.keys(m),h=0;h<E.length;h++){var T=E[h];if(!(T.toLowerCase()=="id"||T.toLowerCase()=="isactive")&&!(m[T]!=!0&&m[T]!=!1&&m[T]!==void 0)){var H=T.replace(/([A-Z])/g," $1").trim();this.ListOfEisSubjection.push({id:h,name:H,subjection:m[T]})}}break}vt.List({},W=>{for(var Y in W.Entities)if(W.Entities[Y].IsActive==1){for(var B=W.Entities[Y],U=Object.keys(B),k=0;k<U.length;k++){var F=U[k];if(!(F.toLowerCase()=="id"||F.toLowerCase()=="isactive")&&!(B[F]!=!0&&B[F]!=!1&&B[F]!==void 0)){var x=F.replace(/([A-Z])/g," $1").trim();this.ListOfHrdfSubjection.push({id:k,name:x,subjection:B[F]})}}break}Lt.List({},D=>{for(var M in D.Entities)if(D.Entities[M].IsActive==1){for(var A=D.Entities[M],j=Object.keys(A),i=0;i<j.length;i++){var G=j[i];if(!(G.toLowerCase()=="id"||G.toLowerCase()=="isactive")&&!(A[G]!=!0&&A[G]!=!1&&A[G]!==void 0)){var fe=G.replace(/([A-Z])/g," $1").trim();this.ListOfSocsoSubjection.push({id:i,name:fe,subjection:A[G]})}}break}if(this.isNew()){var J="Overtime Payments",X=this.CheckSubjection(this.ListOfEisSubjection,J),le=this.CheckSubjection(this.ListOfEpfSubjection,J),ue=this.CheckSubjection(this.ListOfHrdfSubjection,J),oe=this.CheckSubjection(this.ListOfPcbSubjection,J),N=this.CheckSubjection(this.ListOfSocsoSubjection,J);t.form.OtSubjectEis.value=X==1,t.form.OtSubjectEpf.value=le==1,t.form.OtSubjectHrdf.value=ue==1,t.form.OtSubjectPcb.value=oe==1,t.form.OtSubjectSocso.value=N==1,$("#totalOt").attr("eis",X),$("#totalOt").attr("epf",le),$("#totalOt").attr("hrdf",ue),$("#totalOt").attr("pcb",oe),$("#totalOt").attr("socso",N)}})})})})})}calculateAge(){let t=new Date(this.dateString),e=new Date(this.form.BirthDay.value),a=t.getFullYear()-e.getFullYear(),o=new Date(t.getFullYear(),e.getMonth(),e.getDate());t<o&&o.setFullYear(o.getFullYear()-1);let n=t.getTime()-o.getTime(),s=new Date(o);s.setFullYear(s.getFullYear()+1);let r=s.getTime()-o.getTime(),d=n/r;return a+d}dialogOpen(t){$(".field.BasicPay, .field.DailyPay, .field.DailyRate, .field.DaysWorked, .field.HourlyRate, .field.BirthDay, .field.Age").addClass("col-md-2"),$(" .field.WorkingSpouse").addClass("col-md-1"),$(" .field.ChildrenUnderEighteen, .field.ChildrenInUniversity, .field.DisabledChildInUniversity, .field.DisabledChild").addClass("col-md-2"),$(".field.MaritalStatus").addClass("col-md-3"),$(`.field.MaritalStatus label.caption, .field.WorkingSpouse label.caption, .field.ChildrenUnderEighteen label.caption, .field.ChildrenInUniversity label.caption,
        .field.DisabledChildInUniversity label.caption, .field.DisabledChild label.caption, .field.Age label.caption, .field.BirthDay label.caption`).removeClass("caption"),this.ResetTable(),$(".field.EisClass").addClass("col-md-2"),$(".field.SocsoClass").addClass("col-md-6"),$(".field.EpfClass").addClass("col-md-3"),$(".field.TaxClass").addClass("col-md-1"),$(`.field.BasicPay label.caption, .field.DailyPay label.caption, .field.DailyRate label.caption, .field.DaysWorked label.caption,
        .field.HourlyRate label.caption, .field.EisClass label.caption, .field.SocsoClass label.caption, .field.EpfClass label.caption, .field.TaxClass label.caption `).removeClass("caption"),I.EditorUtils.setReadonly(this.form.BasicPay.element,!0),I.EditorUtils.setReadonly(this.form.DaysWorked.element,!0),I.EditorUtils.setReadonly(this.form.HourlyRate.element,!0),I.EditorUtils.setReadonly(this.form.DailyRate.element,!0),I.EditorUtils.setReadonly(this.form.TaxClass.element,!0),I.EditorUtils.setReadonly(this.form.Age.element,!0),I.EditorUtils.setReadonly(this.form.BirthDay.element,!0),this.form.EpfClass.value=1 .valueOf().toString(),$(`.DeductedEarlyLeavingList, .OneTimeDeductionList, .DeductedNoPaidLeaveList,
        .DeductedLateArrivalList, .OneTimeAllowanceList, .PaidMoneyClaimingList, .PaidOtList, .EarlyLeavingRate, .LateArrivalRate, .EarlyLeaving,
        .LateArrival, .FlatOt, .OtOne, .OtOnePointFive, .OtTwo, .NPLHourlyRate, .NPLDailyRate, .NPLHourly, .NPLDaily, .AbsentDailyRate, .AbsentDaily,
        .OtSubjectEpf, .OtSubjectEis, .OtSubjectPcb, .OtSubjectSocso, .OtSubjectHrdf, .AllowanceList, .DeductionList, .OtOnePointFiveRate, .OtTwoRate`).hide();function e(d){let p=new Date(d);if(isNaN(p.getTime()))return d;{p.setDate(28);let u=p.getFullYear(),f=("0"+(p.getMonth()+1)).slice(-2),l=("0"+p.getDate()).slice(-2);return`${u}-${f}-${l}`}}z(e,"isValidDate");var a=this,o=!0;for((0,Te.serviceCall)({service:je.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:d=>{a.dateString=d,o=!1}});o==!0;);Me.List({},d=>{for(var p in d.Entities)if(d.Entities[p].IsActive==1){this.DeductEarlyLeaving=d.Entities[p].DeductSalaryIfEarlyLeaving,this.DeductLateArrival=d.Entities[p].DeductSalaryIfLate,this.PayDate=d.Entities[p].PayDay,a.PublicHolidayMultiplier=d.Entities[p].PublicHolidayOnePointFive==!0?1.5:2,a.WeekendMultiplier=d.Entities[p].WeekendOnePointFive==!0?1.5:2,a.WeekdayMultiplier=d.Entities[p].WeekdayOnePointFive==!0?1.5:2;break}var u=new Date(a.dateString),f=u.getMonth(),l=u.getFullYear(),y=l.toString()+"-"+f.toString().padStart(2,"0")+"-"+this.PayDate.toString().padStart(2,"0");y=e(y);var g=new Date(l,f,this.PayDate),c=g.getFullYear().toString(),b=(g.getMonth()+1).toString(),S=g.getDate().toString(),O=new Date(l,f,this.PayDate);O.setMonth(O.getMonth()-1),O.setDate(O.getDate()-1);var m=O.getFullYear().toString(),E=(O.getMonth()+1).toString(),h=O.getDate().toString(),T=b.padStart(2,"0")+"/"+S.padStart(2,"0")+"/"+c,H=E.padStart(2,"0")+"/"+h.padStart(2,"0")+"/"+m;this.isNew()&&(a.form.PayDate.value=T,a.form.PayPeriodEnd.value=T,a.form.PayPeriodStart.value=H)}),super.dialogOpen(t),a.isNew()&&this.applyChangesButton.hide(),I.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var n=this.form.EmployeeRowId.value;let s=["Deduction","Earnings","Nett","EmployeeEIS","EmployeeEPF","EmployeeSOCSO","EmployeePCB","PayrollTable","EmployerTable","EmployerHRDF","EmployerEPF","EmployerEIS","EmployerSOCSO"];for(var r in s)$("."+s[r]).hide();this.Setup(),Oe.List({},d=>{var p=document.getElementById(this.idPrefix+"PayPeriodStart"),u=document.getElementById(this.idPrefix+"PayPeriodEnd"),f=document.getElementById(this.idPrefix+"EmployeeRowId"),l=document.getElementById(this.idPrefix+"PayMonth"),y=document.getElementById(this.idPrefix+"PayYear"),g=document.getElementById(this.idPrefix+"EisClass"),c=document.getElementById(this.idPrefix+"SocsoClass"),b=document.getElementById(this.idPrefix+"EpfClass"),S=document.getElementById(this.idPrefix+"MaritalStatus"),O=document.getElementById(this.idPrefix+"WorkingSpouse"),m=document.getElementById(this.idPrefix+"ChildrenUnderEighteen"),E=document.getElementById(this.idPrefix+"ChildrenInUniversity"),h=document.getElementById(this.idPrefix+"DisabledChild"),T=document.getElementById(this.idPrefix+"DisabledChildInUniversity");let H=new I.Select2Editor($(l)),W=new I.Select2Editor($(y)),Y=["January","February","March","April","May","June","July","August","September","October","November","December"];var B=new Date(a.dateString),U=B.getFullYear(),k=B.getMonth();for(let i=0;i<Y.length;i++)H.addItem({id:i.toString(),text:Y[i].toString()});a.isNew()&&H.set_value(k.toString());for(let i=-1;i<2;i++)W.addItem({id:(U+i).toString(),text:(U+i).toString()});a.isNew()&&W.set_value(U.toString());let F=new I.Select2Editor($(f)),x=[];for(var D in d.Entities)F.addItem({id:d.Entities[D].Id.toString(),text:d.Entities[D].EmployeeID.toString()}),x.push({id:d.Entities[D].Id,name:d.Entities[D].EmployeeName,BasicPay:d.Entities[D].BasicSalary,Allowance:d.Entities[D].Allowance,type:d.Entities[D].EmployeeType,EpfSubjection:d.Entities[D].EpfContribution,EisClass:d.Entities[D].EisClass,EpfClass:d.Entities[D].EpfClass,SocsoClass:d.Entities[D].SocsoClass,MaritalStatus:d.Entities[D].MaritalStatus,WorkingSpouse:d.Entities[D].WorkingSpouse,ChildrenUnderEighteen:d.Entities[D].ChildrenUnderEighteen,ChildrenInUniversity:d.Entities[D].ChildrenInUniversity,DisabledChildInUniversity:d.Entities[D].DisabledChildInUniversity,DisabledChild:d.Entities[D].DisabledChild,Birthday:d.Entities[D].Birthday});if(this.listOfDicts=x,a.isNew()&&$(f).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),a.Wiz!=1&&($(g).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(c).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(b).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(O).on("change",function(i){return C(this,null,function*(){console.log("haha"),i.stopImmediatePropagation(),a.updatePayroll()})}),$(m).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(S).on("change",function(i){return C(this,null,function*(){console.log("hhaa"),parseInt(a.form.MaritalStatus.value)==1 .valueOf()?$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").show():parseInt(a.form.MaritalStatus.value)==0 .valueOf()&&$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").hide()})}),$(E).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(h).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(T).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})})),this.isNew())$(l).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(y).on("change",function(i){return C(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(p).on("change",function(i){return C(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,R.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodStart.value="";return}a.GeneratePayrollTable(0)})}),$(u).on("change",function(i){return C(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,R.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodEnd.value="";return}a.GeneratePayrollTable(0)})}),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.addEarnings, .field.addDeductions,
        .field.BirthDay, .field.Age,  .addEarnings, .addDeductions`).hide();else if(!this.isNew()){I.EditorUtils.setReadonly(this.form.PayMonth.element,!0),I.EditorUtils.setReadonly(this.form.PayYear.element,!0),I.EditorUtils.setReadonly(this.form.PayDate.element,!0),I.EditorUtils.setReadonly(this.form.PayPeriodEnd.element,!0),I.EditorUtils.setReadonly(this.form.PayPeriodStart.element,!0),$(y).val(this.form.PayYear.value).trigger("change"),$(l).val(this.form.PayMonth.value).trigger("change");for(var D in x)x[D].id==parseInt(n)&&(this.EmployeeType=x[D].type);$(f).val(n.toString()).trigger("change"),I.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),$("#PCB").val(this.form.EmployeePCB.value),$("#EmployeeEIS").val(this.form.EmployeeEIS.value),$("#EmployeeEPF").val(this.form.EmployeeEPF.value),$("#EmployeeSOCSO").val(this.form.EmployeeSOCSO.value),$("#EmployerEIS").val(this.form.EmployerEIS.value),$("#EmployerEPF").val(this.form.EmployerEPF.value),$("#HRD").val(this.form.EmployerHRDF.value),$("#EmployerSOCSO").val(this.form.EmployerSOCSO.value),$("#NplDayRate").text(this.form.NPLDailyRate.value),$("#NplHrRate").text(this.form.NPLHourlyRate.value),$("#AbsentDayRate").text(this.form.AbsentDailyRate.value),$("#NplDay").val(this.form.NPLDaily.value),$("#NplHr").val(this.form.NPLHourly.value),$("#AbsentDay").val(this.form.AbsentDaily.value),document.getElementById("Ot1.0x").textContent=this.form.FlatOt.value.toString(),document.getElementById("Ot1.5x").textContent=this.form.OtOnePointFiveRate.value.toString(),document.getElementById("Ot2.0x").textContent=this.form.OtTwoRate.value.toString(),$("#OtOneTime").val(this.form.OtOne.value),$("#OtOnePointFiveTime").val(this.form.OtOnePointFive.value),$("#OtTwoTime").val(this.form.OtTwo.value),$("#EarlyLeavingRate").text(this.form.EarlyLeavingRate.value),$("#LateArrivalRate").text(this.form.LateArrivalRate.value),$("#EarlyLeavingMinutes").val(this.form.EarlyLeaving.value),$("#LateArrivalMinutes").val(this.form.LateArrival.value),$("#totalOt").attr("eis",a.form.OtSubjectEis.value.toString()),$("#totalOt").attr("epf",a.form.OtSubjectEpf.value.toString()),$("#totalOt").attr("hrdf",a.form.OtSubjectHrdf.value.toString()),$("#totalOt").attr("pcb",a.form.OtSubjectPcb.value.toString()),$("#totalOt").attr("socso",a.form.OtSubjectSocso.value.toString());let i=0;for(i=0;i<this.form.AllowanceList.value.length;i++){var M=document.createElement("tr");M.innerHTML=`<td>${this.form.AllowanceList.value[i].code}</td><td>${this.form.AllowanceList.value[i].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${this.form.AllowanceList.value[i].SubjectionEis.toString()} epf =  ${this.form.AllowanceList.value[i].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.AllowanceList.value[i].SubjectionHrdf.toString()} pcb =  ${this.form.AllowanceList.value[i].SubjectionPcb.toString()}
                                                socso =  ${this.form.AllowanceList.value[i].SubjectionSocso.toString()} 
                                            >${this.form.AllowanceList.value[i].AllowanceAmount}</td>`,$("#AllowanceDeductionBody").append(M)}for(i=0;i<this.form.DeductionList.value.length;i++){var M=document.createElement("tr");M.innerHTML=`<td>${this.form.DeductionList.value[i].code}</td><td>${this.form.DeductionList.value[i].Description}</td><td class = "DeductionAmount">${this.form.DeductionList.value[i].DeductionAmount}</td>`,$("#AllowanceDeductionBody").append(M)}for(i=0;i<this.form.PaidMoneyClaimingList.value.length;i++){var M=document.createElement("tr");M.innerHTML=`<td>${this.form.PaidMoneyClaimingList.value[i].ClaimingCategory}</td><td>${this.form.PaidMoneyClaimingList.value[i].Description}</td>
                                            <td  eis =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionEis.toString()} epf =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionHrdf.toString()} pcb =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionPcb.toString()}
                                                socso =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionSocso.toString()} 
                                            >${this.form.PaidMoneyClaimingList.value[i].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(M)}for(i=0;i<this.form.PayrollEarnings.value.length;i++){var A=this.form.PayrollEarnings.value[i],j=document.createElement("tr"),j=document.createElement("tr");j.innerHTML=`<td> <span>${A.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${A.SubjectionToEis} epf = ${A.SubjectionToEpf} hrdf = ${A.SubjectionToHrdf}
                             pcb = ${A.SubjectionToPcb} socso = ${A.SubjectionToSocso}  value = ${A.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(j)}for(i=0;i<this.form.PayrollDeductions.value.length;i++){A=this.form.PayrollDeductions.value[i];var j=document.createElement("tr");j.innerHTML=`<td>${A.DeductionCode}  <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" max="0"  value = "${A.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(j)}$(".remove").on("click",function(G){return C(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(G){return C(this,null,function*(){a.updatePayroll()})}),a.updateTotals(),a.updatePayroll()}a.Wiz==1&&(a.form.EmployeeRowId.value=a.WizEmployeeRowId.toString(),a.form.PayMonth.value=a.PayMonth,a.form.PayYear.value=a.PayYear,a.form.PayPeriodStart.value=a.PayPeriodStart,a.form.PayPeriodEnd.value=a.PayPeriodEnd,a.form.PayDate.value=a.PayDateWiz)})}updatePayroll(){var t=this;if(this.extraEarningDeduction=0,(0,R.isEmptyOrNull)(t.form.EpfClass.value)||(0,R.isEmptyOrNull)(t.form.EisClass.value)||(0,R.isEmptyOrNull)(t.form.SocsoClass.value)||(0,R.isEmptyOrNull)(t.form.WorkingSpouse.value)||(0,R.isEmptyOrNull)(t.form.ChildrenUnderEighteen.value)||(0,R.isEmptyOrNull)(t.form.ChildrenInUniversity.value)||(0,R.isEmptyOrNull)(t.form.DisabledChild.value)||(0,R.isEmptyOrNull)(t.form.DisabledChildInUniversity.value))return;var e=this.form.BasicPay.value,a=parseFloat(document.getElementById("totalNplAbsent").innerHTML),o=parseFloat(document.getElementById("totalTimeDeduction").innerHTML),n=document.getElementById("totalOt"),s=parseFloat(n.innerHTML);let r=a+o,d=0,p=0,u=0,f=0,l=0,y=0,g=0,c=document.getElementById("AllowanceDeductionBody");c&&Array.from(c.rows).forEach(m=>{let E=m.cells[2],h=parseFloat(E.innerText.trim())||0;h>0?d+=h:h<0&&(p+=h),E.getAttribute("eis")==="true"&&(u+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(y+=h),E.getAttribute("socso")==="true"&&(g+=h)}),$("#TotalAllowance").val(d),$("#TotalDeduction").val(p);let b=document.getElementById("MoneyClaimingBody");b&&Array.from(b.rows).forEach(m=>{let E=m.cells[2],h=parseFloat(E.innerText.trim())||0;t.extraEarningDeduction+=h,E.getAttribute("eis")==="true"&&(u+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(y+=h),E.getAttribute("socso")==="true"&&(g+=h)});let S=document.getElementById("EarningDeductionBody");S&&Array.from(S.rows).forEach(m=>{console.log(m);let E=m.querySelector("input.numberInput"),h=parseFloat(E.value)||0;t.extraEarningDeduction+=h,E.getAttribute("eis")==="true"&&(u+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(y+=h),E.getAttribute("socso")==="true"&&(g+=h)}),n.getAttribute("eis")==="true"&&(u+=s),n.getAttribute("epf")==="true"&&(f+=s),n.getAttribute("hrdf")==="true"&&(l+=s),n.getAttribute("pcb")==="true"&&(y+=s),n.getAttribute("socso")==="true"&&(g+=s),u+=e,f+=e,l+=e,y+=e,g+=e,u-=r,f-=r,l-=r,y-=r,g-=r,$("#TotalEPF").val(f.toFixed(2)),$("#TotalHRD").val(l.toFixed(2)),$("#TotalSOCSO").val(g.toFixed(2)),$("#TotalEIS").val(u.toFixed(2)),$("#TotalTaxableWage").val(y.toFixed(2));var O=t.form.WorkingSpouse.value==!0?1:0;(0,Te.serviceCall)({service:Pe.baseUrl+"/CalculateGovernmentPaymentSpecial",method:"GET",data:{EisCategory:t.form.EisClass.value,EpfCategory:t.form.EpfClass.value,SocsoCategory:t.form.SocsoClass.value,EpfAmount:f,EisAmount:u,SocsoAmount:g,PcbAmount:y,HrdfAmount:l,WorkingSpouse:O,ChildrenUnderEighteen:t.form.ChildrenUnderEighteen.value,ChildrenInUniversity:t.form.ChildrenInUniversity.value,NumberOfDisabledChild:t.form.DisabledChild.value,NumberOfDisabledChildInUni:t.form.DisabledChildInUniversity.value},async:!1,onSuccess:m=>{t.EmployerContributions.length=0,t.form.TaxClass.value=m.Entities[0].TaxClass,$("#EmployeeEPF").val(m.Entities[0].EmployeeEPF.toFixed(2)),$("#EmployeeEIS").val(m.Entities[0].EmployeeEIS.toFixed(2)),$("#PCB").val(m.Entities[0].EmployeePCB.toFixed(2)),$("#EmployeeSOCSO").val(m.Entities[0].EmployeeSOCSO.toFixed(2)),$("#EmployerEPF").val(m.Entities[0].EmployerEPF.toFixed(2)),$("#EmployerEIS").val(m.Entities[0].EmployerEIS.toFixed(2)),$("#HRD").val(m.Entities[0].EmployerHRDF.toFixed(2)),$("#EmployerSOCSO").val(m.Entities[0].EmployerSOCSO.toFixed(2)),t.updateWages()}})}updateTotals(){let t=parseFloat(document.getElementById("NplDayRate").textContent),e=parseFloat(document.getElementById("NplHrRate").textContent),a=parseFloat(document.getElementById("AbsentDayRate").textContent),o=parseFloat(document.getElementById("NplDay").value)||0,n=parseFloat(document.getElementById("NplHr").value)||0,s=parseFloat(document.getElementById("AbsentDay").value)||0;document.getElementById("NplDayValue").textContent=(t*o).toFixed(2),document.getElementById("NplHrValue").textContent=(e*n).toFixed(2),document.getElementById("AbsentDayValue").textContent=(a*s).toFixed(2);let r=t*o+e*n+a*s;document.getElementById("totalNplAbsent").textContent=r.toFixed(2);let d=parseFloat(document.getElementById("Ot1.0x").textContent),p=parseFloat(document.getElementById("Ot1.5x").textContent),u=parseFloat(document.getElementById("Ot2.0x").textContent),f=parseFloat(document.getElementById("OtOneTime").value)||0,l=parseFloat(document.getElementById("OtOnePointFiveTime").value)||0,y=parseFloat(document.getElementById("OtTwoTime").value)||0;document.getElementById("Ot1.0xValueTotal").textContent=(d*f).toFixed(2),document.getElementById("Ot1.5xValueTotal").textContent=(p*l).toFixed(2),document.getElementById("Ot2.0xValueTotal").textContent=(u*y).toFixed(2);let g=d*f+p*l+u*y;document.getElementById("totalOt").textContent=g.toFixed(2);let c=parseFloat(document.getElementById("EarlyLeavingRate").textContent),b=parseFloat(document.getElementById("LateArrivalRate").textContent),S=parseFloat(document.getElementById("EarlyLeavingMinutes").value)||0,O=parseFloat(document.getElementById("LateArrivalMinutes").value)||0;document.getElementById("EarlyLeavingSubtotal").textContent=(c*S).toFixed(2),document.getElementById("LateArrivalSubtotal").textContent=(b*O).toFixed(2);let m=c*S+b*O;document.getElementById("totalTimeDeduction").textContent=m.toFixed(2)}updateWages(){var t=this.form.BasicPay.value,e=parseFloat($("#TotalAllowance").val()),a=parseFloat($("#TotalDeduction").val()),o=parseFloat($("#totalOt").text()),n=0;document.getElementById("totalNplAbsent")&&(n=parseFloat(document.getElementById("totalNplAbsent").innerHTML));var s=0;document.getElementById("totalTimeDeduction")&&(s=parseFloat(document.getElementById("totalTimeDeduction").innerHTML));var r=t+e+o+this.extraEarningDeduction-a-n-s;$("#GrossWage").val(r.toFixed(2));let d=parseFloat($("#EmployeeEPF").val())+parseFloat($("#EmployeeSOCSO").val())+parseFloat($("#EmployeeEIS").val())+parseFloat($("#PCB").val()),p=parseFloat($("#EmployerEPF").val())+parseFloat($("#EmployerEIS").val())+parseFloat($("#EmployerSOCSO").val());$("#totalEmployeeContribution").val(d.toFixed(2)),$("#totalEmployerContribution").val(p.toFixed(2));let u=r-d;$("#NettWage").val(u.toFixed(2)),this.Wiz==1&&this.saveAndCloseButton.click()}GeneratePayrollTable(t){var e=this;e.Wiz!=1&&e.ResetTable();var a=document.getElementById("PayrollTable"),o=document.getElementById(this.idPrefix+"EmployeeRowId"),n=document.getElementById(this.idPrefix+"PayMonth"),s=document.getElementById(this.idPrefix+"PayYear"),r=document.getElementById(this.idPrefix+"EmployeeName"),d=this.ExternalDeductions,p=this.ExternalEarnings,u=this.EarningsString,f=this.DeductionsString,l=e.listOfDicts;if((0,R.isEmptyOrNull)($(o).val()))e.form.EmployeeName.value="";else for(var y in l)l[y].id==$(o).val()&&$(r).val(l[y].name);if((0,R.isEmptyOrNull)($(o).val())||(0,R.isEmptyOrNull)($(n).val())||(0,R.isEmptyOrNull)($(s).val())){$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .addEarnings, .addDeductions,
        .field.BirthDay, .field.Age`).hide();return}else{if(t==1){var g=e.form.PayYear.value,c=e.form.PayMonth.value,b=new Date(g,c,this.PayDate),S=b.getFullYear().toString(),O=(b.getMonth()+1).toString(),m=b.getDate().toString(),E=new Date(g,c,this.PayDate);E.setMonth(E.getMonth()-1),E.setDate(E.getDate()-1);var h=E.getFullYear().toString(),T=(E.getMonth()+1).toString(),H=E.getDate().toString(),W=O.padStart(2,"0")+"/"+m.padStart(2,"0")+"/"+S,Y=T.padStart(2,"0")+"/"+H.padStart(2,"0")+"/"+h;e.form.PayDate.value=W,e.form.PayPeriodEnd.value=W,e.form.PayPeriodStart.value=Y}var B=!0,U=!1,k=!1,F=!1,x=!1,D=!1,M=!1,A=!1,j=!1,i=!1,G=!1,fe=!0,J=!0,X=!0;if(e.NoPaidLeaveId.length=0,e.MoneyClaimingId.length=0,e.OtPayId.length=0,e.EmployerContributions.length=0,d.length=0,p.length=0,u.length=0,f.length=0,e.FinalDeductions.length=0,e.FinalEarnings.length=0,e.NettEarnings=0,e.NettDeductions=0,e.AllowanceId.length=0,e.DeductionId.length=0,(0,R.isEmptyOrNull)($(n).val())&&(0,R.isEmptyOrNull)($(s).val())){e.form.PayPeriodEnd.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate),e.form.PayDate.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate);var E=e.form.PayPeriodEnd.valueAsDate;E.setMonth(E.getMonth()-1),E.setDate(E.getDate()-1),e.form.PayPeriodStart.valueAsDate=E}var le=`${e.form.PayYear.value}/${e.form.PayMonth.value+1}/${1}`,ue=0;for((0,Te.serviceCall)({service:Pe.baseUrl+"/CalculateNplAbsentOtSpecial",method:"GET",data:{EmployeeRowID:parseInt($(o).val()),Date:le},async:!1,onSuccess:N=>{ue=1,e.form.DaysWorked.value=N.Entities[0].NumberOfWorkingDays,$("#NplDayRate").html(N.Entities[0].NPLDaily.toFixed(2)),$("#NplHrRate").html(N.Entities[0].NPLHourly.toFixed(2)),$("#AbsentDayRate").html(N.Entities[0].AbsentDaily.toFixed(2)),$("#EarlyLeavingRate").html(N.Entities[0].EarlyLeavingRate.toFixed(2)),$("#LateArrivalRate").html(N.Entities[0].LateArrivalRate.toFixed(2)),e.form.DailyRate.value=N.Entities[0].DailyRate.toFixed(2),e.form.HourlyRate.value=N.Entities[0].HourlyRate.toFixed(2)}});ue==0;);var oe;mt.List({Criteria:I.Criteria.and(oe,[[Le.Fields.Status],"=","1"],[[Le.Fields.EmployeeRowId],"=",$(o).val()],[[Le.Fields.StartDate],"<=",e.form.PayPeriodEnd.get_value()],[[Le.Fields.EndDate],">=",e.form.PayPeriodStart.get_value()])},N=>{N.Entities.length>0&&(B=!1);var Se;for(var Ve in N.Entities){var De=N.Entities[Ve].LeaveReasonId;switch(De){case 1:U=!0;break;case 2:k=!0;break;case 3:F=!0;break;case 4:x=!0;break;case 5:D=!0;break;case 6:M=!0;break;case 7:A=!0;break;case 8:j=!0;break;case 10:i=!0;break;case 11:G=!0;break}}for(var w in l)if(l[w].id==$(o).val()){e.form.PayrollEarnings.value.length=0,e.form.PayrollDeductions.value.length=0,$(".addEarnings, .addDeductions").show(),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
                            .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
                            .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.BirthDay, .field.Age`).show();var ce=0;for((0,Te.serviceCall)({service:Oe.baseUrl+"/CalculateOtRate",data:{EmployeeRowID:e.form.EmployeeRowId.value,Date:le},method:"GET",async:!1,onSuccess:v=>{if(document.getElementById("PayRoll-Description").children.length==0&&e.Setup(),console.log(v.Entities[0]),e.FixedOtRateOption=v.Entities[0].FixedOtRateOption,e.FixedOtRateOption==!1){e.form.FlatOt.value=v.Entities[0].OtRate;let K=parseFloat(v.Entities[0].OtRate.toFixed(2)),P=(K*1.5).toFixed(2),Ee=(K*2).toFixed(2);document.getElementById("flatOtDesc").innerHTML="OT1.0x",document.getElementById("OnePointFiveOtDesc").innerHTML="OT1.5x",document.getElementById("TwoOtDesc").innerHTML="OT2.0x",document.getElementById("Ot1.0x").textContent=K.toFixed(2),document.getElementById("Ot1.5x").textContent=P,document.getElementById("Ot2.0x").textContent=Ee}else document.getElementById("flatOtDesc").innerHTML="Weekday",document.getElementById("OnePointFiveOtDesc").innerHTML="Weekend",document.getElementById("TwoOtDesc").innerHTML="Public Holiday",document.getElementById("Ot1.0x").textContent=v.Entities[0].OtRateWeekday,document.getElementById("Ot1.5x").textContent=v.Entities[0].OtRateWeekend,document.getElementById("Ot2.0x").textContent=v.Entities[0].OtRatePublicHoliday;ce=1}});ce==0;);e.form.BirthDay.value=l[w].Birthday,e.form.Age.value=e.calculateAge(),e.form.MaritalStatus.value=l[w].MaritalStatus.toString(),e.form.WorkingSpouse.value=l[w].WorkingSpouse,e.form.ChildrenUnderEighteen.value=l[w].ChildrenUnderEighteen,e.form.ChildrenInUniversity.value=l[w].ChildrenInUniversity,e.form.DisabledChildInUniversity.value=l[w].DisabledChildInUniversity,e.form.DisabledChild.value=l[w].DisabledChild,e.form.BasicPay.value=l[w].BasicPay,e.EmployeeType=l[w].type,e.EpfSubjection=l[w].EpfSubjection,e.form.EisClass.value=l[w].EisClass.toString(),e.form.EpfClass.value=l[w].EpfClass.toString(),e.form.SocsoClass.value=l[w].SocsoClass.toString();var Be=l[w].name,Se;ut.List({Criteria:I.Criteria.and(Se,[[Xe.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[Xe.Fields.EffectiveFrom]])},v=>{console.log(v.Entities),$("#AllowanceDeductionBody").empty();var K=0;for(var P in v.Entities){if(!(0,R.isEmptyOrNull)(v.Entities[P].EffectiveUntil)){var Ee=v.Entities[P].EffectiveUntil,Ce=new Date(Ee);if(e.form.PayPeriodStart.valueAsDate>Ce)continue}if(!(v.Entities[P].OneTime==!0&&v.Entities[P].PaidOneTime==!0)){if(v.Entities[P].FullAttendance==!0){if(v.Entities[P].ExemptAnnualLeave==!1&&v.Entities[P].ExemptCompassionateLeave==!1&&v.Entities[P].ExemptEmergencyLeave==!1&&v.Entities[P].ExemptUnpaidLeave==!1&&v.Entities[P].ExemptSickLeave==!1&&v.Entities[P].ExemptPaternityLeave==!1&&v.Entities[P].ExemptMaternityLeave==!1&&v.Entities[P].ExemptMarriageLeave==!1&&v.Entities[P].ExemptHospitalisationLeave==!1&&v.Entities[P].ExemptGatepassLeave==!1){if(B==!1)continue}else if(v.Entities[P].ExemptAnnualLeave==!0&&x==!0||v.Entities[P].ExemptCompassionateLeave==!0&&j==!0||v.Entities[P].ExemptEmergencyLeave==!0&&i==!0||v.Entities[P].ExemptUnpaidLeave==!0&&U==!0||v.Entities[P].ExemptSickLeave==!0&&F==!0||v.Entities[P].ExemptPaternityLeave==!0&&M==!0||v.Entities[P].ExemptMaternityLeave==!0&&D==!0||v.Entities[P].ExemptMarriageLeave==!0&&A==!0||v.Entities[P].ExemptHospitalisationLeave==!0&&k==!0||v.Entities[P].ExemptGatepassLeave==!0&&G==!0)continue}else{if(v.Entities[P].NoAbsence==!0&&J==!1)continue;if(v.Entities[P].NoEarlyLeaving==!0&&X==!1)continue;if(v.Entities[P].NoLate==!0&&fe==!1)continue}var me=document.createElement("tr");me.innerHTML=`<td>${v.Entities[P].AllowanceCode}</td><td>${v.Entities[P].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${v.Entities[P].SubjectionEis.toString()} epf =  ${v.Entities[P].SubjectionEpf.toString()}
                                            hrdf =  ${v.Entities[P].SubjectionHrdf.toString()} pcb =  ${v.Entities[P].SubjectionPcb.toString()}
                                                socso =  ${v.Entities[P].SubjectionSocso.toString()} 
                                            >${v.Entities[P].Amount}</td>`,$("#AllowanceDeductionBody").append(me),e.AllowanceId.push(v.Entities[P].Id),K+=v.Entities[P].Amount}}if($("#TotalAllowance").val(K),$(r).val(Be),a)for(var ge=a.getElementsByTagName("TR"),Fe=ge.length,ee=Fe-1;ee>0;ee--)ge[ee].parentNode.removeChild(ge[ee]);var qe;Tt.List({Criteria:I.Criteria.and(qe,[[$e.Fields.Status],"=","1"],[[$e.Fields.EmployeeRowId],"=",$(o).val()],[[$e.Fields.OtDate],">=",e.form.PayPeriodStart.get_value()],[[$e.Fields.OtDate],"<=",e.form.PayPeriodEnd.get_value()])},Je=>{let _=0,Z=0,re=0,de=0,L=0;Je.Entities.forEach(Q=>{Q.WeekendOt?_+=Q.OtMinute:Q.WeekdayOt?Z+=Q.OtMinute:Q.PublicHolidayOt&&(re+=Q.OtMinute)}),e.FixedOtRateOption==!1?(e.PublicHolidayMultiplier==2?de+=re:L+=re,e.WeekendMultiplier==2?de+=_:L+=_,e.WeekdayMultiplier==2?de+=Z:L+=Z,de=de/60,L=L/60,$("#OtOnePointFiveTime").val(L),$("#OtTwoTime").val(de)):(Z=Z/60,_=_/60,re=re/60,$("#OtOneTime").val(Z),$("#OtOnePointFiveTime").val(_),$("#OtTwoTime").val(re)),$("#OtTwoTime").trigger("change");var te;ft.List({Criteria:I.Criteria.and(te,[[Ne.Fields.EmployeeRowId],"=",$(o).val()],[[Ne.Fields.LeaveDate],">=",e.form.PayPeriodStart.get_value()],[[Ne.Fields.LeaveDate],"<=",e.form.PayPeriodEnd.get_value()])},Q=>{let xt=0;for(var Ke in Q.Entities)(0,R.isEmptyOrNull)(Q.Entities[Ke].Deductions)||(e.NoPaidLeaveId.push(Q.Entities[Ke].Id),xt+=Q.Entities[Ke].HalfDay?.5:1);var wt;ct.List({Criteria:I.Criteria.and(wt,[[et.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[et.Fields.EffectiveFrom]])},ae=>{var lt=0;for(var ie in ae.Entities)if(!(ae.Entities[ie].OneTime==!0&&ae.Entities[ie].DeductedOneTime==!0)){if(!(0,R.isEmptyOrNull)(ae.Entities[ie].EffectiveUntil)){var Rt=ae.Entities[ie].EffectiveUntil,Mt=new Date(Rt);if(e.form.PayPeriodStart.valueAsDate>Mt)continue}var ot=document.createElement("tr");ot.innerHTML=`<td>${ae.Entities[ie].DeductionCode}</td><td>${ae.Entities[ie].Description}</td><td class = "DeductionAmount">-${ae.Entities[ie].Amount}</td>`,$("#AllowanceDeductionBody").append(ot),e.DeductionId.push(ae.Entities[ie].Id),lt+=ae.Entities[ie].Amount}$("#TotalDeduction").val(lt);var Nt;ht.List({Criteria:I.Criteria.and(Nt,[[be.Fields.EmployeeRowId],"=",$(o).val()],[[be.Fields.Paid],"=","0"],[[be.Fields.Status],"=","1"],[[be.Fields.ClaimingDate],">=",e.form.PayPeriodStart.get_value()],[[be.Fields.ClaimingDate],"<=",e.form.PayPeriodEnd.get_value()])},ne=>{$("#MoneyClaimingBody").empty();for(var se in ne.Entities){var rt=document.createElement("tr");rt.innerHTML=`<td>${ne.Entities[se].ClaimingCategory}</td><td>${ne.Entities[se].Description}</td>
                                            <td  eis =  ${ne.Entities[se].SubjectionEis.toString()} epf =  ${ne.Entities[se].SubjectionEpf.toString()}
                                            hrdf =  ${ne.Entities[se].SubjectionHrdf.toString()} pcb =  ${ne.Entities[se].SubjectionPcb.toString()}
                                                socso =  ${ne.Entities[se].SubjectionSocso.toString()} 
                                            >${ne.Entities[se].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(rt)}var jt;At.List({Criteria:I.Criteria.and(jt,[[He.Fields.EmployeeRowId],"=",$(o).val()],[[He.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[He.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},Ie=>{Ie.Entities.length>0&&(X=!1);let dt=0;for(var Ze in Ie.Entities)Ie.Entities[Ze].Deducted==0&&(dt+=Ie.Entities[Ze].EarlyMins,e.EarlyLeavingId.push(Ie.Entities[Ze].Id));$("#EarlyLeavingMinutes").val(dt);var Ht;Bt.List({Criteria:I.Criteria.and(Ht,[[We.Fields.EmployeeRowId],"=",$(o).val()],[[We.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[We.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},he=>{var st=0;he.Entities.length>0&&(fe=!1);for(var xe in he.Entities)he.Entities[xe].Deducted==0&&((0,R.isEmptyOrNull)(he.Entities[xe].Deductions)||(st+=he.Entities[xe].LateMins,e.LateArrivalId.push(he.Entities[xe].Id)));$("#LateArrivalMinutes").val(st),e.updatePayroll()})})})})})})});break}})}}CheckSubjection(t,e){var a=e.match(/\((.*?)\)/),o;if(a&&a.length>1?o=a[1]:o=e,o=="Others")return 0;for(var n=0;n<t.length;n++){var s=t[n];for(var r in s)if(s[r]==o)return s.subjection}return 0}getToolbarButtons(){var t=super.getToolbarButtons(),e=document.createElement("style");e.textContent=`

    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .section h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table td {
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }

    table td input[type="number"] {
      width: 100%;
      text-align: right;
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f9f9f9;
    }









    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #d9e9f9; /* Light blue for headers */
      font-weight: bold;
    }

    td:nth-child(3), td:nth-child(5) {
      background-color: #fde8f1; /* Light pink for specific columns */
    }

    tr:nth-child(even) {
      background-color: #f9f9f9; /* Alternating row colors */
    }

    tr {
    position: sticky;
    }
        
    tr:hover {
      background-color: #f1f1f1; /* Hover effect for rows */
    }

    .numberInput {
      text-align: right; /* Align text consistently */
      width: 100%;
      border: none;
      background-color: transparent;
    }

    .Description {
    text-align: left; /* Align text consistently */
    width: 50px; /* Ensures consistent width for all spans */

    }

    .numberInputContainer {
    text-align: left; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }


    .rates {
    text-align: right; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }
    

    #PayRollGrid {
    display: flex;
    gap: 5px; /* Adds a 20px gap between #left, #center, and #right */
}

#left,
#center,
#right {
    flex: 1; /* Ensures each section takes equal space (optional) */
}

            `,document.head.appendChild(e);var a=this;return t.push({title:"Add Earnings",cssClass:"text-bg-success p-2 addEarnings",icon:"fa-plus text-green",onClick:()=>{$(".PayrollEarnings .add-button").click();var n=a.form.PayrollEarnings.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollEarningsEditDialog").on("dialogclose",function(){if(n!=a.form.PayrollEarnings.value.length){var s=a.form.PayrollEarnings.value[a.form.PayrollEarnings.value.length-1],r=document.createElement("tr");r.innerHTML=`<td> <span>${s.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${s.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${s.SubjectionToEis} epf = ${s.SubjectionToEpf} hrdf = ${s.SubjectionToHrdf}
                             pcb = ${s.SubjectionToPcb} socso = ${s.SubjectionToSocso}  value = ${s.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(r),$(".remove").on("click",function(d){return C(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(d){return C(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t.push({title:"Add Deductions",cssClass:"text-bg-danger p-2 addDeductions",icon:"fa-minus text-red",onClick:()=>{$(".PayrollDeductions .add-button").click();var n=a.form.PayrollDeductions.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollDeductionsEditDialog").on("dialogclose",function(){if(n!=a.form.PayrollDeductions.value.length){var s=a.form.PayrollDeductions.value[a.form.PayrollDeductions.value.length-1],r=document.createElement("tr");r.innerHTML=`<td>   <span>${s.DeductionCode}</span>  <button class="remove">\xD7</button>
                            </td><td>${s.Description}</td><td> <input class = numberInput type="number" max="0"  value = "-${s.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(r),$(".remove").on("click",function(d){return C(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(d){return C(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t}save_submitHandler(t){let e=0,o=document.getElementById("EarningDeductionBody").querySelectorAll("tr");if(o.length){let y=[],g=[],c=Array.from(o).map(b=>{let S=b.querySelectorAll("td");return{code:S[0].querySelector("span").textContent,description:S[1].innerText,amount:S[2].querySelector(".numberInput").value,eis:S[2].querySelector(".numberInput").getAttribute("eis"),epf:S[2].querySelector(".numberInput").getAttribute("epf"),hrdf:S[2].querySelector(".numberInput").getAttribute("hrdf"),pcb:S[2].querySelector(".numberInput").getAttribute("pcb"),socso:S[2].querySelector(".numberInput").getAttribute("socso")}});for(e=0;e<c.length;e++){var n;parseFloat(c[e].amount)>0?(n=new Ye,n.Amount=parseFloat(c[e].amount),n.Description=c[e].description,n.SubjectionToPcb=r(c[e].pcb),n.SubjectionToEis=r(c[e].eis),n.SubjectionToHrdf=r(c[e].hrdf),n.SubjectionToSocso=r(c[e].socso),n.SubjectionToEpf=r(c[e].epf),n.EarningCode=c[e].code,y.push(n)):parseFloat(c[e].amount)<0&&(n=new Ue,n.Amount=parseFloat(c[e].amount),n.Description=c[e].description,n.DeductionCode=c[e].code,g.push(n))}this.form.PayrollEarnings.value=y,this.form.PayrollDeductions.value=g}this.form.NPLDaily.value=$("#NplDay").val(),this.form.NPLHourly.value=$("#NplHr").val(),this.form.AbsentDaily.value=$("#AbsentDay").val(),this.form.OtOne.value=$("#OtOneTime").val(),this.form.OtOnePointFive.value=$("#OtOnePointFiveTime").val(),this.form.OtTwo.value=$("#OtTwoTime").val(),this.form.EarlyLeaving.value=$("#EarlyLeavingMinutes").val(),this.form.LateArrival.value=$("#LateArrivalMinutes").val(),this.form.FlatOt.value=parseFloat(document.getElementById("Ot1.0x").textContent),this.form.OtOnePointFiveRate.value=parseFloat(document.getElementById("Ot1.5x").textContent),this.form.OtTwoRate.value=parseFloat(document.getElementById("Ot2.0x").textContent);var s=this;function r(y){return y==="true"}z(r,"toBoolean"),this.form.EmployeePCB.value=$("#PCB").val(),this.form.EmployeeEIS.value=$("#EmployeeEIS").val(),this.form.EmployeeEPF.value=$("#EmployeeEPF").val(),this.form.EmployeeSOCSO.value=$("#EmployeeSOCSO").val(),this.form.EmployerEIS.value=$("#EmployerEIS").val(),this.form.EmployerEPF.value=$("#EmployerEPF").val(),this.form.EmployerHRDF.value=$("#HRD").val(),this.form.EmployerSOCSO.value=$("#EmployerSOCSO").val(),this.form.NPLDailyRate.value=parseFloat($("#NplDayRate").text()),this.form.NPLHourlyRate.value=parseFloat($("#NplHrRate").text()),this.form.AbsentDailyRate.value=parseFloat($("#AbsentDayRate").text()),this.form.EarlyLeavingRate.value=parseFloat($("#EarlyLeavingRate").text()),this.form.LateArrivalRate.value=parseFloat($("#LateArrivalRate").text());let p=document.getElementById("MoneyClaimingBody").querySelectorAll("tr");if(p.length){let y=[],g=Array.from(p).map(c=>{let b=c.querySelectorAll("td");return{ClaimingCategory:b[0].innerText,description:b[1].innerText,amount:b[2].innerText,eis:b[2].getAttribute("eis"),epf:b[2].getAttribute("epf"),hrdf:b[2].getAttribute("hrdf"),pcb:b[2].getAttribute("pcb"),socso:b[2].getAttribute("socso")}});for(e=0;e<g.length;e++){var u=new ke;u.ClaimAmount=parseFloat(g[e].amount),u.Description=g[e].description,u.ClaimingCategory=g[e].ClaimingCategory,u.SubjectionPcb=r(g[e].pcb),u.SubjectionEis=r(g[e].eis),u.SubjectionHrdf=r(g[e].hrdf),u.SubjectionSocso=r(g[e].socso),u.SubjectionEpf=r(g[e].epf),y.push(u)}this.form.PaidMoneyClaimingList.value=y}let l=document.getElementById("AllowanceDeductionBody").querySelectorAll("tr");if(l.length){let y=[],g=[],c=Array.from(l).map(O=>{let m=O.querySelectorAll("td");return{code:m[0].innerText,description:m[1].innerText,amount:m[2].innerText,eis:m[2].getAttribute("eis"),epf:m[2].getAttribute("epf"),hrdf:m[2].getAttribute("hrdf"),pcb:m[2].getAttribute("pcb"),socso:m[2].getAttribute("socso")}}),b=0,S=0;for(e=0;e<c.length;e++){var n;parseFloat(c[e].amount)>0?(n=new Ge,n.AllowanceId=s.AllowanceId[b],n.AllowanceAmount=parseFloat(c[e].amount),n.Description=c[e].description,n.SubjectionPcb=r(c[e].pcb),n.SubjectionEis=r(c[e].eis),n.SubjectionHrdf=r(c[e].hrdf),n.SubjectionSocso=r(c[e].socso),n.SubjectionEpf=r(c[e].epf),n.code=c[e].code,b+=1,y.push(n)):parseFloat(c[e].amount)<0&&(n=new _e,n.DeductionId=s.DeductionId[S],n.DeductionAmount=parseFloat(c[e].amount),n.Description=c[e].description,n.code=c[e].code,g.push(n),S+=1)}this.form.AllowanceList.value=y,this.form.DeductionList.value=g}super.save_submitHandler(t)}};z(pe,"PayrollDialog"),pe=we([I.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollDialog")],pe);var ke=class extends Ct{constructor(){super()}};z(ke,"ConcreteMoneyClaimApplicationRow");var Ue=class extends Et{constructor(){super()}};z(Ue,"ConcretePayrollDeductionsRow");var Ye=class extends gt{constructor(){super()}};z(Ye,"ConcretePayrollEarningsRow");var Ge=class extends It{constructor(){super()}};z(Ge,"ConcreteEmployeeAllowanceRow");var _e=class extends Dt{constructor(){super()}};z(_e,"ConcreteFixedDeductionRow");var ze=ye(Qe(),1);var V=ye(Re(),1),q=ye(Re(),1),it=ye(Qe(),1);var Ae=class extends ze.EntityDialog{constructor(){super();this.form=new at(this.idPrefix);Oe.List({},t=>{this.EmployeeData=t.Entities}),Pe.List({},t=>{this.PayrollData=t.Entities})}getFormKey(){return at.formKey}getRowDefinition(){return bt}getService(){return Pt.baseUrl}SearchCallback(){var t=this,e=document.getElementById(this.idPrefix+"PayMonth"),a=document.getElementById(this.idPrefix+"PayYear"),o=document.getElementById(this.idPrefix+"OccupationList"),n=document.getElementById(this.idPrefix+"DepartmentList"),s=document.getElementById(this.idPrefix+"DivisionList"),r=document.getElementById(this.idPrefix+"JobGradeList"),d=document.getElementById(this.idPrefix+"SectionList");if((0,V.isEmptyOrNull)($(e).val())||(0,V.isEmptyOrNull)($(a).val())){this.form.EmployeeRowList.value=this.form.EmployeeRowListBuffer.value="";return}function p(E){let h=$(E).val();return h.length?h.split(",").map(T=>parseInt(T,10)):[]}z(p,"parseListFromElement");let u=p(r),f=p(s),l=p(n),y=p(o),g=p(d),c=new Set(u),b=new Set(f),S=new Set(l),O=new Set(y),m=new Set(g);for(let E of t.EmployeeData){let{JobGradeID:h,DivisionID:T,DepartmentID:H,OccupationID:W,SectionID:Y,Id:B}=E,U=c.has(h)||b.has(T)||S.has(H)||O.has(W)||m.has(Y),k=t.form.EmployeeRowListBuffer.value,F=k?k.split(",").map(Number):[];U?F.includes(B)||F.push(B):F=F.filter(x=>x!==B),t.form.EmployeeRowListBuffer.value=F.join(",")}}SearchEmployeeCallback(){var t=this,e=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),a=$(e).val();let o=a.split(","),n=[];a.length&&o.forEach(S=>{n.push(parseInt(S))});var s=document.getElementById(this.idPrefix+"PayMonth"),r=document.getElementById(this.idPrefix+"PayYear"),d=$(r).val(),p=$(s).val();let u=[];var f=t.form.EmployeeRowListBuffer.value;f.split(",").forEach(S=>{u.push(parseInt(S))});for(var y in t.PayrollData){var g=t.PayrollData[y].EmployeeRowId,c=t.PayrollData[y].PayMonth,b=t.PayrollData[y].PayYear;n.indexOf(g)!==-1&&c==p&&b==d&&(f=t.form.EmployeeRowListBuffer.value,f!=""&&(f.split(",").forEach(O=>{u.push(parseInt(O))}),u=u.filter(O=>O!==t.PayrollData[y].EmployeeRowId),t.form.EmployeeRowListBuffer.value=u.join(",")))}t.form.EmployeeRowList.value=u.join(",")}getToolbarButtons(){var t=this,e=document.getElementById(this.idPrefix+"JobGradeList"),a=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),a.push({title:"Generate Payslips",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if((0,V.isEmptyOrNull)(t.form.PayDate.value)){(0,q.notifyError)("Please enter pay date");return}if((0,V.isEmptyOrNull)(t.form.PayMonth.value)){(0,q.notifyError)("Please enter pay Month");return}if((0,V.isEmptyOrNull)(t.form.PayYear.value)){(0,q.notifyError)("Please enter pay Year");return}if((0,V.isEmptyOrNull)(t.form.PayPeriodEnd.value)){(0,q.notifyError)("Please enter pay period end");return}if((0,V.isEmptyOrNull)(t.form.PayPeriodStart.value)){(0,q.notifyError)("Please enter pay period start");return}var o=t.form.EmployeeRowList.value;let n=[],s=o.split(",");o.length&&s.forEach(r=>{n.push(parseInt(r))}),t.counter=0,t.WaitingCounter=n.length,(0,q.confirm)("Are you sure to generate payslip of these employees?",()=>{function r(u){return new Promise(f=>{let l=new pe(1,u,t.form.PayYear.value,t.form.PayMonth.value,t.form.PayDate.value,t.form.PayPeriodStart.value,t.form.PayPeriodEnd.value);l.element.on("dialogopen",function(){$(".s-PayrollDialog").hide()}),l.dialogOpen(),l.element.on("dialogclose",function(){t.counter+=1,f()})})}z(r,"handleEmployee");function d(){return new Promise(u=>{var f=new $t(o,t.form.PayMonth.value,t.form.PayYear.value);f.dialogOpen(),f.element.on("dialogclose",function(){t.SearchCallback(),u()})})}z(d,"handleDownload");function p(u){return C(this,null,function*(){for(let f=0;f<u.length;f++)yield r(u[f]);t.form.Download.value==!0?yield d():t.SearchCallback()})}z(p,"processEmployees"),console.log(n),p(n),(0,q.notifySuccess)("Payslip generated"),t.form.Download.value==!0&&(0,q.notifySuccess)("Payslip downloaded"),t.form.EmployeeRowListBuffer.value=t.form.EmployeeRowList.value=""})}}),a}dialogOpen(t){super.dialogOpen();var e=this;(0,q.serviceCall)({service:je.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:m=>{e.dateString=m,Me.List({},E=>{var h=new Date(e.dateString),T=h.getMonth(),H=h.getFullYear(),W=0;for(var Y in E.Entities)if(E.Entities[Y].IsActive==1){W=E.Entities[Y].PayDay;break}var B=new Date(H,T,W),U=B.getFullYear().toString(),k=(B.getMonth()+1).toString(),F=B.getDate().toString(),x=new Date(H,T,W);x.setMonth(x.getMonth()-1),x.setDate(x.getDate()-1);var D=x.getFullYear().toString(),M=(x.getMonth()+1).toString(),A=x.getDate().toString(),j=k.padStart(2,"0")+"/"+F.padStart(2,"0")+"/"+U,i=M.padStart(2,"0")+"/"+A.padStart(2,"0")+"/"+D;this.isNew()&&(e.form.PayDate.value=j,e.form.PayPeriodEnd.value=j,e.form.PayPeriodStart.value=i)})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var a=document.getElementById(this.idPrefix+"PayMonth"),o=document.getElementById(this.idPrefix+"PayYear");let n=new it.Select2Editor($(a)),s=new it.Select2Editor($(o)),r=["January","February","March","April","May","June","July","August","September","October","November","December"];var d=new Date(e.dateString),p=d.getFullYear(),u=d.getMonth();for(let m=0;m<r.length;m++)n.addItem({id:m.toString(),text:r[m].toString()});n.set_value(u.toString());for(let m=-1;m<2;m++)s.addItem({id:(p+m).toString(),text:(p+m).toString()});s.set_value(p.toString());var f=document.getElementById(this.idPrefix+"SectionList"),l=document.getElementById(this.idPrefix+"OccupationList"),y=document.getElementById(this.idPrefix+"DepartmentList"),g=document.getElementById(this.idPrefix+"DivisionList"),c=document.getElementById(this.idPrefix+"JobGradeList"),b=document.getElementById(this.idPrefix+"PayPeriodStart"),S=document.getElementById(this.idPrefix+"PayPeriodEnd"),O=document.getElementById(this.idPrefix+"EmployeeRowList");console.log(this.idPrefix),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(m){return C(this,null,function*(){$(".select2-drop").hide()})}),$(a).on("change",function(){return C(this,null,function*(){((0,V.isEmptyOrNull)($(a).val())||(0,V.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(o).on("change",function(){return C(this,null,function*(){((0,V.isEmptyOrNull)($(a).val())||(0,V.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(l).on("change",function(){return C(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(g).on("change",function(){return C(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(c).on("change",function(){return C(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(y).on("change",function(){return C(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(f).on("change",function(){return C(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(b).on("change",function(){return C(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,V.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodStart.value="";return}})}),$(S).on("change",function(){return C(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,V.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodEnd.value="";return}})})}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+100,t}};z(Ae,"PayrollGeneratingWizardDialog"),Ae=we([ze.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGeneratingWizardDialog")],Ae);export{pe as a,Ae as b};
//# sourceMappingURL=chunk-S4PTUC6D.js.map
