import{c as ke,d as Bt}from"./chunk-B4PP3UR2.js";import{c as Ue,d as Ft}from"./chunk-YIP4GR2E.js";import{d as Te,e as At}from"./chunk-5TAMAFA5.js";import{a as Tt}from"./chunk-5V4XT6QF.js";import{G as We}from"./chunk-C6XWQKYL.js";import{c as $e,d as yt}from"./chunk-XZKAQRVI.js";import{A as St,B as Ct,C as Pe,J as Dt,N as It,R as Ot,W as Lt,_ as $t,d as pt,h as vt,l as ft,o as je,p as Et,r as gt,s as ht,w as at,y as it,z as Pt}from"./chunk-JVVTNWA6.js";import{c as be,d as bt}from"./chunk-CICJSBLQ.js";import{d as Ne}from"./chunk-2YAUIENJ.js";import{a as et,b as ct,k as tt,l as mt}from"./chunk-KJR5IZZY.js";import{a as He,b as Le}from"./chunk-2SJ2SYN6.js";import{a as Xe}from"./chunk-DNINIZJD.js";import{c as z,g as pe,h as we,j as S,k as Me}from"./chunk-L3ECGIWB.js";var I=pe(Xe(),1);var Ae=pe(Me(),1);var w=pe(Me(),1);var ve=class extends I.EntityDialog{constructor(t,e,a,o,n,r,d){super();this.form=new at(this.idPrefix);this.ExternalEarnings=[];this.ExternalDeductions=[];this.EarningsString=[];this.DeductionsString=[];this.FinalEarnings=[];this.FinalDeductions=[];this.EmployerContributions=[];this.ListOfEpfSubjection=[];this.ListOfEisSubjection=[];this.ListOfHrdfSubjection=[];this.ListOfSocsoSubjection=[];this.ListOfPcbSubjection=[];this.ListOfCriteria=[];this.NoPaidLeaveId=[];this.MoneyClaimingId=[];this.OtPayId=[];this.LateArrivalId=[];this.EarlyLeavingId=[];this.listOfDicts=[];this.AllowanceId=[];this.DeductionId=[];this.Wiz=t,this.WizEmployeeRowId=e,this.PayYear=a,this.PayMonth=o,this.PayDateWiz=n,this.PayPeriodStart=r,this.PayPeriodEnd=d,this.ReadOnly=!1}getFormKey(){return at.formKey}getRowDefinition(){return Ct}getService(){return Pe.baseUrl}dialogClose(){$("#NewEarningsCategory").remove(),super.dialogClose()}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+550,t}ResetTable(){console.log("reset  table"),$("#AllowanceDeductionBody, #EarningDeductionBody, #MoneyClaimingBody").empty(),$(`#EarlyLeavingRate, #LateArrivalRate, #EarlyLeavingSubtotal, #LateArrivalSubtotal,
        #NplDayRate, #totalOt, #NplHrRate, #AbsentDayRate`).text(0);var t=document.getElementById("Ot1.0x");t&&(t.textContent="0"),t=document.getElementById("Ot1.5x"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0x"),t&&(t.textContent="0"),t=document.getElementById("Ot1.0xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot1.5xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0xValueTotal"),t&&(t.textContent="0"),$(`#OtOnePointFiveTime, #OtTwoTime, #OtOneTime, #TotalSOCSO, #TotalEPF, #Deduction,
        #Allowance, #TotalEIS, #TotalHRD, #TotalTaxableWage, #GrossWage, #EmployerEPF, #EmployeeEPF,
        #EmployerSOCSO, #EmployeeSOCSO, #EmployerEIS, #EmployeeEIS, #HRD, #PCB, #TotalAllowance, #TotalDeduction,
        #EarlyLeavingMinutes,  #LateArrivalMinutes, #GrossWage, #NettWage, #GrossWage, #totalEmployerContribution,
        #totalEmployeeContribution`).val(0)}Setup(){var t=this,e=this.idPrefix+"PropertyGrid",a=document.getElementById(e);console.log(a);var o=document.createElement("DIV");o.classList.add("category-title"),o.setAttribute("id","PayRoll-Description"),o.style.display="flex",a.appendChild(o);var n=document.createElement("a");n.classList.add("category-anchor");var r=document.createTextNode("Employee Payroll");n.appendChild(r),document.getElementById("PayRoll-Description").append(n);var d=document.getElementById("PayRoll-Description");d.insertAdjacentHTML("afterend",'<div class="DataGrid" id="PayRollGrid"></div>');var s=document.getElementById("PayRollGrid");s.style.display="flex";var p=document.createElement("TABLE");p.style.width="66%",p.id="PayrollTable",p.className="table";var m=document.createElement("thead");m.className="thead-dark",m.id="PayrollTableHeader";var f=document.createElement("tbody");f.id="PayrollTableBody";var l=document.createElement("tr"),c=document.createElement("tfoot");c.id="PayrollTableFoot";var g=document.createElement("TH"),y=document.createElement("TH"),b=document.createElement("TH"),C=document.createElement("TH");g.style.width="25%",y.style.width="25%",b.style.width="25%",C.style.width="25%";var L=document.createTextNode("Description"),u=document.createTextNode("Earnings"),E=document.createTextNode("Description"),h=document.createTextNode("Deductions");g.appendChild(L),y.appendChild(u),b.appendChild(E),C.appendChild(h);var T=document.createElement("TABLE");T.style.height="55%",T.id="EmployerContributionsTable";var U=document.createElement("thead");U.className="thead-dark",U.id="EmployerContributionsHeader";var W=document.createElement("tbody");W.id="EmployerContributionsBody";var G=document.createElement("tfoot");G.id="EmployerContributionsFoot";var B=document.createElement("TR"),Y=document.createElement("TH"),N=document.createElement("TH");Y.style.width="50%",N.style.width="50%";var R=document.createTextNode("Description"),k=document.createTextNode("Employer Contributions");Y.appendChild(R),N.appendChild(k),l.appendChild(g),l.appendChild(y),l.appendChild(b),l.appendChild(C),m.appendChild(l),p.appendChild(m),p.appendChild(f),p.appendChild(c),B.appendChild(Y),B.appendChild(N),U.appendChild(B),T.appendChild(U),T.appendChild(W),T.appendChild(G);var M=document.createElement("div");M.className="col-md-6",M.id="left";var D=document.createElement("div");D.id="NplAbsentTableContainer",M.appendChild(D);var F=document.createElement("div");F.id="OvertimeTableContainer",M.appendChild(F);var A=document.createElement("div");A.id="EarlyLeavingTableContainer",M.appendChild(A);var H=document.createElement("table");H.id="NplAbsentTable";var i=document.createElement("thead");i.innerHTML=`
      <tr>
        <th rowspan="2">NPL/Absent</th>
        <th colspan="3" id="totalNplAbsentDeduction">
            <span>Total:</span> <span id="totalNplAbsent">0</span>
        </th>
      </tr>
      `,H.appendChild(i);var le=[{label:"NPL Day",id:"NplDayRate",inputId:"NplDay",valueId:"NplDayValue",value:0,total:0,adjustment:0},{label:"NPL Hourly",id:"NplHrRate",inputId:"NplHr",valueId:"NplHrValue",value:0,total:0,adjustment:0},{label:"Absent Day",id:"AbsentDayRate",inputId:"AbsentDay",valueId:"AbsentDayValue",value:0,total:0,adjustment:0}];let J=document.createElement("tbody");J.id="NplAbsentTableBody",le.forEach(O=>{let ae=document.createElement("tr");ae.innerHTML=`
        <td class="Description">${O.label}</td>
        <td class="rates"> <span class="ratesValue" id = ${O.id} > ${O.value} </span> </td>
        <td class ="numberInputContainer"> <input id = ${O.inputId} min="0" class="nplDates numberInput" type="number" value="${O.total.toFixed(2)}" ></td>
        <td class ="subTotalContainer">  <span id = ${O.valueId} class="subTotal">0.00</span> </td>
      `,J.appendChild(ae)}),H.appendChild(J),D.appendChild(H);var ee=document.createElement("table");ee.id="OvertimeTable";var oe=document.createElement("thead");oe.innerHTML=`
      <tr>
        <th rowspan="2">Overtime</th>
        <th colspan="3" id="OvertimeAddition">
            <span>Total:</span> <span id="totalOt">0</span>
        </th>
      </tr>
      `,ee.appendChild(oe);var ce=[{label:"OT1.0x",descId:"flatOtDesc",id:"Ot1.0x",valueId:"Ot1.0xValue",inputId:"OtOneTime",value:0,total:0,adjustment:0},{label:"OT1.5x",descId:"OnePointFiveOtDesc",id:"Ot1.5x",valueId:"Ot1.5xValue",inputId:"OtOnePointFiveTime",value:0,total:0,adjustment:0},{label:"OT2.0x",descId:"TwoOtDesc",id:"Ot2.0x",valueId:"Ot2.0xValue",inputId:"OtTwoTime",value:0,total:0,adjustment:0}];let re=document.createElement("tbody");re.id="OvertimeTableBody",ce.forEach(O=>{let ae=document.createElement("tr");ae.innerHTML=`
        <td class="Description" id=${O.descId}>${O.label}</td>
        <td class="rates"> <span class="ratesValue" id=${O.id}> ${O.value} </span> </td>
        <td class ="numberInputContainer"> <input id=${O.inputId} min="0" class="overtime numberInput" type="number" value="${O.total.toFixed(2)}" ></td>
        <td>  <span class="subTotal" id=${O.valueId}Total>0.00</span> </td>
      `,re.appendChild(ae)}),ee.appendChild(re),F.appendChild(ee);var j=document.createElement("table");j.id="EarlyLeavingTable";var Ce=document.createElement("thead");Ce.innerHTML=`
      <tr>
        <th rowspan="2">Time Deduction</th>
        <th colspan="3" id="ShiftAddition">
            <span>Total:</span> <span id="totalTimeDeduction">0</span>
        </th>
      </tr>
      `,j.appendChild(Ce);var qe=[{label:"Early Leaving",Minutes:"EarlyLeavingMinutes",RateId:"EarlyLeavingRate",SubtotalId:"EarlyLeavingSubtotal",total:0,adjustment:0},{label:"Late Arrival",Minutes:"LateArrivalMinutes",RateId:"LateArrivalRate",SubtotalId:"LateArrivalSubtotal",total:0,adjustment:0}];let De=document.createElement("tbody");De.id="EarlyLeavingTableBody",qe.forEach(O=>{let ae=document.createElement("tr");ae.innerHTML=`
        <td class="Description">${O.label}</td>
        <td class="rates"> <span id=${O.RateId} class="ratesValue">0</span> </td>
        <td class ="numberInputContainer"> <input min="0" id=${O.Minutes} class="time numberInput" type="number" value="${O.total.toString()}" ></td>
        <td>  <span class="subTotal"  id=${O.SubtotalId} >0.00</span> </td>
      `,De.appendChild(ae)}),j.appendChild(De),A.appendChild(j);var x=document.createElement("div");x.className="col-md-4",x.id="center";var _=document.createElement("div");_.id="AllowanceDeductionContainer",x.appendChild(_);var me=document.createElement("table");me.id="AllowanceDeductionTable";var Fe=document.createElement("thead");Fe.innerHTML=`
      <tr>
        <th colspan="3">Allowance/Deduction</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,me.appendChild(Fe);let lt=document.createElement("tbody");lt.id="AllowanceDeductionBody",me.appendChild(lt),_.appendChild(me);var v=document.createElement("div");v.id="MoneyClaimingContainer",x.appendChild(v);var K=document.createElement("table");K.id="MoneyClaimingTable";var P=document.createElement("thead");P.innerHTML=`
      <tr>
        <th colspan="3">Money Claiming</th>
      </tr>
      <tr>
        <th>Category</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,K.appendChild(P);let Ee=document.createElement("tbody");Ee.id="MoneyClaimingBody",K.appendChild(Ee),v.appendChild(K);var Ie=document.createElement("div");Ie.id="EarningDeductionContainer",x.appendChild(Ie);var ye=document.createElement("table");ye.id="EarningDeductionTable";var ge=document.createElement("thead");ge.innerHTML=`
      <tr>
        <th colspan="3">Extra Earnings/Deductions</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,ye.appendChild(ge);let xe=document.createElement("tbody");xe.id="EarningDeductionBody",ye.appendChild(xe),Ie.appendChild(ye);var te=document.createElement("div");te.className="col-md-2 section",te.id="right";let Je=`
      <h3>Statutory Contribution</h3>
      <table class = "StatutoryContribution">

        <tr>
          <td></td>
          <td>Employer</td>
          <td>Employee</td>
        </tr>

        <tr>
          <td>EPF</td>
          <td><input class="govPayment" id="EmployerEPF" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEPF" type="number" value="0.0" ></td>
        </tr>

        
        <tr>
          <td>SOCSO </td>
          <td><input class="govPayment" id="EmployerSOCSO" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeSOCSO" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>EIS </td>
          <td><input class="govPayment" id="EmployerEIS" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEIS" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>HRD</td>
          <td><input class="govPayment" id="HRD" type="number" value="0.0" ></td>
          <td></td>
        </tr>

        <tr>
          <td>PCB</td>
           <td></td>
          <td><input class="govPayment" id="PCB" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>Total</td>
          <td><input class="govPayment" id="totalEmployerContribution" type="number" value="0.0" readonly></td>
          <td><input class="govPayment" id="totalEmployeeContribution" type="number" value="0.0" readonly></td>
        </tr>


      </table>
    `,Ke=`
      <h3>Total Wages</h3>
      <table class = "TotalWages" >
        <tr>
          <td>Total Allowance</td>
          <td><input id="TotalAllowance" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Deduction</td>
          <td><input id="TotalDeduction" type="number" value="0.00" readonly></td>
        </tr>
        <tr>
          <td>EPF Wage</td>
          <td><input id="TotalEPF" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>HRD Wage</td>
          <td><input id="TotalHRD" type="number" value="0.0" readonly></td>
        </tr>



        <tr>
          <td>SOCSO Wage</td>
          <td><input id="TotalSOCSO" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>EIS Wage</td>
          <td><input id="TotalEIS" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Taxable Wage</td>
          <td><input id="TotalTaxableWage" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Gross Wage</td>
          <td><input id="GrossWage"  type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Nett Wage</td>
          <td><input id="NettWage" type="number" value="0.0" readonly></td>
        </tr>
      </table>
    `;var _=document.createElement("div");_.id="AllowanceDeductionContainer",_.className="section",_.innerHTML=Je,te.appendChild(_);var Z=document.createElement("div");Z.id="Container2",Z.className="section",Z.innerHTML=Ke,te.appendChild(Z),document.getElementById("PayRollGrid").append(M),document.getElementById("PayRollGrid").append(x),document.getElementById("PayRollGrid").append(te);var de=document.getElementsByClassName("govPayment");$(de).on("change",function(O){return S(this,null,function*(){t.updateWages()})});var se=document.getElementsByClassName("numberInput");$(se).on("change",function(O){return S(this,null,function*(){t.updateTotals()})})}onDialogOpen(){super.onDialogOpen();var t=this;Lt.List({},e=>{for(var a in e.Entities)if(e.Entities[a].IsActive==1){for(var o=e.Entities[a],n=Object.keys(o),r=0;r<n.length;r++){var d=n[r];if(!(d.toLowerCase()=="id"||d.toLowerCase()=="isactive")&&!(o[d]!=!0&&o[d]!=!1&&o[d]!==void 0)){var s=d.replace(/([A-Z])/g," $1").trim();this.ListOfPcbSubjection.push({id:r,name:s,subjection:o[d]})}}break}vt.List({},p=>{for(var m in p.Entities)if(p.Entities[m].IsActive==1){for(var f=p.Entities[m],b=Object.keys(f),l=0;l<b.length;l++){var c=b[l];if(!(c.toLowerCase()=="id"||c.toLowerCase()=="isactive")&&!(f[c]!=!0&&f[c]!=!1&&f[c]!==void 0)){var g=c.replace(/([A-Z])/g," $1").trim();this.ListOfEpfSubjection.push({id:l,name:g,subjection:f[c]})}}break}for(var y=this.ListOfEpfSubjection,b=Object.keys(y),l=0;l<b.length;l++){var c=b[l];this.ListOfCriteria.push(y[c].name)}pt.List({},C=>{for(var L in C.Entities)if(C.Entities[L].IsActive==1){for(var u=C.Entities[L],E=Object.keys(u),h=0;h<E.length;h++){var T=E[h];if(!(T.toLowerCase()=="id"||T.toLowerCase()=="isactive")&&!(u[T]!=!0&&u[T]!=!1&&u[T]!==void 0)){var U=T.replace(/([A-Z])/g," $1").trim();this.ListOfEisSubjection.push({id:h,name:U,subjection:u[T]})}}break}ft.List({},W=>{for(var G in W.Entities)if(W.Entities[G].IsActive==1){for(var B=W.Entities[G],Y=Object.keys(B),N=0;N<Y.length;N++){var R=Y[N];if(!(R.toLowerCase()=="id"||R.toLowerCase()=="isactive")&&!(B[R]!=!0&&B[R]!=!1&&B[R]!==void 0)){var k=R.replace(/([A-Z])/g," $1").trim();this.ListOfHrdfSubjection.push({id:N,name:k,subjection:B[R]})}}break}$t.List({},M=>{for(var D in M.Entities)if(M.Entities[D].IsActive==1){for(var F=M.Entities[D],A=Object.keys(F),H=0;H<A.length;H++){var i=A[H];if(!(i.toLowerCase()=="id"||i.toLowerCase()=="isactive")&&!(F[i]!=!0&&F[i]!=!1&&F[i]!==void 0)){var le=i.replace(/([A-Z])/g," $1").trim();this.ListOfSocsoSubjection.push({id:H,name:le,subjection:F[i]})}}break}if(this.isNew()){var J="Overtime Payments",ee=this.CheckSubjection(this.ListOfEisSubjection,J),oe=this.CheckSubjection(this.ListOfEpfSubjection,J),ce=this.CheckSubjection(this.ListOfHrdfSubjection,J),re=this.CheckSubjection(this.ListOfPcbSubjection,J),j=this.CheckSubjection(this.ListOfSocsoSubjection,J);t.form.OtSubjectEis.value=ee==1,t.form.OtSubjectEpf.value=oe==1,t.form.OtSubjectHrdf.value=ce==1,t.form.OtSubjectPcb.value=re==1,t.form.OtSubjectSocso.value=j==1,$("#totalOt").attr("eis",ee),$("#totalOt").attr("epf",oe),$("#totalOt").attr("hrdf",ce),$("#totalOt").attr("pcb",re),$("#totalOt").attr("socso",j)}})})})})})}calculateAge(){let t=new Date(this.dateString),e=new Date(this.form.BirthDay.value),a=t.getFullYear()-e.getFullYear(),o=new Date(t.getFullYear(),e.getMonth(),e.getDate());t<o&&o.setFullYear(o.getFullYear()-1);let n=t.getTime()-o.getTime(),r=new Date(o);r.setFullYear(r.getFullYear()+1);let d=r.getTime()-o.getTime(),s=n/d;return a+s}dialogOpen(t){$(".field.BasicPay, .field.DailyPay, .field.DailyRate, .field.DaysWorked, .field.HourlyRate, .field.BirthDay, .field.Age").addClass("col-md-2"),$(" .field.WorkingSpouse").addClass("col-md-1"),$(".field.HrdfClass").addClass("col-md-2"),$(" .field.ChildrenUnderEighteen, .field.ChildrenInUniversity, .field.DisabledChildInUniversity, .field.DisabledChild").addClass("col-md-2"),$(".field.MaritalStatus").addClass("col-md-3"),$(`.field.MaritalStatus label.caption, .field.WorkingSpouse label.caption, .field.ChildrenUnderEighteen label.caption, .field.ChildrenInUniversity label.caption,
        .field.DisabledChildInUniversity label.caption, .field.DisabledChild label.caption, .field.Age label.caption, .field.BirthDay label.caption, .field.HrdfClass label.caption`).removeClass("caption"),this.ResetTable(),$(".field.EisClass").addClass("col-md-2"),$(".field.SocsoClass").addClass("col-md-6"),$(".field.EpfClass").addClass("col-md-3"),$(".field.TaxClass").addClass("col-md-1"),$(`.field.BasicPay label.caption, .field.DailyPay label.caption, .field.DailyRate label.caption, .field.DaysWorked label.caption,
        .field.HourlyRate label.caption, .field.EisClass label.caption, .field.SocsoClass label.caption, .field.EpfClass label.caption, .field.TaxClass label.caption `).removeClass("caption"),I.EditorUtils.setReadonly(this.form.BasicPay.element,!0),I.EditorUtils.setReadonly(this.form.DaysWorked.element,!0),I.EditorUtils.setReadonly(this.form.HourlyRate.element,!0),I.EditorUtils.setReadonly(this.form.DailyRate.element,!0),I.EditorUtils.setReadonly(this.form.TaxClass.element,!0),I.EditorUtils.setReadonly(this.form.Age.element,!0),I.EditorUtils.setReadonly(this.form.BirthDay.element,!0),this.form.EpfClass.value=1 .valueOf().toString(),$(`.DeductedEarlyLeavingList, .OneTimeDeductionList, .DeductedNoPaidLeaveList,
        .DeductedLateArrivalList, .OneTimeAllowanceList, .PaidMoneyClaimingList, .PaidOtList, .EarlyLeavingRate, .LateArrivalRate, .EarlyLeaving,
        .LateArrival, .FlatOt, .OtOne, .OtOnePointFive, .OtTwo, .NPLHourlyRate, .NPLDailyRate, .NPLHourly, .NPLDaily, .AbsentDailyRate, .AbsentDaily,
        .OtSubjectEpf, .OtSubjectEis, .OtSubjectPcb, .OtSubjectSocso, .OtSubjectHrdf, .AllowanceList, .DeductionList, .OtOnePointFiveRate, .OtTwoRate, .HrdfClass`).hide();function e(s){let p=new Date(s);if(isNaN(p.getTime()))return s;{p.setDate(28);let m=p.getFullYear(),f=("0"+(p.getMonth()+1)).slice(-2),l=("0"+p.getDate()).slice(-2);return`${m}-${f}-${l}`}}z(e,"isValidDate");var a=this,o=!0;for((0,Ae.serviceCall)({service:We.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:s=>{a.dateString=s,o=!1}});o==!0;);Ne.List({},s=>{for(var p in s.Entities)if(s.Entities[p].IsActive==1){this.DeductEarlyLeaving=s.Entities[p].DeductSalaryIfEarlyLeaving,this.DeductLateArrival=s.Entities[p].DeductSalaryIfLate,this.PayDate=s.Entities[p].PayDay,a.PublicHolidayMultiplier=s.Entities[p].PublicHolidayOnePointFive==!0?1.5:2,a.WeekendMultiplier=s.Entities[p].WeekendOnePointFive==!0?1.5:2,a.WeekdayMultiplier=s.Entities[p].WeekdayOnePointFive==!0?1.5:2;break}var m=new Date(a.dateString),f=m.getMonth(),l=m.getFullYear(),c=l.toString()+"-"+f.toString().padStart(2,"0")+"-"+this.PayDate.toString().padStart(2,"0");c=e(c);var g=new Date(l,f,this.PayDate),y=g.getFullYear().toString(),b=(g.getMonth()+1).toString(),C=g.getDate().toString(),L=new Date(l,f,this.PayDate);L.setMonth(L.getMonth()-1),L.setDate(L.getDate()-1);var u=L.getFullYear().toString(),E=(L.getMonth()+1).toString(),h=L.getDate().toString(),T=b.padStart(2,"0")+"/"+C.padStart(2,"0")+"/"+y,U=E.padStart(2,"0")+"/"+h.padStart(2,"0")+"/"+u;this.isNew()&&(a.form.PayDate.value=T,a.form.PayPeriodEnd.value=T,a.form.PayPeriodStart.value=U)}),super.dialogOpen(t),a.isNew()&&this.applyChangesButton.hide(),I.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var n=this.form.EmployeeRowId.value;let r=["Deduction","Earnings","Nett","EmployeeEIS","EmployeeEPF","EmployeeSOCSO","EmployeePCB","PayrollTable","EmployerTable","EmployerHRDF","EmployerEPF","EmployerEIS","EmployerSOCSO"];for(var d in r)$("."+r[d]).hide();this.Setup(),Le.List({},s=>{var p=document.getElementById(this.idPrefix+"PayPeriodStart"),m=document.getElementById(this.idPrefix+"PayPeriodEnd"),f=document.getElementById(this.idPrefix+"EmployeeRowId"),l=document.getElementById(this.idPrefix+"PayMonth"),c=document.getElementById(this.idPrefix+"PayYear"),g=document.getElementById(this.idPrefix+"HrdfClass"),y=document.getElementById(this.idPrefix+"EisClass"),b=document.getElementById(this.idPrefix+"SocsoClass"),C=document.getElementById(this.idPrefix+"EpfClass"),L=document.getElementById(this.idPrefix+"MaritalStatus"),u=document.getElementById(this.idPrefix+"WorkingSpouse"),E=document.getElementById(this.idPrefix+"ChildrenUnderEighteen"),h=document.getElementById(this.idPrefix+"ChildrenInUniversity"),T=document.getElementById(this.idPrefix+"DisabledChild"),U=document.getElementById(this.idPrefix+"DisabledChildInUniversity");let W=new I.Select2Editor($(l)),G=new I.Select2Editor($(c)),B=["January","February","March","April","May","June","July","August","September","October","November","December"];var Y=new Date(a.dateString),N=Y.getFullYear(),R=Y.getMonth();for(let i=0;i<B.length;i++)W.addItem({id:i.toString(),text:B[i].toString()});a.isNew()&&W.set_value(R.toString());for(let i=-1;i<2;i++)G.addItem({id:(N+i).toString(),text:(N+i).toString()});a.isNew()&&G.set_value(N.toString());let k=new I.Select2Editor($(f)),M=[];for(var D in s.Entities)k.addItem({id:s.Entities[D].Id.toString(),text:s.Entities[D].EmployeeID.toString()}),M.push({id:s.Entities[D].Id,name:s.Entities[D].EmployeeName,BasicPay:s.Entities[D].BasicSalary,Allowance:s.Entities[D].Allowance,type:s.Entities[D].EmployeeType,EisClass:s.Entities[D].EisClass,EpfClass:s.Entities[D].EpfClass,SocsoClass:s.Entities[D].SocsoClass,MaritalStatus:s.Entities[D].MaritalStatus,WorkingSpouse:s.Entities[D].WorkingSpouse,ChildrenUnderEighteen:s.Entities[D].ChildrenUnderEighteen,ChildrenInUniversity:s.Entities[D].ChildrenInUniversity,DisabledChildInUniversity:s.Entities[D].DisabledChildInUniversity,DisabledChild:s.Entities[D].DisabledChild,Birthday:s.Entities[D].Birthday,HrdfClass:s.Entities[D].HRDFClass});if(this.listOfDicts=M,a.isNew()&&$(f).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),a.Wiz!=1&&($(y).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(b).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(g).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(C).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(u).on("change",function(i){return S(this,null,function*(){console.log("haha"),i.stopImmediatePropagation(),a.updatePayroll()})}),$(E).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(L).on("change",function(i){return S(this,null,function*(){console.log("hhaa"),parseInt(a.form.MaritalStatus.value)==1 .valueOf()?$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").show():parseInt(a.form.MaritalStatus.value)==0 .valueOf()&&$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").hide()})}),$(h).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(T).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})}),$(U).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.updatePayroll()})})),this.isNew())$(l).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(c).on("change",function(i){return S(this,null,function*(){i.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(p).on("change",function(i){return S(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,w.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodStart.value="";return}a.GeneratePayrollTable(0)})}),$(m).on("change",function(i){return S(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,w.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodEnd.value="";return}a.GeneratePayrollTable(0)})}),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.addEarnings, .field.addDeductions,
        .field.BirthDay, .field.Age,  .addEarnings, .addDeductions`).hide();else if(!this.isNew()){I.EditorUtils.setReadonly(this.form.PayMonth.element,!0),I.EditorUtils.setReadonly(this.form.PayYear.element,!0),I.EditorUtils.setReadonly(this.form.PayDate.element,!0),I.EditorUtils.setReadonly(this.form.PayPeriodEnd.element,!0),I.EditorUtils.setReadonly(this.form.PayPeriodStart.element,!0),$(c).val(this.form.PayYear.value).trigger("change"),$(l).val(this.form.PayMonth.value).trigger("change");for(var D in M)M[D].id==parseInt(n)&&(this.EmployeeType=M[D].type);$(f).val(n.toString()).trigger("change"),I.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),$("#PCB").val(this.form.EmployeePCB.value),$("#EmployeeEIS").val(this.form.EmployeeEIS.value),$("#EmployeeEPF").val(this.form.EmployeeEPF.value),$("#EmployeeSOCSO").val(this.form.EmployeeSOCSO.value),$("#EmployerEIS").val(this.form.EmployerEIS.value),$("#EmployerEPF").val(this.form.EmployerEPF.value),$("#HRD").val(this.form.EmployerHRDF.value),$("#EmployerSOCSO").val(this.form.EmployerSOCSO.value),$("#NplDayRate").text(this.form.NPLDailyRate.value),$("#NplHrRate").text(this.form.NPLHourlyRate.value),$("#AbsentDayRate").text(this.form.AbsentDailyRate.value),$("#NplDay").val(this.form.NPLDaily.value),$("#NplHr").val(this.form.NPLHourly.value),$("#AbsentDay").val(this.form.AbsentDaily.value),document.getElementById("Ot1.0x").textContent=this.form.FlatOt.value.toString(),document.getElementById("Ot1.5x").textContent=this.form.OtOnePointFiveRate.value.toString(),document.getElementById("Ot2.0x").textContent=this.form.OtTwoRate.value.toString(),$("#OtOneTime").val(this.form.OtOne.value),$("#OtOnePointFiveTime").val(this.form.OtOnePointFive.value),$("#OtTwoTime").val(this.form.OtTwo.value),$("#EarlyLeavingRate").text(this.form.EarlyLeavingRate.value),$("#LateArrivalRate").text(this.form.LateArrivalRate.value),$("#EarlyLeavingMinutes").val(this.form.EarlyLeaving.value),$("#LateArrivalMinutes").val(this.form.LateArrival.value),$("#totalOt").attr("eis",a.form.OtSubjectEis.value.toString()),$("#totalOt").attr("epf",a.form.OtSubjectEpf.value.toString()),$("#totalOt").attr("hrdf",a.form.OtSubjectHrdf.value.toString()),$("#totalOt").attr("pcb",a.form.OtSubjectPcb.value.toString()),$("#totalOt").attr("socso",a.form.OtSubjectSocso.value.toString());let i=0;for(i=0;i<this.form.AllowanceList.value.length;i++){var F=document.createElement("tr");F.innerHTML=`<td>${this.form.AllowanceList.value[i].code}</td><td>${this.form.AllowanceList.value[i].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${this.form.AllowanceList.value[i].SubjectionEis.toString()} epf =  ${this.form.AllowanceList.value[i].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.AllowanceList.value[i].SubjectionHrdf.toString()} pcb =  ${this.form.AllowanceList.value[i].SubjectionPcb.toString()}
                                                socso =  ${this.form.AllowanceList.value[i].SubjectionSocso.toString()} 
                                            >${this.form.AllowanceList.value[i].AllowanceAmount}</td>`,$("#AllowanceDeductionBody").append(F)}for(i=0;i<this.form.DeductionList.value.length;i++){var F=document.createElement("tr");F.innerHTML=`<td>${this.form.DeductionList.value[i].code}</td><td>${this.form.DeductionList.value[i].Description}</td><td class = "DeductionAmount">${this.form.DeductionList.value[i].DeductionAmount}</td>`,$("#AllowanceDeductionBody").append(F)}for(i=0;i<this.form.PaidMoneyClaimingList.value.length;i++){var F=document.createElement("tr");F.innerHTML=`<td>${this.form.PaidMoneyClaimingList.value[i].ClaimingCategory}</td><td>${this.form.PaidMoneyClaimingList.value[i].Description}</td>
                                            <td  eis =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionEis.toString()} epf =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionHrdf.toString()} pcb =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionPcb.toString()}
                                                socso =  ${this.form.PaidMoneyClaimingList.value[i].SubjectionSocso.toString()} 
                                            >${this.form.PaidMoneyClaimingList.value[i].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(F)}for(i=0;i<this.form.PayrollEarnings.value.length;i++){var A=this.form.PayrollEarnings.value[i],H=document.createElement("tr"),H=document.createElement("tr");H.innerHTML=`<td> <span>${A.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${A.SubjectionToEis} epf = ${A.SubjectionToEpf} hrdf = ${A.SubjectionToHrdf}
                             pcb = ${A.SubjectionToPcb} socso = ${A.SubjectionToSocso}  value = ${A.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(H)}for(i=0;i<this.form.PayrollDeductions.value.length;i++){A=this.form.PayrollDeductions.value[i];var H=document.createElement("tr");H.innerHTML=`<td>${A.DeductionCode}  <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" max="0"  value = "${A.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(H)}$(".remove").on("click",function(le){return S(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(le){return S(this,null,function*(){a.updatePayroll()})}),a.updateTotals(),a.updatePayroll()}a.Wiz==1&&(a.form.EmployeeRowId.value=a.WizEmployeeRowId.toString(),a.form.PayMonth.value=a.PayMonth,a.form.PayYear.value=a.PayYear,a.form.PayPeriodStart.value=a.PayPeriodStart,a.form.PayPeriodEnd.value=a.PayPeriodEnd,a.form.PayDate.value=a.PayDateWiz)})}updatePayroll(){var t=this;if(this.extraEarningDeduction=0,(0,w.isEmptyOrNull)(t.form.EpfClass.value)||(0,w.isEmptyOrNull)(t.form.EisClass.value)||(0,w.isEmptyOrNull)(t.form.SocsoClass.value)||(0,w.isEmptyOrNull)(t.form.WorkingSpouse.value)||(0,w.isEmptyOrNull)(t.form.ChildrenUnderEighteen.value)||(0,w.isEmptyOrNull)(t.form.ChildrenInUniversity.value)||(0,w.isEmptyOrNull)(t.form.DisabledChild.value)||(0,w.isEmptyOrNull)(t.form.DisabledChildInUniversity.value))return;var e=this.form.BasicPay.value,a=parseFloat(document.getElementById("totalNplAbsent").innerHTML),o=parseFloat(document.getElementById("totalTimeDeduction").innerHTML),n=document.getElementById("totalOt"),r=parseFloat(n.innerHTML);let d=a+o,s=0,p=0,m=0,f=0,l=0,c=0,g=0,y=document.getElementById("AllowanceDeductionBody");y&&Array.from(y.rows).forEach(u=>{let E=u.cells[2],h=parseFloat(E.innerText.trim())||0;h>0?s+=h:h<0&&(p+=h),E.getAttribute("eis")==="true"&&(m+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(c+=h),E.getAttribute("socso")==="true"&&(g+=h)}),$("#TotalAllowance").val(s),$("#TotalDeduction").val(p);let b=document.getElementById("MoneyClaimingBody");b&&Array.from(b.rows).forEach(u=>{let E=u.cells[2],h=parseFloat(E.innerText.trim())||0;t.extraEarningDeduction+=h,E.getAttribute("eis")==="true"&&(m+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(c+=h),E.getAttribute("socso")==="true"&&(g+=h)});let C=document.getElementById("EarningDeductionBody");C&&Array.from(C.rows).forEach(u=>{console.log(u);let E=u.querySelector("input.numberInput"),h=parseFloat(E.value)||0;t.extraEarningDeduction+=h,E.getAttribute("eis")==="true"&&(m+=h),E.getAttribute("epf")==="true"&&(f+=h),E.getAttribute("hrdf")==="true"&&(l+=h),E.getAttribute("pcb")==="true"&&(c+=h),E.getAttribute("socso")==="true"&&(g+=h)}),n.getAttribute("eis")==="true"&&(m+=r),n.getAttribute("epf")==="true"&&(f+=r),n.getAttribute("hrdf")==="true"&&(l+=r),n.getAttribute("pcb")==="true"&&(c+=r),n.getAttribute("socso")==="true"&&(g+=r),m+=e,f+=e,l+=e,c+=e,g+=e,m-=d,f-=d,l-=d,c-=d,g-=d,$("#TotalEPF").val(f.toFixed(2)),$("#TotalHRD").val(l.toFixed(2)),$("#TotalSOCSO").val(g.toFixed(2)),$("#TotalEIS").val(m.toFixed(2)),$("#TotalTaxableWage").val(c.toFixed(2));var L=t.form.WorkingSpouse.value==!0?1:0;(0,Ae.serviceCall)({service:Pe.baseUrl+"/CalculateGovernmentPaymentSpecial",method:"GET",data:{EisCategory:t.form.EisClass.value,EpfCategory:t.form.EpfClass.value,SocsoCategory:t.form.SocsoClass.value,HrdfCategory:t.form.HrdfClass.value,EpfAmount:f,EisAmount:m,SocsoAmount:g,PcbAmount:c,HrdfAmount:l,WorkingSpouse:L,ChildrenUnderEighteen:t.form.ChildrenUnderEighteen.value,ChildrenInUniversity:t.form.ChildrenInUniversity.value,NumberOfDisabledChild:t.form.DisabledChild.value,NumberOfDisabledChildInUni:t.form.DisabledChildInUniversity.value},async:!1,onSuccess:u=>{t.EmployerContributions.length=0,t.form.TaxClass.value=u.Entities[0].TaxClass,$("#EmployeeEPF").val(u.Entities[0].EmployeeEPF.toFixed(2)),$("#EmployeeEIS").val(u.Entities[0].EmployeeEIS.toFixed(2)),$("#PCB").val(u.Entities[0].EmployeePCB.toFixed(2)),$("#EmployeeSOCSO").val(u.Entities[0].EmployeeSOCSO.toFixed(2)),$("#EmployerEPF").val(u.Entities[0].EmployerEPF.toFixed(2)),$("#EmployerEIS").val(u.Entities[0].EmployerEIS.toFixed(2)),$("#HRD").val(u.Entities[0].EmployerHRDF.toFixed(2)),$("#EmployerSOCSO").val(u.Entities[0].EmployerSOCSO.toFixed(2)),t.updateWages()}})}updateTotals(){let t=parseFloat(document.getElementById("NplDayRate").textContent),e=parseFloat(document.getElementById("NplHrRate").textContent),a=parseFloat(document.getElementById("AbsentDayRate").textContent),o=parseFloat(document.getElementById("NplDay").value)||0,n=parseFloat(document.getElementById("NplHr").value)||0,r=parseFloat(document.getElementById("AbsentDay").value)||0;document.getElementById("NplDayValue").textContent=(t*o).toFixed(2),document.getElementById("NplHrValue").textContent=(e*n).toFixed(2),document.getElementById("AbsentDayValue").textContent=(a*r).toFixed(2);let d=t*o+e*n+a*r;document.getElementById("totalNplAbsent").textContent=d.toFixed(2);let s=parseFloat(document.getElementById("Ot1.0x").textContent),p=parseFloat(document.getElementById("Ot1.5x").textContent),m=parseFloat(document.getElementById("Ot2.0x").textContent),f=parseFloat(document.getElementById("OtOneTime").value)||0,l=parseFloat(document.getElementById("OtOnePointFiveTime").value)||0,c=parseFloat(document.getElementById("OtTwoTime").value)||0;document.getElementById("Ot1.0xValueTotal").textContent=(s*f).toFixed(2),document.getElementById("Ot1.5xValueTotal").textContent=(p*l).toFixed(2),document.getElementById("Ot2.0xValueTotal").textContent=(m*c).toFixed(2);let g=s*f+p*l+m*c;document.getElementById("totalOt").textContent=g.toFixed(2);let y=parseFloat(document.getElementById("EarlyLeavingRate").textContent),b=parseFloat(document.getElementById("LateArrivalRate").textContent),C=parseFloat(document.getElementById("EarlyLeavingMinutes").value)||0,L=parseFloat(document.getElementById("LateArrivalMinutes").value)||0;document.getElementById("EarlyLeavingSubtotal").textContent=(y*C).toFixed(2),document.getElementById("LateArrivalSubtotal").textContent=(b*L).toFixed(2);let u=y*C+b*L;document.getElementById("totalTimeDeduction").textContent=u.toFixed(2)}updateWages(){var t=this.form.BasicPay.value,e=parseFloat($("#TotalAllowance").val()),a=parseFloat($("#TotalDeduction").val()),o=parseFloat($("#totalOt").text()),n=0;document.getElementById("totalNplAbsent")&&(n=parseFloat(document.getElementById("totalNplAbsent").innerHTML));var r=0;document.getElementById("totalTimeDeduction")&&(r=parseFloat(document.getElementById("totalTimeDeduction").innerHTML));var d=t+e+o+this.extraEarningDeduction-a-n-r;$("#GrossWage").val(d.toFixed(2));let s=parseFloat($("#EmployeeEPF").val())+parseFloat($("#EmployeeSOCSO").val())+parseFloat($("#EmployeeEIS").val())+parseFloat($("#PCB").val()),p=parseFloat($("#EmployerEPF").val())+parseFloat($("#EmployerEIS").val())+parseFloat($("#EmployerSOCSO").val());$("#totalEmployeeContribution").val(s.toFixed(2)),$("#totalEmployerContribution").val(p.toFixed(2));let m=d-s;$("#NettWage").val(m.toFixed(2)),this.Wiz==1&&this.saveAndCloseButton.click()}GeneratePayrollTable(t){var e=this;e.Wiz!=1&&e.ResetTable();var a=document.getElementById("PayrollTable"),o=document.getElementById(this.idPrefix+"EmployeeRowId"),n=document.getElementById(this.idPrefix+"PayMonth"),r=document.getElementById(this.idPrefix+"PayYear"),d=document.getElementById(this.idPrefix+"EmployeeName"),s=this.ExternalDeductions,p=this.ExternalEarnings,m=this.EarningsString,f=this.DeductionsString,l=e.listOfDicts;if((0,w.isEmptyOrNull)($(o).val()))e.form.EmployeeName.value="";else for(var c in l)l[c].id==$(o).val()&&$(d).val(l[c].name);if((0,w.isEmptyOrNull)($(o).val())||(0,w.isEmptyOrNull)($(n).val())||(0,w.isEmptyOrNull)($(r).val())){$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .addEarnings, .addDeductions,
        .field.BirthDay, .field.Age`).hide();return}else{if(t==1){var g=e.form.PayYear.value,y=e.form.PayMonth.value,b=new Date(g,y,this.PayDate),C=b.getFullYear().toString(),L=(b.getMonth()+1).toString(),u=b.getDate().toString(),E=new Date(g,y,this.PayDate);E.setMonth(E.getMonth()-1),E.setDate(E.getDate()-1);var h=E.getFullYear().toString(),T=(E.getMonth()+1).toString(),U=E.getDate().toString(),W=L.padStart(2,"0")+"/"+u.padStart(2,"0")+"/"+C,G=T.padStart(2,"0")+"/"+U.padStart(2,"0")+"/"+h;e.form.PayDate.value=W,e.form.PayPeriodEnd.value=W,e.form.PayPeriodStart.value=G}var B=!0,Y=!1,N=!1,R=!1,k=!1,M=!1,D=!1,F=!1,A=!1,H=!1,i=!1,le=!0,J=!0,ee=!0;if(e.NoPaidLeaveId.length=0,e.MoneyClaimingId.length=0,e.OtPayId.length=0,e.EmployerContributions.length=0,s.length=0,p.length=0,m.length=0,f.length=0,e.FinalDeductions.length=0,e.FinalEarnings.length=0,e.NettEarnings=0,e.NettDeductions=0,e.AllowanceId.length=0,e.DeductionId.length=0,(0,w.isEmptyOrNull)($(n).val())&&(0,w.isEmptyOrNull)($(r).val())){e.form.PayPeriodEnd.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate),e.form.PayDate.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate);var E=e.form.PayPeriodEnd.valueAsDate;E.setMonth(E.getMonth()-1),E.setDate(E.getDate()-1),e.form.PayPeriodStart.valueAsDate=E}var oe=`${e.form.PayYear.value}/${e.form.PayMonth.value+1}/${1}`,ce=0;for((0,Ae.serviceCall)({service:Pe.baseUrl+"/CalculateNplAbsentOtSpecial",method:"GET",data:{EmployeeRowID:parseInt($(o).val()),Date:oe},async:!1,onSuccess:j=>{ce=1,e.form.DaysWorked.value=j.Entities[0].NumberOfWorkingDays,$("#NplDayRate").html(j.Entities[0].NPLDaily.toFixed(2)),$("#NplHrRate").html(j.Entities[0].NPLHourly.toFixed(2)),$("#AbsentDayRate").html(j.Entities[0].AbsentDaily.toFixed(2)),$("#EarlyLeavingRate").html(j.Entities[0].EarlyLeavingRate.toFixed(2)),$("#LateArrivalRate").html(j.Entities[0].LateArrivalRate.toFixed(2)),e.form.DailyRate.value=j.Entities[0].DailyRate.toFixed(2),e.form.HourlyRate.value=j.Entities[0].HourlyRate.toFixed(2)}});ce==0;);var re;yt.List({Criteria:I.Criteria.and(re,[[$e.Fields.Status],"=","1"],[[$e.Fields.EmployeeRowId],"=",$(o).val()],[[$e.Fields.StartDate],"<=",e.form.PayPeriodEnd.get_value()],[[$e.Fields.EndDate],">=",e.form.PayPeriodStart.get_value()])},j=>{j.Entities.length>0&&(B=!1);var Ce;for(var qe in j.Entities){var De=j.Entities[qe].LeaveReasonId;switch(De){case 1:Y=!0;break;case 2:N=!0;break;case 3:R=!0;break;case 4:k=!0;break;case 5:M=!0;break;case 6:D=!0;break;case 7:F=!0;break;case 8:A=!0;break;case 10:H=!0;break;case 11:i=!0;break}}for(var x in l)if(l[x].id==$(o).val()){e.form.PayrollEarnings.value.length=0,e.form.PayrollDeductions.value.length=0,$(".addEarnings, .addDeductions").show(),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
                            .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
                            .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.BirthDay, .field.Age, .field.HrdfClass`).show();var me=0;for((0,Ae.serviceCall)({service:Le.baseUrl+"/CalculateOtRate",data:{EmployeeRowID:e.form.EmployeeRowId.value,Date:oe},method:"GET",async:!1,onSuccess:v=>{if(document.getElementById("PayRoll-Description").children.length==0&&e.Setup(),console.log(v.Entities[0]),e.FixedOtRateOption=v.Entities[0].FixedOtRateOption,e.FixedOtRateOption==!1){e.form.FlatOt.value=v.Entities[0].OtRate;let K=parseFloat(v.Entities[0].OtRate.toFixed(2)),P=(K*1.5).toFixed(2),Ee=(K*2).toFixed(2);document.getElementById("flatOtDesc").innerHTML="OT1.0x",document.getElementById("OnePointFiveOtDesc").innerHTML="OT1.5x",document.getElementById("TwoOtDesc").innerHTML="OT2.0x",document.getElementById("Ot1.0x").textContent=K.toFixed(2),document.getElementById("Ot1.5x").textContent=P,document.getElementById("Ot2.0x").textContent=Ee}else document.getElementById("flatOtDesc").innerHTML="Weekday",document.getElementById("OnePointFiveOtDesc").innerHTML="Weekend",document.getElementById("TwoOtDesc").innerHTML="Public Holiday",document.getElementById("Ot1.0x").textContent=v.Entities[0].OtRateWeekday,document.getElementById("Ot1.5x").textContent=v.Entities[0].OtRateWeekend,document.getElementById("Ot2.0x").textContent=v.Entities[0].OtRatePublicHoliday;me=1}});me==0;);e.form.BirthDay.value=l[x].Birthday,e.form.Age.value=e.calculateAge(),e.form.MaritalStatus.value=l[x].MaritalStatus.toString(),e.form.WorkingSpouse.value=l[x].WorkingSpouse,e.form.ChildrenUnderEighteen.value=l[x].ChildrenUnderEighteen,e.form.ChildrenInUniversity.value=l[x].ChildrenInUniversity,e.form.DisabledChildInUniversity.value=l[x].DisabledChildInUniversity,e.form.DisabledChild.value=l[x].DisabledChild,e.form.BasicPay.value=l[x].BasicPay,e.EmployeeType=l[x].type,e.EpfSubjection=l[x].EpfSubjection,e.form.EisClass.value=l[x].EisClass.toString(),e.form.EpfClass.value=l[x].EpfClass.toString(),e.form.SocsoClass.value=l[x].SocsoClass.toString(),e.form.HrdfClass.value=l[x].HrdfClass;var Fe=l[x].name,Ce;ct.List({Criteria:I.Criteria.and(Ce,[[et.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[et.Fields.EffectiveFrom]])},v=>{console.log(v.Entities),$("#AllowanceDeductionBody").empty();var K=0;for(var P in v.Entities){if(!(0,w.isEmptyOrNull)(v.Entities[P].EffectiveUntil)){var Ee=v.Entities[P].EffectiveUntil,Ie=new Date(Ee);if(e.form.PayPeriodStart.valueAsDate>Ie)continue}if(!(v.Entities[P].OneTime==!0&&v.Entities[P].PaidOneTime==!0)){if(v.Entities[P].FullAttendance==!0){if(v.Entities[P].ExemptAnnualLeave==!1&&v.Entities[P].ExemptCompassionateLeave==!1&&v.Entities[P].ExemptEmergencyLeave==!1&&v.Entities[P].ExemptUnpaidLeave==!1&&v.Entities[P].ExemptSickLeave==!1&&v.Entities[P].ExemptPaternityLeave==!1&&v.Entities[P].ExemptMaternityLeave==!1&&v.Entities[P].ExemptMarriageLeave==!1&&v.Entities[P].ExemptHospitalisationLeave==!1&&v.Entities[P].ExemptGatepassLeave==!1){if(B==!1)continue}else if(v.Entities[P].ExemptAnnualLeave==!0&&k==!0||v.Entities[P].ExemptCompassionateLeave==!0&&A==!0||v.Entities[P].ExemptEmergencyLeave==!0&&H==!0||v.Entities[P].ExemptUnpaidLeave==!0&&Y==!0||v.Entities[P].ExemptSickLeave==!0&&R==!0||v.Entities[P].ExemptPaternityLeave==!0&&D==!0||v.Entities[P].ExemptMaternityLeave==!0&&M==!0||v.Entities[P].ExemptMarriageLeave==!0&&F==!0||v.Entities[P].ExemptHospitalisationLeave==!0&&N==!0||v.Entities[P].ExemptGatepassLeave==!0&&i==!0)continue}else{if(v.Entities[P].NoAbsence==!0&&J==!1)continue;if(v.Entities[P].NoEarlyLeaving==!0&&ee==!1)continue;if(v.Entities[P].NoLate==!0&&le==!1)continue}var ye=document.createElement("tr");ye.innerHTML=`<td>${v.Entities[P].AllowanceCode}</td><td>${v.Entities[P].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${v.Entities[P].SubjectionEis.toString()} epf =  ${v.Entities[P].SubjectionEpf.toString()}
                                            hrdf =  ${v.Entities[P].SubjectionHrdf.toString()} pcb =  ${v.Entities[P].SubjectionPcb.toString()}
                                                socso =  ${v.Entities[P].SubjectionSocso.toString()} 
                                            >${v.Entities[P].Amount}</td>`,$("#AllowanceDeductionBody").append(ye),e.AllowanceId.push(v.Entities[P].Id),K+=v.Entities[P].Amount}}if($("#TotalAllowance").val(K),$(d).val(Fe),a)for(var ge=a.getElementsByTagName("TR"),xe=ge.length,te=xe-1;te>0;te--)ge[te].parentNode.removeChild(ge[te]);var Je;At.List({Criteria:I.Criteria.and(Je,[[Te.Fields.Status],"=","1"],[[Te.Fields.EmployeeRowId],"=",$(o).val()],[[Te.Fields.OtDate],">=",e.form.PayPeriodStart.get_value()],[[Te.Fields.OtDate],"<=",e.form.PayPeriodEnd.get_value()])},Ke=>{let _=0,Z=0,de=0,se=0,O=0;Ke.Entities.forEach(Q=>{Q.WeekendOt?_+=Q.OtMinute:Q.WeekdayOt?Z+=Q.OtMinute:Q.PublicHolidayOt&&(de+=Q.OtMinute)}),e.FixedOtRateOption==!1?(e.PublicHolidayMultiplier==2?se+=de:O+=de,e.WeekendMultiplier==2?se+=_:O+=_,e.WeekdayMultiplier==2?se+=Z:O+=Z,se=se/60,O=O/60,$("#OtOnePointFiveTime").val(O),$("#OtTwoTime").val(se)):(Z=Z/60,_=_/60,de=de/60,$("#OtOneTime").val(Z),$("#OtOnePointFiveTime").val(_),$("#OtTwoTime").val(de)),$("#OtTwoTime").trigger("change");var ae;Et.List({Criteria:I.Criteria.and(ae,[[je.Fields.EmployeeRowId],"=",$(o).val()],[[je.Fields.LeaveDate],">=",e.form.PayPeriodStart.get_value()],[[je.Fields.LeaveDate],"<=",e.form.PayPeriodEnd.get_value()])},Q=>{let Rt=0;for(var Ze in Q.Entities)(0,w.isEmptyOrNull)(Q.Entities[Ze].Deductions)||(e.NoPaidLeaveId.push(Q.Entities[Ze].Id),Rt+=Q.Entities[Ze].HalfDay?.5:1);var wt;mt.List({Criteria:I.Criteria.and(wt,[[tt.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[tt.Fields.EffectiveFrom]])},ie=>{var ot=0;for(var ne in ie.Entities)if(!(ie.Entities[ne].OneTime==!0&&ie.Entities[ne].DeductedOneTime==!0)){if(!(0,w.isEmptyOrNull)(ie.Entities[ne].EffectiveUntil)){var Mt=ie.Entities[ne].EffectiveUntil,Ht=new Date(Mt);if(e.form.PayPeriodStart.valueAsDate>Ht)continue}var rt=document.createElement("tr");rt.innerHTML=`<td>${ie.Entities[ne].DeductionCode}</td><td>${ie.Entities[ne].Description}</td><td class = "DeductionAmount">-${ie.Entities[ne].Amount}</td>`,$("#AllowanceDeductionBody").append(rt),e.DeductionId.push(ie.Entities[ne].Id),ot+=ie.Entities[ne].Amount}$(".remove").on("click",function(X){return S(this,null,function*(){console.log("haha"),$(this).closest("tr").remove(),e.updatePayroll()})}),$(".numberInput").on("change",function(X){return S(this,null,function*(){e.updatePayroll()})}),$("#TotalDeduction").val(ot);var Nt;bt.List({Criteria:I.Criteria.and(Nt,[[be.Fields.EmployeeRowId],"=",$(o).val()],[[be.Fields.Paid],"=","0"],[[be.Fields.Status],"=","1"],[[be.Fields.ClaimingDate],">=",e.form.PayPeriodStart.get_value()],[[be.Fields.ClaimingDate],"<=",e.form.PayPeriodEnd.get_value()])},X=>{$("#MoneyClaimingBody").empty();for(var ue in X.Entities){var dt=document.createElement("tr");dt.innerHTML=`<td>${X.Entities[ue].ClaimingCategory}</td><td>${X.Entities[ue].Description}</td>
                                            <td  eis =  ${X.Entities[ue].SubjectionEis.toString()} epf =  ${X.Entities[ue].SubjectionEpf.toString()}
                                            hrdf =  ${X.Entities[ue].SubjectionHrdf.toString()} pcb =  ${X.Entities[ue].SubjectionPcb.toString()}
                                                socso =  ${X.Entities[ue].SubjectionSocso.toString()} 
                                            >${X.Entities[ue].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(dt)}var jt;Bt.List({Criteria:I.Criteria.and(jt,[[ke.Fields.EmployeeRowId],"=",$(o).val()],[[ke.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[ke.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},Oe=>{Oe.Entities.length>0&&(ee=!1);let st=0;for(var Qe in Oe.Entities)Oe.Entities[Qe].Deducted==0&&(st+=Oe.Entities[Qe].EarlyMins,e.EarlyLeavingId.push(Oe.Entities[Qe].Id));$("#EarlyLeavingMinutes").val(st);var Wt;Ft.List({Criteria:I.Criteria.and(Wt,[[Ue.Fields.EmployeeRowId],"=",$(o).val()],[[Ue.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[Ue.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},he=>{var ut=0;he.Entities.length>0&&(le=!1);for(var Re in he.Entities)he.Entities[Re].Deducted==0&&((0,w.isEmptyOrNull)(he.Entities[Re].Deductions)||(ut+=he.Entities[Re].LateMins,e.LateArrivalId.push(he.Entities[Re].Id)));$("#LateArrivalMinutes").val(ut),e.updatePayroll()})})})})})})});break}})}}CheckSubjection(t,e){var a=e.match(/\((.*?)\)/),o;if(a&&a.length>1?o=a[1]:o=e,o=="Others")return 0;for(var n=0;n<t.length;n++){var r=t[n];for(var d in r)if(r[d]==o)return r.subjection}return 0}getToolbarButtons(){var t=super.getToolbarButtons(),e=document.createElement("style");e.textContent=`

    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .section h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table td {
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }

    table td input[type="number"] {
      width: 100%;
      text-align: right;
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f9f9f9;
    }









    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #d9e9f9; /* Light blue for headers */
      font-weight: bold;
    }

    td:nth-child(3), td:nth-child(5) {
      background-color: #fde8f1; /* Light pink for specific columns */
    }

    tr:nth-child(even) {
      background-color: #f9f9f9; /* Alternating row colors */
    }

    tr {
    position: sticky;
    }
        
    tr:hover {
      background-color: #f1f1f1; /* Hover effect for rows */
    }

    .numberInput {
      text-align: right; /* Align text consistently */
      width: 100%;
      border: none;
      background-color: transparent;
    }

    .Description {
    text-align: left; /* Align text consistently */
    width: 50px; /* Ensures consistent width for all spans */

    }

    .numberInputContainer {
    text-align: left; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }


    .rates {
    text-align: right; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }
    

    #PayRollGrid {
    display: flex;
    gap: 5px; /* Adds a 20px gap between #left, #center, and #right */
}

#left,
#center,
#right {
    flex: 1; /* Ensures each section takes equal space (optional) */
}

            `,document.head.appendChild(e);var a=this;return t.push({title:"Add Earnings",cssClass:"text-bg-success p-2 addEarnings",icon:"fa-plus text-green",onClick:()=>{$(".PayrollEarnings .add-button").click();var n=a.form.PayrollEarnings.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollEarningsEditDialog").on("dialogclose",function(){if(n!=a.form.PayrollEarnings.value.length){var r=a.form.PayrollEarnings.value[a.form.PayrollEarnings.value.length-1],d=document.createElement("tr");d.innerHTML=`<td> <span>${r.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${r.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${r.SubjectionToEis} epf = ${r.SubjectionToEpf} hrdf = ${r.SubjectionToHrdf}
                             pcb = ${r.SubjectionToPcb} socso = ${r.SubjectionToSocso}  value = ${r.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(d),$(".remove").on("click",function(s){return S(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(s){return S(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t.push({title:"Add Deductions",cssClass:"text-bg-danger p-2 addDeductions",icon:"fa-minus text-red",onClick:()=>{$(".PayrollDeductions .add-button").click();var n=a.form.PayrollDeductions.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollDeductionsEditDialog").on("dialogclose",function(){if(n!=a.form.PayrollDeductions.value.length){var r=a.form.PayrollDeductions.value[a.form.PayrollDeductions.value.length-1],d=document.createElement("tr");d.innerHTML=`<td>   <span>${r.DeductionCode}</span>  <button class="remove">\xD7</button>
                            </td><td>${r.Description}</td><td> <input class = numberInput type="number" max="0"  value = "-${r.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(d),$(".remove").on("click",function(s){return S(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(s){return S(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t}save_submitHandler(t){let e=0,o=document.getElementById("EarningDeductionBody").querySelectorAll("tr");if(o.length){let c=[],g=[],y=Array.from(o).map(b=>{let C=b.querySelectorAll("td");return{code:C[0].querySelector("span").textContent,description:C[1].innerText,amount:C[2].querySelector(".numberInput").value,eis:C[2].querySelector(".numberInput").getAttribute("eis"),epf:C[2].querySelector(".numberInput").getAttribute("epf"),hrdf:C[2].querySelector(".numberInput").getAttribute("hrdf"),pcb:C[2].querySelector(".numberInput").getAttribute("pcb"),socso:C[2].querySelector(".numberInput").getAttribute("socso")}});for(e=0;e<y.length;e++){var n;parseFloat(y[e].amount)>0?(n=new _e,n.Amount=parseFloat(y[e].amount),n.Description=y[e].description,n.SubjectionToPcb=d(y[e].pcb),n.SubjectionToEis=d(y[e].eis),n.SubjectionToHrdf=d(y[e].hrdf),n.SubjectionToSocso=d(y[e].socso),n.SubjectionToEpf=d(y[e].epf),n.EarningCode=y[e].code,c.push(n)):parseFloat(y[e].amount)<0&&(n=new Ge,n.Amount=parseFloat(y[e].amount),n.Description=y[e].description,n.DeductionCode=y[e].code,g.push(n))}this.form.PayrollEarnings.value=c,this.form.PayrollDeductions.value=g}this.form.NPLDaily.value=$("#NplDay").val(),this.form.NPLHourly.value=$("#NplHr").val(),this.form.AbsentDaily.value=$("#AbsentDay").val(),this.form.OtOne.value=$("#OtOneTime").val(),this.form.OtOnePointFive.value=$("#OtOnePointFiveTime").val(),this.form.OtTwo.value=$("#OtTwoTime").val(),this.form.EarlyLeaving.value=$("#EarlyLeavingMinutes").val(),this.form.LateArrival.value=$("#LateArrivalMinutes").val(),this.form.FlatOt.value=parseFloat(document.getElementById("Ot1.0x").textContent),this.form.OtOnePointFiveRate.value=parseFloat(document.getElementById("Ot1.5x").textContent),this.form.OtTwoRate.value=parseFloat(document.getElementById("Ot2.0x").textContent);var r=this;function d(c){return c==="true"}z(d,"toBoolean"),this.form.EmployeePCB.value=$("#PCB").val(),this.form.EmployeeEIS.value=$("#EmployeeEIS").val(),this.form.EmployeeEPF.value=$("#EmployeeEPF").val(),this.form.EmployeeSOCSO.value=$("#EmployeeSOCSO").val(),this.form.EmployerEIS.value=$("#EmployerEIS").val(),this.form.EmployerEPF.value=$("#EmployerEPF").val(),this.form.EmployerHRDF.value=$("#HRD").val(),this.form.EmployerSOCSO.value=$("#EmployerSOCSO").val(),this.form.NPLDailyRate.value=parseFloat($("#NplDayRate").text()),this.form.NPLHourlyRate.value=parseFloat($("#NplHrRate").text()),this.form.AbsentDailyRate.value=parseFloat($("#AbsentDayRate").text()),this.form.EarlyLeavingRate.value=parseFloat($("#EarlyLeavingRate").text()),this.form.LateArrivalRate.value=parseFloat($("#LateArrivalRate").text());let p=document.getElementById("MoneyClaimingBody").querySelectorAll("tr");if(p.length){let c=[],g=Array.from(p).map(y=>{let b=y.querySelectorAll("td");return{ClaimingCategory:b[0].innerText,description:b[1].innerText,amount:b[2].innerText,eis:b[2].getAttribute("eis"),epf:b[2].getAttribute("epf"),hrdf:b[2].getAttribute("hrdf"),pcb:b[2].getAttribute("pcb"),socso:b[2].getAttribute("socso")}});for(e=0;e<g.length;e++){var m=new Ye;m.ClaimAmount=parseFloat(g[e].amount),m.Description=g[e].description,m.ClaimingCategory=g[e].ClaimingCategory,m.SubjectionPcb=d(g[e].pcb),m.SubjectionEis=d(g[e].eis),m.SubjectionHrdf=d(g[e].hrdf),m.SubjectionSocso=d(g[e].socso),m.SubjectionEpf=d(g[e].epf),c.push(m)}this.form.PaidMoneyClaimingList.value=c}let l=document.getElementById("AllowanceDeductionBody").querySelectorAll("tr");if(l.length){let c=[],g=[],y=Array.from(l).map(L=>{let u=L.querySelectorAll("td");return{code:u[0].innerText,description:u[1].innerText,amount:u[2].innerText,eis:u[2].getAttribute("eis"),epf:u[2].getAttribute("epf"),hrdf:u[2].getAttribute("hrdf"),pcb:u[2].getAttribute("pcb"),socso:u[2].getAttribute("socso")}}),b=0,C=0;for(e=0;e<y.length;e++){var n;parseFloat(y[e].amount)>0?(n=new ze,n.AllowanceId=r.AllowanceId[b],n.AllowanceAmount=parseFloat(y[e].amount),n.Description=y[e].description,n.SubjectionPcb=d(y[e].pcb),n.SubjectionEis=d(y[e].eis),n.SubjectionHrdf=d(y[e].hrdf),n.SubjectionSocso=d(y[e].socso),n.SubjectionEpf=d(y[e].epf),n.code=y[e].code,b+=1,c.push(n)):parseFloat(y[e].amount)<0&&(n=new Ve,n.DeductionId=r.DeductionId[C],n.DeductionAmount=parseFloat(y[e].amount),n.Description=y[e].description,n.code=y[e].code,g.push(n),C+=1)}this.form.AllowanceList.value=c,this.form.DeductionList.value=g}r.form.Nett.value=$("#NettWage").val(),r.form.Earnings.value=$("#GrossWage").val(),r.form.Deduction.value=r.form.Earnings.value-r.form.Nett.value,super.save_submitHandler(t)}};z(ve,"PayrollDialog"),ve=we([I.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollDialog")],ve);var Ye=class extends It{constructor(){super()}};z(Ye,"ConcreteMoneyClaimApplicationRow");var Ge=class extends gt{constructor(){super()}};z(Ge,"ConcretePayrollDeductionsRow");var _e=class extends ht{constructor(){super()}};z(_e,"ConcretePayrollEarningsRow");var ze=class extends Ot{constructor(){super()}};z(ze,"ConcreteEmployeeAllowanceRow");var Ve=class extends Dt{constructor(){super()}};z(Ve,"ConcreteFixedDeductionRow");var Se=pe(Xe(),1);var V=pe(Me(),1),q=pe(Me(),1),nt=pe(Xe(),1);var Be=class extends Se.EntityDialog{constructor(){super();this.form=new it(this.idPrefix);var t;Le.List({Criteria:Se.Criteria.and(t,[[He.Fields.Retired],"=","0"],[[He.Fields.Terminated],"=","0"],[[He.Fields.Resigned],"=","0"])},e=>{this.EmployeeData=e.Entities})}getFormKey(){return it.formKey}getRowDefinition(){return Pt}getService(){return St.baseUrl}SearchCallback(){var t=this,e=document.getElementById(this.idPrefix+"PayMonth"),a=document.getElementById(this.idPrefix+"PayYear"),o=document.getElementById(this.idPrefix+"OccupationList"),n=document.getElementById(this.idPrefix+"DepartmentList"),r=document.getElementById(this.idPrefix+"DivisionList"),d=document.getElementById(this.idPrefix+"JobGradeList"),s=document.getElementById(this.idPrefix+"SectionList");if((0,V.isEmptyOrNull)($(e).val())||(0,V.isEmptyOrNull)($(a).val())){this.form.EmployeeRowList.value=this.form.EmployeeRowListBuffer.value="";return}function p(E){let h=$(E).val();return h.length?h.split(",").map(T=>parseInt(T,10)):[]}z(p,"parseListFromElement");let m=p(d),f=p(r),l=p(n),c=p(o),g=p(s),y=new Set(m),b=new Set(f),C=new Set(l),L=new Set(c),u=new Set(g);for(let E of t.EmployeeData){let{JobGradeID:h,DivisionID:T,DepartmentID:U,OccupationID:W,SectionID:G,Id:B}=E,Y=y.has(h)||b.has(T)||C.has(U)||L.has(W)||u.has(G),N=t.form.EmployeeRowListBuffer.value,R=N?N.split(",").map(Number):[];Y?R.includes(B)||R.push(B):R=R.filter(k=>k!==B),t.form.EmployeeRowListBuffer.value=R.join(",")}}SearchEmployeeCallback(){var t=this,e=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),a=$(e).val();let o=a.split(","),n=[];a.length&&o.forEach(c=>{n.push(parseInt(c))});var r=document.getElementById(this.idPrefix+"PayMonth"),d=document.getElementById(this.idPrefix+"PayYear"),s=$(d).val(),p=$(r).val();let m=[];var f=t.form.EmployeeRowListBuffer.value;f.split(",").forEach(c=>{m.push(parseInt(c))}),Pe.List({},c=>{for(var g in c.Entities){var y=c.Entities[g].EmployeeRowId,b=c.Entities[g].PayMonth,C=c.Entities[g].PayYear;n.indexOf(y)!==-1&&b==p&&C==s&&(f=t.form.EmployeeRowListBuffer.value,f!=""&&(f.split(",").forEach(u=>{m.push(parseInt(u))}),m=m.filter(u=>u!==c.Entities[g].EmployeeRowId),t.form.EmployeeRowListBuffer.value=m.join(",")))}t.form.EmployeeRowList.value=m.join(",")})}getToolbarButtons(){var t=this,e=document.getElementById(this.idPrefix+"JobGradeList"),a=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),a.push({title:"Generate Payslips",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if((0,V.isEmptyOrNull)(t.form.PayDate.value)){(0,q.notifyError)("Please enter pay date");return}if((0,V.isEmptyOrNull)(t.form.PayMonth.value)){(0,q.notifyError)("Please enter pay Month");return}if((0,V.isEmptyOrNull)(t.form.PayYear.value)){(0,q.notifyError)("Please enter pay Year");return}if((0,V.isEmptyOrNull)(t.form.PayPeriodEnd.value)){(0,q.notifyError)("Please enter pay period end");return}if((0,V.isEmptyOrNull)(t.form.PayPeriodStart.value)){(0,q.notifyError)("Please enter pay period start");return}var o=t.form.EmployeeRowList.value;let n=[],r=o.split(",");o.length&&r.forEach(d=>{n.push(parseInt(d))}),t.counter=0,t.WaitingCounter=n.length,(0,q.confirm)("Are you sure to generate payslip of these employees?",()=>{function d(m){return new Promise(f=>{let l=new ve(1,m,t.form.PayYear.value,t.form.PayMonth.value,t.form.PayDate.value,t.form.PayPeriodStart.value,t.form.PayPeriodEnd.value);l.element.on("dialogopen",function(){$(".s-PayrollDialog").hide()}),l.dialogOpen(),l.element.on("dialogclose",function(){t.counter+=1,t.counter==n.length&&(0,q.notifySuccess)("Payslip generated"),f()})})}z(d,"handleEmployee");function s(){return new Promise(m=>{var f=new Tt(o,t.form.PayMonth.value,t.form.PayYear.value);f.dialogOpen(),f.element.on("dialogclose",function(){t.SearchCallback(),m()})})}z(s,"handleDownload");function p(m){return S(this,null,function*(){for(let f=0;f<m.length;f++)yield d(m[f]);t.form.Download.value==!0?yield s():t.SearchCallback()})}z(p,"processEmployees"),console.log(n),p(n),t.form.Download.value==!0&&(0,q.notifySuccess)("Payslip downloaded"),t.form.EmployeeRowListBuffer.value=t.form.EmployeeRowList.value=""})}}),a}dialogOpen(t){super.dialogOpen();var e=this;(0,q.serviceCall)({service:We.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:u=>{e.dateString=u,Ne.List({},E=>{var h=new Date(e.dateString),T=h.getMonth(),U=h.getFullYear(),W=0;for(var G in E.Entities)if(E.Entities[G].IsActive==1){W=E.Entities[G].PayDay;break}var B=new Date(U,T,W),Y=B.getFullYear().toString(),N=(B.getMonth()+1).toString(),R=B.getDate().toString(),k=new Date(U,T,W);k.setMonth(k.getMonth()-1),k.setDate(k.getDate()-1);var M=k.getFullYear().toString(),D=(k.getMonth()+1).toString(),F=k.getDate().toString(),A=N.padStart(2,"0")+"/"+R.padStart(2,"0")+"/"+Y,H=D.padStart(2,"0")+"/"+F.padStart(2,"0")+"/"+M;this.isNew()&&(e.form.PayDate.value=A,e.form.PayPeriodEnd.value=A,e.form.PayPeriodStart.value=H)})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var a=document.getElementById(this.idPrefix+"PayMonth"),o=document.getElementById(this.idPrefix+"PayYear");let n=new nt.Select2Editor($(a)),r=new nt.Select2Editor($(o)),d=["January","February","March","April","May","June","July","August","September","October","November","December"];var s=new Date(e.dateString),p=s.getFullYear(),m=s.getMonth();for(let u=0;u<d.length;u++)n.addItem({id:u.toString(),text:d[u].toString()});n.set_value(m.toString());for(let u=-1;u<2;u++)r.addItem({id:(p+u).toString(),text:(p+u).toString()});r.set_value(p.toString());var f=document.getElementById(this.idPrefix+"SectionList"),l=document.getElementById(this.idPrefix+"OccupationList"),c=document.getElementById(this.idPrefix+"DepartmentList"),g=document.getElementById(this.idPrefix+"DivisionList"),y=document.getElementById(this.idPrefix+"JobGradeList"),b=document.getElementById(this.idPrefix+"PayPeriodStart"),C=document.getElementById(this.idPrefix+"PayPeriodEnd"),L=document.getElementById(this.idPrefix+"EmployeeRowList");console.log(this.idPrefix),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(u){return S(this,null,function*(){$(".select2-drop").hide()})}),$(a).on("change",function(){return S(this,null,function*(){((0,V.isEmptyOrNull)($(a).val())||(0,V.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(o).on("change",function(){return S(this,null,function*(){((0,V.isEmptyOrNull)($(a).val())||(0,V.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(l).on("change",function(){return S(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(g).on("change",function(){return S(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(y).on("change",function(){return S(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(c).on("change",function(){return S(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(f).on("change",function(){return S(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(b).on("change",function(){return S(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,V.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodStart.value="";return}})}),$(C).on("change",function(){return S(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,V.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodEnd.value="";return}})})}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+100,t}};z(Be,"PayrollGeneratingWizardDialog"),Be=we([Se.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGeneratingWizardDialog")],Be);export{ve as a,Be as b};
//# sourceMappingURL=chunk-JBASIQVH.js.map
