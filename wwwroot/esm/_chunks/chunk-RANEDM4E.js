import{b as P,g as H,h as x,m as D,n as L,o as F,p as I}from"./chunk-YH4BIPAQ.js";import{a as _}from"./chunk-DNINIZJD.js";import{c as u,g as c,h as A,k as R}from"./chunk-L3ECGIWB.js";var E=c(_(),1);var O=c(R(),1);var g=c(R(),1);var G=c(R(),1);var y=class extends E.EntityDialog{constructor(){super();this.form=new P(this.idPrefix);this.EmployeeProfileTable=(0,O.getLookup)("EmployeeProfile.EmployeeProfile")}getFormKey(){return P.formKey}getRowDefinition(){return H}getService(){return x.baseUrl}getDialogOptions(){let l=super.getDialogOptions();return l.height=800,l.width=1e3,l}save_submitHandler(l){var i=l,e=this;function f(t){return new Date(t)}u(f,"parseDate");function C(t,r,h,s){return t<s&&r>=h}u(C,"areShiftsOverlapping");function K(t){var r=!1;for(let a=0;a<t.length;a++){var h=f(t[a].ShiftStartDate),s=f(t[a].ShiftEndDate);for(let m=0;m<t.length;m++)if(a!=m){var v=f(t[m].ShiftStartDate),d=f(t[m].ShiftEndDate);if(C(h,s,v,d)){var S="There is a clash between "+t[a].Shift+" and "+t[m].Shift;(0,g.alertDialog)(S),r=!0;break}}if(r==!0)break}return r}u(K,"areAnyShiftsOverlapping");var T=[];if(!K(this.form.Shifts.value)){for(let t=0;t<this.form.EmployeeList.values.length;t++)for(let r=0;r<this.form.Shifts.value.length;r++){var p=new w;p.EmployeeRowId=parseInt(this.form.EmployeeList.values[t]),p.ShiftStartDate=this.form.Shifts.value[r].ShiftStartDate,p.ShiftEndDate=this.form.Shifts.value[r].ShiftEndDate,p.ShiftId=this.form.Shifts.value[r].ShiftId,T.push(p)}if(this.form.ActualShifts.value=T,this.form.ActualShifts.refresh(),this.isNew()){var U=document.getElementById(this.idPrefix+"EmployeeList");L.List({Criteria:[[D.Fields.EmployeeRowId],"=",$(U).val()]},t=>{var r=!0;console.log(t);for(i in t.Entities)if(!(0,G.isEmptyOrNull)(t.Entities[i].EmployeeRowId)&&this.form.EmployeeList.values.includes(t.Entities[i].EmployeeRowId.toString())){var h=f(t.Entities[i].ShiftStartDate),s=f(t.Entities[i].ShiftEndDate);for(let o=0;o<e.form.Shifts.value.length;o++){var v=f(e.form.Shifts.value[o].ShiftStartDate),d=f(e.form.Shifts.value[o].ShiftEndDate);if(C(h,s,v,d)==!0){var S;for(var a in e.EmployeeProfileTable.items)if(e.EmployeeProfileTable.items[a].Id==t.Entities[i].EmployeeRowId){S=e.EmployeeProfileTable.items[a].EmployeeID;break}var m="Employee "+S+" Already has a Shift from "+t.Entities[i].ShiftStartDate+" until "+t.Entities[i].ShiftEndDate;if(r=!1,(0,g.alertDialog)(m),r=!1)return}}}r==!0&&super.save_submitHandler(i)})}else L.List({Criteria:[[D.Fields.EmployeeRowId],"=",e.form.EmployeeList.values]},t=>{var r=!0;for(i in t.Entities)if(!(t.Entities[i].EmployeeGroupId=e.entityId)&&!(0,G.isEmptyOrNull)(t.Entities[i].EmployeeRowId)&&this.form.EmployeeList.values.indexOf(t.Entities[i].EmployeeRowId.toString())!=-1){var h=f(t.Entities[i].ShiftStartDate),s=f(t.Entities[i].ShiftEndDate);for(let o=0;o<e.form.Shifts.value.length;o++){var v=f(e.form.Shifts.value[o].ShiftStartDate),d=f(e.form.Shifts.value[o].ShiftEndDate);if(C(h,s,v,d)){var S;for(var a in e.EmployeeProfileTable.items)if(e.EmployeeProfileTable.items[a].Id==t.Entities[i].EmployeeRowId){S=e.EmployeeProfileTable.items[a].EmployeeID;break}var m="Employee "+S+" Already has a Shift from "+t.Entities[i].ShiftStartDate+" until "+t.Entities[i].ShiftEndDate;if(r=!1,(0,g.alertDialog)(m),r=!1)return}}}if(r==!0){for(i in t.Entities)t.Entities[i].EmployeeGroupId==e.entityId&&EmployeeShiftPatternService.Delete({EntityId:t.Entities[i].Id});I.List({Criteria:[[F.Fields.EmployeeGroupID],"=",e.entityId]},o=>{for(var k in o.Entities)o.Entities[k].EmployeeGroupId==e.entityId&&I.Delete({EntityId:o.Entities[k].Id});for(let n=0;n<e.form.Shifts.value.length;n++){I.Create({Entity:{EmployeeGroupId:e.entityId,ShiftStartDate:e.form.Shifts.value[n].ShiftStartDate,ShiftEndDate:e.form.Shifts.value[n].ShiftEndDate,ShiftId:e.form.Shifts.value[n].ShiftId}});for(let b=0;b<e.form.EmployeeList.values.length;b++)EmployeeShiftPatternService.Create({Entity:{EmployeeRowId:parseInt(e.form.EmployeeList.values[b]),EmployeeGroupID:e.entityId,ShiftStartDate:e.form.Shifts.value[n].ShiftStartDate,ShiftEndDate:e.form.Shifts.value[n].ShiftEndDate,ShiftId:e.form.Shifts.value[n].ShiftId}})}e.dialogClose()})}})}}onDialogOpen(){super.onDialogOpen(),this.isNew()||(this.form.Shifts.value=this.form.Shifts.value.sort((i,e)=>new Date(i.ShiftStartDate).getTime()-new Date(e.ShiftStartDate).getTime()),this.form.Shifts.refresh()),$(this.form.Shifts.value).on("change",function(){console.log("haha")}),E.EditorUtils.setReadonly(this.form.ShiftColor.element,!0),$(".ActualShifts").hide();var l=document.createElement("toolcool-color-picker");l.setAttribute("id","color-picker-1"),l.setAttribute("color","#e76ff1"),this.form.ShiftColor.element.after(l),l.addEventListener("change",i=>{let e=i;this.ColorCode=e.detail.hex,this.form.ShiftColor.value=this.ColorCode}),this.form.ShiftColor.element.click(function(){l.opened=!0})}};u(y,"EmployeeGroupDialog"),y=A([E.Decorators.registerClass("HRMSoftware.EmployeeGroup.EmployeeGroupDialog")],y);var w=class extends D{constructor(){super()}};u(w,"ConcreteEmployeeShiftPatternRow");export{y as a};
//# sourceMappingURL=chunk-RANEDM4E.js.map
