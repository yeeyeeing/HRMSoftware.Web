import{a as Kt,b as Xt}from"./chunk-FQXHXHZD.js";import{b as $t}from"./chunk-U47JSUFM.js";import{e as _t}from"./chunk-GHIP3IPF.js";import{d as yt}from"./chunk-3MJ4Y52C.js";import{b as pt,c as Ct,d as X}from"./chunk-T7MGTPAP.js";import{a as Tt}from"./chunk-47F7KCJ6.js";import{d as At}from"./chunk-C45P7KJQ.js";import{c as Nt}from"./chunk-U2RRK6JY.js";import{b as Rt}from"./chunk-J5PFZI4S.js";import{a as kt}from"./chunk-DNINIZJD.js";import{c as y,g as G,h as Mt,j as Lt,k as Ft}from"./chunk-L3ECGIWB.js";var R=G(kt(),1),F=G(Ft(),1);var gt=G(Kt(),1),Wt=G(Xt(),1),Gt=G(kt(),1);var Ot=G(Ft(),1);(0,Wt.default)(gt);var Z=class extends R.EntityDialog{constructor(S,O){super();this.form=new pt(this.idPrefix);this.list_of_shift_text=[];this.list_of_shift_id=[];this.list_of_color=[];this.list_of_public_holiday_date=[];this.list_of_public_holiday_name=[];this.list_of_public_holiday_id=[];this.FromDayList=[];this.UntilDayList=[];this.EmployeeID=S,this.EmployeeRowID=O,this.saveAndCloseButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.undeleteButton.hide(),this.cloneButton.hide(),this.applyChangesButton.hide(),Rt.Retrieve({EntityId:O},j=>{this.form.EmployeeId.value=j.Entity.EmployeeID,this.form.EmployeeName.value=j.Entity.EmployeeName}),R.EditorUtils.setReadonly(this.form.EmployeeId.element,!0),R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var C=$(".fieldset").children().attr("id"),w=document.getElementById(C),g=document.createElement("DIV");g.setAttribute("id","time-box"),g.setAttribute("class","row"),g.setAttribute("align","right");var I=document.createElement("DIV"),N=document.createElement("INPUT");N.setAttribute("id","Month"),N.setAttribute("type","text"),N.setAttribute("class","monthSelect"),I.appendChild(N),g.appendChild(I),w.appendChild(g);var U=document.createElement("DIV");U.classList.add("category-title"),U.setAttribute("id","Employee-Timetable"),w.appendChild(U)}getFormKey(){return pt.formKey}getRowDefinition(){return Ct}getService(){return X.baseUrl}dialogOpen(S){super.dialogOpen(S);function O(t){return t<10?"0"+t:t.toString()}y(O,"addLeadingZero");function C(t,e,r,o){let a=new Date(t[0].date).getDay(),i=t.length,n=a,s=[];for(let p=1;p<=i;p++){var u=new Date(t[p-1].date),b=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}-${u.getDate().toString().padStart(2,"0")}`;let c=(n+p-1)%7,rt=Math.floor((a+p-1)/7),at=p;var d=t[p-1].shift,H=t[p-1].GroupID,D=null,E=null,W=null;for(var v in r)if(r[v].PublicHolidayDate.substring(0,10)==b){E=W=r[v].PublicHolidayName,D="#FF0000",d=null,H=null;break}if(d!=null){var m;for(var v in e)if(e[v].ShiftIdList==d){m=v;break}D=e[m].Color,E=e[m].ShiftName,e[m].WorkingHourUntilList[c]===void 0&&e[m].WorkingHourFromList[c]==null?(E="Rest Day",D="#FFFFE0",W="Happy Holidays"):e[m].WorkingHourFromList[c]!=null&&e[m].WorkingHourUntilList[c]!=null&&(W=e[m].WorkingHourFromList[c]+"-"+e[m].WorkingHourUntilList[c])}var Y=(0,Ot.getLookup)("LeaveReason.LeaveReason");for(var v in o){var dt=new Date(o[v].StartDate),x=new Date(o[v].EndDate),tt=o[v].LeaveReason,et;for(var V in Y.items)if(Y.items[V].Id==tt){et=Y.items[V].LeaveReason.replace(/\s/g,"");break}u>=dt&&u<=x&&(E=W=et,D="#00FF00",d=null)}s.push({x:c,y:5-rt,color:D,shiftstring:E,value:d,date:b,custom:{monthDay:at,details:W}})}return s}y(C,"generateChartData");function w(t,e,r){var o=[],a=[],i=[];for(var n in t){var s=new Date(t[n].PublicHolidayDate.substring(0,10)),u=s.getFullYear(),b=s.getMonth()+1;u==e&&b==r&&(o.push(t[n].PublicHolidayName),a.push(t[n].PublicHolidayDate.substring(0,10)),i.push(t[n].PublicHolidayId))}return[o,a,i]}y(w,"GetCurrentMonthHoliday");function g(t,e,r){var o=new Date(e,r,0).getDate();let a=[];for(let H=1;H<=o;H++){var i=`${e}-${O(r)}-${O(H)}`,n=null,s=new Date(e,r-1,H);for(var u in t){var b=new Date(t[u].ShiftStartDate),d=new Date(t[u].ShiftEndDate);if(s>=b&&s<=d){n=t[u].EmployeeGroupID;break}}a.push({date:i,shift:null,GroupID:n})}return a}y(g,"generateListOfDate");function I(t,e){for(var r in e){let i=new Date(e[r].ShiftStartDate.substring(0,10)),n=new Date(e[r].ShiftEndDate.substring(0,10));for(var o of t){var a=new Date(o.date);a>=i&&a<=n&&(o.shift=e[r].ShiftId)}}return t}y(I,"appendShift");function N(t,e){let r=[],o=new Date(t,e-1,1);for(let a=6;a>0;a--){let i=new Date(o);i.setMonth(i.getMonth()-a),r.push(`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}`)}r.push(`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}`);for(let a=1;a<=6;a++){let i=new Date(o);i.setMonth(i.getMonth()+a),r.push(`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}`)}return r}y(N,"generateMonthRange");function U(t){let e=t.map(r=>new Date(r));return e.sort((r,o)=>r.getTime()-o.getTime()),e.map(r=>r.toISOString().substring(0,10))}y(U,"sortDatesAscending");function j(t,e){let r=new Date(t),o=e.map(n=>new Date(n)),a=null,i=1/0;for(let n of o)if(n>r){let s=n.getTime()-r.getTime();s<i&&(i=s,a=n)}return a?(a.setDate(a.getDate()-1),a.toISOString().split("T")[0]):null}y(j,"findClosestGreaterDate");function q(t,e,r){let o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var a=[];gt.chart("Employee-Timetable",{chart:{type:"heatmap"},title:{text:"",align:"left"},accessibility:{landmarkVerbosity:"one"},tooltip:{enabled:!0,zIndex:Number.MAX_SAFE_INTEGER,headerFormat:"",pointFormat:"{point.date:%A, %b %e, %Y} </br>{point.custom.details:%s }",nullFormat:"{point.date:%A, %b %e, %Y} </br>{point.custom.details:%s }"},xAxis:{categories:o,opposite:!0,lineWidth:26,offset:13,lineColor:"rgba(27, 26, 37, 0.2)",labels:{rotation:0,y:20,style:{textTransform:"uppercase",fontWeight:"bold"}},accessibility:{description:"weekdays",rangeDescription:"X Axis is showing all 7 days of the week, starting with Sunday."}},yAxis:{min:0,max:5,accessibility:{description:"weeks"},visible:!1},legend:{enable:!1,layout:"vertical",verticalAlign:"middle"},series:[{showInLegend:!1,keys:["x","y","value","date","color","id"],data:t,nullColor:"rgba(196, 196, 196, 0.2)",borderWidth:2,borderColor:"rgba(196, 196, 196, 0.2)",dataLabels:[{enabled:!0,format:"{#unless point.custom.empty}{point.shiftstring}{/unless}",style:{textOutline:"none",fontWeight:"normal",fontSize:"0.73rem"},y:4},{enabled:!0,align:"left",verticalAlign:"top",format:"{#unless point.custom.details}{point.custom.details}{/unless}",backgroundColor:"whitesmoke",padding:2,style:{textOutline:"none",color:"rgba(70, 70, 92, 1)",fontSize:"0.8rem",fontWeight:"bold",opacity:.5},x:1,y:1}]}],plotOptions:{series:{point:{events:{click:function(){var i=-1,n=!1,s=0,u=0;for(var b in t)if(t[b].x==this.x&&t[b].y==this.y){var d=new Date(t[b].date),H=d.getDate(),D=d.getMonth()+1,E=d.getFullYear(),W=!1;let ct=`${E}-${D.toString().padStart(2,"0")}-${H.toString().padStart(2,"0")}`;var v=new Date(d.getFullYear(),d.getMonth(),d.getDate());for(var m in h){var Y=new Date(h[m].StartDate),dt=new Date(h[m].EndDate);if(d>=Y&&d<=dt){var x=new $t;x.loadByIdAndOpenDialog(h[m].ID),x.set_readOnly(!0),u=1;break}}if(u==1)break;for(var tt in e)if(e[tt]==ct){var et=r[tt];s=1;var V=new Tt;V.loadByIdAndOpenDialog(et),V.set_readOnly(!0);break}if(s)break;var p=!1;for(var c in l){var rt=new Date(l[c].ShiftStartDate),at=new Date(l[c].ShiftEndDate);if(v>=rt&&v<=at){i=l[c].Id,p=!0;var It=new yt(A,l[c].ShiftStartDate,1,l[c].ShiftEndDate);It.loadByIdAndOpenDialog(i),It.element.on("dialogclose",function(){(0,F.serviceCall)({service:X.baseUrl+"/RetriveShiftHistory",method:"GET",data:{EmployeeID:A},async:!1,onSuccess:mt=>{l=mt.Entities;for(var ft in l)if(parseInt(l[ft].Id)==0){n=!0;break}f=g(l,E,D),n==!1&&(f=I(f,l));var[vt,L,z]=w(T,M,P),K=[];for(var k in L)K.push({PublicHolidayDate:L[k],PublicHolidayId:z[k],PublicHolidayName:vt[k]});var it=C(f,B,K,h);q(it,L,z)}})});break}if(n==!1){var rt=new Date(l[c].ShiftStartDate.substring(0,10)),at=new Date(l[c].ShiftEndDate.substring(0,10)),Vt=l[c].ShiftStartDate.substring(0,10);a.push(Vt)}}if(p==!0)break;if(i==-1&&s==0){a=U(a);var zt=j(ct,a),Pt=new yt(A,ct,0,zt);Pt.dialogOpen(),Pt.element.on("dialogclose",function(){(0,F.serviceCall)({service:X.baseUrl+"/RetriveShiftHistory",method:"GET",data:{EmployeeID:A},async:!1,onSuccess:mt=>{l=mt.Entities,n=!1;for(var ft in l)if(parseInt(l[ft].Id)==0){n=!0;break}f=g(l,E,D),n==!1&&(f=I(f,l));var[vt,L,z]=w(T,M,P),K=[];for(var k in L)K.push({PublicHolidayDate:L[k],PublicHolidayId:z[k],PublicHolidayName:vt[k]});var it=C(f,B,K,h);console.log(it),q(it,L,z)}})})}break}}}}}}})}y(q,"plot");var A=this.EmployeeRowID,l,B=[],bt=!1;for((0,F.serviceCall)({service:Nt.baseUrl+"/ListShift",method:"GET",data:{},async:!1,onSuccess:t=>{bt=!0;let e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(var r in t.Entities){var o=[],a=[],i=[];for(var n in e)o.push(t.Entities[r][e[n]+"StartingFrom"]),a.push(t.Entities[r][e[n]+"EndingAt"]),i.push(t.Entities[r][e[n]+"WorkingTime"]);B.push({ShiftName:t.Entities[r].ShiftName,WorkingHourFromList:o,WorkingHourUntilList:a,WorkingTimeList:i,Color:t.Entities[r].ShiftColor,ShiftIdList:t.Entities[r].Id})}},onError:t=>{}});bt==!1;);var T=[],ht=!1;for((0,F.serviceCall)({service:At.baseUrl+"/ListPublicHoliday",method:"GET",data:{},async:!1,onSuccess:t=>{ht=!0;for(var e in t.Entities)t.Entities[e].IsActive==1&&T.push({PublicHolidayDate:t.Entities[e].Date,PublicHolidayName:t.Entities[e].Name,PublicHolidayId:t.Entities[e].Id});console.log(T)},onError:t=>{}});ht==!1;);var h=[],Dt=!1;for((0,F.serviceCall)({service:_t.baseUrl+"/ListTakenLeave",method:"GET",data:{EmployeeRowID:A},async:!1,onSuccess:t=>{Dt=!0;for(var e in t.Entities){var r=0;t.Entities[e].LeaveReasonId==4&&t.Entities[e].HalfDay==1&&(r=1),h.push({ID:t.Entities[e].Id,StartDate:t.Entities[e].StartDate.substring(0,10),EndDate:t.Entities[e].EndDate.substring(0,10),HalfDate:r,LeaveReason:t.Entities[e].LeaveReasonId})}},onError:t=>{}});Dt==!1;);var f,nt,ot,J=new Date,P=J.getMonth()+1,M=J.getFullYear(),Ut=`${J.getFullYear()}-${(J.getMonth()+1).toString().padStart(2,"0")}`,Et=!1,lt=!1;for((0,F.serviceCall)({service:X.baseUrl+"/RetriveShiftHistory",method:"GET",data:{EmployeeID:A},async:!1,onSuccess:t=>{l=t.Entities,f=g(l,M,P);for(var e in t.Entities)if(parseInt(t.Entities[e].Id)==0){lt=!0;break}Et=!0},onError:t=>{}});Et==!1;);var Q=N(M,P);let Ht=new Gt.Select2Editor($("#Month"));for(var _=0;_<Q.length;_++)Ht.addItem({id:_.toString(),text:Q[_].toString()}),Q[_].toString()==Ut&&Ht.set_value(_.toString());$("#Month").on("change",function(){return Lt(this,null,function*(){var t=$(this).val(),e=Q[t];nt=parseInt(e.split("-")[0]),ot=parseInt(e.split("-")[1]),P=ot,M=nt;var r=g(l,nt,ot);lt==!1&&(r=I(r,l));var[o,a,i]=w(T,M,P),n=[];for(var s in a)n.push({PublicHolidayDate:a[s],PublicHolidayId:i[s],PublicHolidayName:o[s]});var u=C(r,B,n,h);q(u,a,i)})}),lt==!1&&(f=I(f,l));var[Bt,st,St]=w(T,M,P),wt=[];for(var ut in st)wt.push({PublicHolidayDate:st[ut],PublicHolidayId:St[ut],PublicHolidayName:Bt[ut]});var Yt=C(f,B,wt,h);q(Yt,st,St)}getDialogOptions(){let S=super.getDialogOptions();return S.height=800,S.width=1200,S}};y(Z,"ViewShiftHistoryDialog"),Z=Mt([R.Decorators.registerClass("HRMSoftware.ViewShiftHistory.ViewShiftHistoryDialog")],Z);export{Z as a};
//# sourceMappingURL=chunk-ZKVNYKFQ.js.map
