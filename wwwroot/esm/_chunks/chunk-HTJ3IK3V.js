import{c as _e,d as xt}from"./chunk-B4PP3UR2.js";import{c as ze,d as Ft}from"./chunk-YIP4GR2E.js";import{d as Fe,e as Bt}from"./chunk-5TAMAFA5.js";import{a as At}from"./chunk-7W3VFIA6.js";import{G as Ge}from"./chunk-TKHJTMDB.js";import{c as xe,d as pt}from"./chunk-XZKAQRVI.js";import{A as Ct,B as Dt,C as ve,J as It,N as Ot,R as Lt,W as $t,_ as Tt,d as vt,h as ft,l as Et,o as Ye,p as gt,r as ht,s as bt,w as nt,y as lt,z as St}from"./chunk-CMTK4D4K.js";import{c as De,d as Pt}from"./chunk-CICJSBLQ.js";import{d as Ue}from"./chunk-2YAUIENJ.js";import{a as at,b as mt,o as it,p as yt}from"./chunk-TXZZYEY4.js";import{a as ke,b as Be}from"./chunk-J32UWVCU.js";import{a as tt}from"./chunk-DNINIZJD.js";import{c as _,g as me,h as We,j as D,k as Ae}from"./chunk-L3ECGIWB.js";var O=me(tt(),1);var we=me(Ae(),1);var w=me(Ae(),1);var wt=me(Ae(),1);var fe=class extends O.EntityDialog{constructor(t,e,a,o,i,r,d){super();this.form=new nt(this.idPrefix);this.ExternalEarnings=[];this.ExternalDeductions=[];this.EarningsString=[];this.DeductionsString=[];this.FinalEarnings=[];this.FinalDeductions=[];this.EmployerContributions=[];this.ListOfEpfSubjection=[];this.ListOfEisSubjection=[];this.ListOfHrdfSubjection=[];this.ListOfSocsoSubjection=[];this.ListOfPcbSubjection=[];this.ListOfCriteria=[];this.NoPaidLeaveId=[];this.MoneyClaimingId=[];this.OtPayId=[];this.LateArrivalId=[];this.EarlyLeavingId=[];this.listOfDicts=[];this.AllowanceId=[];this.DeductionId=[];this.Wiz=t,this.WizEmployeeRowId=e,this.PayYear=a,this.PayMonth=o,this.PayDateWiz=i,this.PayPeriodStart=r,this.PayPeriodEnd=d;var l=this;this.ReadOnly=!1,ve.List({},c=>{l.ListOfPayrollData=c.Entities})}getFormKey(){return nt.formKey}getRowDefinition(){return Dt}getService(){return ve.baseUrl}dialogClose(){$("#NewEarningsCategory").remove(),super.dialogClose()}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+550,t}ResetTable(){console.log("reset  table"),$("#AllowanceDeductionBody, #EarningDeductionBody, #MoneyClaimingBody").empty(),$(`#EarlyLeavingRate, #LateArrivalRate, #EarlyLeavingSubtotal, #LateArrivalSubtotal,
        #NplDayRate, #totalOt, #NplHrRate, #AbsentDayRate`).text(0);var t=document.getElementById("Ot1.0x");t&&(t.textContent="0"),t=document.getElementById("Ot1.5x"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0x"),t&&(t.textContent="0"),t=document.getElementById("Ot1.0xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot1.5xValueTotal"),t&&(t.textContent="0"),t=document.getElementById("Ot2.0xValueTotal"),t&&(t.textContent="0"),$(`#OtOnePointFiveTime, #OtTwoTime, #OtOneTime, #TotalSOCSO, #TotalEPF, #Deduction,
        #Allowance, #TotalEIS, #TotalHRD, #TotalTaxableWage, #GrossWage, #EmployerEPF, #EmployeeEPF,
        #EmployerSOCSO, #EmployeeSOCSO, #EmployerEIS, #EmployeeEIS, #HRD, #PCB, #TotalAllowance, #TotalDeduction,
        #EarlyLeavingMinutes,  #LateArrivalMinutes, #GrossWage, #NettWage, #GrossWage, #totalEmployerContribution,
        #totalEmployeeContribution`).val(0)}Setup(){var t=this,e=this.idPrefix+"PropertyGrid",a=document.getElementById(e);console.log(a);var o=document.createElement("DIV");o.classList.add("category-title"),o.setAttribute("id","PayRoll-Description"),o.style.display="flex",a.appendChild(o);var i=document.createElement("a");i.classList.add("category-anchor");var r=document.createTextNode("Employee Payroll");i.appendChild(r),document.getElementById("PayRoll-Description").append(i);var d=document.getElementById("PayRoll-Description");d.insertAdjacentHTML("afterend",'<div class="DataGrid" id="PayRollGrid"></div>');var l=document.getElementById("PayRollGrid");l.style.display="flex";var c=document.createElement("TABLE");c.style.width="66%",c.id="PayrollTable",c.className="table";var m=document.createElement("thead");m.className="thead-dark",m.id="PayrollTableHeader";var E=document.createElement("tbody");E.id="PayrollTableBody";var s=document.createElement("tr"),u=document.createElement("tfoot");u.id="PayrollTableFoot";var f=document.createElement("TH"),p=document.createElement("TH"),b=document.createElement("TH"),P=document.createElement("TH");f.style.width="25%",p.style.width="25%",b.style.width="25%",P.style.width="25%";var T=document.createTextNode("Description"),y=document.createTextNode("Earnings"),S=document.createTextNode("Description"),g=document.createTextNode("Deductions");f.appendChild(T),p.appendChild(y),b.appendChild(S),P.appendChild(g);var C=document.createElement("TABLE");C.style.height="55%",C.id="EmployerContributionsTable";var j=document.createElement("thead");j.className="thead-dark",j.id="EmployerContributionsHeader";var W=document.createElement("tbody");W.id="EmployerContributionsBody";var U=document.createElement("tfoot");U.id="EmployerContributionsFoot";var B=document.createElement("TR"),Y=document.createElement("TH"),H=document.createElement("TH");Y.style.width="50%",H.style.width="50%";var F=document.createTextNode("Description"),k=document.createTextNode("Employer Contributions");Y.appendChild(F),H.appendChild(k),s.appendChild(f),s.appendChild(p),s.appendChild(b),s.appendChild(P),m.appendChild(s),c.appendChild(m),c.appendChild(E),c.appendChild(u),B.appendChild(Y),B.appendChild(H),j.appendChild(B),C.appendChild(j),C.appendChild(W),C.appendChild(U);var R=document.createElement("div");R.className="col-md-6",R.id="left";var I=document.createElement("div");I.id="NplAbsentTableContainer",R.appendChild(I);var x=document.createElement("div");x.id="OvertimeTableContainer",R.appendChild(x);var A=document.createElement("div");A.id="EarlyLeavingTableContainer",R.appendChild(A);var M=document.createElement("table");M.id="NplAbsentTable";var n=document.createElement("thead");n.innerHTML=`
      <tr>
        <th rowspan="2">NPL/Absent</th>
        <th colspan="3" id="totalNplAbsentDeduction">
            <span>Total:</span> <span id="totalNplAbsent">0</span>
        </th>
      </tr>
      `,M.appendChild(n);var oe=[{label:"NPL Day",id:"NplDayRate",inputId:"NplDay",valueId:"NplDayValue",value:0,total:0,adjustment:0},{label:"NPL Hourly",id:"NplHrRate",inputId:"NplHr",valueId:"NplHrValue",value:0,total:0,adjustment:0},{label:"Absent Day",id:"AbsentDayRate",inputId:"AbsentDay",valueId:"AbsentDayValue",value:0,total:0,adjustment:0}];let J=document.createElement("tbody");J.id="NplAbsentTableBody",oe.forEach(L=>{let G=document.createElement("tr");G.innerHTML=`
        <td class="Description">${L.label}</td>
        <td class="rates"> <span class="ratesValue" id = ${L.id} > ${L.value} </span> </td>
        <td class ="numberInputContainer"> <input id = ${L.inputId} min="0" class="nplDates numberInput" type="number" value="${L.total.toFixed(2)}" ></td>
        <td class ="subTotalContainer">  <span id = ${L.valueId} class="subTotal">0.00</span> </td>
      `,J.appendChild(G)}),M.appendChild(J),I.appendChild(M);var X=document.createElement("table");X.id="OvertimeTable";var ye=document.createElement("thead");ye.innerHTML=`
      <tr>
        <th rowspan="2">Overtime</th>
        <th colspan="3" id="OvertimeAddition">
            <span>Total:</span> <span id="totalOt">0</span>
        </th>
      </tr>
      `,X.appendChild(ye);var pe=[{label:"OT1.0x",descId:"flatOtDesc",id:"Ot1.0x",valueId:"Ot1.0xValue",inputId:"OtOneTime",value:0,total:0,adjustment:0},{label:"OT1.5x",descId:"OnePointFiveOtDesc",id:"Ot1.5x",valueId:"Ot1.5xValue",inputId:"OtOnePointFiveTime",value:0,total:0,adjustment:0},{label:"OT2.0x",descId:"TwoOtDesc",id:"Ot2.0x",valueId:"Ot2.0xValue",inputId:"OtTwoTime",value:0,total:0,adjustment:0}];let ae=document.createElement("tbody");ae.id="OvertimeTableBody",pe.forEach(L=>{let G=document.createElement("tr");G.innerHTML=`
        <td class="Description" id=${L.descId}>${L.label}</td>
        <td class="rates"> <span class="ratesValue" id=${L.id}> ${L.value} </span> </td>
        <td class ="numberInputContainer"> <input id=${L.inputId} min="0" class="overtime numberInput" type="number" value="${L.total.toFixed(2)}" ></td>
        <td>  <span class="subTotal" id=${L.valueId}Total>0.00</span> </td>
      `,ae.appendChild(G)}),X.appendChild(ae),x.appendChild(X);var Q=document.createElement("table");Q.id="EarlyLeavingTable";var Me=document.createElement("thead");Me.innerHTML=`
      <tr>
        <th rowspan="2">Time Deduction</th>
        <th colspan="3" id="ShiftAddition">
            <span>Total:</span> <span id="totalTimeDeduction">0</span>
        </th>
      </tr>
      `,Q.appendChild(Me);var V=[{label:"Early Leaving",Minutes:"EarlyLeavingMinutes",RateId:"EarlyLeavingRate",SubtotalId:"EarlyLeavingSubtotal",total:0,adjustment:0},{label:"Late Arrival",Minutes:"LateArrivalMinutes",RateId:"LateArrivalRate",SubtotalId:"LateArrivalSubtotal",total:0,adjustment:0}];let ge=document.createElement("tbody");ge.id="EarlyLeavingTableBody",V.forEach(L=>{let G=document.createElement("tr");G.innerHTML=`
        <td class="Description">${L.label}</td>
        <td class="rates"> <span id=${L.RateId} class="ratesValue">0</span> </td>
        <td class ="numberInputContainer"> <input min="0" id=${L.Minutes} class="time numberInput" type="number" value="${L.total.toString()}" ></td>
        <td>  <span class="subTotal"  id=${L.SubtotalId} >0.00</span> </td>
      `,ge.appendChild(G)}),Q.appendChild(ge),A.appendChild(Q);var re=document.createElement("div");re.className="col-md-4",re.id="center";var ee=document.createElement("div");ee.id="AllowanceDeductionContainer",re.appendChild(ee);var he=document.createElement("table");he.id="AllowanceDeductionTable";var N=document.createElement("thead");N.innerHTML=`
      <tr>
        <th colspan="3">Allowance/Deduction</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,he.appendChild(N);let Oe=document.createElement("tbody");Oe.id="AllowanceDeductionBody",he.appendChild(Oe),ee.appendChild(he);var Le=document.createElement("div");Le.id="MoneyClaimingContainer",re.appendChild(Le);var He=document.createElement("table");He.id="MoneyClaimingTable";var v=document.createElement("thead");v.innerHTML=`
      <tr>
        <th colspan="3">Money Claiming</th>
      </tr>
      <tr>
        <th>Category</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,He.appendChild(v);let ie=document.createElement("tbody");ie.id="MoneyClaimingBody",He.appendChild(ie),Le.appendChild(He);var h=document.createElement("div");h.id="EarningDeductionContainer",re.appendChild(h);var de=document.createElement("table");de.id="EarningDeductionTable";var Ne=document.createElement("thead");Ne.innerHTML=`
      <tr>
        <th colspan="3">Extra Earnings/Deductions</th>
      </tr>
      <tr>
        <th>Code</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
      `,de.appendChild(Ne);let $e=document.createElement("tbody");$e.id="EarningDeductionBody",de.appendChild($e),h.appendChild(de);var ne=document.createElement("div");ne.className="col-md-2 section",ne.id="right";let Xe=`
      <h3>Statutory Contribution</h3>
      <table class = "StatutoryContribution">

        <tr>
          <td></td>
          <td>Employer</td>
          <td>Employee</td>
        </tr>

        <tr>
          <td>EPF</td>
          <td><input class="govPayment" id="EmployerEPF" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEPF" type="number" value="0.0" ></td>
        </tr>

        
        <tr>
          <td>SOCSO </td>
          <td><input class="govPayment" id="EmployerSOCSO" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeSOCSO" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>EIS </td>
          <td><input class="govPayment" id="EmployerEIS" type="number" value="0.0" ></td>
          <td><input class="govPayment" id="EmployeeEIS" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>HRD</td>
          <td><input class="govPayment" id="HRD" type="number" value="0.0" ></td>
          <td></td>
        </tr>

        <tr>
          <td>PCB</td>
           <td></td>
          <td><input class="govPayment" id="PCB" type="number" value="0.0" ></td>
        </tr>

        <tr>
          <td>Total</td>
          <td><input class="govPayment" id="totalEmployerContribution" type="number" value="0.0" readonly></td>
          <td><input class="govPayment" id="totalEmployeeContribution" type="number" value="0.0" readonly></td>
        </tr>


      </table>
    `,be=`
      <h3>Total Wages</h3>
      <table class = "TotalWages" >
        <tr>
          <td>Total Allowance</td>
          <td><input id="TotalAllowance" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Deduction</td>
          <td><input id="TotalDeduction" type="number" value="0.00" readonly></td>
        </tr>
        <tr>
          <td>EPF Wage</td>
          <td><input id="TotalEPF" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>HRD Wage</td>
          <td><input id="TotalHRD" type="number" value="0.0" readonly></td>
        </tr>



        <tr>
          <td>SOCSO Wage</td>
          <td><input id="TotalSOCSO" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>EIS Wage</td>
          <td><input id="TotalEIS" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Total Taxable Wage</td>
          <td><input id="TotalTaxableWage" type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Gross Wage</td>
          <td><input id="GrossWage"  type="number" value="0.0" readonly></td>
        </tr>
        <tr>
          <td>Nett Wage</td>
          <td><input id="NettWage" type="number" value="0.0" readonly></td>
        </tr>
      </table>
    `;var ee=document.createElement("div");ee.id="AllowanceDeductionContainer",ee.className="section",ee.innerHTML=Xe,ne.appendChild(ee);var Pe=document.createElement("div");Pe.id="Container2",Pe.className="section",Pe.innerHTML=be,ne.appendChild(Pe),document.getElementById("PayRollGrid").append(R),document.getElementById("PayRollGrid").append(re),document.getElementById("PayRollGrid").append(ne);var se=document.getElementsByClassName("govPayment");$(se).on("change",function(L){return D(this,null,function*(){t.updateWages()})});var ue=document.getElementsByClassName("numberInput");$(ue).on("change",function(L){return D(this,null,function*(){t.updateTotals()})})}onDialogOpen(){super.onDialogOpen();var t=this;$t.List({},e=>{for(var a in e.Entities)if(e.Entities[a].IsActive==1){for(var o=e.Entities[a],i=Object.keys(o),r=0;r<i.length;r++){var d=i[r];if(!(d.toLowerCase()=="id"||d.toLowerCase()=="isactive")&&!(o[d]!=!0&&o[d]!=!1&&o[d]!==void 0)){var l=d.replace(/([A-Z])/g," $1").trim();this.ListOfPcbSubjection.push({id:r,name:l,subjection:o[d]})}}break}ft.List({},c=>{for(var m in c.Entities)if(c.Entities[m].IsActive==1){for(var E=c.Entities[m],b=Object.keys(E),s=0;s<b.length;s++){var u=b[s];if(!(u.toLowerCase()=="id"||u.toLowerCase()=="isactive")&&!(E[u]!=!0&&E[u]!=!1&&E[u]!==void 0)){var f=u.replace(/([A-Z])/g," $1").trim();this.ListOfEpfSubjection.push({id:s,name:f,subjection:E[u]})}}break}for(var p=this.ListOfEpfSubjection,b=Object.keys(p),s=0;s<b.length;s++){var u=b[s];this.ListOfCriteria.push(p[u].name)}vt.List({},P=>{for(var T in P.Entities)if(P.Entities[T].IsActive==1){for(var y=P.Entities[T],S=Object.keys(y),g=0;g<S.length;g++){var C=S[g];if(!(C.toLowerCase()=="id"||C.toLowerCase()=="isactive")&&!(y[C]!=!0&&y[C]!=!1&&y[C]!==void 0)){var j=C.replace(/([A-Z])/g," $1").trim();this.ListOfEisSubjection.push({id:g,name:j,subjection:y[C]})}}break}Et.List({},W=>{for(var U in W.Entities)if(W.Entities[U].IsActive==1){for(var B=W.Entities[U],Y=Object.keys(B),H=0;H<Y.length;H++){var F=Y[H];if(!(F.toLowerCase()=="id"||F.toLowerCase()=="isactive")&&!(B[F]!=!0&&B[F]!=!1&&B[F]!==void 0)){var k=F.replace(/([A-Z])/g," $1").trim();this.ListOfHrdfSubjection.push({id:H,name:k,subjection:B[F]})}}break}Tt.List({},R=>{for(var I in R.Entities)if(R.Entities[I].IsActive==1){for(var x=R.Entities[I],A=Object.keys(x),M=0;M<A.length;M++){var n=A[M];if(!(n.toLowerCase()=="id"||n.toLowerCase()=="isactive")&&!(x[n]!=!0&&x[n]!=!1&&x[n]!==void 0)){var oe=n.replace(/([A-Z])/g," $1").trim();this.ListOfSocsoSubjection.push({id:M,name:oe,subjection:x[n]})}}break}if(this.isNew()){var J="Overtime Payments",X=this.CheckSubjection(this.ListOfEisSubjection,J),ye=this.CheckSubjection(this.ListOfEpfSubjection,J),pe=this.CheckSubjection(this.ListOfHrdfSubjection,J),ae=this.CheckSubjection(this.ListOfPcbSubjection,J),Q=this.CheckSubjection(this.ListOfSocsoSubjection,J);t.form.OtSubjectEis.value=X==1,t.form.OtSubjectEpf.value=ye==1,t.form.OtSubjectHrdf.value=pe==1,t.form.OtSubjectPcb.value=ae==1,t.form.OtSubjectSocso.value=Q==1,$("#totalOt").attr("eis",X),$("#totalOt").attr("epf",ye),$("#totalOt").attr("hrdf",pe),$("#totalOt").attr("pcb",ae),$("#totalOt").attr("socso",Q)}})})})})})}calculateAge(){let t=new Date(this.dateString),e=new Date(this.form.BirthDay.value),a=t.getFullYear()-e.getFullYear(),o=new Date(t.getFullYear(),e.getMonth(),e.getDate());t<o&&o.setFullYear(o.getFullYear()-1);let i=t.getTime()-o.getTime(),r=new Date(o);r.setFullYear(r.getFullYear()+1);let d=r.getTime()-o.getTime(),l=i/d;return a+l}dialogOpen(t){$(".field.BasicPay, .field.DailyPay, .field.DailyRate, .field.DaysWorked, .field.HourlyRate, .field.BirthDay, .field.Age").addClass("col-md-2"),$(" .field.WorkingSpouse").addClass("col-md-1"),$(".field.HrdfClass").addClass("col-md-2"),$(" .field.ChildrenUnderEighteen, .field.ChildrenInUniversity, .field.DisabledChildInUniversity, .field.DisabledChild").addClass("col-md-2"),$(".field.MaritalStatus").addClass("col-md-3"),$(`.field.MaritalStatus label.caption, .field.WorkingSpouse label.caption, .field.ChildrenUnderEighteen label.caption, .field.ChildrenInUniversity label.caption,
        .field.DisabledChildInUniversity label.caption, .field.DisabledChild label.caption, .field.Age label.caption, .field.BirthDay label.caption, .field.HrdfClass label.caption`).removeClass("caption"),this.ResetTable(),$(".field.EisClass").addClass("col-md-2"),$(".field.SocsoClass").addClass("col-md-6"),$(".field.EpfClass").addClass("col-md-3"),$(".field.TaxClass").addClass("col-md-1"),$(`.field.BasicPay label.caption, .field.DailyPay label.caption, .field.DailyRate label.caption, .field.DaysWorked label.caption,
        .field.HourlyRate label.caption, .field.EisClass label.caption, .field.SocsoClass label.caption, .field.EpfClass label.caption, .field.HrdfClass label.caption, .field.TaxClass label.caption `).removeClass("caption"),O.EditorUtils.setReadonly(this.form.BasicPay.element,!0),O.EditorUtils.setReadonly(this.form.DaysWorked.element,!0),O.EditorUtils.setReadonly(this.form.HourlyRate.element,!0),O.EditorUtils.setReadonly(this.form.DailyRate.element,!0),O.EditorUtils.setReadonly(this.form.TaxClass.element,!0),O.EditorUtils.setReadonly(this.form.Age.element,!0),O.EditorUtils.setReadonly(this.form.BirthDay.element,!0),this.form.EpfClass.value=1 .valueOf().toString(),$(`.DeductedEarlyLeavingList, .OneTimeDeductionList, .DeductedNoPaidLeaveList,
        .DeductedLateArrivalList, .OneTimeAllowanceList, .PaidMoneyClaimingList, .PaidOtList, .EarlyLeavingRate, .LateArrivalRate, .EarlyLeaving,
        .LateArrival, .FlatOt, .OtOne, .OtOnePointFive, .OtTwo, .NPLHourlyRate, .NPLDailyRate, .NPLHourly, .NPLDaily, .AbsentDailyRate, .AbsentDaily,
        .OtSubjectEpf, .OtSubjectEis, .OtSubjectPcb, .OtSubjectSocso, .OtSubjectHrdf, .AllowanceList, .DeductionList, .OtOnePointFiveRate, .OtTwoRate, .HrdfClass`).hide();function e(l){let c=new Date(l);if(isNaN(c.getTime()))return l;{c.setDate(28);let m=c.getFullYear(),E=("0"+(c.getMonth()+1)).slice(-2),s=("0"+c.getDate()).slice(-2);return`${m}-${E}-${s}`}}_(e,"isValidDate");var a=this,o=!0;for((0,we.serviceCall)({service:Ge.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:l=>{a.dateString=l,o=!1}});o==!0;);Ue.List({},l=>{for(var c in l.Entities)if(l.Entities[c].IsActive==1){this.DeductEarlyLeaving=l.Entities[c].DeductSalaryIfEarlyLeaving,this.DeductLateArrival=l.Entities[c].DeductSalaryIfLate,this.PayDate=l.Entities[c].PayDay,a.PublicHolidayMultiplier=l.Entities[c].PublicHolidayOnePointFive==!0?1.5:2,a.WeekendMultiplier=l.Entities[c].WeekendOnePointFive==!0?1.5:2,a.WeekdayMultiplier=l.Entities[c].WeekdayOnePointFive==!0?1.5:2;break}var m=new Date(a.dateString),E=m.getMonth(),s=m.getFullYear(),u=s.toString()+"-"+E.toString().padStart(2,"0")+"-"+this.PayDate.toString().padStart(2,"0");u=e(u);var f=new Date(s,E,this.PayDate),p=f.getFullYear().toString(),b=(f.getMonth()+1).toString(),P=f.getDate().toString();E=E-1;var T=new Date(s,E,this.PayDate);T.setDate(T.getDate()+1);var y=T.getFullYear().toString(),S=(T.getMonth()+1).toString(),g=T.getDate().toString(),C=b.padStart(2,"0")+"/"+P.padStart(2,"0")+"/"+p,j=S.padStart(2,"0")+"/"+g.padStart(2,"0")+"/"+y;this.isNew()&&(a.form.PayDate.value=C,a.form.PayPeriodEnd.value=C,a.form.PayPeriodStart.value=j)}),super.dialogOpen(t),a.isNew()&&this.applyChangesButton.hide(),O.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var i=this.form.EmployeeRowId.value;let r=["Deduction","Earnings","Nett","EmployeeEIS","EmployeeEPF","EmployeeSOCSO","EmployeePCB","PayrollTable","EmployerTable","EmployerHRDF","EmployerEPF","EmployerEIS","EmployerSOCSO"];for(var d in r)$("."+r[d]).hide();this.Setup(),Be.List({},l=>{var c=document.getElementById(this.idPrefix+"PayPeriodStart"),m=document.getElementById(this.idPrefix+"PayPeriodEnd"),E=document.getElementById(this.idPrefix+"EmployeeRowId"),s=document.getElementById(this.idPrefix+"PayMonth"),u=document.getElementById(this.idPrefix+"PayYear"),f=document.getElementById(this.idPrefix+"HrdfClass"),p=document.getElementById(this.idPrefix+"EisClass"),b=document.getElementById(this.idPrefix+"SocsoClass"),P=document.getElementById(this.idPrefix+"EpfClass"),T=document.getElementById(this.idPrefix+"MaritalStatus"),y=document.getElementById(this.idPrefix+"WorkingSpouse"),S=document.getElementById(this.idPrefix+"ChildrenUnderEighteen"),g=document.getElementById(this.idPrefix+"ChildrenInUniversity"),C=document.getElementById(this.idPrefix+"DisabledChild"),j=document.getElementById(this.idPrefix+"DisabledChildInUniversity");let W=new O.Select2Editor($(s)),U=new O.Select2Editor($(u)),B=["January","February","March","April","May","June","July","August","September","October","November","December"];var Y=new Date(a.dateString),H=Y.getFullYear(),F=Y.getMonth();for(let n=0;n<B.length;n++)W.addItem({id:n.toString(),text:B[n].toString()});a.isNew()&&W.set_value(F.toString());for(let n=-1;n<2;n++)U.addItem({id:(H+n).toString(),text:(H+n).toString()});a.isNew()&&U.set_value(H.toString());let k=new O.Select2Editor($(E)),R=[];for(var I in l.Entities)k.addItem({id:l.Entities[I].Id.toString(),text:l.Entities[I].EmployeeID.toString()}),R.push({id:l.Entities[I].Id,name:l.Entities[I].EmployeeName,BasicPay:l.Entities[I].BasicSalary,Allowance:l.Entities[I].Allowance,type:l.Entities[I].EmployeeType,EisClass:l.Entities[I].EisClass,EpfClass:l.Entities[I].EpfClass,SocsoClass:l.Entities[I].SocsoClass,MaritalStatus:l.Entities[I].MaritalStatus,WorkingSpouse:l.Entities[I].WorkingSpouse,ChildrenUnderEighteen:l.Entities[I].ChildrenUnderEighteen,ChildrenInUniversity:l.Entities[I].ChildrenInUniversity,DisabledChildInUniversity:l.Entities[I].DisabledChildInUniversity,DisabledChild:l.Entities[I].DisabledChild,Birthday:l.Entities[I].Birthday,HrdfClass:l.Entities[I].HRDFClass});if(this.listOfDicts=R,a.isNew()&&$(E).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),a.Wiz!=1&&($(p).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(b).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(f).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(P).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(y).on("change",function(n){return D(this,null,function*(){console.log("haha"),n.stopImmediatePropagation(),a.updatePayroll()})}),$(S).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(T).on("change",function(n){return D(this,null,function*(){console.log("hhaa"),parseInt(a.form.MaritalStatus.value)==1 .valueOf()?$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").show():parseInt(a.form.MaritalStatus.value)==0 .valueOf()&&$(".WorkingSpouse, .ChildrenUnderEighteen, .ChildrenInUniversity, .DisabledChild, .DisabledChildInUniversity").hide()})}),$(g).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(C).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})}),$(j).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.updatePayroll()})})),this.isNew())$(s).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(u).on("change",function(n){return D(this,null,function*(){n.stopImmediatePropagation(),a.GeneratePayrollTable(1)})}),$(c).on("change",function(n){return D(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,w.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodStart.value="";return}a.GeneratePayrollTable(0)})}),$(m).on("change",function(n){return D(this,null,function*(){if(a.form.PayPeriodStart.valueAsDate>a.form.PayPeriodEnd.valueAsDate){(0,w.alertDialog)("Pay period start cannot be ahead of pay period end"),a.form.PayPeriodEnd.value="";return}a.GeneratePayrollTable(0)})}),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.HrdfClass, .field.addEarnings, .field.addDeductions,
        .field.BirthDay, .field.Age,  .addEarnings, .addDeductions`).hide();else if(!this.isNew()){O.EditorUtils.setReadonly(this.form.PayMonth.element,!0),O.EditorUtils.setReadonly(this.form.PayYear.element,!0),O.EditorUtils.setReadonly(this.form.PayDate.element,!0),O.EditorUtils.setReadonly(this.form.PayPeriodEnd.element,!0),O.EditorUtils.setReadonly(this.form.PayPeriodStart.element,!0),$(u).val(this.form.PayYear.value).trigger("change"),$(s).val(this.form.PayMonth.value).trigger("change");for(var I in R)R[I].id==parseInt(i)&&(this.EmployeeType=R[I].type);$(E).val(i.toString()).trigger("change"),$(".HrdfClass").show(),O.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),$("#PCB").val(this.form.EmployeePCB.value),$("#EmployeeEIS").val(this.form.EmployeeEIS.value),$("#EmployeeEPF").val(this.form.EmployeeEPF.value),$("#EmployeeSOCSO").val(this.form.EmployeeSOCSO.value),$("#EmployerEIS").val(this.form.EmployerEIS.value),$("#EmployerEPF").val(this.form.EmployerEPF.value),$("#HRD").val(this.form.EmployerHRDF.value),$("#EmployerSOCSO").val(this.form.EmployerSOCSO.value),$("#NplDayRate").text(this.form.NPLDailyRate.value),$("#NplHrRate").text(this.form.NPLHourlyRate.value),$("#AbsentDayRate").text(this.form.AbsentDailyRate.value),$("#NplDay").val(this.form.NPLDaily.value),$("#NplHr").val(this.form.NPLHourly.value),$("#AbsentDay").val(this.form.AbsentDaily.value),document.getElementById("Ot1.0x").textContent=this.form.FlatOt.value.toString(),document.getElementById("Ot1.5x").textContent=this.form.OtOnePointFiveRate.value.toString(),document.getElementById("Ot2.0x").textContent=this.form.OtTwoRate.value.toString(),$("#OtOneTime").val(this.form.OtOne.value),$("#OtOnePointFiveTime").val(this.form.OtOnePointFive.value),$("#OtTwoTime").val(this.form.OtTwo.value),$("#EarlyLeavingRate").text(this.form.EarlyLeavingRate.value),$("#LateArrivalRate").text(this.form.LateArrivalRate.value),$("#EarlyLeavingMinutes").val(this.form.EarlyLeaving.value),$("#LateArrivalMinutes").val(this.form.LateArrival.value),$("#totalOt").attr("eis",a.form.OtSubjectEis.value.toString()),$("#totalOt").attr("epf",a.form.OtSubjectEpf.value.toString()),$("#totalOt").attr("hrdf",a.form.OtSubjectHrdf.value.toString()),$("#totalOt").attr("pcb",a.form.OtSubjectPcb.value.toString()),$("#totalOt").attr("socso",a.form.OtSubjectSocso.value.toString());let n=0;for(n=0;n<this.form.AllowanceList.value.length;n++){var x=document.createElement("tr");x.innerHTML=`<td>${this.form.AllowanceList.value[n].code}</td><td>${this.form.AllowanceList.value[n].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${this.form.AllowanceList.value[n].SubjectionEis.toString()} epf =  ${this.form.AllowanceList.value[n].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.AllowanceList.value[n].SubjectionHrdf.toString()} pcb =  ${this.form.AllowanceList.value[n].SubjectionPcb.toString()}
                                                socso =  ${this.form.AllowanceList.value[n].SubjectionSocso.toString()} 
                                            >${this.form.AllowanceList.value[n].AllowanceAmount}</td>`,$("#AllowanceDeductionBody").append(x)}for(n=0;n<this.form.DeductionList.value.length;n++){var x=document.createElement("tr");x.innerHTML=`<td>${this.form.DeductionList.value[n].code}</td><td>${this.form.DeductionList.value[n].Description}</td><td class = "DeductionAmount">${this.form.DeductionList.value[n].DeductionAmount}</td>`,$("#AllowanceDeductionBody").append(x)}for(n=0;n<this.form.PaidMoneyClaimingList.value.length;n++){var x=document.createElement("tr");x.innerHTML=`<td>${this.form.PaidMoneyClaimingList.value[n].ClaimingCategory}</td><td>${this.form.PaidMoneyClaimingList.value[n].Description}</td>
                                            <td  eis =  ${this.form.PaidMoneyClaimingList.value[n].SubjectionEis.toString()} epf =  ${this.form.PaidMoneyClaimingList.value[n].SubjectionEpf.toString()}
                                            hrdf =  ${this.form.PaidMoneyClaimingList.value[n].SubjectionHrdf.toString()} pcb =  ${this.form.PaidMoneyClaimingList.value[n].SubjectionPcb.toString()}
                                                socso =  ${this.form.PaidMoneyClaimingList.value[n].SubjectionSocso.toString()} 
                                            >${this.form.PaidMoneyClaimingList.value[n].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(x)}for(n=0;n<this.form.PayrollEarnings.value.length;n++){var A=this.form.PayrollEarnings.value[n],M=document.createElement("tr"),M=document.createElement("tr");M.innerHTML=`<td> <span>${A.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${A.SubjectionToEis} epf = ${A.SubjectionToEpf} hrdf = ${A.SubjectionToHrdf}
                             pcb = ${A.SubjectionToPcb} socso = ${A.SubjectionToSocso}  value = ${A.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(M)}for(n=0;n<this.form.PayrollDeductions.value.length;n++){A=this.form.PayrollDeductions.value[n];var M=document.createElement("tr");M.innerHTML=`<td>${A.DeductionCode}  <button class="remove">\xD7</button>
                            </td><td>${A.Description}</td><td> <input class = numberInput type="number" max="0"  value = "${A.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(M)}$(".remove").on("click",function(oe){return D(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(oe){return D(this,null,function*(){a.updatePayroll()})}),a.updateTotals(),a.updatePayroll()}a.Wiz==1&&(a.form.EmployeeRowId.value=a.WizEmployeeRowId.toString(),a.form.PayMonth.value=a.PayMonth,a.form.PayYear.value=a.PayYear,a.form.PayPeriodStart.value=a.PayPeriodStart,a.form.PayPeriodEnd.value=a.PayPeriodEnd,a.form.PayDate.value=a.PayDateWiz)})}updatePayroll(){var t=this;if(this.extraEarningDeduction=0,(0,w.isEmptyOrNull)(t.form.EpfClass.value)||(0,w.isEmptyOrNull)(t.form.EisClass.value)||(0,w.isEmptyOrNull)(t.form.SocsoClass.value)||(0,w.isEmptyOrNull)(t.form.WorkingSpouse.value)||(0,w.isEmptyOrNull)(t.form.ChildrenUnderEighteen.value)||(0,w.isEmptyOrNull)(t.form.ChildrenInUniversity.value)||(0,w.isEmptyOrNull)(t.form.DisabledChild.value)||(0,w.isEmptyOrNull)(t.form.DisabledChildInUniversity.value))return;var e=this.form.BasicPay.value,a=parseFloat(document.getElementById("totalNplAbsent").innerHTML),o=parseFloat(document.getElementById("totalTimeDeduction").innerHTML),i=document.getElementById("totalOt"),r=parseFloat(i.innerHTML);let d=a+o,l=0,c=0,m=0,E=0,s=0,u=0,f=0,p=document.getElementById("AllowanceDeductionBody");p&&Array.from(p.rows).forEach(y=>{let S=y.cells[2],g=parseFloat(S.innerText.trim())||0;g>0?l+=g:g<0&&(c+=g),S.getAttribute("eis")==="true"&&(m+=g),S.getAttribute("epf")==="true"&&(E+=g),S.getAttribute("hrdf")==="true"&&(s+=g),S.getAttribute("pcb")==="true"&&(u+=g),S.getAttribute("socso")==="true"&&(f+=g)}),$("#TotalAllowance").val(l),$("#TotalDeduction").val(c);let b=document.getElementById("MoneyClaimingBody");b&&Array.from(b.rows).forEach(y=>{let S=y.cells[2],g=parseFloat(S.innerText.trim())||0;t.extraEarningDeduction+=g,S.getAttribute("eis")==="true"&&(m+=g),S.getAttribute("epf")==="true"&&(E+=g),S.getAttribute("hrdf")==="true"&&(s+=g),S.getAttribute("pcb")==="true"&&(u+=g),S.getAttribute("socso")==="true"&&(f+=g)});let P=document.getElementById("EarningDeductionBody");P&&Array.from(P.rows).forEach(y=>{console.log(y);let S=y.querySelector("input.numberInput"),g=parseFloat(S.value)||0;t.extraEarningDeduction+=g,S.getAttribute("eis")==="true"&&(m+=g),S.getAttribute("epf")==="true"&&(E+=g),S.getAttribute("hrdf")==="true"&&(s+=g),S.getAttribute("pcb")==="true"&&(u+=g),S.getAttribute("socso")==="true"&&(f+=g)}),i.getAttribute("eis")==="true"&&(m+=r),i.getAttribute("epf")==="true"&&(E+=r),i.getAttribute("hrdf")==="true"&&(s+=r),i.getAttribute("pcb")==="true"&&(u+=r),i.getAttribute("socso")==="true"&&(f+=r),m+=e,E+=e,s+=e,u+=e,f+=e,m-=d,E-=d,s-=d,u-=d,f-=d,$("#TotalEPF").val(E.toFixed(2)),$("#TotalHRD").val(s.toFixed(2)),$("#TotalSOCSO").val(f.toFixed(2)),$("#TotalEIS").val(m.toFixed(2)),$("#TotalTaxableWage").val(u.toFixed(2));var T=t.form.WorkingSpouse.value==!0?1:0;(0,we.serviceCall)({service:ve.baseUrl+"/CalculateGovernmentPaymentSpecial",method:"GET",data:{EisCategory:t.form.EisClass.value,EpfCategory:t.form.EpfClass.value,SocsoCategory:t.form.SocsoClass.value,HrdfCategory:t.form.HrdfClass.value,EpfAmount:E,EisAmount:m,SocsoAmount:f,PcbAmount:u,HrdfAmount:s,WorkingSpouse:T,ChildrenUnderEighteen:t.form.ChildrenUnderEighteen.value,ChildrenInUniversity:t.form.ChildrenInUniversity.value,NumberOfDisabledChild:t.form.DisabledChild.value,NumberOfDisabledChildInUni:t.form.DisabledChildInUniversity.value},async:!1,onSuccess:y=>{t.EmployerContributions.length=0,t.form.TaxClass.value=y.Entities[0].TaxClass,$("#EmployeeEPF").val(y.Entities[0].EmployeeEPF.toFixed(2)),$("#EmployeeEIS").val(y.Entities[0].EmployeeEIS.toFixed(2)),$("#PCB").val(y.Entities[0].EmployeePCB.toFixed(2)),$("#EmployeeSOCSO").val(y.Entities[0].EmployeeSOCSO.toFixed(2)),$("#EmployerEPF").val(y.Entities[0].EmployerEPF.toFixed(2)),$("#EmployerEIS").val(y.Entities[0].EmployerEIS.toFixed(2)),$("#HRD").val(y.Entities[0].EmployerHRDF.toFixed(2)),$("#EmployerSOCSO").val(y.Entities[0].EmployerSOCSO.toFixed(2)),t.updateWages()}})}updateTotals(){let t=parseFloat(document.getElementById("NplDayRate").textContent),e=parseFloat(document.getElementById("NplHrRate").textContent),a=parseFloat(document.getElementById("AbsentDayRate").textContent),o=parseFloat(document.getElementById("NplDay").value)||0,i=parseFloat(document.getElementById("NplHr").value)||0,r=parseFloat(document.getElementById("AbsentDay").value)||0;document.getElementById("NplDayValue").textContent=(t*o).toFixed(2),document.getElementById("NplHrValue").textContent=(e*i).toFixed(2),document.getElementById("AbsentDayValue").textContent=(a*r).toFixed(2);let d=t*o+e*i+a*r;document.getElementById("totalNplAbsent").textContent=d.toFixed(2);let l=parseFloat(document.getElementById("Ot1.0x").textContent),c=parseFloat(document.getElementById("Ot1.5x").textContent),m=parseFloat(document.getElementById("Ot2.0x").textContent),E=parseFloat(document.getElementById("OtOneTime").value)||0,s=parseFloat(document.getElementById("OtOnePointFiveTime").value)||0,u=parseFloat(document.getElementById("OtTwoTime").value)||0;document.getElementById("Ot1.0xValueTotal").textContent=(l*E).toFixed(2),document.getElementById("Ot1.5xValueTotal").textContent=(c*s).toFixed(2),document.getElementById("Ot2.0xValueTotal").textContent=(m*u).toFixed(2);let f=l*E+c*s+m*u;document.getElementById("totalOt").textContent=f.toFixed(2);let p=parseFloat(document.getElementById("EarlyLeavingRate").textContent),b=parseFloat(document.getElementById("LateArrivalRate").textContent),P=parseFloat(document.getElementById("EarlyLeavingMinutes").value)||0,T=parseFloat(document.getElementById("LateArrivalMinutes").value)||0;document.getElementById("EarlyLeavingSubtotal").textContent=(p*P).toFixed(2),document.getElementById("LateArrivalSubtotal").textContent=(b*T).toFixed(2);let y=p*P+b*T;document.getElementById("totalTimeDeduction").textContent=y.toFixed(2)}updateWages(){var t=this.form.BasicPay.value,e=parseFloat($("#TotalAllowance").val()),a=parseFloat($("#TotalDeduction").val()),o=parseFloat($("#totalOt").text()),i=0;document.getElementById("totalNplAbsent")&&(i=parseFloat(document.getElementById("totalNplAbsent").innerHTML));var r=0;document.getElementById("totalTimeDeduction")&&(r=parseFloat(document.getElementById("totalTimeDeduction").innerHTML));var d=t+e+o+this.extraEarningDeduction-a-i-r;$("#GrossWage").val(d.toFixed(2));let l=parseFloat($("#EmployeeEPF").val())+parseFloat($("#EmployeeSOCSO").val())+parseFloat($("#EmployeeEIS").val())+parseFloat($("#PCB").val()),c=parseFloat($("#EmployerEPF").val())+parseFloat($("#EmployerEIS").val())+parseFloat($("#EmployerSOCSO").val())+parseFloat($("#HRD").val());$("#totalEmployeeContribution").val(l.toFixed(2)),$("#totalEmployerContribution").val(c.toFixed(2));let m=d-l;$("#NettWage").val(m.toFixed(2)),this.Wiz==1&&this.saveAndCloseButton.click()}GeneratePayrollTable(t){var e=this;e.Wiz!=1&&e.ResetTable();var a=document.getElementById("PayrollTable"),o=document.getElementById(this.idPrefix+"EmployeeRowId"),i=document.getElementById(this.idPrefix+"PayMonth"),r=document.getElementById(this.idPrefix+"PayYear"),d=document.getElementById(this.idPrefix+"EmployeeName"),l=this.ExternalDeductions,c=this.ExternalEarnings,m=this.EarningsString,E=this.DeductionsString,s=e.listOfDicts;if((0,w.isEmptyOrNull)($(o).val()))e.form.EmployeeName.value="";else for(var u in s)s[u].id==$(o).val()&&$(d).val(s[u].name);if((0,w.isEmptyOrNull)($(o).val())||(0,w.isEmptyOrNull)($(i).val())||(0,w.isEmptyOrNull)($(r).val())){$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
        .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
        .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.HrdfClass, .field.EpfClass, .field.TaxClass, .addEarnings, .addDeductions,
        .field.BirthDay, .field.Age`).hide();return}else{for(var u in e.ListOfPayrollData){var f=e.ListOfPayrollData[u].PayMonth,p=e.ListOfPayrollData[u].PayYear;if(e.form.PayMonth.value==f&&e.form.PayYear.value==p&&e.form.EmployeeRowId.value==e.ListOfPayrollData[u].EmployeeRowId){e.form.EmployeeRowId.value="",(0,wt.notifyError)("The employee already have payslip for current month");return}}if(t==1){var b=e.form.PayYear.value,P=e.form.PayMonth.value,T=new Date(b,P,this.PayDate),y=T.getFullYear().toString(),S=(T.getMonth()+1).toString(),g=T.getDate().toString();P=P-1;var C=new Date(b,P,this.PayDate);C.setDate(C.getDate()+1);var j=C.getFullYear().toString(),W=(C.getMonth()+1).toString(),U=C.getDate().toString(),B=S.padStart(2,"0")+"/"+g.padStart(2,"0")+"/"+y,Y=W.padStart(2,"0")+"/"+U.padStart(2,"0")+"/"+j;e.form.PayDate.value=B,e.form.PayPeriodEnd.value=B,e.form.PayPeriodStart.value=Y}var H=!0,F=!1,k=!1,R=!1,I=!1,x=!1,A=!1,M=!1,n=!1,oe=!1,J=!1,X=!0,ye=!0,pe=!0;if(e.NoPaidLeaveId.length=0,e.MoneyClaimingId.length=0,e.OtPayId.length=0,e.EmployerContributions.length=0,l.length=0,c.length=0,m.length=0,E.length=0,e.FinalDeductions.length=0,e.FinalEarnings.length=0,e.NettEarnings=0,e.NettDeductions=0,e.AllowanceId.length=0,e.DeductionId.length=0,(0,w.isEmptyOrNull)($(i).val())&&(0,w.isEmptyOrNull)($(r).val())){e.form.PayPeriodEnd.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate),e.form.PayDate.valueAsDate=new Date(e.form.PayYear.value,e.form.PayMonth.value,e.PayDate);var C=e.form.PayPeriodEnd.valueAsDate;C.setMonth(C.getMonth()-1),C.setDate(C.getDate()-1),e.form.PayPeriodStart.valueAsDate=C}var ae=`${e.form.PayYear.value}/${e.form.PayMonth.value+1}/${1}`,Q=0;for((0,we.serviceCall)({service:ve.baseUrl+"/CalculateNplAbsentOtSpecial",method:"GET",data:{EmployeeRowID:parseInt($(o).val()),Date:ae},async:!1,onSuccess:V=>{Q=1,e.form.DaysWorked.value=V.Entities[0].NumberOfWorkingDays,$("#NplDayRate").html(V.Entities[0].NPLDaily.toFixed(2)),$("#NplHrRate").html(V.Entities[0].NPLHourly.toFixed(2)),$("#AbsentDayRate").html(V.Entities[0].AbsentDaily.toFixed(2)),$("#EarlyLeavingRate").html(V.Entities[0].EarlyLeavingRate.toFixed(2)),$("#LateArrivalRate").html(V.Entities[0].LateArrivalRate.toFixed(2)),e.form.DailyRate.value=V.Entities[0].DailyRate.toFixed(2),e.form.HourlyRate.value=V.Entities[0].HourlyRate.toFixed(2)}});Q==0;);var Me;pt.List({Criteria:O.Criteria.and(Me,[[xe.Fields.Status],"=","1"],[[xe.Fields.EmployeeRowId],"=",$(o).val()],[[xe.Fields.StartDate],"<=",e.form.PayPeriodEnd.get_value()],[[xe.Fields.EndDate],">=",e.form.PayPeriodStart.get_value()])},V=>{V.Entities.length>0&&(H=!1);var ge;for(var re in V.Entities){var he=V.Entities[re].LeaveReasonId;switch(he){case 1:F=!0;break;case 2:k=!0;break;case 3:R=!0;break;case 4:I=!0;break;case 5:x=!0;break;case 6:A=!0;break;case 7:M=!0;break;case 8:n=!0;break;case 10:oe=!0;break;case 11:J=!0;break}}for(var N in s)if(s[N].id==$(o).val()){e.form.PayrollEarnings.value.length=0,e.form.PayrollDeductions.value.length=0,$(".addEarnings, .addDeductions").show(),$(`.field.MaritalStatus, .field.WorkingSpouse, .field.ChildrenUnderEighteen, .field.ChildrenInUniversity,
                            .field.DisabledChildInUniversity, .field.DisabledChild,  .field.DaysWorked, .field.BasicPay, .field.DailyRate,
                            .field.HourlyRate, .field.EisClass, .field.SocsoClass, .field.EpfClass, .field.TaxClass, .field.BirthDay, .field.Age`).show(),$(".HrdfClass").show();var Oe=0;for((0,we.serviceCall)({service:Be.baseUrl+"/CalculateOtRate",data:{EmployeeRowID:e.form.EmployeeRowId.value,Date:ae},method:"GET",async:!1,onSuccess:v=>{if(document.getElementById("PayRoll-Description").children.length==0&&e.Setup(),console.log(v.Entities[0]),e.FixedOtRateOption=v.Entities[0].FixedOtRateOption,e.FixedOtRateOption==!1){e.form.FlatOt.value=v.Entities[0].OtRate;let ie=parseFloat(v.Entities[0].OtRate.toFixed(2)),h=(ie*1.5).toFixed(2),de=(ie*2).toFixed(2);document.getElementById("flatOtDesc").innerHTML="OT1.0x",document.getElementById("OnePointFiveOtDesc").innerHTML="OT1.5x",document.getElementById("TwoOtDesc").innerHTML="OT2.0x",document.getElementById("Ot1.0x").textContent=ie.toFixed(2),document.getElementById("Ot1.5x").textContent=h,document.getElementById("Ot2.0x").textContent=de}else document.getElementById("flatOtDesc").innerHTML="Weekday",document.getElementById("OnePointFiveOtDesc").innerHTML="Weekend",document.getElementById("TwoOtDesc").innerHTML="Public Holiday",document.getElementById("Ot1.0x").textContent=v.Entities[0].OtRateWeekday,document.getElementById("Ot1.5x").textContent=v.Entities[0].OtRateWeekend,document.getElementById("Ot2.0x").textContent=v.Entities[0].OtRatePublicHoliday;Oe=1}});Oe==0;);e.form.BirthDay.value=s[N].Birthday,e.form.Age.value=e.calculateAge(),e.form.MaritalStatus.value=s[N].MaritalStatus.toString(),e.form.WorkingSpouse.value=s[N].WorkingSpouse,e.form.ChildrenUnderEighteen.value=s[N].ChildrenUnderEighteen,e.form.ChildrenInUniversity.value=s[N].ChildrenInUniversity,e.form.DisabledChildInUniversity.value=s[N].DisabledChildInUniversity,e.form.DisabledChild.value=s[N].DisabledChild,e.form.BasicPay.value=s[N].BasicPay,e.EmployeeType=s[N].type,e.EpfSubjection=s[N].EpfSubjection,e.form.EisClass.value=s[N].EisClass.toString(),e.form.EpfClass.value=s[N].EpfClass.toString(),e.form.SocsoClass.value=s[N].SocsoClass.toString(),e.form.HrdfClass.value=s[N].HrdfClass;var Le=s[N].name,ge;mt.List({Criteria:O.Criteria.and(ge,[[at.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[at.Fields.EffectiveFrom]])},v=>{console.log(v.Entities),$("#AllowanceDeductionBody").empty();var ie=0;for(var h in v.Entities){if(!(0,w.isEmptyOrNull)(v.Entities[h].EffectiveUntil)){var de=v.Entities[h].EffectiveUntil,Ne=new Date(de);if(e.form.PayPeriodStart.valueAsDate>Ne)continue}if(!(v.Entities[h].OneTime==!0&&v.Entities[h].PaidOneTime==!0)){if(v.Entities[h].FullAttendance==!0){if(v.Entities[h].ExemptAnnualLeave==!1&&v.Entities[h].ExemptCompassionateLeave==!1&&v.Entities[h].ExemptEmergencyLeave==!1&&v.Entities[h].ExemptUnpaidLeave==!1&&v.Entities[h].ExemptSickLeave==!1&&v.Entities[h].ExemptPaternityLeave==!1&&v.Entities[h].ExemptMaternityLeave==!1&&v.Entities[h].ExemptMarriageLeave==!1&&v.Entities[h].ExemptHospitalisationLeave==!1&&v.Entities[h].ExemptGatepassLeave==!1){if(H==!1)continue}else if(v.Entities[h].ExemptAnnualLeave==!0&&I==!0||v.Entities[h].ExemptCompassionateLeave==!0&&n==!0||v.Entities[h].ExemptEmergencyLeave==!0&&oe==!0||v.Entities[h].ExemptUnpaidLeave==!0&&F==!0||v.Entities[h].ExemptSickLeave==!0&&R==!0||v.Entities[h].ExemptPaternityLeave==!0&&A==!0||v.Entities[h].ExemptMaternityLeave==!0&&x==!0||v.Entities[h].ExemptMarriageLeave==!0&&M==!0||v.Entities[h].ExemptHospitalisationLeave==!0&&k==!0||v.Entities[h].ExemptGatepassLeave==!0&&J==!0)continue}else{if(v.Entities[h].NoAbsence==!0&&ye==!1)continue;if(v.Entities[h].NoEarlyLeaving==!0&&pe==!1)continue;if(v.Entities[h].NoLate==!0&&X==!1)continue}var $e=document.createElement("tr");$e.innerHTML=`<td>${v.Entities[h].AllowanceCode}</td><td>${v.Entities[h].Description}</td>
                                            <td class = "AllowanceAmount" eis =  ${v.Entities[h].SubjectionEis.toString()} epf =  ${v.Entities[h].SubjectionEpf.toString()}
                                            hrdf =  ${v.Entities[h].SubjectionHrdf.toString()} pcb =  ${v.Entities[h].SubjectionPcb.toString()}
                                                socso =  ${v.Entities[h].SubjectionSocso.toString()} 
                                            >${v.Entities[h].Amount}</td>`,$("#AllowanceDeductionBody").append($e),e.AllowanceId.push(v.Entities[h].Id),ie+=v.Entities[h].Amount}}if($("#TotalAllowance").val(ie),$(d).val(Le),a)for(var ne=a.getElementsByTagName("TR"),Xe=ne.length,be=Xe-1;be>0;be--)ne[be].parentNode.removeChild(ne[be]);var ee;Bt.List({Criteria:O.Criteria.and(ee,[[Fe.Fields.Status],"=","1"],[[Fe.Fields.EmployeeRowId],"=",$(o).val()],[[Fe.Fields.OtDate],">=",e.form.PayPeriodStart.get_value()],[[Fe.Fields.OtDate],"<=",e.form.PayPeriodEnd.get_value()])},Pe=>{let se=0,ue=0,L=0,G=0,Se=0;Pe.Entities.forEach(K=>{K.WeekendOt?se+=K.OtMinute:K.WeekdayOt?ue+=K.OtMinute:K.PublicHolidayOt&&(L+=K.OtMinute)}),e.FixedOtRateOption==!1?(e.PublicHolidayMultiplier==2?G+=L:Se+=L,e.WeekendMultiplier==2?G+=se:Se+=se,e.WeekdayMultiplier==2?G+=ue:Se+=ue,G=G/60,Se=Se/60,$("#OtOnePointFiveTime").val(Se),$("#OtTwoTime").val(G)):(ue=ue/60,se=se/60,L=L/60,$("#OtOneTime").val(ue),$("#OtOnePointFiveTime").val(se),$("#OtTwoTime").val(L)),$("#OtTwoTime").trigger("change");var Mt;gt.List({Criteria:O.Criteria.and(Mt,[[Ye.Fields.EmployeeRowId],"=",$(o).val()],[[Ye.Fields.LeaveDate],">=",e.form.PayPeriodStart.get_value()],[[Ye.Fields.LeaveDate],"<=",e.form.PayPeriodEnd.get_value()])},K=>{let Ht=0;for(var Qe in K.Entities)(0,w.isEmptyOrNull)(K.Entities[Qe].Deductions)||(e.NoPaidLeaveId.push(K.Entities[Qe].Id),Ht+=K.Entities[Qe].HalfDay?.5:1);var Nt;yt.List({Criteria:O.Criteria.and(Nt,[[it.Fields.EmployeeRowId],"=",$(o).val()],[e.form.PayPeriodStart.get_value(),">=",[it.Fields.EffectiveFrom]])},te=>{var rt=0;for(var le in te.Entities)if(!(te.Entities[le].OneTime==!0&&te.Entities[le].DeductedOneTime==!0)){if(!(0,w.isEmptyOrNull)(te.Entities[le].EffectiveUntil)){var jt=te.Entities[le].EffectiveUntil,Wt=new Date(jt);if(e.form.PayPeriodStart.valueAsDate>Wt)continue}var dt=document.createElement("tr");dt.innerHTML=`<td>${te.Entities[le].DeductionCode}</td><td>${te.Entities[le].Description}</td><td class = "DeductionAmount">-${te.Entities[le].Amount}</td>`,$("#AllowanceDeductionBody").append(dt),e.DeductionId.push(te.Entities[le].Id),rt+=te.Entities[le].Amount}$(".remove").on("click",function(Z){return D(this,null,function*(){console.log("haha"),$(this).closest("tr").remove(),e.updatePayroll()})}),$(".numberInput").on("change",function(Z){return D(this,null,function*(){e.updatePayroll()})}),$("#TotalDeduction").val(rt);var kt;Pt.List({Criteria:O.Criteria.and(kt,[[De.Fields.EmployeeRowId],"=",$(o).val()],[[De.Fields.Paid],"=","0"],[[De.Fields.Status],"=","1"],[[De.Fields.ClaimingDate],">=",e.form.PayPeriodStart.get_value()],[[De.Fields.ClaimingDate],"<=",e.form.PayPeriodEnd.get_value()])},Z=>{$("#MoneyClaimingBody").empty();for(var ce in Z.Entities){var st=document.createElement("tr");st.innerHTML=`<td>${Z.Entities[ce].ClaimingCategory}</td><td>${Z.Entities[ce].Description}</td>
                                            <td  eis =  ${Z.Entities[ce].SubjectionEis.toString()} epf =  ${Z.Entities[ce].SubjectionEpf.toString()}
                                            hrdf =  ${Z.Entities[ce].SubjectionHrdf.toString()} pcb =  ${Z.Entities[ce].SubjectionPcb.toString()}
                                                socso =  ${Z.Entities[ce].SubjectionSocso.toString()} 
                                            >${Z.Entities[ce].ClaimAmount}</td>`,$("#MoneyClaimingBody").append(st)}var Ut;xt.List({Criteria:O.Criteria.and(Ut,[[_e.Fields.EmployeeRowId],"=",$(o).val()],[[_e.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[_e.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},Te=>{Te.Entities.length>0&&(pe=!1);let ut=0;for(var et in Te.Entities)Te.Entities[et].Deducted==0&&(ut+=Te.Entities[et].EarlyMins,e.EarlyLeavingId.push(Te.Entities[et].Id));$("#EarlyLeavingMinutes").val(ut);var Yt;Ft.List({Criteria:O.Criteria.and(Yt,[[ze.Fields.EmployeeRowId],"=",$(o).val()],[[ze.Fields.Date],">=",e.form.PayPeriodStart.get_value()],[[ze.Fields.Date],"<=",e.form.PayPeriodEnd.get_value()])},Ce=>{var ct=0;Ce.Entities.length>0&&(X=!1);for(var je in Ce.Entities)Ce.Entities[je].Deducted==0&&((0,w.isEmptyOrNull)(Ce.Entities[je].Deductions)||(ct+=Ce.Entities[je].LateMins,e.LateArrivalId.push(Ce.Entities[je].Id)));$("#LateArrivalMinutes").val(ct),e.updatePayroll()})})})})})})});break}})}}CheckSubjection(t,e){var a=e.match(/\((.*?)\)/),o;if(a&&a.length>1?o=a[1]:o=e,o=="Others")return 0;for(var i=0;i<t.length;i++){var r=t[i];for(var d in r)if(r[d]==o)return r.subjection}return 0}getToolbarButtons(){var t=super.getToolbarButtons(),e=document.createElement("style");e.textContent=`

    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .section h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table td {
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }

    table td input[type="number"] {
      width: 100%;
      text-align: right;
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f9f9f9;
    }









    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #d9e9f9; /* Light blue for headers */
      font-weight: bold;
    }

    td:nth-child(3), td:nth-child(5) {
      background-color: #fde8f1; /* Light pink for specific columns */
    }

    tr:nth-child(even) {
      background-color: #f9f9f9; /* Alternating row colors */
    }

    tr {
    position: sticky;
    }
        
    tr:hover {
      background-color: #f1f1f1; /* Hover effect for rows */
    }

    .numberInput {
      text-align: right; /* Align text consistently */
      width: 100%;
      border: none;
      background-color: transparent;
    }

    .Description {
    text-align: left; /* Align text consistently */
    width: 50px; /* Ensures consistent width for all spans */

    }

    .numberInputContainer {
    text-align: left; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }


    .rates {
    text-align: right; /* Align text consistently */
    width: 100px; /* Ensures consistent width for all spans */
    }
    

    #PayRollGrid {
    display: flex;
    gap: 5px; /* Adds a 20px gap between #left, #center, and #right */
}

#left,
#center,
#right {
    flex: 1; /* Ensures each section takes equal space (optional) */
}

            `,document.head.appendChild(e);var a=this;return t.push({title:"Add Earnings",cssClass:"text-bg-success p-2 addEarnings",icon:"fa-plus text-green",onClick:()=>{$(".PayrollEarnings .add-button").click();var i=a.form.PayrollEarnings.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollEarningsEditDialog").on("dialogclose",function(){if(i!=a.form.PayrollEarnings.value.length){var r=a.form.PayrollEarnings.value[a.form.PayrollEarnings.value.length-1],d=document.createElement("tr");d.innerHTML=`<td> <span>${r.EarningCode}</span>           <button class="remove">\xD7</button>
                            </td><td>${r.Description}</td><td> <input class = numberInput type="number" min="0" eis = ${r.SubjectionToEis} epf = ${r.SubjectionToEpf} hrdf = ${r.SubjectionToHrdf}
                             pcb = ${r.SubjectionToPcb} socso = ${r.SubjectionToSocso}  value = ${r.Amount} ></input>           </td>`,$("#EarningDeductionBody").append(d),$(".remove").on("click",function(l){return D(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(l){return D(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t.push({title:"Add Deductions",cssClass:"text-bg-danger p-2 addDeductions",icon:"fa-minus text-red",onClick:()=>{$(".PayrollDeductions .add-button").click();var i=a.form.PayrollDeductions.value.length;$(".s-HRMSoftware-PayrollSettings-PayrollDeductionsEditDialog").on("dialogclose",function(){if(i!=a.form.PayrollDeductions.value.length){var r=a.form.PayrollDeductions.value[a.form.PayrollDeductions.value.length-1],d=document.createElement("tr");d.innerHTML=`<td>   <span>${r.DeductionCode}</span>  <button class="remove">\xD7</button>
                            </td><td>${r.Description}</td><td> <input class = numberInput type="number" max="0"  value = "-${r.Amount}" ></input>           </td>`,$("#EarningDeductionBody").append(d),$(".remove").on("click",function(l){return D(this,null,function*(){$(this).closest("tr").remove(),a.updatePayroll()})}),$(".numberInput").on("change",function(l){return D(this,null,function*(){a.updatePayroll()})}),a.updatePayroll()}})}}),t}save_submitHandler(t){let e=0,o=document.getElementById("EarningDeductionBody").querySelectorAll("tr");if(o.length){let u=[],f=[],p=Array.from(o).map(b=>{let P=b.querySelectorAll("td");return{code:P[0].querySelector("span").textContent,description:P[1].innerText,amount:P[2].querySelector(".numberInput").value,eis:P[2].querySelector(".numberInput").getAttribute("eis"),epf:P[2].querySelector(".numberInput").getAttribute("epf"),hrdf:P[2].querySelector(".numberInput").getAttribute("hrdf"),pcb:P[2].querySelector(".numberInput").getAttribute("pcb"),socso:P[2].querySelector(".numberInput").getAttribute("socso")}});for(e=0;e<p.length;e++){var i;parseFloat(p[e].amount)>0?(i=new Je,i.Amount=parseFloat(p[e].amount),i.Description=p[e].description,i.SubjectionToPcb=d(p[e].pcb),i.SubjectionToEis=d(p[e].eis),i.SubjectionToHrdf=d(p[e].hrdf),i.SubjectionToSocso=d(p[e].socso),i.SubjectionToEpf=d(p[e].epf),i.EarningCode=p[e].code,u.push(i)):parseFloat(p[e].amount)<0&&(i=new qe,i.Amount=parseFloat(p[e].amount),i.Description=p[e].description,i.DeductionCode=p[e].code,f.push(i))}this.form.PayrollEarnings.value=u,this.form.PayrollDeductions.value=f}this.form.NPLDaily.value=$("#NplDay").val(),this.form.NPLHourly.value=$("#NplHr").val(),this.form.AbsentDaily.value=$("#AbsentDay").val(),this.form.OtOne.value=$("#OtOneTime").val(),this.form.OtOnePointFive.value=$("#OtOnePointFiveTime").val(),this.form.OtTwo.value=$("#OtTwoTime").val(),this.form.EarlyLeaving.value=$("#EarlyLeavingMinutes").val(),this.form.LateArrival.value=$("#LateArrivalMinutes").val(),this.form.FlatOt.value=parseFloat(document.getElementById("Ot1.0x").textContent),this.form.OtOnePointFiveRate.value=parseFloat(document.getElementById("Ot1.5x").textContent),this.form.OtTwoRate.value=parseFloat(document.getElementById("Ot2.0x").textContent);var r=this;function d(u){return u==="true"}_(d,"toBoolean"),this.form.EmployeePCB.value=$("#PCB").val(),this.form.EmployeeEIS.value=$("#EmployeeEIS").val(),this.form.EmployeeEPF.value=$("#EmployeeEPF").val(),this.form.EmployeeSOCSO.value=$("#EmployeeSOCSO").val(),this.form.EmployerEIS.value=$("#EmployerEIS").val(),this.form.EmployerEPF.value=$("#EmployerEPF").val(),this.form.EmployerHRDF.value=$("#HRD").val(),this.form.EmployerSOCSO.value=$("#EmployerSOCSO").val(),this.form.NPLDailyRate.value=parseFloat($("#NplDayRate").text()),this.form.NPLHourlyRate.value=parseFloat($("#NplHrRate").text()),this.form.AbsentDailyRate.value=parseFloat($("#AbsentDayRate").text()),this.form.EarlyLeavingRate.value=parseFloat($("#EarlyLeavingRate").text()),this.form.LateArrivalRate.value=parseFloat($("#LateArrivalRate").text());let c=document.getElementById("MoneyClaimingBody").querySelectorAll("tr");if(c.length){let u=[],f=Array.from(c).map(p=>{let b=p.querySelectorAll("td");return{ClaimingCategory:b[0].innerText,description:b[1].innerText,amount:b[2].innerText,eis:b[2].getAttribute("eis"),epf:b[2].getAttribute("epf"),hrdf:b[2].getAttribute("hrdf"),pcb:b[2].getAttribute("pcb"),socso:b[2].getAttribute("socso")}});for(e=0;e<f.length;e++){var m=new Ve;m.ClaimAmount=parseFloat(f[e].amount),m.Description=f[e].description,m.ClaimingCategory=f[e].ClaimingCategory,m.SubjectionPcb=d(f[e].pcb),m.SubjectionEis=d(f[e].eis),m.SubjectionHrdf=d(f[e].hrdf),m.SubjectionSocso=d(f[e].socso),m.SubjectionEpf=d(f[e].epf),u.push(m)}this.form.PaidMoneyClaimingList.value=u}let s=document.getElementById("AllowanceDeductionBody").querySelectorAll("tr");if(s.length){let u=[],f=[],p=Array.from(s).map(T=>{let y=T.querySelectorAll("td");return{code:y[0].innerText,description:y[1].innerText,amount:y[2].innerText,eis:y[2].getAttribute("eis"),epf:y[2].getAttribute("epf"),hrdf:y[2].getAttribute("hrdf"),pcb:y[2].getAttribute("pcb"),socso:y[2].getAttribute("socso")}}),b=0,P=0;for(e=0;e<p.length;e++){var i;parseFloat(p[e].amount)>0?(i=new Ke,i.AllowanceId=r.AllowanceId[b],i.AllowanceAmount=parseFloat(p[e].amount),i.Description=p[e].description,i.SubjectionPcb=d(p[e].pcb),i.SubjectionEis=d(p[e].eis),i.SubjectionHrdf=d(p[e].hrdf),i.SubjectionSocso=d(p[e].socso),i.SubjectionEpf=d(p[e].epf),i.code=p[e].code,b+=1,u.push(i)):parseFloat(p[e].amount)<0&&(i=new Ze,i.DeductionId=r.DeductionId[P],i.DeductionAmount=parseFloat(p[e].amount),i.Description=p[e].description,i.code=p[e].code,f.push(i),P+=1)}this.form.AllowanceList.value=u,this.form.DeductionList.value=f}r.form.Nett.value=$("#NettWage").val(),r.form.Earnings.value=$("#GrossWage").val(),r.form.Deduction.value=r.form.Earnings.value-r.form.Nett.value,super.save_submitHandler(t)}};_(fe,"PayrollDialog"),fe=We([O.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollDialog")],fe);var Ve=class extends Ot{constructor(){super()}};_(Ve,"ConcreteMoneyClaimApplicationRow");var qe=class extends ht{constructor(){super()}};_(qe,"ConcretePayrollDeductionsRow");var Je=class extends bt{constructor(){super()}};_(Je,"ConcretePayrollEarningsRow");var Ke=class extends Lt{constructor(){super()}};_(Ke,"ConcreteEmployeeAllowanceRow");var Ze=class extends It{constructor(){super()}};_(Ze,"ConcreteFixedDeductionRow");var Ie=me(tt(),1);var z=me(Ae(),1),q=me(Ae(),1),ot=me(tt(),1);var Re=class extends Ie.EntityDialog{constructor(){super();this.form=new lt(this.idPrefix);var t;Be.List({Criteria:Ie.Criteria.and(t,[[ke.Fields.Retired],"=","0"],[[ke.Fields.Terminated],"=","0"],[[ke.Fields.Resigned],"=","0"])},e=>{this.EmployeeData=e.Entities})}getFormKey(){return lt.formKey}getRowDefinition(){return St}getService(){return Ct.baseUrl}SearchCallback(){var t=this,e=document.getElementById(this.idPrefix+"PayMonth"),a=document.getElementById(this.idPrefix+"PayYear"),o=document.getElementById(this.idPrefix+"OccupationList"),i=document.getElementById(this.idPrefix+"DepartmentList"),r=document.getElementById(this.idPrefix+"DivisionList"),d=document.getElementById(this.idPrefix+"JobGradeList"),l=document.getElementById(this.idPrefix+"SectionList");if((0,z.isEmptyOrNull)($(e).val())||(0,z.isEmptyOrNull)($(a).val())){this.form.EmployeeRowList.value=this.form.EmployeeRowListBuffer.value="";return}function c(S){let g=$(S).val();return g.length?g.split(",").map(C=>parseInt(C,10)):[]}_(c,"parseListFromElement");let m=c(d),E=c(r),s=c(i),u=c(o),f=c(l),p=new Set(m),b=new Set(E),P=new Set(s),T=new Set(u),y=new Set(f);for(let S of t.EmployeeData){let{JobGradeID:g,DivisionID:C,DepartmentID:j,OccupationID:W,SectionID:U,Id:B}=S,Y=p.has(g)||b.has(C)||P.has(j)||T.has(W)||y.has(U),H=t.form.EmployeeRowListBuffer.value,F=H?H.split(",").map(Number):[];Y?F.includes(B)||F.push(B):F=F.filter(k=>k!==B),t.form.EmployeeRowListBuffer.value=F.join(",")}}SearchEmployeeCallback(){var t=this,e=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),a=$(e).val();let o=a.split(","),i=[];a.length&&o.forEach(u=>{i.push(parseInt(u))});var r=document.getElementById(this.idPrefix+"PayMonth"),d=document.getElementById(this.idPrefix+"PayYear"),l=$(d).val(),c=$(r).val();let m=[];var E=t.form.EmployeeRowListBuffer.value;E.split(",").forEach(u=>{m.push(parseInt(u))}),ve.List({},u=>{for(var f in u.Entities){var p=u.Entities[f].EmployeeRowId,b=u.Entities[f].PayMonth,P=u.Entities[f].PayYear;i.indexOf(p)!==-1&&b==c&&P==l&&(E=t.form.EmployeeRowListBuffer.value,E!=""&&(E.split(",").forEach(y=>{m.push(parseInt(y))}),m=m.filter(y=>y!==u.Entities[f].EmployeeRowId),t.form.EmployeeRowListBuffer.value=m.join(",")))}t.form.EmployeeRowList.value=m.join(",")})}getToolbarButtons(){var t=this,e=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),e.push({title:"Generate Payslips",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if((0,z.isEmptyOrNull)(t.form.PayDate.value)){(0,q.notifyError)("Please enter pay date");return}if((0,z.isEmptyOrNull)(t.form.PayMonth.value)){(0,q.notifyError)("Please enter pay Month");return}if((0,z.isEmptyOrNull)(t.form.PayYear.value)){(0,q.notifyError)("Please enter pay Year");return}if((0,z.isEmptyOrNull)(t.form.PayPeriodEnd.value)){(0,q.notifyError)("Please enter pay period end");return}if((0,z.isEmptyOrNull)(t.form.PayPeriodStart.value)){(0,q.notifyError)("Please enter pay period start");return}var a=t.form.EmployeeRowList.value;let o=[],i=a.split(",");a.length&&i.forEach(r=>{o.push(parseInt(r))}),t.counter=0,t.WaitingCounter=o.length,(0,q.confirm)("Are you sure to generate payslip of these employees?",()=>{function r(c){return new Promise(m=>{let E=new fe(1,c,t.form.PayYear.value,t.form.PayMonth.value,t.form.PayDate.value,t.form.PayPeriodStart.value,t.form.PayPeriodEnd.value);E.element.on("dialogopen",function(){$(".s-PayrollDialog").hide()}),E.dialogOpen(),E.element.on("dialogclose",function(){t.counter+=1,t.counter==o.length&&(0,q.notifySuccess)("Payslip generated"),m()})})}_(r,"handleEmployee");function d(){return new Promise(c=>{var m=new At(a,t.form.PayMonth.value,t.form.PayYear.value);m.dialogOpen(),m.element.on("dialogclose",function(){t.SearchCallback(),c()})})}_(d,"handleDownload");function l(c){return D(this,null,function*(){for(let m=0;m<c.length;m++)yield r(c[m]);t.form.Download.value==!0?yield d():t.SearchCallback()})}_(l,"processEmployees"),console.log(o),l(o),t.form.Download.value==!0&&(0,q.notifySuccess)("Payslip downloaded"),t.form.EmployeeRowListBuffer.value=t.form.EmployeeRowList.value=""})}}),e.push({title:"Download Txt",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{var a="PayMonth="+encodeURIComponent(t.form.PayMonth.value)+"&PayYear="+encodeURIComponent(t.form.PayYear.value),o=window.location.origin+"/PayrollSettings/Payroll/TxtGenerate?"+a,i=new XMLHttpRequest;i.open("GET",o,!0),i.responseType="blob",i.onload=function(){if(i.status===200){var r=i.response;let d=window.URL.createObjectURL(r),l=document.createElement("a");l.style.display="none",l.href=d,l.download="example.txt",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(d)}else(0,q.notifyError)("Error encounter when downloading Payslip Pdf")},i.send()}}),e}dialogOpen(t){super.dialogOpen();var e=this;(0,q.serviceCall)({service:Ge.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:y=>{e.dateString=y,Ue.List({},S=>{var g=new Date(e.dateString),C=g.getMonth(),j=g.getFullYear(),W=0;for(var U in S.Entities)if(S.Entities[U].IsActive==1){W=S.Entities[U].PayDay;break}var B=new Date(j,C,W),Y=B.getFullYear().toString(),H=(B.getMonth()+1).toString(),F=B.getDate().toString();C=C+1;var k=new Date(j,C,W);k.setDate(k.getDate()+1);var R=k.getFullYear().toString(),I=(k.getMonth()+1).toString(),x=k.getDate().toString(),A=H.padStart(2,"0")+"/"+F.padStart(2,"0")+"/"+Y,M=I.padStart(2,"0")+"/"+x.padStart(2,"0")+"/"+R;this.isNew()&&(e.form.PayDate.value=A,e.form.PayPeriodEnd.value=A,e.form.PayPeriodStart.value=M)})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var a=document.getElementById(this.idPrefix+"PayMonth"),o=document.getElementById(this.idPrefix+"PayYear");let i=new ot.Select2Editor($(a)),r=new ot.Select2Editor($(o)),d=["January","February","March","April","May","June","July","August","September","October","November","December"];var l=new Date(e.dateString),c=l.getFullYear(),m=l.getMonth();for(let y=0;y<d.length;y++)i.addItem({id:y.toString(),text:d[y].toString()});i.set_value(m.toString());for(let y=-1;y<2;y++)r.addItem({id:(c+y).toString(),text:(c+y).toString()});r.set_value(c.toString());var E=document.getElementById(this.idPrefix+"SectionList"),s=document.getElementById(this.idPrefix+"OccupationList"),u=document.getElementById(this.idPrefix+"DepartmentList"),f=document.getElementById(this.idPrefix+"DivisionList"),p=document.getElementById(this.idPrefix+"JobGradeList"),b=document.getElementById(this.idPrefix+"PayPeriodStart"),P=document.getElementById(this.idPrefix+"PayPeriodEnd"),T=document.getElementById(this.idPrefix+"EmployeeRowList");console.log(this.idPrefix),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(y){return D(this,null,function*(){$(".select2-drop").hide()})}),$(a).on("change",function(){return D(this,null,function*(){((0,z.isEmptyOrNull)($(a).val())||(0,z.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(o).on("change",function(){return D(this,null,function*(){((0,z.isEmptyOrNull)($(a).val())||(0,z.isEmptyOrNull)($(o).val()))&&(e.form.EmployeeRowList.value=""),e.SearchCallback(),e.SearchEmployeeCallback()})}),$(s).on("change",function(){return D(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(f).on("change",function(){return D(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(p).on("change",function(){return D(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(u).on("change",function(){return D(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(E).on("change",function(){return D(this,null,function*(){e.SearchCallback(),e.SearchEmployeeCallback()})}),$(b).on("change",function(){return D(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,z.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodStart.value="";return}})}),$(P).on("change",function(){return D(this,null,function*(){if(e.form.PayPeriodStart.valueAsDate>e.form.PayPeriodEnd.valueAsDate){(0,z.alertDialog)("Pay period start cannot be ahead of pay period end"),e.form.PayPeriodEnd.value="";return}})})}getDialogOptions(){let t=super.getDialogOptions();return t.width=t.width+100,t}};_(Re,"PayrollGeneratingWizardDialog"),Re=We([Ie.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGeneratingWizardDialog")],Re);export{fe as a,Re as b};
//# sourceMappingURL=chunk-HTJ3IK3V.js.map
