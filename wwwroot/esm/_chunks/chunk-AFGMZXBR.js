import{d as G}from"./chunk-I3VQVPHQ.js";import{b as W,c as Q,d as h}from"./chunk-BAH6NAWX.js";import{d as X}from"./chunk-KXMTVQGO.js";import{d as q}from"./chunk-GYFJ4L6D.js";import{a as x}from"./chunk-27W64ILM.js";import{b as J}from"./chunk-J5PFZI4S.js";import{a as Z}from"./chunk-DNINIZJD.js";import{c as F,g as V,h as z,j as Y,k as ee}from"./chunk-L3ECGIWB.js";var D=V(Z(),1);var e=V(ee(),1);var M=class extends D.EntityDialog{constructor(){super();this.form=new W(this.idPrefix);this.ListOfLeave=[];this.PublicHolidayDateList=[];this.PublicHolidayEventList=[];this.cloneButton.remove();var y=this;D.EditorUtils.setReadonly(this.form.LeaveTaken.element,!0)}getFormKey(){return W.formKey}getRowDefinition(){return Q}getService(){return h.baseUrl}onDialogOpen(){if(super.onDialogOpen(),$(".EmployeeUpdated").hide(),$(".HrUpdated").hide(),(0,e.isEmptyOrNull)(this.form.EmployeeUpdatedName.value))$(".EmployeeUpdatedName").hide();else{var y=document.getElementById(this.idPrefix+"EmployeeUpdatedName");$(y).on("click",function(){return Y(this,null,function*(){console.log(i.form.EmployeeUpdatedName.value),console.log(i.form.EmployeeUpdated.value);var d=new q(parseInt(i.form.EmployeeUpdated.value));d.loadByIdAndOpenDialog(parseInt(i.form.EmployeeUpdated.value))})})}if((0,e.isEmptyOrNull)(this.form.HrUpdatedName.value))$(".HrUpdatedName").hide();else{var a=document.getElementById(this.idPrefix+"HrUpdatedName");$(a).on("click",function(){return Y(this,null,function*(){var d=new q(parseInt(i.form.HrUpdated.value));d.loadByIdAndOpenDialog(parseInt(i.form.HrUpdated.value))})})}D.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var i=this;$(".MorningSession").hide(),$(".AfternoonSession").hide();var o=".ApproveEmployeeName",n=".RejectedEmployeeName";if(this.isNew()){var C=document.querySelectorAll(".text-bg-success");C.forEach(function(d){$(d).hide()}),$(o).hide();var P=document.querySelectorAll(".text-bg-danger");P.forEach(function(d){$(d).hide()}),$(n).hide()}else if(!this.isNew()){if(!e.Authorization.userDefinition.Permissions[x.HumanResources]&&i.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&(this.readOnly=!0),i.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){D.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),D.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);return}h.Retrieve({EntityId:this.entityId},d=>{var g=d.Entity.EmployeeRowId,S=d.Entity.HrStatus,u=d.Entity.EmployeeStatus;console.log(g),i.EmployeeApproval=d.Entity.EmployeeStatus,i.HrApproval=d.Entity.HrStatus;var m=d.Entity.Status;m==0?(0,e.serviceCall)({service:X.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:e.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:g},method:"GET",async:!1,onSuccess:R=>{var H=R;if(i.SuperiorPermission=R,i.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&this.set_readOnly(!0),$(".delete-button").removeClass("disabled"),S==0||u==0)H==!0&&!u&&$(".tool-button").removeClass("hidden"),e.Authorization.userDefinition.Permissions[x.HumanResources]&&!S&&$(".tool-button").removeClass("hidden");else if($(n).hide(),$(o).hide(),i.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){var t=document.querySelectorAll(".text-bg-success");t.forEach(function(p){$(p).hide()});var v=document.querySelectorAll(".text-bg-danger");v.forEach(function(p){$(p).hide()})}},onError:R=>{console.log(R.Error)}}):(this.set_readOnly(!0),$(".delete-button").removeClass("disabled"))})}}dialogOpen(y){super.dialogOpen(y);function a(v){let p=v.toString();if(p.includes(".")){let c=parseFloat(p.split(".")[1]),r=parseFloat(p.split(".")[0]);return c>.5?r+.5:r}else return v}F(a,"processValue");let i="#"+this.idPrefix+"HalfDay",o="#"+this.idPrefix+"EligibleDay",n="#"+this.idPrefix+"BalanceLeave",C="#"+this.idPrefix+"EmployeeID",P="#"+this.idPrefix+"MorningSession",d="#"+this.idPrefix+"AfternoonSession";this.form.HalfDay.value="0";var g=this.form.HalfDay;$(i).prop("readonly",!0),$(o).prop("readonly",!0),$(n).prop("readonly",!0);let S="#"+this.idPrefix+"LeaveReasonId",u="#"+this.idPrefix+"StartDate",m="#"+this.idPrefix+"EndDate";var R=document.getElementById(this.idPrefix+"EmployeeRowId"),t=this;if(this.isNew())if(e.Authorization.userDefinition.Permissions[x.HumanResources])$(R).on("change",function(){return Y(this,null,function*(){t.form.EmployeeName.value="",t.form.StartDate.value="",t.form.EndDate.value="",t.form.LeaveReasonId.value="",$(o).val(""),$(n).val(""),!(0,e.isEmptyOrNull)($(this).val())&&(J.Retrieve({EntityId:$(R).val()},v=>{t.form.EmployeeName.value=v.Entity.EmployeeName}),G.List({},v=>{var p=parseInt($(R).val());for(var c in v.Entities)v.Entities[c].EmployeeRowId==p&&t.ListOfLeave.push(v.Entities[c]);t.RowData=t.ListOfLeave[t.ListOfLeave.length-1];for(let l in t.RowData)if(l.includes("Entitled")){let E=l.replace("Entitled","");t.RowData[E]=t.RowData[l],delete t.RowData[l]}var r=t.RowData;r.MaternityLeave===void 0&&(r.MaternityLeave=0),r.PaternityLeave===void 0&&(r.PaternityLeave=0),console.log(t.ListOfLeave),console.log(r);var f=new Date(t.ListOfLeave[t.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),s=new Date(f);s.setFullYear(s.getFullYear()-1),$(S).on("change",function(l){var E=$(S).val(),w=(0,e.getLookup)("LeaveReason.LeaveReason"),T;for(var O in w.items)if(w.items[O].Id==E){T=w.items[O].LeaveReason.replace(/\s/g,"");break}var U=s.getFullYear(),I=(s.getMonth()+1).toString().padStart(2,"0"),b=s.getDate().toString().padStart(2,"0"),N=`${U}-${I}-${b}`;U=f.getFullYear(),I=(f.getMonth()+1).toString().padStart(2,"0"),b=f.getDate().toString().padStart(2,"0");var B=`${U}-${I}-${b}`,j=!1,A;for(console.log("hereee"),console.log(t.form.EmployeeRowId.value),console.log(N),console.log(B),console.log(E),(0,e.serviceCall)({service:h.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:N,EndingDate:B,TypeOfLeave:E},async:!1,onSuccess:_=>{A=_,(0,e.isEmptyOrNull)(A)&&(A=0),j=!0},onError:_=>{}});j==!1;);var L=r[T];if(L===void 0&&(L=99999),$(o).val(a(L)),$(o).val()!="-"){$(n).prop("readonly",!1);var k=L-A;$(n).val(a(k)),$(n).prop("readonly",!0)}else $(n).prop("readonly",!1),$(n).val("-"),$(n).prop("readonly",!0)})}))})});else{var t=this;this.form.EmployeeRowId.value=e.Authorization.userDefinition.EmployeeRowID,this.form.EmployeeName.value=e.Authorization.userDefinition.DisplayName,console.log(e.Authorization.userDefinition.DisplayName),D.EditorUtils.setReadonly(this.form.EmployeeName.element,!0),D.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),G.List({},p=>{var c=parseInt(this.form.EmployeeRowId.value);for(var r in p.Entities)p.Entities[r].EmployeeRowId==c&&this.ListOfLeave.push(p.Entities[r]);this.RowData=this.ListOfLeave[this.ListOfLeave.length-1];for(let E in this.RowData)if(E.includes("Entitled")){let w=E.replace("Entitled","");this.RowData[w]=this.RowData[E],delete this.RowData[E]}var f=this.RowData;console.log(f),f.MaternityLeave===void 0&&(f.MaternityLeave=0),f.PaternityLeave===void 0&&(f.PaternityLeave=0);var s=new Date(this.ListOfLeave[this.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),l=new Date(s);l.setFullYear(l.getFullYear()-1),$(S).on("change",function(E){var w=$(S).val(),T=(0,e.getLookup)("LeaveReason.LeaveReason"),O;for(var U in T.items)if(T.items[U].Id==w){O=T.items[U].LeaveReason.replace(/\s/g,"");break}var I=l.getFullYear(),b=(l.getMonth()+1).toString().padStart(2,"0"),N=l.getDate().toString().padStart(2,"0"),B=`${I}-${b}-${N}`;I=s.getFullYear(),b=(s.getMonth()+1).toString().padStart(2,"0"),N=s.getDate().toString().padStart(2,"0");var j=`${I}-${b}-${N}`,A=!1,L;for(console.log("hereee"),(0,e.serviceCall)({service:h.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:B,EndingDate:j,TypeOfLeave:w},async:!1,onSuccess:K=>{L=K,(0,e.isEmptyOrNull)(L)&&(L=0),A=!0},onError:K=>{}});A==!1;);var k=f[O];if(console.log(k),k===void 0&&(k=99999),$(o).val(a(k)),$(o).val()!="-"){$(n).prop("readonly",!1);var _=k-L;$(n).val(a(_)),$(n).prop("readonly",!0)}else $(n).prop("readonly",!1),$(n).val("-"),$(n).prop("readonly",!0)})})}let H=F(v=>{let[p,c,r]=v.split("/");return new Date(parseInt(r),parseInt(p)-1,parseInt(c))},"parseDate");var t=this;$(u).on("change",function(v){if($(m).val()!=""){var p=H($(u).val()),c=H($(m).val());if(p>c){(0,e.alertDialog)("the start date cannot be greater than end date"),$(u).val(null);return}if($(m).val()==$(u).val()){$(i).prop("readonly",!1);var r=!1;for((0,e.serviceCall)({service:h.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:s=>{t.WeekdaysList=s.Entities[0].WeekdaysList,console.log(s.Entities),this.form.LeaveTaken.value=s.Entities[0].LeaveToTake,r=!0},onError:s=>{}});r==!1;);$(i).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var r=!1;for((0,e.serviceCall)({service:h.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:l=>{t.WeekdaysList=l.Entities[0].WeekdaysList,console.log(l.Entities),this.form.LeaveTaken.value=l.Entities[0].LeaveToTake,r=!0},onError:l=>{}});r==!1;);g.value="0",$(i).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var f="No need to take leave in this period for holiday";(0,e.alertDialog)(f)}}}),$(m).on("change",function(v){if($(u).val()!=""){var p=H($(u).val()),c=H($(m).val());if(p>c){(0,e.alertDialog)("the start date cannot be greater than end date"),$(m).val(null);return}if($(m).val()==$(u).val()){$(i).prop("readonly",!1);var r=!1;for((0,e.serviceCall)({service:h.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:s=>{console.log(s.Entities),t.WeekdaysList=s.Entities[0].WeekdaysList,this.form.LeaveTaken.value=s.Entities[0].LeaveToTake,r=!0},onError:s=>{}});r==!1;);$(i).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var r=!1;for((0,e.serviceCall)({service:h.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:l=>{t.WeekdaysList=l.Entities[0].WeekdaysList,console.log(l.Entities),this.form.LeaveTaken.value=l.Entities[0].LeaveToTake,r=!0},onError:l=>{}});r==!1;);g.value="0",$(i).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var f="No need to take leave in this period for holiday";(0,e.alertDialog)(f)}}}),$(i).on("change",function(v){$(m).val()==$(u).val()&&($(i).val()==1?(this.form.LeaveTaken.value=.5,$(".MorningSession").show(),$(".AfternoonSession").show()):(this.form.LeaveTaken.value=1,t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1,$(".MorningSession").hide(),$(".AfternoonSession").hide()))}),$(P).on("change",function(v){t.form.MorningSession.value&&(t.form.AfternoonSession.value=!1)}),$(d).on("change",function(v){t.form.AfternoonSession.value&&(t.form.MorningSession.value=!1)})}save_submitHandler(y){if(this.form.LeaveTaken.value==0){var a="No need to take leave in this period for holiday";(0,e.alertDialog)(a);return}var i=$(".fieldset").children().uniqueId(),o=y;let n="#"+this.idPrefix+"StartDate",C="#"+this.idPrefix+"EndDate",P="#"+this.idPrefix+"HalfDay";if($(P).val()==1){if(this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please choose morning session or afternoon session";(0,e.alertDialog)(a);return}if(this.form.MorningSession.value==!0&&this.form.AfternoonSession.value==!0){var a="Please choose only morning session or afternoon session";(0,e.alertDialog)(a);return}}let d="#"+i[0].id.replace("PropertyGrid","BalanceLeave");var g=this.form.LeaveTaken.value,S=new Date($(n).val()),u=new Date($(C).val()),m=u.getTime()-S.getTime(),R=Math.floor(m/(1e3*60*60*24))+1;if(g==1&&$(P).val()==1&&(g=.5),$(d).val()-g>=0){var o=y;if(parseInt(this.form.HalfDay.value)==1&&this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please select whether is morning session or afternoon session";(0,e.alertDialog)(a);return}super.save_submitHandler(o)}else{var a="The applied leave exceed the available leave by "+(g-$(d).val()).toString()+" days.";(0,e.alertDialog)(a)}}getToolbarButtons(){var y=super.getToolbarButtons(),a=this,i=document.createElement("style");return i.textContent=`
        .hidden {
  display: none;
}
            `,document.head.appendChild(i),y.push({title:"Approve Application",cssClass:"text-bg-success p-2 hidden approveApplication",icon:"fa-check text-green",onClick:()=>{(0,e.confirm)("Do you want to approve this application?",()=>{let o={};e.Authorization.userDefinition.Permissions[x.HumanResources]?a.SuperiorPermission?a.EmployeeApproval===2||a.HrApproval===2?a.EmployeeApproval===2?o={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.HrApproval===2&&(o={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}):a.HrApproval===1?o={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.EmployeeApproval===1?o={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:a.entityId,Entity:o},n=>{a.loadById(n.EntityId),$(".rejectApplication, .approveApplication").hide()})})}}),y.push({title:"Rejected Application",cssClass:"text-bg-danger p-2 hidden rejectApplication",icon:"fa-times text-red",onClick:()=>{(0,e.confirm)("Do you want to reject this application?",()=>{let o={};e.Authorization.userDefinition.Permissions[x.HumanResources]?a.SuperiorPermission==!0?a.EmployeeApproval==2||a.HrApproval==2?a.EmployeeApproval==2?o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.HrApproval==2&&(o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}):a.HrApproval==0?o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:a.EmployeeApproval==0?o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:a.entityId,Entity:o},n=>{a.loadById(n.EntityId),$(".rejectApplication, .approveApplication").hide()})})}}),y}};F(M,"LeaveApplicationDialog"),M=z([D.Decorators.registerClass("HRMSoftware.LeaveApplication.LeaveApplicationDialog")],M);export{M as a};
//# sourceMappingURL=chunk-AFGMZXBR.js.map
