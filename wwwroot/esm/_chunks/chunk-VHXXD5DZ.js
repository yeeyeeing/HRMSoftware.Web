import{d as Y}from"./chunk-I3VQVPHQ.js";import{b as G,c as X,d as r}from"./chunk-OLYWZP6G.js";import{p as K}from"./chunk-3XL6K2Z3.js";import{b as Z}from"./chunk-BFH3N3PU.js";import{d as q}from"./chunk-6ZNY3LBE.js";import{a as M}from"./chunk-27W64ILM.js";import{b as Q}from"./chunk-BA2LGLQM.js";import{a as ee}from"./chunk-DNINIZJD.js";import{c as C,g as z,h as J,j,k as te}from"./chunk-L3ECGIWB.js";var S=z(ee(),1);var e=z(te(),1);var B=class extends S.EntityDialog{constructor(){super();this.form=new G(this.idPrefix);this.ListOfLeave=[];this.PublicHolidayDateList=[];this.PublicHolidayEventList=[];this.cloneButton.remove();var h=this;S.EditorUtils.setReadonly(this.form.LeaveTaken.element,!0)}getFormKey(){return G.formKey}getRowDefinition(){return X}getService(){return r.baseUrl}onDialogOpen(){if(super.onDialogOpen(),$(".EmployeeUpdated").hide(),$(".HrUpdated").hide(),(0,e.isEmptyOrNull)(this.form.EmployeeUpdatedName.value))$(".EmployeeUpdatedName").hide();else{var h=document.getElementById(this.idPrefix+"EmployeeUpdatedName");$(h).on("click",function(){return j(this,null,function*(){console.log(o.form.EmployeeUpdatedName.value),console.log(o.form.EmployeeUpdated.value);var s=new q(parseInt(o.form.EmployeeUpdated.value));s.loadByIdAndOpenDialog(parseInt(o.form.EmployeeUpdated.value))})})}if((0,e.isEmptyOrNull)(this.form.HrUpdatedName.value))$(".HrUpdatedName").hide();else{var a=document.getElementById(this.idPrefix+"HrUpdatedName");$(a).on("click",function(){return j(this,null,function*(){var s=new q(parseInt(o.form.HrUpdated.value));s.loadByIdAndOpenDialog(parseInt(o.form.HrUpdated.value))})})}S.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var o=this;$(".MorningSession").hide(),$(".AfternoonSession").hide();var u=".ApproveEmployeeName",n=".RejectedEmployeeName";if(this.isNew()){var U=document.querySelectorAll(".text-bg-success");U.forEach(function(s){$(s).hide()}),$(u).hide();var D=document.querySelectorAll(".text-bg-danger");D.forEach(function(s){$(s).hide()}),$(n).hide()}else if(!this.isNew()){if(!e.Authorization.userDefinition.Permissions[M.HumanResources]&&o.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&(this.readOnly=!0),o.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){S.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),S.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);return}r.Retrieve({EntityId:this.entityId},s=>{var y=s.Entity.EmployeeRowId,R=s.Entity.HrStatus,m=s.Entity.EmployeeStatus;console.log(y),o.EmployeeApproval=s.Entity.EmployeeStatus,o.HrApproval=s.Entity.HrStatus;var c=s.Entity.Status;c==0?(0,e.serviceCall)({service:Z.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:e.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:y},method:"GET",async:!1,onSuccess:L=>{var P=L;if(o.SuperiorPermission=L,o.form.EmployeeRowId.value!=e.Authorization.userDefinition.EmployeeRowID&&this.set_readOnly(!0),$(".delete-button").removeClass("disabled"),R==0||m==0)P==!0&&!m&&$(".tool-button").removeClass("hidden"),e.Authorization.userDefinition.Permissions[M.HumanResources]&&!R&&$(".tool-button").removeClass("hidden");else if($(n).hide(),$(u).hide(),o.form.EmployeeRowId.value==e.Authorization.userDefinition.EmployeeRowID){var t=document.querySelectorAll(".text-bg-success");t.forEach(function(p){$(p).hide()});var v=document.querySelectorAll(".text-bg-danger");v.forEach(function(p){$(p).hide()})}},onError:L=>{console.log(L.Error)}}):(this.set_readOnly(!0),$(".delete-button").removeClass("disabled"))})}}dialogOpen(h){super.dialogOpen(h);function a(v){let p=v.toString();if(p.includes(".")){let E=parseFloat(p.split(".")[1]),i=parseFloat(p.split(".")[0]);return E>.5?i+.5:i}else return v}C(a,"processValue");let o="#"+this.idPrefix+"HalfDay",u="#"+this.idPrefix+"EligibleDay",n="#"+this.idPrefix+"BalanceLeave",U="#"+this.idPrefix+"EmployeeID",D="#"+this.idPrefix+"MorningSession",s="#"+this.idPrefix+"AfternoonSession";this.form.HalfDay.value="0";var y=this.form.HalfDay;$(o).prop("readonly",!0),$(u).prop("readonly",!0),$(n).prop("readonly",!0);let R="#"+this.idPrefix+"LeaveReasonId",m="#"+this.idPrefix+"StartDate",c="#"+this.idPrefix+"EndDate";var L=document.getElementById(this.idPrefix+"EmployeeRowId"),t=this;if(this.isNew())if(e.Authorization.userDefinition.Permissions[M.HumanResources])$(L).on("change",function(){return j(this,null,function*(){t.form.EmployeeName.value="",t.form.StartDate.value="",t.form.EndDate.value="",t.form.LeaveReasonId.value="",$(u).val(""),$(n).val(""),!(0,e.isEmptyOrNull)($(this).val())&&(Q.Retrieve({EntityId:$(L).val()},v=>{t.form.EmployeeName.value=v.Entity.EmployeeName}),Y.List({},v=>{var p=parseInt($(L).val());for(var E in v.Entities)v.Entities[E].EmployeeRowId==p&&t.ListOfLeave.push(v.Entities[E]);t.RowData=t.ListOfLeave[t.ListOfLeave.length-1];for(let l in t.RowData)if(l.includes("Entitled")){let g=l.replace("Entitled","");t.RowData[g]=t.RowData[l],delete t.RowData[l]}var i=t.RowData;i.MaternityLeave===void 0&&(i.MaternityLeave=0),i.PaternityLeave===void 0&&(i.PaternityLeave=0),console.log(t.ListOfLeave),console.log(i);var f=new Date(t.ListOfLeave[t.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),d=new Date(f);d.setFullYear(d.getFullYear()-1),$(R).on("change",function(l){var g=$(R).val(),w=(0,e.getLookup)("LeaveReason.LeaveReason"),T;for(var O in w.items)if(w.items[O].Id==g){T=w.items[O].LeaveReason.replace(/\s/g,"");break}var N=d.getFullYear(),b=(d.getMonth()+1).toString().padStart(2,"0"),A=d.getDate().toString().padStart(2,"0"),x=`${N}-${b}-${A}`;N=f.getFullYear(),b=(f.getMonth()+1).toString().padStart(2,"0"),A=f.getDate().toString().padStart(2,"0");var _=`${N}-${b}-${A}`,F=!1,k;for(console.log("hereee"),console.log(t.form.EmployeeRowId.value),console.log(x),console.log(_),console.log(g),(0,e.serviceCall)({service:r.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:x,EndingDate:_,TypeOfLeave:g},async:!1,onSuccess:W=>{k=W,(0,e.isEmptyOrNull)(k)&&(k=0),F=!0},onError:W=>{}});F==!1;);var I=i[T];if(I===void 0&&(I=99999),$(u).val(a(I)),$(u).val()!="-"){$(n).prop("readonly",!1);var H=I-k;$(n).val(a(H)),$(n).prop("readonly",!0)}else $(n).prop("readonly",!1),$(n).val("-"),$(n).prop("readonly",!0)})}))})});else{var t=this;this.form.EmployeeRowId.value=e.Authorization.userDefinition.EmployeeRowID,this.form.EmployeeName.value=e.Authorization.userDefinition.DisplayName,console.log(e.Authorization.userDefinition.DisplayName),S.EditorUtils.setReadonly(this.form.EmployeeName.element,!0),S.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),Y.List({},p=>{var E=parseInt(this.form.EmployeeRowId.value);for(var i in p.Entities)p.Entities[i].EmployeeRowId==E&&this.ListOfLeave.push(p.Entities[i]);this.RowData=this.ListOfLeave[this.ListOfLeave.length-1];for(let g in this.RowData)if(g.includes("Entitled")){let w=g.replace("Entitled","");this.RowData[w]=this.RowData[g],delete this.RowData[g]}var f=this.RowData;console.log(f),f.MaternityLeave===void 0&&(f.MaternityLeave=0),f.PaternityLeave===void 0&&(f.PaternityLeave=0);var d=new Date(this.ListOfLeave[this.ListOfLeave.length-1].CurrentPolicyEndDate.substring(0,10)),l=new Date(d);l.setFullYear(l.getFullYear()-1),$(R).on("change",function(g){var w=$(R).val(),T=(0,e.getLookup)("LeaveReason.LeaveReason"),O;for(var N in T.items)if(T.items[N].Id==w){O=T.items[N].LeaveReason.replace(/\s/g,"");break}var b=l.getFullYear(),A=(l.getMonth()+1).toString().padStart(2,"0"),x=l.getDate().toString().padStart(2,"0"),_=`${b}-${A}-${x}`;b=d.getFullYear(),A=(d.getMonth()+1).toString().padStart(2,"0"),x=d.getDate().toString().padStart(2,"0");var F=`${b}-${A}-${x}`,k=!1,I;for(console.log("hereee"),(0,e.serviceCall)({service:r.baseUrl+"/RetrieveLeaveTaken",method:"GET",data:{EmployeeID:t.form.EmployeeRowId.value,StartingDate:_,EndingDate:F,TypeOfLeave:w},async:!1,onSuccess:V=>{I=V,(0,e.isEmptyOrNull)(I)&&(I=0),k=!0},onError:V=>{}});k==!1;);var H=f[O];if(console.log(H),H===void 0&&(H=99999),$(u).val(a(H)),$(u).val()!="-"){$(n).prop("readonly",!1);var W=H-I;$(n).val(a(W)),$(n).prop("readonly",!0)}else $(n).prop("readonly",!1),$(n).val("-"),$(n).prop("readonly",!0)})})}let P=C(v=>{let[p,E,i]=v.split("/");return new Date(parseInt(i),parseInt(p)-1,parseInt(E))},"parseDate");var t=this;$(m).on("change",function(v){if($(c).val()!=""){var p=P($(m).val()),E=P($(c).val());if(p>E){(0,e.alertDialog)("the start date cannot be greater than end date"),$(m).val(null);return}if($(c).val()==$(m).val()){$(o).prop("readonly",!1);var i=!1;for((0,e.serviceCall)({service:r.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:d=>{t.WeekdaysList=d.Entities[0].WeekdaysList,console.log(d.Entities),this.form.LeaveTaken.value=d.Entities[0].LeaveToTake,i=!0},onError:d=>{}});i==!1;);$(o).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var i=!1;for((0,e.serviceCall)({service:r.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:l=>{t.WeekdaysList=l.Entities[0].WeekdaysList,console.log(l.Entities),this.form.LeaveTaken.value=l.Entities[0].LeaveToTake,i=!0},onError:l=>{}});i==!1;);y.value="0",$(o).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var f="No need to take leave in this period for holiday";(0,e.alertDialog)(f)}}}),$(c).on("change",function(v){if($(m).val()!=""){var p=P($(m).val()),E=P($(c).val());if(p>E){(0,e.alertDialog)("the start date cannot be greater than end date"),$(c).val(null);return}if($(c).val()==$(m).val()){$(o).prop("readonly",!1);var i=!1;for((0,e.serviceCall)({service:r.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:d=>{console.log(d.Entities),t.WeekdaysList=d.Entities[0].WeekdaysList,this.form.LeaveTaken.value=d.Entities[0].LeaveToTake,i=!0},onError:d=>{}});i==!1;);$(o).val()==1&&(this.form.LeaveTaken.value=.5)}else{$(".MorningSession").hide(),$(".AfternoonSession").hide(),t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1;var i=!1;for((0,e.serviceCall)({service:r.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:t.form.StartDate.value,endDate:t.form.EndDate.value},async:!1,onSuccess:l=>{t.WeekdaysList=l.Entities[0].WeekdaysList,console.log(l.Entities),this.form.LeaveTaken.value=l.Entities[0].LeaveToTake,i=!0},onError:l=>{}});i==!1;);y.value="0",$(o).prop("readonly",!0)}if(this.form.LeaveTaken.value<=0){this.form.LeaveTaken.value=0;var f="No need to take leave in this period for holiday";(0,e.alertDialog)(f)}}}),$(o).on("change",function(v){$(c).val()==$(m).val()&&($(o).val()==1?(this.form.LeaveTaken.value=.5,$(".MorningSession").show(),$(".AfternoonSession").show()):(this.form.LeaveTaken.value=1,t.form.MorningSession.value=!1,t.form.AfternoonSession.value=!1,$(".MorningSession").hide(),$(".AfternoonSession").hide()))}),$(D).on("change",function(v){t.form.MorningSession.value&&(t.form.AfternoonSession.value=!1)}),$(s).on("change",function(v){t.form.AfternoonSession.value&&(t.form.MorningSession.value=!1)})}save_submitHandler(h){if(this.form.LeaveTaken.value==0){var a="No need to take leave in this period for holiday";(0,e.alertDialog)(a);return}var o=$(".fieldset").children().uniqueId(),u=h;let n="#"+this.idPrefix+"StartDate",U="#"+this.idPrefix+"EndDate",D="#"+this.idPrefix+"HalfDay";if($(D).val()==1){if(this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please choose morning session or afternoon session";(0,e.alertDialog)(a);return}if(this.form.MorningSession.value==!0&&this.form.AfternoonSession.value==!0){var a="Please choose only morning session or afternoon session";(0,e.alertDialog)(a);return}}let s="#"+o[0].id.replace("PropertyGrid","BalanceLeave");var y=this.form.LeaveTaken.value,R=new Date($(n).val()),m=new Date($(U).val()),c=m.getTime()-R.getTime(),L=Math.floor(c/(1e3*60*60*24))+1;if(y==1&&$(D).val()==1&&(y=.5),$(s).val()-y>=0){var u=h;if(parseInt(this.form.HalfDay.value)==1&&this.form.MorningSession.value==!1&&this.form.AfternoonSession.value==!1){var a="Please select whether is morning session or afternoon session";(0,e.alertDialog)(a);return}super.save_submitHandler(u)}else{var a="The applied leave exceed the available leave by "+(y-$(s).val()).toString()+" days.";(0,e.alertDialog)(a)}}getToolbarButtons(){var h=super.getToolbarButtons(),a=this,o=document.createElement("style");return o.textContent=`
        .hidden {
  display: none;
}
            `,document.head.appendChild(o),h.push({title:"Approve Application",cssClass:"text-bg-success p-2 hidden ",icon:"fa-check text-green",onClick:()=>{(0,e.confirm)("Do you want to approve this leave application?",()=>{e.Authorization.userDefinition.Permissions[M.HumanResources]?a.SuperiorPermission==!0?a.EmployeeApproval==2||a.HrApproval==2?a.EmployeeApproval==2?r.Update({EntityId:this.entityId,Entity:{HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.HrApproval==2&&r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.HrApproval==1?r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.EmployeeApproval==1?r.Update({EntityId:this.entityId,Entity:{HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:1,HrStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):(a.HrApproval=1,r.Update({EntityId:this.entityId,Entity:{HrStatus:1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}})):(a.EmployeeApproval=1,r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}})),a.HrApproval==1&&a.EmployeeApproval==1&&parseInt(a.form.LeaveReasonId.value)==1?(0,e.serviceCall)({service:K.baseUrl+"/CalculateNoPaidLeaveRate",method:"GET",data:{EmployeeRowID:a.form.EmployeeRowId.value},async:!1,onSuccess:u=>{var n=u;parseInt(this.form.HalfDay.value)&&(n=n/2);function U(D){return D===1}C(U,"binaryToBoolean"),console.log(a.WeekdaysList),(0,e.serviceCall)({service:r.baseUrl+"/CalculateHolidayToTake",method:"GET",data:{startDate:a.form.StartDate.value,endDate:a.form.EndDate.value},async:!1,onSuccess:D=>{a.WeekdaysList=D.Entities[0].WeekdaysList;var s=a.WeekdaysList.split(", ");s.forEach(y=>{K.Create({Entity:{EmployeeRowId:parseInt(a.form.EmployeeRowId.value),Deducted:0,LeaveDate:y,HalfDay:U(parseInt(this.form.HalfDay.value)),Deductions:n,MorningSession:this.form.MorningSession.value,AfternoonSession:this.form.AfternoonSession.value}})}),location.reload()},onError:D=>{}})}}):location.reload()})}}),h.push({title:"Reject Application",cssClass:"text-bg-danger p-2 hidden",icon:"fa-times text-red",onClick:()=>{(0,e.confirm)("Do you want to reject this Leave application?",()=>{e.Authorization.userDefinition.Permissions[M.HumanResources]?a.SuperiorPermission==!0?a.EmployeeApproval==2||a.HrApproval==2?a.EmployeeApproval==2?r.Update({EntityId:this.entityId,Entity:{HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.HrApproval==2&&r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.HrApproval==0?r.Update({EntityId:this.entityId,Entity:{HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):a.EmployeeApproval==0?r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}}):r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):r.Update({EntityId:this.entityId,Entity:{HrStatus:-1,HrUpdated:e.Authorization.userDefinition.EmployeeRowID}}):r.Update({EntityId:this.entityId,Entity:{EmployeeStatus:-1,EmployeeUpdated:e.Authorization.userDefinition.EmployeeRowID}}),location.reload()})}}),h}};C(B,"LeaveApplicationDialog"),B=J([S.Decorators.registerClass("HRMSoftware.LeaveApplication.LeaveApplicationDialog")],B);export{B as a};
//# sourceMappingURL=chunk-VHXXD5DZ.js.map
