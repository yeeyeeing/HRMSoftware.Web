import{a as T}from"../../../../_chunks/chunk-QIB2K6MS.js";import{l as K}from"../../../../_chunks/chunk-DCWHR4KR.js";import{a as z,b as R}from"../../../../_chunks/chunk-JBASIQVH.js";import"../../../../_chunks/chunk-B4PP3UR2.js";import"../../../../_chunks/chunk-YIP4GR2E.js";import"../../../../_chunks/chunk-5TAMAFA5.js";import{a as A}from"../../../../_chunks/chunk-5V4XT6QF.js";import"../../../../_chunks/chunk-C6XWQKYL.js";import{f as U,j as W,n as q}from"../../../../_chunks/chunk-HERT6KZV.js";import{a as Y}from"../../../../_chunks/chunk-C5I7O5E4.js";import{a as J}from"../../../../_chunks/chunk-UVKKSBKV.js";import{a as M}from"../../../../_chunks/chunk-Z5G2QNGG.js";import{a as Q}from"../../../../_chunks/chunk-GXWOODB6.js";import"../../../../_chunks/chunk-XZKAQRVI.js";import{B as r,C as c,W as L,_ as B,d as C,h as k,l as N,q as O}from"../../../../_chunks/chunk-JVVTNWA6.js";import"../../../../_chunks/chunk-CICJSBLQ.js";import"../../../../_chunks/chunk-BFH3N3PU.js";import"../../../../_chunks/chunk-LCDQ6GJF.js";import"../../../../_chunks/chunk-T7E74GLF.js";import"../../../../_chunks/chunk-2YAUIENJ.js";import"../../../../_chunks/chunk-BVVXSYMS.js";import{a as H}from"../../../../_chunks/chunk-TIB4BNCY.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import"../../../../_chunks/chunk-YDNSOE4Z.js";import{a as S}from"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-KJR5IZZY.js";import{b as j}from"../../../../_chunks/chunk-2SJ2SYN6.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as G}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as D,g as E,h as x,k as I}from"../../../../_chunks/chunk-L3ECGIWB.js";var V=E(I(),1);var y=E(G(),1);var n=E(I(),1);var d=E(I(),1),a=E(G(),1);var f=class extends y.EntityGrid{constructor(t){super(t)}getColumnsKey(){return O.columnsKey}getDialogType(){return z}getRowDefinition(){return r}getService(){return c.baseUrl}getAddButtonCaption(){return"Create Employee Payroll"}getQuickFilters(){let t=super.getQuickFilters();return d.Authorization.hasPermission(S.HumanResources)&&(t.push({cssClass:"hidden-xs",field:r.Fields.CostCentreName,type:a.Select2Editor,title:"Cost Centre"}),t.push({cssClass:"hidden-xs",field:r.Fields.OccupationName,type:a.Select2Editor,title:"Occupation"}),t.push({cssClass:"hidden-xs",field:r.Fields.JobGradeName,type:a.Select2Editor,title:"Job Grade"}),t.push({cssClass:"hidden-xs",field:r.Fields.DivisionName,type:a.Select2Editor,title:"Division"}),t.push({cssClass:"hidden-xs",field:r.Fields.DepartmentName,type:a.Select2Editor,title:"Department"}),t.push({cssClass:"hidden-xs",field:r.Fields.EmployeeName,type:a.Select2Editor,title:"Name"}),t.push({cssClass:"hidden-xs",field:r.Fields.EmployeeId,type:a.Select2Editor,title:"Employee ID"}),t.reverse()),t.push({cssClass:"hidden-xs",field:r.Fields.PayMonth,type:a.Select2Editor,title:"Pay Month"}),t.push({cssClass:"hidden-xs",field:r.Fields.PayYear,type:a.Select2Editor,title:"Pay Year"}),t}createQuickFilters(){let t=["January","February","March","April","May","June","July","August","September","October","November","December"];super.createQuickFilters(),d.Authorization.hasPermission(S.HumanResources)?(q.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.OccupationName).items.push({id:i.Entities[e].Name.toString(),text:i.Entities[e].Name.toString()})}),W.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.JobGradeName).items.push({id:i.Entities[e].Name.toString(),text:i.Entities[e].Name.toString()})}),H.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.DepartmentName).items.push({id:i.Entities[e].Name.toString(),text:i.Entities[e].Name.toString()})}),U.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.DivisionName).items.push({id:i.Entities[e].Name.toString(),text:i.Entities[e].Name.toString()})}),j.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.EmployeeName).items.push({id:i.Entities[e].EmployeeName.toString(),text:i.Entities[e].EmployeeName.toString()}),this.findQuickFilter(a.Select2Editor,r.Fields.EmployeeId).items.push({id:i.Entities[e].EmployeeID.toString(),text:i.Entities[e].EmployeeID.toString()})}),K.List({},i=>{for(var e in i.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.CostCentreName).items.push({id:i.Entities[e].Name.toString(),text:i.Entities[e].Name.toString()})})):this.toolbar.findButton("add-button").toggle(!1);for(var l in t)this.findQuickFilter(a.Select2Editor,r.Fields.PayMonth).items.push({id:l.toString(),text:t[l].toString()});c.List({},i=>{let e=[];for(var o in i.Entities)e.indexOf(i.Entities[o].PayYear)==-1&&e.push(i.Entities[o].PayYear);for(var o in e)this.findQuickFilter(a.Select2Editor,r.Fields.PayYear).items.push({id:e[o].toString(),text:e[o].toString()})})}onViewProcessData(t){if(console.log(this.rowSelection.getSelectedKeys()),t=super.onViewProcessData(t),d.Authorization.hasPermission(S.HumanResources)){var l=t;if(!(0,d.isEmptyOrNull)($(this.toolbar.findButton("add-button")).attr("style"))){var i=document.querySelectorAll(".text-bg-warning");i.forEach(function(s){$(s).hide()});var e=document.querySelectorAll(".text-bg-success");e.forEach(function(s){$(s).hide()})}for(var o in t.Entities)if((0,d.isEmptyOrNull)(t.Entities[o].PayslipPath)){var u="PayrollRowId="+encodeURIComponent(t.Entities[o].Id),p=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+u,h=new XMLHttpRequest;h.open("GET",p,!0),h.send(),c.Update({EntityId:t.Entities[o].Id,Entity:{PayslipPath:"Payroll\\Payslip\\"+t.Entities[o].Id+".pdf"}})}(0,n.serviceCall)({service:c.baseUrl+"/AskGenerationOfPayslip",method:"GET",data:{},async:!1,onSuccess:s=>{if(s[0]==1){let F=["January","February","March","April","May","June","July","August","September","October","November","December"];var b=s[1],v=s[2];(0,n.confirm)("Do you want to generate payslip for "+s[2]+" "+F[s[1]],()=>{(0,n.serviceCall)({service:c.baseUrl+"/LogGeneration",method:"GET",data:{Month:b,Year:v},async:!1,onSuccess:m=>{var P=new R;P.dialogOpen(),P.element.on("dialogclose",function(){location.reload()})},onError:m=>{console.log(m.Error)}})},{onNo:()=>{(0,n.serviceCall)({service:c.baseUrl+"/LogGeneration",method:"GET",data:{Month:b,Year:v},async:!1,onSuccess:m=>{},onError:m=>{console.log(m.Error)}}),(0,n.notifyInfo)("You can run the payslip generation wizard anytime")}})}},onError:s=>{console.log(s.Error)}}),this.toolbar.findButton("column-picker-button").toggle(!1)}return l}getButtons(){var t=super.getButtons(),l=this;return d.Authorization.hasPermission(S.HumanResources)&&(k.List({},i=>{i.Entities.length>0?C.List({},e=>{e.Entities.length>0?N.List({},o=>{o.Entities.length>0?C.List({},u=>{u.Entities.length>0?L.List({},p=>{p.Entities.length<=0&&(this.toolbar.findButton("add-button").toggle(!1),(0,n.notifyError)("Please complete PCB subjection form before using payslip function"))}):(this.toolbar.findButton("add-button").toggle(!1),(0,n.notifyError)("Please complete EIS subjection form before using payslip function"))}):((0,n.notifyError)("Please complete HRDF subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,n.notifyError)("Please complete EIS subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,n.notifyError)("Please complete EPF subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}),t.push({title:"Payroll Generator",cssClass:"fas fa-hat-wizard text-bg-success",onClick:i=>{(0,n.confirm)("Do you want to run payslip generating wizard",()=>{var e=new R;e.dialogOpen(),e.element.on("dialogclose",function(){location.reload()})})},separator:!1}),t.push({title:"Payroll Download",cssClass:"fas fa-hat-wizard text-bg-warning",onClick:i=>{(0,n.confirm)("Do you want to run payslip download wizard",()=>{var e=new A(null,null,null);e.dialogOpen()})},separator:!0}),t.push({title:"Payroll Batch Delete",cssClass:"fas fa-hat-wizard text-bg-danger",onClick:i=>{(0,n.confirm)("Do you want to delete all selected payslips?",()=>{let e=[];$(".select-row-checkbox:checked").each(function(){let o=$(this).data("id"),u=c.Delete({EntityId:o}).then(()=>{console.log("Deleted Data ID:",o)}).catch(p=>{console.error("Error deleting Data ID:",o,p)});e.push(u)}),Promise.all(e).then(()=>{location.reload()}).catch(o=>{console.error("Error in delete operations:",o)})})},separator:!0}),t.push({title:"EPF Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,n.confirm)("Do you want to set EPF Subjection",()=>{var e=new J;k.List({},o=>{o.Entities.length>0?e.loadByIdAndOpenDialog(o.Entities[0].Id):e.dialogOpen()}),e.element.on("dialogclose",function(){})})},separator:!0}),t.push({title:"EIS Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,n.confirm)("Do you want to set EPF Subjection",()=>{var e=new T;C.List({},o=>{o.Entities.length>0?e.loadByIdAndOpenDialog(o.Entities[0].Id):e.dialogOpen()}),e.element.on("dialogclose",function(){})})},separator:!0}),t.push({title:"HRDF Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,n.confirm)("Do you want to set HRDF Subjection",()=>{var e=new Y;N.List({},o=>{o.Entities.length>0?e.loadByIdAndOpenDialog(o.Entities[0].Id):e.dialogOpen()}),e.element.on("dialogclose",function(){})})},separator:!0}),t.push({title:"PCB Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,n.confirm)("Do you want to set PCB Subjection",()=>{var e=new Q;L.List({},o=>{o.Entities.length>0?e.loadByIdAndOpenDialog(o.Entities[0].Id):e.dialogOpen()}),e.element.on("dialogclose",function(){})})},separator:!0}),t.push({title:"Socso Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,n.confirm)("Do you want to set Socso Subjection",()=>{var e=new M;B.List({},o=>{o.Entities.length>0?e.loadByIdAndOpenDialog(o.Entities[0].Id):e.dialogOpen()}),e.element.on("dialogclose",function(){})})},separator:!0})),t}onClick(t,l,i){if(super.onClick(t,l,i),!t.isDefaultPrevented()){var e=this.itemAt(l),o=$(t.target);o.parent().hasClass("inline-action")&&(o=o.parent()),o.hasClass("download-payroll")&&(0,n.confirm)("Do you want to download Payroll?",()=>{var u=e.Id,p=e.PayDate,h=new Date(p),s=h.toLocaleString("en-US",{month:"long"}),b=h.getFullYear().toString(),v=e.EmployeeRowId;j.Retrieve({EntityId:v},F=>{var m=F.Entity.EmployeeName.replace(/\s/g,""),P="PayrollRowId="+encodeURIComponent(u),X=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+P,g=new XMLHttpRequest;g.open("GET",X,!0),g.responseType="blob",g.onload=function(){if(g.status===200){var Z=g.response;let _=window.URL.createObjectURL(Z),w=document.createElement("a");w.style.display="none",w.href=_,w.download=m+"Payslip"+s+b+".pdf",w.click(),(0,n.notifySuccess)("Payslip downloaded")}else(0,n.notifyError)("Error encounter when downloading Payslip Pdf")},g.send()})})}}createToolbarExtensions(){super.createToolbarExtensions(),this.rowSelection=new y.GridRowSelectionMixin(this,{selectable:t=>(console.log(t),!0)})}getColumns(){var t=super.getColumns();return t.splice(2,0,{field:"Download Payroll",name:"",format:l=>{var i='<a class="inline-action download-payroll" title="Download Payroll pdf"><i class="fa fa-download text-yellow"></i></a>';return i},width:12,minWidth:12,maxWidth:12}),t.splice(0,0,{name:"",field:"",cssClass:"select-row-checkbox",format:l=>`<input type="checkbox" class="select-row-checkbox" data-id="${l.item.Id}" />`,width:40}),t}};D(f,"PayrollGrid"),f=x([y.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGrid")],f);function ee(){(0,V.initFullHeightGridPage)(new f($("#GridDiv")).element)}D(ee,"pageInit");export{ee as default};
//# sourceMappingURL=PayrollPage.js.map
