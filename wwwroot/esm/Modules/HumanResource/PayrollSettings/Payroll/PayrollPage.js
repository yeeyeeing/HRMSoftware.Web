import{a as z}from"../../../../_chunks/chunk-FQIZJBNU.js";import{l as K}from"../../../../_chunks/chunk-DCWHR4KR.js";import{a as J,b as k}from"../../../../_chunks/chunk-S4PTUC6D.js";import"../../../../_chunks/chunk-YIP4GR2E.js";import"../../../../_chunks/chunk-B4PP3UR2.js";import"../../../../_chunks/chunk-5TAMAFA5.js";import{a as A}from"../../../../_chunks/chunk-H3GFL7W6.js";import"../../../../_chunks/chunk-FIJG4RKS.js";import{f as U,j as W,n as q}from"../../../../_chunks/chunk-HERT6KZV.js";import{a as Y}from"../../../../_chunks/chunk-OLJZM6LL.js";import{a as T}from"../../../../_chunks/chunk-ATRDGFOK.js";import{a as M}from"../../../../_chunks/chunk-CFV2YDVS.js";import{a as Q}from"../../../../_chunks/chunk-3RGFKN5E.js";import"../../../../_chunks/chunk-XZKAQRVI.js";import{B as r,C as u,W as R,_ as B,d as C,h as N,l as L,q as x}from"../../../../_chunks/chunk-62DEBFZW.js";import"../../../../_chunks/chunk-CICJSBLQ.js";import"../../../../_chunks/chunk-BFH3N3PU.js";import"../../../../_chunks/chunk-M5MV7SGZ.js";import"../../../../_chunks/chunk-T7E74GLF.js";import"../../../../_chunks/chunk-2YAUIENJ.js";import"../../../../_chunks/chunk-BVVXSYMS.js";import{a as H}from"../../../../_chunks/chunk-TIB4BNCY.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import"../../../../_chunks/chunk-YDNSOE4Z.js";import{a as S}from"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-2C2HJ25O.js";import{b as I}from"../../../../_chunks/chunk-XGDIBSP2.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as O}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as D,g as E,h as G,k as j}from"../../../../_chunks/chunk-L3ECGIWB.js";var V=E(j(),1);var f=E(O(),1);var n=E(j(),1);var c=E(j(),1),a=E(O(),1);var p=class extends f.EntityGrid{constructor(i){super(i)}getColumnsKey(){return x.columnsKey}getDialogType(){return J}getRowDefinition(){return r}getService(){return u.baseUrl}getAddButtonCaption(){return"Create Employee Payroll"}getQuickFilters(){let i=super.getQuickFilters();return c.Authorization.hasPermission(S.HumanResources)&&(i.push({cssClass:"hidden-xs",field:r.Fields.CostCentreName,type:a.Select2Editor,title:"Cost Centre"}),i.push({cssClass:"hidden-xs",field:r.Fields.OccupationName,type:a.Select2Editor,title:"Occupation"}),i.push({cssClass:"hidden-xs",field:r.Fields.JobGradeName,type:a.Select2Editor,title:"Job Grade"}),i.push({cssClass:"hidden-xs",field:r.Fields.DivisionName,type:a.Select2Editor,title:"Division"}),i.push({cssClass:"hidden-xs",field:r.Fields.DepartmentName,type:a.Select2Editor,title:"Department"}),i.push({cssClass:"hidden-xs",field:r.Fields.EmployeeName,type:a.Select2Editor,title:"Name"}),i.push({cssClass:"hidden-xs",field:r.Fields.EmployeeId,type:a.Select2Editor,title:"Employee ID"}),i.reverse()),i.push({cssClass:"hidden-xs",field:r.Fields.PayMonth,type:a.Select2Editor,title:"Pay Month"}),i.push({cssClass:"hidden-xs",field:r.Fields.PayYear,type:a.Select2Editor,title:"Pay Year"}),i}createQuickFilters(){let i=["January","February","March","April","May","June","July","August","September","October","November","December"];super.createQuickFilters(),c.Authorization.hasPermission(S.HumanResources)?(q.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.OccupationName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),W.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.JobGradeName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),H.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.DepartmentName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),U.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.DivisionName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),I.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.EmployeeName).items.push({id:e.Entities[t].EmployeeName.toString(),text:e.Entities[t].EmployeeName.toString()}),this.findQuickFilter(a.Select2Editor,r.Fields.EmployeeId).items.push({id:e.Entities[t].EmployeeID.toString(),text:e.Entities[t].EmployeeID.toString()})}),K.List({},e=>{for(var t in e.Entities)this.findQuickFilter(a.Select2Editor,r.Fields.CostCentreName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})})):this.toolbar.findButton("add-button").toggle(!1);for(var l in i)this.findQuickFilter(a.Select2Editor,r.Fields.PayMonth).items.push({id:l.toString(),text:i[l].toString()});u.List({},e=>{let t=[];for(var o in e.Entities)t.indexOf(e.Entities[o].PayYear)==-1&&t.push(e.Entities[o].PayYear);for(var o in t)this.findQuickFilter(a.Select2Editor,r.Fields.PayYear).items.push({id:t[o].toString(),text:t[o].toString()})})}onViewProcessData(i){if(i=super.onViewProcessData(i),c.Authorization.hasPermission(S.HumanResources)){var l=i;if(!(0,c.isEmptyOrNull)($(this.toolbar.findButton("add-button")).attr("style"))){var e=document.querySelectorAll(".text-bg-warning");e.forEach(function(s){$(s).hide()});var t=document.querySelectorAll(".text-bg-success");t.forEach(function(s){$(s).hide()})}for(var o in i.Entities)if((0,c.isEmptyOrNull)(i.Entities[o].PayslipPath)){var g="PayrollRowId="+encodeURIComponent(i.Entities[o].Id),y=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+g,h=new XMLHttpRequest;h.open("GET",y,!0),h.send(),u.Update({EntityId:i.Entities[o].Id,Entity:{PayslipPath:"Payroll\\Payslip\\"+i.Entities[o].Id+".pdf"}})}(0,n.serviceCall)({service:u.baseUrl+"/AskGenerationOfPayslip",method:"GET",data:{},async:!1,onSuccess:s=>{if(s[0]==1){let F=["January","February","March","April","May","June","July","August","September","October","November","December"];var b=s[1],v=s[2];(0,n.confirm)("Do you want to generate payslip for "+s[2]+" "+F[s[1]],()=>{(0,n.serviceCall)({service:u.baseUrl+"/LogGeneration",method:"GET",data:{Month:b,Year:v},async:!1,onSuccess:d=>{var P=new k;P.dialogOpen(),P.element.on("dialogclose",function(){location.reload()})},onError:d=>{console.log(d.Error)}})},{onNo:()=>{(0,n.serviceCall)({service:u.baseUrl+"/LogGeneration",method:"GET",data:{Month:b,Year:v},async:!1,onSuccess:d=>{},onError:d=>{console.log(d.Error)}}),(0,n.notifyInfo)("You can run the payslip generation wizard anytime")}})}},onError:s=>{console.log(s.Error)}}),this.toolbar.findButton("column-picker-button").toggle(!1)}return l}getButtons(){var i=super.getButtons(),l=this;return c.Authorization.hasPermission(S.HumanResources)&&(N.List({},e=>{e.Entities.length>0?C.List({},t=>{t.Entities.length>0?L.List({},o=>{o.Entities.length>0?C.List({},g=>{g.Entities.length>0?R.List({},y=>{y.Entities.length<=0&&(this.toolbar.findButton("add-button").toggle(!1),(0,n.notifyError)("Please complete PCB subjection form before using payslip function"))}):(this.toolbar.findButton("add-button").toggle(!1),(0,n.notifyError)("Please complete EIS subjection form before using payslip function"))}):((0,n.notifyError)("Please complete HRDF subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,n.notifyError)("Please complete EIS subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,n.notifyError)("Please complete EPF subjection form before using payslip function"),this.toolbar.findButton("add-button").toggle(!1))}),i.push({title:"Payroll Generator",cssClass:"fas fa-hat-wizard text-bg-success",onClick:e=>{(0,n.confirm)("Do you want to run payslip generating wizard",()=>{var t=new k;t.dialogOpen(),t.element.on("dialogclose",function(){location.reload()})})},separator:!1}),i.push({title:"Payroll Download",cssClass:"fas fa-hat-wizard text-bg-warning",onClick:e=>{(0,n.confirm)("Do you want to run payslip download wizard",()=>{var t=new A(null,null,null);t.dialogOpen()})},separator:!0}),i.push({title:"EPF Subjection",cssClass:"apply-changes-button",onClick:e=>{(0,n.confirm)("Do you want to set EPF Subjection",()=>{var t=new T;N.List({},o=>{o.Entities.length>0?t.loadByIdAndOpenDialog(o.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),i.push({title:"EIS Subjection",cssClass:"apply-changes-button",onClick:e=>{(0,n.confirm)("Do you want to set EPF Subjection",()=>{var t=new z;C.List({},o=>{o.Entities.length>0?t.loadByIdAndOpenDialog(o.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),i.push({title:"HRDF Subjection",cssClass:"apply-changes-button",onClick:e=>{(0,n.confirm)("Do you want to set HRDF Subjection",()=>{var t=new Y;L.List({},o=>{o.Entities.length>0?t.loadByIdAndOpenDialog(o.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),i.push({title:"PCB Subjection",cssClass:"apply-changes-button",onClick:e=>{(0,n.confirm)("Do you want to set PCB Subjection",()=>{var t=new Q;R.List({},o=>{o.Entities.length>0?t.loadByIdAndOpenDialog(o.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),i.push({title:"Socso Subjection",cssClass:"apply-changes-button",onClick:e=>{(0,n.confirm)("Do you want to set Socso Subjection",()=>{var t=new M;B.List({},o=>{o.Entities.length>0?t.loadByIdAndOpenDialog(o.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0})),i}onClick(i,l,e){if(super.onClick(i,l,e),!i.isDefaultPrevented()){var t=this.itemAt(l),o=$(i.target);o.parent().hasClass("inline-action")&&(o=o.parent()),o.hasClass("download-payroll")&&(0,n.confirm)("Do you want to download Payroll?",()=>{var g=t.Id,y=t.PayDate,h=new Date(y),s=h.toLocaleString("en-US",{month:"long"}),b=h.getFullYear().toString(),v=t.EmployeeRowId;I.Retrieve({EntityId:v},F=>{var d=F.Entity.EmployeeName.replace(/\s/g,""),P="PayrollRowId="+encodeURIComponent(g),X=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+P,m=new XMLHttpRequest;m.open("GET",X,!0),m.responseType="blob",m.onload=function(){if(m.status===200){var Z=m.response;let _=window.URL.createObjectURL(Z),w=document.createElement("a");w.style.display="none",w.href=_,w.download=d+"Payslip"+s+b+".pdf",w.click(),(0,n.notifySuccess)("Payslip downloaded")}else(0,n.notifyError)("Error encounter when downloading Payslip Pdf")},m.send()})})}}createToolbarExtensions(){super.createToolbarExtensions(),this.rowSelection=new f.GridRowSelectionMixin(this,{selectable:i=>!0})}getColumns(){var i=super.getColumns();return i.splice(2,0,{field:"Download Payroll",name:"",format:l=>{var e='<a class="inline-action download-payroll" title="Download Payroll pdf"><i class="fa fa-download text-yellow"></i></a>';return e},width:12,minWidth:12,maxWidth:12}),i}};D(p,"PayrollGrid"),p=G([f.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGrid")],p);function tt(){(0,V.initFullHeightGridPage)(new p($("#GridDiv")).element)}D(tt,"pageInit");export{tt as default};
//# sourceMappingURL=PayrollPage.js.map
