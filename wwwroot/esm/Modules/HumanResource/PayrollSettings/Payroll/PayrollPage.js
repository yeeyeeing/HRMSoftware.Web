import{a as Be}from"../../../../_chunks/chunk-CBKDZ6FX.js";import{a as Te}from"../../../../_chunks/chunk-RWFUARJ7.js";import{a as Fe}from"../../../../_chunks/chunk-GCZFI35H.js";import{a as De}from"../../../../_chunks/chunk-27FUZXOC.js";import{a as xe,b as de}from"../../../../_chunks/chunk-UV6LIRZW.js";import"../../../../_chunks/chunk-B4PP3UR2.js";import"../../../../_chunks/chunk-YIP4GR2E.js";import"../../../../_chunks/chunk-IFNCZ3M2.js";import{a as we}from"../../../../_chunks/chunk-Y5WEA3NM.js";import{G as Ce}from"../../../../_chunks/chunk-TCOECVPP.js";import{a as Pe}from"../../../../_chunks/chunk-7R7PPPPM.js";import{a as be}from"../../../../_chunks/chunk-GYGNC3HF.js";import{$ as le,A as Ee,B as Se,C as m,D as I,H as P,d as Z,ea as Ie,fa as se,h as ne,l as re,q as ve}from"../../../../_chunks/chunk-N2Z54I7F.js";import"../../../../_chunks/chunk-J5U3DV55.js";import"../../../../_chunks/chunk-GHIP3IPF.js";import"../../../../_chunks/chunk-2YJXBIYS.js";import"../../../../_chunks/chunk-GYFJ4L6D.js";import"../../../../_chunks/chunk-T7E74GLF.js";import{d as he}from"../../../../_chunks/chunk-HDHDXEPW.js";import"../../../../_chunks/chunk-BVVXSYMS.js";import"../../../../_chunks/chunk-3FMYFY2A.js";import{a as W}from"../../../../_chunks/chunk-OAOSE5IN.js";import"../../../../_chunks/chunk-F3ZQHHES.js";import{B as ge,l as ye}from"../../../../_chunks/chunk-E5LOGLR4.js";import{f as ue,j as ce,n as fe,r as pe}from"../../../../_chunks/chunk-EM5O7OU6.js";import"../../../../_chunks/chunk-JXMDZA3A.js";import{a as me}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{a as V,b as Q}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as _}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as B,g as b,h as X,j as d,k as J}from"../../../../_chunks/chunk-L3ECGIWB.js";var Oe=b(J(),1);var A=b(_(),1);var l=b(J(),1);var D=b(J(),1),c=b(_(),1);var L=b(_(),1);var r=b(J(),1),te=b(J(),1),ee=b(_(),1);var O=class extends L.EntityDialog{constructor(){super();this.form=new se(this.idPrefix);var e,t=this;P.List({},a=>{for(var i in a.Entities){let o=a.Entities[i];o.IsActive==1&&(t.payrollSettingId=o.Id||null,t.payDay=o.CreditingDay||null,o.OrganisationName&&(t.form.OrganisationName.value=o.OrganisationName),o.OrganisationCode&&(t.form.OrganisationCode.value=o.OrganisationCode),o.Email&&(t.form.Email.value=o.Email),o.PhoneNumber&&(t.form.PhoneNumber.value=o.PhoneNumber),o.ContactPerson&&(t.form.ContactPerson.value=o.ContactPerson),o.StateCodeId&&(t.form.MasterStateId.value=o.StateCodeId),t.ContactPerson=o.ContactPerson||"",t.OrganisationCode=o.OrganisationCode||"",t.OrganisationName=o.OrganisationName||"",t.PhoneNumber=o.PhoneNumber||"",t.Email=o.Email||"",o.LhdnFormatId&&(t.form.TextFormatLhdnId.value=o.LhdnFormatId.toString()),o.SocsoFormatId&&(t.form.TextFormatEisSocsoId.value=o.SocsoFormatId.toString()),o.EisFormatId&&(t.form.TextFormatEisSocsoId.value=o.EisFormatId.toString()),o.AutopayFormatId&&(t.form.TextFormatAutopayId.value=o.AutopayFormatId.toString()),o.EpfFormatId&&(t.form.TextFormatEpfId.value=o.EpfFormatId.toString()))}}),Q.List({Criteria:L.Criteria.and(e,[[V.Fields.Retired],"=","0"],[[V.Fields.Terminated],"=","0"],[[V.Fields.Resigned],"=","0"])},a=>{this.EmployeeData=a.Entities})}getFormKey(){return se.formKey}getRowDefinition(){return Ee}getService(){return Se.baseUrl}getToolbarButtons(){var e=this,t=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),t.push({title:"Download Text File",cssClass:"text-bg-success p-2 ml-auto downloadButton hidden",icon:"fas fa-hat-wizard text-green",onClick:()=>{if((0,r.isEmptyOrNull)(e.form.TextType.value)){(0,r.alertDialog)("Please fill in the type of government payment to generate");return}if((0,r.isEmptyOrNull)(e.form.EmployeeRowList.value)){(0,r.alertDialog)("Please select the employee to include in the report");return}parseInt(e.form.TextType.value)==3 .valueOf()?P.Update({EntityId:e.payrollSettingId,Entity:{Email:e.form.Email.value,PhoneNumber:e.form.PhoneNumber.value,ContactPerson:e.form.ContactPerson.value,LhdnFormatId:parseInt(e.form.TextFormatLhdnId.value),StateCodeId:e.form.MasterStateId.value}}):parseInt(e.form.TextType.value)==5 .valueOf()?P.Update({EntityId:e.payrollSettingId,Entity:{CreditingDay:e.form.CreditingDate.valueAsDate.getDay(),OrganisationName:e.form.OrganisationName.value,OrganisationCode:e.form.OrganisationCode.value,AutopayFormatId:parseInt(e.form.TextFormatAutopayId.value)}}):parseInt(e.form.TextType.value)==4 .valueOf()?P.Update({EntityId:e.payrollSettingId,Entity:{SocsoFormatId:parseInt(e.form.TextFormatEisSocsoId.value)}}):parseInt(e.form.TextType.value)==2 .valueOf()?P.Update({EntityId:e.payrollSettingId,Entity:{EisFormatId:parseInt(e.form.TextFormatEisSocsoId.value)}}):parseInt(e.form.TextType.value)==1 .valueOf()&&P.Update({EntityId:e.payrollSettingId,Entity:{EpfFormatId:parseInt(e.form.TextFormatEpfId.value)}});var a;parseInt(e.form.TextType.value)==3 .valueOf()?a=e.form.TextFormatLhdnId.value:parseInt(e.form.TextType.value)==5 .valueOf()?a=e.form.TextFormatAutopayId.value:parseInt(e.form.TextType.value)==1 .valueOf()?a=e.form.TextFormatEpfId.value:(parseInt(e.form.TextType.value)==2 .valueOf()||parseInt(e.form.TextType.value)==4 .valueOf())&&(a=e.form.TextFormatEisSocsoId.value);var i="PayMonth="+encodeURIComponent(e.form.PayMonth.value)+"&PayYear="+encodeURIComponent(e.form.PayYear.value)+"&Type="+encodeURIComponent(e.form.TextType.value)+"&CompanyCode="+encodeURIComponent(e.form.OrganisationCode.value)+"&CompanyName="+encodeURIComponent(e.form.OrganisationName.value)+"&CreditingDate="+encodeURIComponent(e.form.CreditingDate.value)+"&Email="+encodeURIComponent(e.form.Email.value)+"&PhoneNumber="+encodeURIComponent(e.form.PhoneNumber.value)+"&ContactPerson="+encodeURIComponent(e.form.ContactPerson.value)+"&EmployeeArrayString="+encodeURIComponent(e.form.EmployeeRowList.value)+"&StateCodeId="+encodeURIComponent(e.form.MasterStateId.value)+"&TextFormat="+encodeURIComponent(a)+"&testMode="+encodeURIComponent(e.form.TestingMode.value),o=window.location.origin+"/PayrollSettings/Payroll/TxtGenerate?"+i,u=new XMLHttpRequest;u.open("GET",o,!0),u.responseType="blob",u.onload=function(){if(u.status===200){var f=u.response;let p=window.URL.createObjectURL(f),s=document.createElement("a");s.style.display="none",s.href=p;var y=`${e.form.TextType.text}.txt`;s.download=y,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(p)}else(0,te.notifyError)("Error encounter when downloading Payslip Pdf")},u.send()}}),t}dialogOpen(e){super.dialogOpen();var t=this;(0,te.serviceCall)({service:Ce.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:n=>{t.dateString=n,he.List({},v=>{var K=new Date(t.dateString),H=0;for(var M in v.Entities)if(v.Entities[M].IsActive==1){H=v.Entities[M].PayDay;break}})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var a=document.getElementById(this.idPrefix+"MasterStateId"),i=document.getElementById(this.idPrefix+"PayMonth"),o=document.getElementById(this.idPrefix+"PayYear");let u=new ee.Select2Editor($(i)),f=new ee.Select2Editor($(o)),y=new ee.Select2Editor($(a));ge.List({},n=>{for(var v in n.Entities)(0,r.isEmptyOrNull)(n.Entities[v].StateCode)||y.addItem({id:n.Entities[v].Id.toString(),text:n.Entities[v].Name.toString()})});let p=["January","February","March","April","May","June","July","August","September","October","November","December"];var s=new Date(t.dateString),g=s.getFullYear(),E=s.getMonth();for(let n=0;n<p.length;n++)u.addItem({id:n.toString(),text:p[n].toString()});u.set_value(E.toString());for(let n=-1;n<2;n++)f.addItem({id:(g+n).toString(),text:(g+n).toString()});f.set_value(g.toString());var x=document.getElementById(this.idPrefix+"MasterStateId");$(x).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var Y=document.getElementById(this.idPrefix+"TestingMode");$(Y).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var h=document.getElementById(this.idPrefix+"TextFormatEpfId");$(h).on("change",function(){return d(this,null,function*(){parseInt(t.form.TextFormatEpfId.value)==1 .valueOf()?$(".PhoneNumber, .ContactPerson").show():$(".PhoneNumber, .ContactPerson").hide(),t.handleDownloadButton()})});var z=document.getElementById(this.idPrefix+"TextFormatAutopayId");$(z).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var C=document.getElementById(this.idPrefix+"TextType"),S=document.getElementById(this.idPrefix+"TextFormatEisSocsoId");$(S).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var k=document.getElementById(this.idPrefix+"TextFormatLhdnId");$(k).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})}),$(".TextFormatEisSocsoId, .TextFormatEpfId, .TextFormatAutopayId, .TextFormatLhdnId, .TestingMode, .MasterStateId").hide(),$(C).on("change",function(){return d(this,null,function*(){if($(".Email, .PhoneNumber, .ContactPerson, .CreditingDate, .OrganisationName, .OrganisationCode, .MasterStateId").hide(),$(".TextFormatEisSocsoId, .TextFormatEpfId, .TextFormatAutopayId, .TextFormatLhdnId, .TestingMode").hide(),parseInt(t.form.TextType.value)==3 .valueOf())t.form.Email.value=t.Email,t.form.PhoneNumber.value=t.PhoneNumber,t.form.ContactPerson.value=t.ContactPerson,$(".Email, .PhoneNumber, .ContactPerson, .TextFormatLhdnId, .CreditingDate").show(),console.log("hahaha");else if(parseInt(t.form.TextType.value)==5 .valueOf()){$(".TextFormatAutopayId").show();var n=new Date(g,E,t.payDay),v=n.getFullYear().toString(),K=(n.getMonth()+1).toString(),H=n.getDate().toString(),M=K.padStart(2,"0")+"/"+H.padStart(2,"0")+"/"+v;t.form.CreditingDate.value=M,t.form.OrganisationName.value=t.OrganisationName,t.form.OrganisationCode.value=t.OrganisationCode,$(" .CreditingDate, .OrganisationName, .OrganisationCode").show()}else if(parseInt(t.form.TextType.value)==1 .valueOf()){$(".TextFormatEpfId, .TestingMode").show();var n=new Date(g,E,t.payDay),v=n.getFullYear().toString(),K=(n.getMonth()+1).toString(),H=n.getDate().toString(),M=K.padStart(2,"0")+"/"+H.padStart(2,"0")+"/"+v;if(t.form.CreditingDate.value=M,$(" .CreditingDate, .MasterStateId").show(),parseInt(t.form.TextFormatEpfId.value)==1 .valueOf()&&!(0,r.isEmptyOrNull)(t.form.MasterStateId.value)&&!(0,r.isEmptyOrNull)(t.form.TextFormatEpfId.value)&&!(0,r.isEmptyOrNull)(t.form.TestingMode.value)&&!(0,r.isEmptyOrNull)(t.form.ContactPerson.value)&&!(0,r.isEmptyOrNull)(t.form.PhoneNumber.value)){$(".downloadButton").removeClass("hidden");return}}else(parseInt(t.form.TextType.value)==2 .valueOf()||parseInt(t.form.TextType.value)==4 .valueOf())&&$(".TextFormatEisSocsoId").show();t.handleDownloadButton()})});var j=document.getElementById(this.idPrefix+"ContactPerson");$(j).on("input",function(){return d(this,null,function*(){let n=this.value;n.length>40&&(n=n.slice(0,40)),this.value=n,t.handleDownloadButton()})});var T=document.getElementById(this.idPrefix+"Email");$(T).on("input",function(){return d(this,null,function*(){let n=this.value;n.length>40&&(n=n.slice(0,40)),this.value=n,t.handleDownloadButton()})});var w=document.getElementById(this.idPrefix+"PhoneNumber");$(w).on("input",function(){return d(this,null,function*(){let n=this.value;n=n.replace(/\D/g,""),n.length>20&&(n=n.slice(0,20)),this.value=n,t.handleDownloadButton()})});var U=document.getElementById(this.idPrefix+"SectionList"),R=document.getElementById(this.idPrefix+"OccupationList"),G=document.getElementById(this.idPrefix+"DepartmentList"),oe=document.getElementById(this.idPrefix+"DivisionList"),ie=document.getElementById(this.idPrefix+"JobGradeList"),Y=document.getElementById(this.idPrefix+"TestingMode");$(Y).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var T=document.getElementById(this.idPrefix+"Email");$(T).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var ae=document.getElementById(this.idPrefix+"CreditingDate");$(ae).on("change",function(){return d(this,null,function*(){t.handleDownloadButton()})});var q=document.getElementById(this.idPrefix+"OrganisationCode");$(q).on("input",function(){return d(this,null,function*(){t.handleDownloadButton()})});var F=document.getElementById(this.idPrefix+"OrganisationName");$(F).on("input",function(){return d(this,null,function*(){t.handleDownloadButton()})});var z=document.getElementById(this.idPrefix+"TextFormatAutopayId");$(z).on("input",function(){return d(this,null,function*(){t.handleDownloadButton()})}),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(n){return d(this,null,function*(){$(".select2-drop").hide()})}),$(i).on("change",function(){return d(this,null,function*(){((0,r.isEmptyOrNull)($(i).val())||(0,r.isEmptyOrNull)($(o).val()))&&(t.form.EmployeeRowList.value=""),t.AllButton()})}),$(o).on("change",function(){return d(this,null,function*(){((0,r.isEmptyOrNull)($(i).val())||(0,r.isEmptyOrNull)($(o).val()))&&(t.form.EmployeeRowList.value=""),t.AllButton()})}),$(R).on("change",function(){return d(this,null,function*(){t.form.All.value=!1,t.AllButton()})}),$(oe).on("change",function(){return d(this,null,function*(){t.form.All.value=!1,t.AllButton()})}),$(ie).on("change",function(){return d(this,null,function*(){t.form.All.value=!1,t.AllButton()})}),$(G).on("change",function(){return d(this,null,function*(){t.form.All.value=!1,t.AllButton()})}),$(U).on("change",function(){return d(this,null,function*(){t.form.All.value=!1,t.AllButton()})});var Re=document.getElementById(this.idPrefix+"All");$(Re).on("change",function(){return d(this,null,function*(){t.AllButton()})}),$(".Email, .PhoneNumber, .ContactPerson, .CreditingDate, .OrganisationName, .OrganisationCode, .MasterStateId, .TextFormatId").hide()}handleDownloadButton(){var e=this;if((0,r.isEmptyOrNull)(e.form.EmployeeRowList.value)){$(".downloadButton").addClass("hidden");return}if(parseInt(e.form.TextType.value)==1 .valueOf())if(parseInt(e.form.TextFormatEpfId.value)==1 .valueOf())if(!(0,r.isEmptyOrNull)(e.form.MasterStateId.value)&&!(0,r.isEmptyOrNull)(e.form.TextFormatEpfId.value)&&!(0,r.isEmptyOrNull)(e.form.TestingMode.value)&&!(0,r.isEmptyOrNull)(e.form.ContactPerson.value)&&!(0,r.isEmptyOrNull)(e.form.PhoneNumber.value)&&!(0,r.isEmptyOrNull)(e.form.CreditingDate.value)){$(".downloadButton").removeClass("hidden");return}else $(".downloadButton").addClass("hidden");else if(parseInt(e.form.TextFormatEpfId.value)==2 .valueOf())if(!(0,r.isEmptyOrNull)(e.form.MasterStateId.value)&&!(0,r.isEmptyOrNull)(e.form.TestingMode.value)&&!(0,r.isEmptyOrNull)(e.form.CreditingDate.value)){$(".downloadButton").removeClass("hidden");return}else $(".downloadButton").addClass("hidden");else $(".downloadButton").addClass("hidden");else if(parseInt(e.form.TextType.value)==3 .valueOf())if(parseInt(e.form.TextFormatLhdnId.value)==1 .valueOf())if(!(0,r.isEmptyOrNull)(e.form.Email.value)&&!(0,r.isEmptyOrNull)(e.form.ContactPerson.value)&&!(0,r.isEmptyOrNull)(e.form.PhoneNumber.value)&&!(0,r.isEmptyOrNull)(e.form.CreditingDate.value)){$(".downloadButton").removeClass("hidden");return}else $(".downloadButton").addClass("hidden");else $(".downloadButton").addClass("hidden");else if(parseInt(e.form.TextType.value)==5 .valueOf())if(parseInt(e.form.TextFormatAutopayId.value)==1 .valueOf())if(!(0,r.isEmptyOrNull)(e.form.OrganisationName.value)&&!(0,r.isEmptyOrNull)(e.form.OrganisationCode.value)&&!(0,r.isEmptyOrNull)(e.form.CreditingDate.value)){$(".downloadButton").removeClass("hidden");return}else $(".downloadButton").addClass("hidden");else $(".downloadButton").addClass("hidden");else if(parseInt(e.form.TextType.value)==2 .valueOf()||parseInt(e.form.TextType.value)==4 .valueOf())if((0,r.isEmptyOrNull)(e.form.TextFormatEisSocsoId.value))$(".downloadButton").addClass("hidden");else{$(".downloadButton").removeClass("hidden");return}else $(".downloadButton").addClass("hidden")}AllButton(){var e=this;if(e.form.All.value==!0){var t="";for(var a in e.EmployeeData)t=`${t} , ${e.EmployeeData[a].Id.toString()}`;e.form.EmployeeRowListBuffer.value=t}else e.form.All.value==!1&&e.SearchCallback();e.SearchEmployeeCallback(),e.handleDownloadButton()}getDialogOptions(){let e=super.getDialogOptions();return e.width=e.width+100,e}SearchCallback(){var e=this,t=document.getElementById(this.idPrefix+"PayMonth"),a=document.getElementById(this.idPrefix+"PayYear"),i=document.getElementById(this.idPrefix+"OccupationList"),o=document.getElementById(this.idPrefix+"DepartmentList"),u=document.getElementById(this.idPrefix+"DivisionList"),f=document.getElementById(this.idPrefix+"JobGradeList"),y=document.getElementById(this.idPrefix+"SectionList");if((0,r.isEmptyOrNull)($(t).val())||(0,r.isEmptyOrNull)($(a).val())){this.form.EmployeeRowList.value=this.form.EmployeeRowListBuffer.value="";return}function p(U){let R=$(U).val();return R.length?R.split(",").map(G=>parseInt(G,10)):[]}B(p,"parseListFromElement");let s=p(f),g=p(u),E=p(o),x=p(i),h=p(y),C=new Set(s),S=new Set(g),k=new Set(E),j=new Set(x),w=new Set(h);for(let U of e.EmployeeData){let{JobGradeID:R,DivisionID:G,DepartmentID:oe,OccupationID:ie,SectionID:Y,Id:T}=U,ae=C.has(R)||S.has(G)||k.has(oe)||j.has(ie)||w.has(Y),q=e.form.EmployeeRowListBuffer.value,F=q?q.split(",").map(Number):[];ae?F.includes(T)||F.push(T):F=F.filter(z=>z!==T),e.form.EmployeeRowListBuffer.value=F.join(",")}}SearchEmployeeCallback(){var e=this,t=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),a=$(t).val();let i=a.split(","),o=[];if(a.length&&i.forEach(f=>{o.push(parseInt(f))}),o.length!=0){var u=L.Criteria.and([[m.Fields.PayYear],"=",e.form.PayYear.value],[[m.Fields.PayMonth],"=",e.form.PayMonth.value],[[m.Fields.EmployeeRowId],"in",[o]]);I.List({Criteria:u},f=>{var y="";for(var p in f.Entities){var s=f.Entities[p].EmployeeRowId;o.indexOf(s)!=-1&&(y=y+" , "+s)}e.form.EmployeeRowList.value=y,e.handleDownloadButton()})}}};B(O,"TextDownloadingWizardDialog"),O=X([L.Decorators.registerClass("HRMSoftware.PayrollSettings.TextDownloadingWizardDialog")],O);var N=class extends A.EntityGrid{constructor(e){super(e)}getColumnsKey(){return ve.columnsKey}getDialogType(){return xe}getRowDefinition(){return m}getService(){return I.baseUrl}getAddButtonCaption(){return"Create Employee Payroll"}getQuickFilters(){let e=super.getQuickFilters();return D.Authorization.hasPermission(W.HumanResources)&&(e.push({cssClass:"hidden-xs",field:m.Fields.CostCentreName,type:c.Select2Editor,title:"Cost Centre"}),e.push({cssClass:"hidden-xs",field:m.Fields.OccupationName,type:c.Select2Editor,title:"Occupation"}),e.push({cssClass:"hidden-xs",field:m.Fields.JobGradeName,type:c.Select2Editor,title:"Job Grade"}),e.push({cssClass:"hidden-xs",field:m.Fields.DivisionName,type:c.Select2Editor,title:"Division"}),e.push({cssClass:"hidden-xs",field:m.Fields.DepartmentName,type:c.Select2Editor,title:"Department"}),e.push({cssClass:"hidden-xs",field:m.Fields.SectionName,type:c.Select2Editor,title:"Section"}),e.push({cssClass:"hidden-xs",field:m.Fields.EmployeeName,type:c.Select2Editor,title:"Name"}),e.push({cssClass:"hidden-xs",field:m.Fields.EmployeeId,type:c.Select2Editor,title:"Employee ID"}),e.reverse()),e.push({cssClass:"hidden-xs",field:m.Fields.PayMonth,type:c.Select2Editor,title:"Pay Month"}),e.push({cssClass:"hidden-xs",field:m.Fields.PayYear,type:c.Select2Editor,title:"Pay Year"}),e}createQuickFilters(){let e=["January","February","March","April","May","June","July","August","September","October","November","December"];super.createQuickFilters(),D.Authorization.hasPermission(W.HumanResources)?(fe.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.OccupationName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})}),ce.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.JobGradeName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})}),me.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.DepartmentName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})}),ue.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.DivisionName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})}),pe.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.SectionName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})}),Q.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.EmployeeName).items.push({id:a.Entities[i].EmployeeName.toString(),text:a.Entities[i].EmployeeName.toString()}),this.findQuickFilter(c.Select2Editor,m.Fields.EmployeeId).items.push({id:a.Entities[i].EmployeeID.toString(),text:a.Entities[i].EmployeeID.toString()})}),ye.List({},a=>{for(var i in a.Entities)this.findQuickFilter(c.Select2Editor,m.Fields.CostCentreName).items.push({id:a.Entities[i].Name.toString(),text:a.Entities[i].Name.toString()})})):this.toolbar.findButton("add-button").toggle(!1);for(var t in e)this.findQuickFilter(c.Select2Editor,m.Fields.PayMonth).items.push({id:t.toString(),text:e[t].toString()});I.List({},a=>{let i=[];for(var o in a.Entities)i.indexOf(a.Entities[o].PayYear)==-1&&i.push(a.Entities[o].PayYear);for(var o in i)this.findQuickFilter(c.Select2Editor,m.Fields.PayYear).items.push({id:i[o].toString(),text:i[o].toString()})})}onViewProcessData(e){var t=this;if(e=super.onViewProcessData(e),D.Authorization.hasPermission(W.HumanResources)){var a=e;if(!(0,D.isEmptyOrNull)($(this.toolbar.findButton("add-button")).attr("style"))){var i=document.querySelectorAll(".text-bg-warning");i.forEach(function(s){$(s).hide()});var o=document.querySelectorAll(".text-bg-success");o.forEach(function(s){$(s).hide()})}for(var u in e.Entities)if((0,D.isEmptyOrNull)(e.Entities[u].PayslipPath)){var f="PayrollRowId="+encodeURIComponent(e.Entities[u].Id),y=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+f,p=new XMLHttpRequest;p.open("GET",y,!0),p.send(),I.Update({EntityId:e.Entities[u].Id,Entity:{PayslipPath:"Payroll\\Payslip\\"+e.Entities[u].Id+".pdf"}})}(0,l.serviceCall)({service:I.baseUrl+"/AskGenerationOfPayslip",method:"GET",data:{},async:!1,onSuccess:s=>{if(s[0]==1){let x=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=s[1],E=s[2];(0,l.confirm)("Do you want to generate payslip for "+s[2]+" "+x[s[1]],()=>{(0,l.serviceCall)({service:I.baseUrl+"/LogGeneration",method:"GET",data:{Month:g,Year:E},async:!1,onSuccess:h=>{var C=new de;C.dialogOpen(),C.element.on("dialogclose",function(){t.internalRefresh()})},onError:h=>{console.log(h.Error)}})},{onNo:()=>{(0,l.serviceCall)({service:I.baseUrl+"/LogGeneration",method:"GET",data:{Month:g,Year:E},async:!1,onSuccess:h=>{},onError:h=>{console.log(h.Error)}}),(0,l.notifyInfo)("You can run the payroll generation wizard anytime")}})}},onError:s=>{console.log(s.Error)}}),this.toolbar.findButton("column-picker-button").toggle(!1)}return a}getButtons(){var e=super.getButtons(),t=this;return D.Authorization.hasPermission(W.HumanResources)&&(P.List({},a=>{a.Entities.length>0?ne.List({},i=>{i.Entities.length>0?Z.List({},o=>{o.Entities.length>0?re.List({},u=>{u.Entities.length>0?Z.List({},f=>{f.Entities.length>0?le.List({},y=>{y.Entities.length<=0&&(this.toolbar.findButton("add-button").toggle(!1),(0,l.notifyError)("Please complete PCB subjection form before using payroll function"))}):(this.toolbar.findButton("add-button").toggle(!1),(0,l.notifyError)("Please complete EIS subjection form before using payroll function"))}):((0,l.notifyError)("Please complete HRDF subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,l.notifyError)("Please complete EIS subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,l.notifyError)("Please complete EPF subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,l.notifyError)("Please complete Payroll Settings form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}),e.push({title:"Payroll Settings",cssClass:"fas fa-wrench text-bg-primary",onClick:a=>{(0,l.confirm)("Do you want to edit payroll settings?",()=>{var i=new De;P.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()})})}}),e.push({title:"Payroll Generator",cssClass:"fas fa-hat-wizard text-bg-success",onClick:a=>{(0,l.confirm)("Do you want to run payroll generating wizard",()=>{var i=new de;i.dialogOpen(),i.element.on("dialogclose",function(){t.internalRefresh()})})}}),e.push({title:"Payroll Download",cssClass:"fas fa-hat-wizard text-bg-warning",onClick:a=>{(0,l.confirm)("Do you want to run payroll download wizard",()=>{var i=new we(null,null,null);i.dialogOpen()})},separator:!0}),e.push({title:"Payroll Batch Delete",cssClass:"fas fa-hat-wizard text-bg-danger",onClick:a=>{(0,l.confirm)("Do you want to delete all selected payslips?",()=>{let i=[];$(".select-row-checkbox:checked").each(function(){let o=$(this).data("id"),u=I.Delete({EntityId:o}).then(()=>{console.log("Deleted Data ID:",o)}).catch(f=>{console.error("Error deleting Data ID:",o,f)});i.push(u)}),Promise.all(i).then(()=>{t.internalRefresh()}).catch(o=>{console.error("Error in delete operations:",o)})})},separator:!0}),e.push({title:"Download Text Report",cssClass:"fas fa-hat-wizard text-bg-info",onClick:a=>{(0,l.confirm)("Do you want to download text report?",()=>{var i=new O;i.dialogOpen(),i.element.on("dialogclose",function(){t.internalRefresh()})})},separator:!0}),e.push({title:"EPF Subjection",cssClass:"apply-changes-button",onClick:a=>{(0,l.confirm)("Do you want to set EPF Subjection",()=>{var i=new Te;ne.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()})})},separator:!0}),e.push({title:"EIS Subjection",cssClass:"apply-changes-button",onClick:a=>{(0,l.confirm)("Do you want to set EPF Subjection",()=>{var i=new Fe;Z.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()}),i.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"HRDF Subjection",cssClass:"apply-changes-button",onClick:a=>{(0,l.confirm)("Do you want to set HRDF Subjection",()=>{var i=new Be;re.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()}),i.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"PCB Subjection",cssClass:"apply-changes-button",onClick:a=>{(0,l.confirm)("Do you want to set PCB Subjection",()=>{var i=new be;le.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()}),i.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"Socso Subjection",cssClass:"apply-changes-button",onClick:a=>{(0,l.confirm)("Do you want to set Socso Subjection",()=>{var i=new Pe;Ie.List({},o=>{o.Entities.length>0?i.loadByIdAndOpenDialog(o.Entities[0].Id):i.dialogOpen()}),i.element.on("dialogclose",function(){})})},separator:!0})),e}onClick(e,t,a){if(super.onClick(e,t,a),!e.isDefaultPrevented()){var i=this.itemAt(t),o=$(e.target);o.parent().hasClass("inline-action")&&(o=o.parent()),o.hasClass("download-payroll")&&(0,l.confirm)("Do you want to download Payroll?",()=>{var u=i.Id,f=i.PayDate,y=new Date(f),p=y.toLocaleString("en-US",{month:"long"}),s=y.getFullYear().toString(),g=i.EmployeeRowId;Q.Retrieve({EntityId:g},E=>{var x=E.Entity.EmployeeName.replace(/\s/g,""),h="PayrollRowId="+encodeURIComponent(u),C=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+h,S=new XMLHttpRequest;S.open("GET",C,!0),S.responseType="blob",S.onload=function(){if(S.status===200){var k=S.response;let j=window.URL.createObjectURL(k),w=document.createElement("a");w.style.display="none",w.href=j,w.download=x+"Payslip"+p+s+".pdf",w.click(),(0,l.notifySuccess)("Payslip downloaded")}else(0,l.notifyError)("Error encounter when downloading Payslip Pdf")},S.send()})})}}createToolbarExtensions(){super.createToolbarExtensions(),this.rowSelection=new A.GridRowSelectionMixin(this,{selectable:e=>(console.log(e),!0)})}getColumns(){var e=super.getColumns();return e.splice(2,0,{field:"Download Payroll",name:"",format:t=>{var a='<a class="inline-action download-payroll" title="Download Payroll pdf"><i class="fa fa-download text-yellow"></i></a>';return a},width:12,minWidth:12,maxWidth:12}),e.splice(0,0,{name:"",field:"",cssClass:"select-row-checkbox",format:t=>`<input type="checkbox" class="select-row-checkbox" data-id="${t.item.Id}" />`,width:40}),e}};B(N,"PayrollGrid"),N=X([A.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGrid")],N);function $e(){(0,Oe.initFullHeightGridPage)(new N($("#GridDiv")).element)}B($e,"pageInit");export{$e as default};
//# sourceMappingURL=PayrollPage.js.map
