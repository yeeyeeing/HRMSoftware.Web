import{a as Ce}from"../../../../_chunks/chunk-TNGZP62C.js";import{a as we}from"../../../../_chunks/chunk-UGUOBLVM.js";import{a as be}from"../../../../_chunks/chunk-4HOGAWEX.js";import{a as Ie,b as ae}from"../../../../_chunks/chunk-QKPMDANV.js";import"../../../../_chunks/chunk-YIP4GR2E.js";import"../../../../_chunks/chunk-B4PP3UR2.js";import"../../../../_chunks/chunk-AUHCGJNL.js";import{a as Pe}from"../../../../_chunks/chunk-AORTIJZQ.js";import{G as Se}from"../../../../_chunks/chunk-BAMNZFIK.js";import{a as De}from"../../../../_chunks/chunk-BQQJYR64.js";import{a as ve}from"../../../../_chunks/chunk-AG4TBRZP.js";import{a as Ee}from"../../../../_chunks/chunk-S3QWAECI.js";import"../../../../_chunks/chunk-OLYWZP6G.js";import{A as ge,B as d,C,G as D,_ as ie,d as q,da as he,ea as oe,h as ee,l as te,q as pe,z as ye}from"../../../../_chunks/chunk-6BHXH7OQ.js";import"../../../../_chunks/chunk-CICJSBLQ.js";import"../../../../_chunks/chunk-PMW367QL.js";import"../../../../_chunks/chunk-HHF47QKB.js";import"../../../../_chunks/chunk-T7E74GLF.js";import{d as fe}from"../../../../_chunks/chunk-HDHDXEPW.js";import"../../../../_chunks/chunk-BVVXSYMS.js";import"../../../../_chunks/chunk-DA7Z2NN7.js";import{a as H}from"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-NN5FEWI3.js";import{l as ue,x as ce}from"../../../../_chunks/chunk-KCWQ5BXW.js";import{f as le,j as se,n as de,r as me}from"../../../../_chunks/chunk-MVZ476J5.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import{a as re}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{a as W,b as z}from"../../../../_chunks/chunk-MUCPV7IN.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as Q}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as F,g as w,h as J,j as p,k as Y}from"../../../../_chunks/chunk-L3ECGIWB.js";var xe=w(Y(),1);var A=w(Q(),1);var r=w(Y(),1);var O=w(Y(),1),m=w(Q(),1);var B=w(Q(),1);var v=w(Y(),1),X=w(Y(),1),K=w(Q(),1);var R=class extends B.EntityDialog{constructor(){super();this.form=new oe(this.idPrefix);var e,o=this;D.List({},i=>{for(var t in i.Entities)i.Entities[t].IsActive==1&&(o.payrollSettingId=i.Entities[t].Id,o.payDay=i.Entities[t].CreditingDay,o.form.OrganisationName.value=i.Entities[t].OrganisationName,o.form.OrganisationCode.value=i.Entities[t].OrganisationCode,o.form.Email.value=i.Entities[t].Email,o.form.PhoneNumber.value=i.Entities[t].PhoneNumber,o.form.ContactPerson.value=i.Entities[t].ContactPerson,o.ContactPerson=i.Entities[t].ContactPerson,o.OrganisationCode=i.Entities[t].OrganisationCode,o.OrganisationName=i.Entities[t].OrganisationName,o.PhoneNumber=i.Entities[t].PhoneNumber,o.Email=i.Entities[t].Email)}),z.List({Criteria:B.Criteria.and(e,[[W.Fields.Retired],"=","0"],[[W.Fields.Terminated],"=","0"],[[W.Fields.Resigned],"=","0"])},i=>{this.EmployeeData=i.Entities})}getFormKey(){return oe.formKey}getRowDefinition(){return ye}getService(){return ge.baseUrl}getToolbarButtons(){var e=this,o=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),o.push({title:"Download Text File",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{if((0,v.isEmptyOrNull)(e.form.TextType.value)){(0,v.alertDialog)("Please fill in the type of government payment to generate");return}if((0,v.isEmptyOrNull)(e.form.EmployeeRowList.value)){(0,v.alertDialog)("Please select the employee to include in the report");return}if(console.log(e.form.EmployeeRowList.value),console.log(e.form.MasterStateId.value),parseInt(e.form.TextType.value)==3 .valueOf())D.Update({EntityId:e.payrollSettingId,Entity:{Email:e.form.Email.value,PhoneNumber:e.form.PhoneNumber.value,ContactPerson:e.form.ContactPerson.value}});else if(parseInt(e.form.TextType.value)==5 .valueOf())D.Update({EntityId:e.payrollSettingId,Entity:{CreditingDay:e.form.CreditingDate.valueAsDate.getDay(),OrganisationName:e.form.OrganisationName.value,OrganisationCode:e.form.OrganisationCode.value}});else if(parseInt(e.form.TextType.value)==1 .valueOf()){if((0,v.isEmptyOrNull)(e.form.MasterStateId.value)){(0,v.alertDialog)("Please fill in the State Code");return}parseInt(e.form.TextFormatEpfId.value)==1 .valueOf()&&D.Update({EntityId:e.payrollSettingId,Entity:{ContactPerson:e.form.ContactPerson.value,PhoneNumber:e.form.PhoneNumber.value}}),D.Update({EntityId:e.payrollSettingId,Entity:{StateCodeId:e.form.MasterStateId.value,OrganisationName:e.form.OrganisationName.value,OrganisationCode:e.form.OrganisationCode.value}})}var i;parseInt(e.form.TextType.value)==3 .valueOf()?i=e.form.TextFormatLhdnId.value:parseInt(e.form.TextType.value)==5 .valueOf()?i=e.form.TextFormatAutopayId.value:parseInt(e.form.TextType.value)==1 .valueOf()?i=e.form.TextFormatEpfId.value:(parseInt(e.form.TextType.value)==2 .valueOf()||parseInt(e.form.TextType.value)==4 .valueOf())&&(i=e.form.TextFormatEisSocsoId.value);var t="PayMonth="+encodeURIComponent(e.form.PayMonth.value)+"&PayYear="+encodeURIComponent(e.form.PayYear.value)+"&Type="+encodeURIComponent(e.form.TextType.value)+"&CompanyCode="+encodeURIComponent(e.form.OrganisationCode.value)+"&CompanyName="+encodeURIComponent(e.form.OrganisationName.value)+"&CreditingDate="+encodeURIComponent(e.form.CreditingDate.value)+"&Email="+encodeURIComponent(e.form.Email.value)+"&PhoneNumber="+encodeURIComponent(e.form.PhoneNumber.value)+"&ContactPerson="+encodeURIComponent(e.form.ContactPerson.value)+"&EmployeeArrayString="+encodeURIComponent(e.form.EmployeeRowList.value)+"&StateCodeId="+encodeURIComponent(e.form.MasterStateId.value)+"&TextFormat="+encodeURIComponent(i)+"&testMode="+encodeURIComponent(e.form.TestingMode.value);console.log(e.form.MasterStateId.value),console.log(t);var a=window.location.origin+"/PayrollSettings/Payroll/TxtGenerate?"+t,s=new XMLHttpRequest;s.open("GET",a,!0),s.responseType="blob",s.onload=function(){if(s.status===200){var u=s.response;let f=window.URL.createObjectURL(u),l=document.createElement("a");l.style.display="none",l.href=f;var c=`${e.form.TextType.text}.txt`;l.download=c,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(f)}else(0,X.notifyError)("Error encounter when downloading Payslip Pdf")},s.send()}}),o}dialogOpen(e){super.dialogOpen();var o=this,i=document.getElementById(this.idPrefix+"ContactPerson");$(i).on("input",function(){return p(this,null,function*(){let n=this.value;n.length>40&&(n=n.slice(0,40)),this.value=n})});var t=document.getElementById(this.idPrefix+"Email");$(t).on("input",function(){return p(this,null,function*(){let n=this.value;n.length>40&&(n=n.slice(0,40)),this.value=n})});var a=document.getElementById(this.idPrefix+"PhoneNumber");$(a).on("input",function(){return p(this,null,function*(){let n=this.value;n=n.replace(/\D/g,""),n.length>20&&(n=n.slice(0,20)),this.value=n})}),(0,X.serviceCall)({service:Se.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:n=>{o.dateString=n,fe.List({},h=>{var L=new Date(o.dateString),T=L.getMonth(),I=L.getFullYear(),Z=0;for(var ne in h.Entities)if(h.Entities[ne].IsActive==1){Z=h.Entities[ne].PayDay;break}})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var s=document.getElementById(this.idPrefix+"MasterStateId"),u=document.getElementById(this.idPrefix+"PayMonth"),c=document.getElementById(this.idPrefix+"PayYear");let f=new K.Select2Editor($(u)),l=new K.Select2Editor($(c)),g=new K.Select2Editor($(s));ce.List({},n=>{for(var h in n.Entities)(0,v.isEmptyOrNull)(n.Entities[h].StateCode)||g.addItem({id:n.Entities[h].Id.toString(),text:n.Entities[h].Name.toString()})});let E=["January","February","March","April","May","June","July","August","September","October","November","December"];var S=new Date(o.dateString),y=S.getFullYear(),P=S.getMonth();for(let n=0;n<E.length;n++)f.addItem({id:n.toString(),text:E[n].toString()});f.set_value(P.toString());for(let n=-1;n<2;n++)l.addItem({id:(y+n).toString(),text:(y+n).toString()});l.set_value(y.toString());var b=document.getElementById(this.idPrefix+"MasterStateId");$(b).on("change",function(){return p(this,null,function*(){})});var k=document.getElementById(this.idPrefix+"TextFormatEpfId");$(k).on("change",function(){return p(this,null,function*(){parseInt(o.form.TextFormatEpfId.value)==1 .valueOf()?$(".PhoneNumber, .ContactPerson").show():$(".PhoneNumber, .ContactPerson").hide()})});var j=document.getElementById(this.idPrefix+"TextType");$(".TextFormatEisSocsoId, .TextFormatEpfId, .TextFormatAutopayId, .TextFormatLhdnId, .TestingMode, .MasterStateId").hide(),$(j).on("change",function(){return p(this,null,function*(){if($(".Email, .PhoneNumber, .ContactPerson, .CreditingDate, .OrganisationName, .OrganisationCode, .MasterStateId").hide(),$(".TextFormatEisSocsoId, .TextFormatEpfId, .TextFormatAutopayId, .TextFormatLhdnId, .TestingMode").hide(),parseInt(o.form.TextType.value)==3 .valueOf())o.form.Email.value=o.Email,o.form.PhoneNumber.value=o.PhoneNumber,o.form.ContactPerson.value=o.ContactPerson,$(".Email, .PhoneNumber, .ContactPerson").show(),$(".TextFormatLhdnId").show();else if(parseInt(o.form.TextType.value)==5 .valueOf()){$(".TextFormatAutopayId").show();var n=new Date(y,P,o.payDay),h=n.getFullYear().toString(),L=(n.getMonth()+1).toString(),T=n.getDate().toString(),I=L.padStart(2,"0")+"/"+T.padStart(2,"0")+"/"+h;o.form.CreditingDate.value=I,o.form.OrganisationName.value=o.OrganisationName,o.form.OrganisationCode.value=o.OrganisationCode,$(" .CreditingDate, .OrganisationName, .OrganisationCode").show()}else if(parseInt(o.form.TextType.value)==1 .valueOf()){$(".TextFormatEpfId, .TestingMode").show();var n=new Date(y,P,o.payDay),h=n.getFullYear().toString(),L=(n.getMonth()+1).toString(),T=n.getDate().toString(),I=L.padStart(2,"0")+"/"+T.padStart(2,"0")+"/"+h;o.form.CreditingDate.value=I,$(" .CreditingDate, .MasterStateId").show()}else(parseInt(o.form.TextType.value)==2 .valueOf()||parseInt(o.form.TextType.value)==4 .valueOf())&&$(".TextFormatEisSocsoId").show()})});var x=document.getElementById(this.idPrefix+"SectionList"),G=document.getElementById(this.idPrefix+"OccupationList"),M=document.getElementById(this.idPrefix+"DepartmentList"),U=document.getElementById(this.idPrefix+"DivisionList"),_=document.getElementById(this.idPrefix+"JobGradeList");console.log(this.idPrefix),$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(n){return p(this,null,function*(){$(".select2-drop").hide()})}),$(u).on("change",function(){return p(this,null,function*(){((0,v.isEmptyOrNull)($(u).val())||(0,v.isEmptyOrNull)($(c).val()))&&(o.form.EmployeeRowList.value=""),o.AllButton()})}),$(c).on("change",function(){return p(this,null,function*(){((0,v.isEmptyOrNull)($(u).val())||(0,v.isEmptyOrNull)($(c).val()))&&(o.form.EmployeeRowList.value=""),o.AllButton()})}),$(G).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(U).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(_).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(M).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(x).on("change",function(){return p(this,null,function*(){o.AllButton()})});var V=document.getElementById(this.idPrefix+"All");$(V).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(u).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(c).on("change",function(){return p(this,null,function*(){o.AllButton()})}),$(".Email, .PhoneNumber, .ContactPerson, .CreditingDate, .OrganisationName, .OrganisationCode, .MasterStateId, .TextFormatId").hide()}AllButton(){var e=this;if(e.form.All.value==!0){let t=[];for(var o in e.EmployeeData){var i=e.form.EmployeeRowListBuffer.value;i!=""?i.includes(",")?(i.split(",").forEach(s=>{t.push(parseInt(s))}),t.indexOf(e.EmployeeData[o].Id)===-1&&(e.form.EmployeeRowListBuffer.value=e.form.EmployeeRowListBuffer.value+" , "+e.EmployeeData[o].Id.toString())):e.form.EmployeeRowListBuffer.value=e.form.EmployeeRowListBuffer.value+" , "+e.EmployeeData[o].Id.toString():e.form.EmployeeRowListBuffer.value=e.EmployeeData[o].Id.toString()}e.SearchEmployeeCallback()}else e.SearchCallback(),e.SearchEmployeeCallback()}getDialogOptions(){let e=super.getDialogOptions();return e.width=e.width+100,e}SearchCallback(){var e=this,o=document.getElementById(this.idPrefix+"PayMonth"),i=document.getElementById(this.idPrefix+"PayYear"),t=document.getElementById(this.idPrefix+"OccupationList"),a=document.getElementById(this.idPrefix+"DepartmentList"),s=document.getElementById(this.idPrefix+"DivisionList"),u=document.getElementById(this.idPrefix+"JobGradeList"),c=document.getElementById(this.idPrefix+"SectionList");if((0,v.isEmptyOrNull)($(o).val())||(0,v.isEmptyOrNull)($(i).val())){this.form.EmployeeRowList.value=this.form.EmployeeRowListBuffer.value="";return}function f(G){let M=$(G).val();return M.length?M.split(",").map(U=>parseInt(U,10)):[]}F(f,"parseListFromElement");let l=f(u),g=f(s),E=f(a),S=f(t),y=f(c),P=new Set(l),b=new Set(g),k=new Set(E),j=new Set(S),x=new Set(y);for(let G of e.EmployeeData){let{JobGradeID:M,DivisionID:U,DepartmentID:_,OccupationID:V,SectionID:n,Id:h}=G,L=P.has(M)||b.has(U)||k.has(_)||j.has(V)||x.has(n),T=e.form.EmployeeRowListBuffer.value,I=T?T.split(",").map(Number):[];L?I.includes(h)||I.push(h):I=I.filter(Z=>Z!==h),e.form.EmployeeRowListBuffer.value=I.join(",")}}SearchEmployeeCallback(){var e=this,o=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),i=$(o).val();let t=i.split(","),a=[];i.length&&t.forEach(g=>{a.push(parseInt(g))});var s=document.getElementById(this.idPrefix+"PayMonth"),u=document.getElementById(this.idPrefix+"PayYear"),c=$(u).val(),f=$(s).val(),l;e.form.EmployeeRowList.value="",C.List({Criteria:B.Criteria.and(l,[[d.Fields.PayYear],"=",e.form.PayYear.value],[[d.Fields.PayMonth],"=",e.form.PayMonth.value])},g=>{console.log(a);for(var E in g.Entities){var S=g.Entities[E].EmployeeRowId,y=g.Entities[E].PayMonth,P=g.Entities[E].PayYear;console.log(S),a.indexOf(S)!=-1&&y==f&&P==c&&(console.log(S),e.form.EmployeeRowList.value=S+" , "+e.form.EmployeeRowList.value)}})}};F(R,"TextDownloadingWizardDialog"),R=J([B.Decorators.registerClass("HRMSoftware.PayrollSettings.TextDownloadingWizardDialog")],R);var N=class extends A.EntityGrid{constructor(e){super(e)}getColumnsKey(){return pe.columnsKey}getDialogType(){return Ie}getRowDefinition(){return d}getService(){return C.baseUrl}getAddButtonCaption(){return"Create Employee Payroll"}getQuickFilters(){let e=super.getQuickFilters();return O.Authorization.hasPermission(H.HumanResources)&&(e.push({cssClass:"hidden-xs",field:d.Fields.CostCentreName,type:m.Select2Editor,title:"Cost Centre"}),e.push({cssClass:"hidden-xs",field:d.Fields.OccupationName,type:m.Select2Editor,title:"Occupation"}),e.push({cssClass:"hidden-xs",field:d.Fields.JobGradeName,type:m.Select2Editor,title:"Job Grade"}),e.push({cssClass:"hidden-xs",field:d.Fields.DivisionName,type:m.Select2Editor,title:"Division"}),e.push({cssClass:"hidden-xs",field:d.Fields.DepartmentName,type:m.Select2Editor,title:"Department"}),e.push({cssClass:"hidden-xs",field:d.Fields.SectionName,type:m.Select2Editor,title:"Section"}),e.push({cssClass:"hidden-xs",field:d.Fields.EmployeeName,type:m.Select2Editor,title:"Name"}),e.push({cssClass:"hidden-xs",field:d.Fields.EmployeeId,type:m.Select2Editor,title:"Employee ID"}),e.reverse()),e.push({cssClass:"hidden-xs",field:d.Fields.PayMonth,type:m.Select2Editor,title:"Pay Month"}),e.push({cssClass:"hidden-xs",field:d.Fields.PayYear,type:m.Select2Editor,title:"Pay Year"}),e}createQuickFilters(){let e=["January","February","March","April","May","June","July","August","September","October","November","December"];super.createQuickFilters(),O.Authorization.hasPermission(H.HumanResources)?(de.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.OccupationName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})}),se.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.JobGradeName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})}),re.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.DepartmentName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})}),le.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.DivisionName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})}),me.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.SectionName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})}),z.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.EmployeeName).items.push({id:i.Entities[t].EmployeeName.toString(),text:i.Entities[t].EmployeeName.toString()}),this.findQuickFilter(m.Select2Editor,d.Fields.EmployeeId).items.push({id:i.Entities[t].EmployeeID.toString(),text:i.Entities[t].EmployeeID.toString()})}),ue.List({},i=>{for(var t in i.Entities)this.findQuickFilter(m.Select2Editor,d.Fields.CostCentreName).items.push({id:i.Entities[t].Name.toString(),text:i.Entities[t].Name.toString()})})):this.toolbar.findButton("add-button").toggle(!1);for(var o in e)this.findQuickFilter(m.Select2Editor,d.Fields.PayMonth).items.push({id:o.toString(),text:e[o].toString()});C.List({},i=>{let t=[];for(var a in i.Entities)t.indexOf(i.Entities[a].PayYear)==-1&&t.push(i.Entities[a].PayYear);for(var a in t)this.findQuickFilter(m.Select2Editor,d.Fields.PayYear).items.push({id:t[a].toString(),text:t[a].toString()})})}onViewProcessData(e){var o=this;if(e=super.onViewProcessData(e),O.Authorization.hasPermission(H.HumanResources)){var i=e;if(!(0,O.isEmptyOrNull)($(this.toolbar.findButton("add-button")).attr("style"))){var t=document.querySelectorAll(".text-bg-warning");t.forEach(function(l){$(l).hide()});var a=document.querySelectorAll(".text-bg-success");a.forEach(function(l){$(l).hide()})}for(var s in e.Entities)if((0,O.isEmptyOrNull)(e.Entities[s].PayslipPath)){var u="PayrollRowId="+encodeURIComponent(e.Entities[s].Id),c=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+u,f=new XMLHttpRequest;f.open("GET",c,!0),f.send(),C.Update({EntityId:e.Entities[s].Id,Entity:{PayslipPath:"Payroll\\Payslip\\"+e.Entities[s].Id+".pdf"}})}(0,r.serviceCall)({service:C.baseUrl+"/AskGenerationOfPayslip",method:"GET",data:{},async:!1,onSuccess:l=>{if(l[0]==1){let S=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=l[1],E=l[2];(0,r.confirm)("Do you want to generate payslip for "+l[2]+" "+S[l[1]],()=>{(0,r.serviceCall)({service:C.baseUrl+"/LogGeneration",method:"GET",data:{Month:g,Year:E},async:!1,onSuccess:y=>{var P=new ae;P.dialogOpen(),P.element.on("dialogclose",function(){o.internalRefresh()})},onError:y=>{console.log(y.Error)}})},{onNo:()=>{(0,r.serviceCall)({service:C.baseUrl+"/LogGeneration",method:"GET",data:{Month:g,Year:E},async:!1,onSuccess:y=>{},onError:y=>{console.log(y.Error)}}),(0,r.notifyInfo)("You can run the payroll generation wizard anytime")}})}},onError:l=>{console.log(l.Error)}}),this.toolbar.findButton("column-picker-button").toggle(!1)}return i}getButtons(){var e=super.getButtons(),o=this;return O.Authorization.hasPermission(H.HumanResources)&&(D.List({},i=>{i.Entities.length>0?ee.List({},t=>{t.Entities.length>0?q.List({},a=>{a.Entities.length>0?te.List({},s=>{s.Entities.length>0?q.List({},u=>{u.Entities.length>0?ie.List({},c=>{c.Entities.length<=0&&(this.toolbar.findButton("add-button").toggle(!1),(0,r.notifyError)("Please complete PCB subjection form before using payroll function"))}):(this.toolbar.findButton("add-button").toggle(!1),(0,r.notifyError)("Please complete EIS subjection form before using payroll function"))}):((0,r.notifyError)("Please complete HRDF subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,r.notifyError)("Please complete EIS subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,r.notifyError)("Please complete EPF subjection form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}):((0,r.notifyError)("Please complete Payroll Settings form before using payroll function"),this.toolbar.findButton("add-button").toggle(!1))}),e.push({title:"Payroll Settings",cssClass:"fas fa-wrench text-bg-primary",onClick:i=>{(0,r.confirm)("Do you want to edit payroll settings?",()=>{var t=new be;D.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()})})}}),e.push({title:"Payroll Generator",cssClass:"fas fa-hat-wizard text-bg-success",onClick:i=>{(0,r.confirm)("Do you want to run payroll generating wizard",()=>{var t=new ae;t.dialogOpen(),t.element.on("dialogclose",function(){o.internalRefresh()})})}}),e.push({title:"Payroll Download",cssClass:"fas fa-hat-wizard text-bg-warning",onClick:i=>{(0,r.confirm)("Do you want to run payroll download wizard",()=>{var t=new Pe(null,null,null);t.dialogOpen()})},separator:!0}),e.push({title:"Payroll Batch Delete",cssClass:"fas fa-hat-wizard text-bg-danger",onClick:i=>{(0,r.confirm)("Do you want to delete all selected payslips?",()=>{let t=[];$(".select-row-checkbox:checked").each(function(){let a=$(this).data("id"),s=C.Delete({EntityId:a}).then(()=>{console.log("Deleted Data ID:",a)}).catch(u=>{console.error("Error deleting Data ID:",a,u)});t.push(s)}),Promise.all(t).then(()=>{o.internalRefresh()}).catch(a=>{console.error("Error in delete operations:",a)})})},separator:!0}),e.push({title:"Download Text Report",cssClass:"fas fa-hat-wizard text-bg-info",onClick:i=>{(0,r.confirm)("Do you want to download text report?",()=>{var t=new R;t.dialogOpen(),t.element.on("dialogclose",function(){o.internalRefresh()})})},separator:!0}),e.push({title:"EPF Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,r.confirm)("Do you want to set EPF Subjection",()=>{var t=new Ce;ee.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()})})},separator:!0}),e.push({title:"EIS Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,r.confirm)("Do you want to set EPF Subjection",()=>{var t=new we;q.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"HRDF Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,r.confirm)("Do you want to set HRDF Subjection",()=>{var t=new De;te.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"PCB Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,r.confirm)("Do you want to set PCB Subjection",()=>{var t=new Ee;ie.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0}),e.push({title:"Socso Subjection",cssClass:"apply-changes-button",onClick:i=>{(0,r.confirm)("Do you want to set Socso Subjection",()=>{var t=new ve;he.List({},a=>{a.Entities.length>0?t.loadByIdAndOpenDialog(a.Entities[0].Id):t.dialogOpen()}),t.element.on("dialogclose",function(){})})},separator:!0})),e}onClick(e,o,i){if(super.onClick(e,o,i),!e.isDefaultPrevented()){var t=this.itemAt(o),a=$(e.target);a.parent().hasClass("inline-action")&&(a=a.parent()),a.hasClass("download-payroll")&&(0,r.confirm)("Do you want to download Payroll?",()=>{var s=t.Id,u=t.PayDate,c=new Date(u),f=c.toLocaleString("en-US",{month:"long"}),l=c.getFullYear().toString(),g=t.EmployeeRowId;z.Retrieve({EntityId:g},E=>{var S=E.Entity.EmployeeName.replace(/\s/g,""),y="PayrollRowId="+encodeURIComponent(s),P=window.location.origin+"/PayrollSettings/Payroll/PdfSharpConvert?"+y,b=new XMLHttpRequest;b.open("GET",P,!0),b.responseType="blob",b.onload=function(){if(b.status===200){var k=b.response;let j=window.URL.createObjectURL(k),x=document.createElement("a");x.style.display="none",x.href=j,x.download=S+"Payslip"+f+l+".pdf",x.click(),(0,r.notifySuccess)("Payslip downloaded")}else(0,r.notifyError)("Error encounter when downloading Payslip Pdf")},b.send()})})}}createToolbarExtensions(){super.createToolbarExtensions(),this.rowSelection=new A.GridRowSelectionMixin(this,{selectable:e=>(console.log(e),!0)})}getColumns(){var e=super.getColumns();return e.splice(2,0,{field:"Download Payroll",name:"",format:o=>{var i='<a class="inline-action download-payroll" title="Download Payroll pdf"><i class="fa fa-download text-yellow"></i></a>';return i},width:12,minWidth:12,maxWidth:12}),e.splice(0,0,{name:"",field:"",cssClass:"select-row-checkbox",format:o=>`<input type="checkbox" class="select-row-checkbox" data-id="${o.item.Id}" />`,width:40}),e}};F(N,"PayrollGrid"),N=J([A.Decorators.registerClass("HRMSoftware.PayrollSettings.PayrollGrid")],N);function Te(){(0,xe.initFullHeightGridPage)(new N($("#GridDiv")).element)}F(Te,"pageInit");export{Te as default};
//# sourceMappingURL=PayrollPage.js.map
