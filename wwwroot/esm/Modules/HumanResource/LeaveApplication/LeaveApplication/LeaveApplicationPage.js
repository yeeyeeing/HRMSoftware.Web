import{a as L,b as j}from"../../../../_chunks/chunk-U47JSUFM.js";import"../../../../_chunks/chunk-I3VQVPHQ.js";import{a as F,d as a,e as f}from"../../../../_chunks/chunk-GHIP3IPF.js";import{d as w}from"../../../../_chunks/chunk-2YJXBIYS.js";import"../../../../_chunks/chunk-GYFJ4L6D.js";import"../../../../_chunks/chunk-T7E74GLF.js";import"../../../../_chunks/chunk-3FMYFY2A.js";import{a as u}from"../../../../_chunks/chunk-OAOSE5IN.js";import"../../../../_chunks/chunk-F3ZQHHES.js";import{l as H}from"../../../../_chunks/chunk-E5LOGLR4.js";import{f as A,j as C,n as b}from"../../../../_chunks/chunk-EM5O7OU6.js";import"../../../../_chunks/chunk-JXMDZA3A.js";import{a as N}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{b as k}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as Q}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as R,g as S,h as D,j as v,k as I}from"../../../../_chunks/chunk-L3ECGIWB.js";var P=S(I(),1);var r=S(Q(),1);var t=S(I(),1);var m=class extends r.EntityGrid{constructor(i){super(i);this.SuperiorOfEmployeeRowIdList=[]}getColumnsKey(){return F.columnsKey}getDialogType(){return j}getRowDefinition(){return a}getService(){return f.baseUrl}getAddButtonCaption(){return"Apply Leave"}getButtons(){var i=super.getButtons(),e=this;return i.push({title:"Leave Application Claim Batch Approve",cssClass:"fas fa-hat-wizard text-bg-success approveButton hidden",onClick:o=>{(0,t.confirm)("Do you want to approve all selected applications?",()=>v(this,null,function*(){if(e.rowSelection.getSelectedAsInt64().length==0){(0,t.alertDialog)("Please select at least one application to approve");return}let s=e.rowSelection.getSelectedAsInt64();for(let l of s)try{let n=yield f.Retrieve({EntityId:l}),y=n.Entity.EmployeeStatus,p=n.Entity.HrStatus,E=n.Entity.Id,h=n.Entity.EmployeeRowId,d={},g=e.SuperiorOfEmployeeRowIdList.includes(h);t.Authorization.userDefinition.Permissions[u.HumanResources]?g==!0?y===2||p===2?y===2?d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:p===2&&(d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID}):p===1?d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID}:y===1?d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID},yield f.Update({EntityId:E,Entity:d})}catch(n){console.error(`Error updating application ${l}:`,n)}(0,t.notifyInfo)(`${s.length} records have been approved.`),e.internalRefresh()}))},separator:!0}),i.push({title:"Leave Application Batch Reject",cssClass:"fas fa-hat-wizard text-bg-danger rejectButton hidden",onClick:o=>{if(e.rowSelection.getSelectedAsInt64().length==0){(0,t.alertDialog)("Please select at least one application to reject");return}(0,t.confirm)("Do you want to reject all selected applications?",()=>v(this,null,function*(){let s=e.rowSelection.getSelectedAsInt64();var l=new L;l.dialogOpen(),l.element.on("dialogclose",()=>v(this,null,function*(){var n=window.rejectReason;for(let y of s)try{let p=yield f.Retrieve({EntityId:y}),E=p.Entity.EmployeeStatus,h=p.Entity.HrStatus,d=p.Entity.Id,g=p.Entity.EmployeeRowId,c={},U=yield new Promise((x,B)=>{(0,t.serviceCall)({service:w.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:t.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:g},method:"GET",onSuccess:x,onError:B})});t.Authorization.userDefinition.Permissions[u.HumanResources]==!0?U==!0?E==2||h==2?E==2?c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:n}:h==2&&(c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:n}):h==0?c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:n}:E==0?c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:n}:c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:n,SuperiorRejectReason:n}:c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:n}:c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:n},yield f.Update({EntityId:d,Entity:c})}catch(p){console.error(`Error updating application ${y}:`,p)}(0,t.notifyInfo)(`${s.length} records have been rejected.`),e.internalRefresh()}))}))}}),i}onViewSubmit(){if(!super.onViewSubmit())return!1;var i=this;return this.slickGrid.onHeaderCellRendered.subscribe((e,o)=>{o.column.id==="SelectAll"&&$(o.node).empty().append("<input type='checkbox' id='selectAll'/>")}),$(document).on("change","#selectAll",function(){let e=$(this).prop("checked");$(".row-checkbox").prop("checked",e)}),!0}getQuickFilters(){let i=super.getQuickFilters();return i.push({cssClass:"hidden-xs",field:a.Fields.OccupationName,type:r.Select2Editor,title:"Occupation"}),i.push({cssClass:"hidden-xs",field:a.Fields.JobGradeName,type:r.Select2Editor,title:"Job Grade"}),i.push({cssClass:"hidden-xs",field:a.Fields.DivisionName,type:r.Select2Editor,title:"Division"}),i.push({cssClass:"hidden-xs",field:a.Fields.DepartmentName,type:r.Select2Editor,title:"Department"}),i.push({cssClass:"hidden-xs",field:a.Fields.EmployeeName,type:r.Select2Editor,title:"Name"}),i.push({cssClass:"hidden-xs",field:a.Fields.EmployeeID,type:r.Select2Editor,title:"Employee ID"}),i.push({cssClass:"hidden-xs",field:a.Fields.CostCentreName,type:r.Select2Editor,title:"Cost Centre"}),i.reverse(),i}createQuickFilters(){super.createQuickFilters();let i=["January","February","March","April","May","June","July","August","September","October","November","December"];b.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.OccupationName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),C.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.JobGradeName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),N.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.DepartmentName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),A.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.DivisionName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),k.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.EmployeeName).items.push({id:e.Entities[o].EmployeeName.toString(),text:e.Entities[o].EmployeeName.toString()}),this.findQuickFilter(r.Select2Editor,a.Fields.EmployeeID).items.push({id:e.Entities[o].EmployeeID.toString(),text:e.Entities[o].EmployeeID.toString()})}),H.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,a.Fields.CostCentreName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})})}createToolbarExtensions(){super.createToolbarExtensions();var i=this;console.log("haha");let e=new Promise((o,s)=>{(0,t.serviceCall)({service:w.baseUrl+"/GetEmployeeUserCanView",data:{EmployeeRowID:t.Authorization.userDefinition.EmployeeRowID,PermissionKey:u.LeaveApproval},method:"GET",onError:l=>s(l),onSuccess:l=>{console.log("API Response:",l),o(l||[])}})});console.log("haha"),e.then(o=>{i.SuperiorOfEmployeeRowIdList=e,console.log("Received data:",i.SuperiorOfEmployeeRowIdList),console.log("Received data:",e),i.rowSelection=new r.GridRowSelectionMixin(i,{selectable:s=>{var l=o.includes(s.EmployeeRowId);if(s.EmployeeRowId==t.Authorization.userDefinition.EmployeeRowID||s.Status!=0)return!1;let n=t.Authorization.hasPermission(u.HumanResources);if(s.Status==0){if(s.EmployeeStatus==2||n&&s.HrStatus==2)return!1;if(n&&s.HrStatus==0||l&&s.EmployeeStatus==0)return $(".approveButton, .rejectButton").removeClass("hidden"),!0}}})}).catch(o=>{console.error("Error fetching data:",o)}),$(document).on("click",".select-item.check-box.no-float",function(){$(".select-item.check-box.no-float").parent().parent().removeClass("highlighted-row"),$(".select-item.check-box.no-float.checked").parent().parent().addClass("highlighted-row")}),$("<style>").prop("type","text/css").html(`
            .slick-row.highlighted-row {
                background-color: #D3E5FF !important;
            }
        `).appendTo("head")}getColumns(){var i=super.getColumns(),e;if(!t.Authorization.hasPermission(u.HumanResources))for(e in i)(i[e].name=="Employee Id"||i[e].name=="Approved By")&&i.splice(e,1);return i.unshift(r.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection)),i}onViewProcessData(i){i=super.onViewProcessData(i);let o=t.Authorization.userDefinition.EmployeeRowID;return i.Entities.every(l=>l.EmployeeRowId===o)?t.Authorization.hasPermission(u.HumanResources)?$(".approveButton, .rejectButton").removeClass("hidden"):$(".approveButton, .rejectButton").addClass("hidden"):$(".approveButton, .rejectButton").removeClass("hidden"),this.toolbar.findButton("column-picker-button").toggle(!1),i}createEntityDialog(i,e){let o=super.createEntityDialog(i,e);var s=this;return o.element.on("dialogclose",()=>{s.internalRefresh()}),o}};R(m,"LeaveApplicationGrid"),m=D([r.Decorators.registerClass("HRMSoftware.LeaveApplication.LeaveApplicationGrid")],m);function O(){(0,P.initFullHeightGridPage)(new m($("#GridDiv")).element)}R(O,"pageInit");export{O as default};
//# sourceMappingURL=LeaveApplicationPage.js.map
