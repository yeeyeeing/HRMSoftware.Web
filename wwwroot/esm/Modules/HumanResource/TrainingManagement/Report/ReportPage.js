import{a as C}from"../../../../_chunks/chunk-TIB4BNCY.js";import{u as w,v as R,w as h,x as v}from"../../../../_chunks/chunk-CJU7T46Q.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import"../../../../_chunks/chunk-YDNSOE4Z.js";import"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-KJR5IZZY.js";import"../../../../_chunks/chunk-2SJ2SYN6.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as y}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as l,g as D,h as f,k as H}from"../../../../_chunks/chunk-L3ECGIWB.js";var P=D(H(),1);var a=D(y(),1);var p=D(y(),1);var n=class extends p.EntityDialog{constructor(){super(...arguments);this.form=new R(this.idPrefix)}getFormKey(){return R.formKey}getRowDefinition(){return h}getService(){return v.baseUrl}dialogOpen(o){super.dialogOpen(!0)}onDialogOpen(){super.onDialogOpen(),this.element.closest(".ui-dialog").css("top","1%"),this.element.children().hide();let o=this.form.ProgramName.value,c=this.form.StartDate.value+(this.form.StartDate.value==this.form.EndDate.value?"":" to "+this.form.EndDate.value);this.form.DepartmentList.values.length>0?C.List({Criteria:(0,p.Criteria)("Id").in(this.form.DepartmentList.values)},s=>{setTimeout(()=>{console.log("Trigged");let u=s.Entities.map((t,T)=>t.Name).join(", ");$("#departmentPlaceholder").first().text(u)},1e3)}):setTimeout(()=>{$("#departmentPlaceholder").first().text("N/A")},1e3);let m=`<div class="header">
                <h4>Training Report</h4>
                   <p><strong>Course Name:</strong> ${o}</p>
                   <p><strong>Date:</strong> ${c}</p>
                   <p><strong>Department:</strong> <span id="departmentPlaceholder">Loading...</span></p>
            </div>
            <hr>

            `;$(m).appendTo(this.element)}getToolbarButtons(){return[]}updateTitle(){super.updateTitle(),this.dialogTitle="View Report ("+this.entity.ProgramName+")"}};l(n,"ReportDialog"),n=f([p.Decorators.registerClass("HRMSoftware.TrainingManagement.ReportDialog")],n);var i=class extends a.EntityGrid{getColumnsKey(){return w.columnsKey}getDialogType(){return n}getRowDefinition(){return h}getService(){return v.baseUrl}constructor(e){super(e),this.openDialogsAsPanel=!0}getButtons(){return[]}getColumns(){let e=super.getColumns();return e.splice(0,0,{id:"Print Pdf",field:"PDF Form",name:"",cssClass:"align-center",format:o=>{let c=o.item;return'<a class="inline-action pdf-form" data-action="print-pdf" title="PDF"><i class="fa fa-file-pdf" style="color: red;"></i></a>'},width:36,minWidth:36,maxWidth:36}),e}onClick(e,o,c){if(super.onClick(e,o,c),!e.isDefaultPrevented()){var m=this.itemAt(o),s=$(e.target);if(s.parent().hasClass("inline-action")&&(s=s.parent()),s.hasClass("pdf-form")){var u={FormId:m.Id},t=new Date,T=t.getFullYear(),F=("0"+(t.getMonth()+1)).slice(-2),S=("0"+t.getDate()).slice(-2),E=("0"+t.getHours()).slice(-2),M=("0"+t.getMinutes()).slice(-2),L=("0"+t.getSeconds()).slice(-2),O=Object.keys(u).map(function(g){return g+"="+encodeURIComponent(u[g])}).join("&"),k=window.location.origin+"/TrainingManagement/PdfSharpConvert?"+O,r=new XMLHttpRequest;r.open("GET",k,!0),r.responseType="blob",r.onload=function(){if(r.status===200){var g=r.response;let B=window.URL.createObjectURL(g),d=document.createElement("a");d.style.display="none",d.href=B,d.download=`report_${S}${F}${T}_${E}${M}${L}.pdf`,document.body.appendChild(d),d.click()}else r.status!==200&&(0,a.alertDialog)("An error occurred while generating the PDF.")},r.onerror=function(){(0,a.alertDialog)("An error occurred while making the request. Please check your network connection.")},r.send()}}}};l(i,"ReportGrid"),i=f([a.Decorators.registerClass("HRMSoftware.TrainingManagement.ReportGrid")],i);function I(){(0,P.initFullHeightGridPage)(new i($("#GridDiv")).element)}l(I,"pageInit");export{I as default};
//# sourceMappingURL=ReportPage.js.map
