import{a as M,c as x,d as m,e as h}from"../../../../_chunks/chunk-EP3WVGAK.js";import{G}from"../../../../_chunks/chunk-TCOECVPP.js";import{d as b}from"../../../../_chunks/chunk-KXMTVQGO.js";import{d as C}from"../../../../_chunks/chunk-GYFJ4L6D.js";import"../../../../_chunks/chunk-T7E74GLF.js";import"../../../../_chunks/chunk-6XVG2SV4.js";import{a as E}from"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-3NATHMDL.js";import{l as W}from"../../../../_chunks/chunk-RTQCGMRU.js";import{f as F,j,n as L}from"../../../../_chunks/chunk-MVZ476J5.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import{a as B}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{b as A}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as T}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as w,g,h as N,j as P,k as O}from"../../../../_chunks/chunk-L3ECGIWB.js";var _=g(O(),1);var p=g(T(),1);var R=g(T(),1);var l=g(O(),1);var Q=g(O(),1),v=g(O(),1);var I=class extends R.EntityDialog{constructor(){super();this.form=new x(this.idPrefix);var t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/npm/clocklet@0.3.0/css/clocklet.min.css";var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/clocklet@0.3.0",document.head.appendChild(t),document.head.appendChild(e);var i=$(".fieldset").children().attr("id");let o="PropertyGrid",s="StartingAt",r="EndingAt",c=i.lastIndexOf(o);if(c!==-1)var f=i.substring(0,c)+s,D=i.substring(0,c)+r;var n=document.getElementById(f);n.setAttribute("data-clocklet",""),n.setAttribute("id","ot-start-clocklet"),n.addEventListener("clocklet.opening",function(u){let y=document.getElementById("ot-start-clocklet");y&&(y.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),n.addEventListener("clocklet.closed",function(u){});var d=document.getElementById(D);d.setAttribute("data-clocklet",""),d.setAttribute("id","ot-end-clocklet"),d.addEventListener("clocklet.opening",function(u){let y=document.getElementById("ot-end-clocklet");y&&(y.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),d.addEventListener("clocklet.closed",function(u){})}getFormKey(){return x.formKey}getRowDefinition(){return m}getService(){return h.baseUrl}calculateOtRate(){var t=this;if(t.form.WeekendOt.value==!1&&t.form.WeekdayOt.value==!1&&t.form.PublicHolidayOt.value==!1){t.form.OtRate.value=0;return}(0,v.serviceCall)({service:A.baseUrl+"/CalculateOtRate",data:{EmployeeRowID:t.form.EmployeeRowId.value,Date:t.form.OtDate.value},method:"GET",async:!1,onSuccess:e=>{console.log(e),t.form.WeekendOt.value==!0?t.form.OtRate.value=e.Entities[0].OtRateWeekend:t.form.WeekdayOt.value==!0?t.form.OtRate.value=e.Entities[0].OtRateWeekday:t.form.PublicHolidayOt.value==!0&&(t.form.OtRate.value=e.Entities[0].OtRatePublicHoliday)}})}dialogOpen(t){super.dialogOpen(t),R.EditorUtils.setReadonly(this.form.OtRate.element,!0),R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);var e=this,i=document.getElementById(this.idPrefix+"OtDate");$(i).on("change",()=>{e.calculateOtRate()});var o=document.getElementById(this.idPrefix+"WeekendOt");$(o).on("change",()=>{e.form.PublicHolidayOt.value==!0&&(e.form.PublicHolidayOt.value=!1),e.form.WeekdayOt.value==!0&&(e.form.WeekdayOt.value=!1),e.calculateOtRate()});var s=document.getElementById(this.idPrefix+"PublicHolidayOt");$(s).on("change",()=>{e.form.WeekendOt.value==!0&&(e.form.WeekendOt.value=!1),e.form.WeekdayOt.value==!0&&(e.form.WeekdayOt.value=!1),e.calculateOtRate()});var r=document.getElementById(this.idPrefix+"WeekdayOt");$(r).on("change",()=>{e.form.WeekendOt.value==!0&&(e.form.WeekendOt.value=!1),e.form.PublicHolidayOt.value==!0&&(e.form.PublicHolidayOt.value=!1),e.calculateOtRate()}),(0,v.serviceCall)({service:G.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:c=>{e.form.OtDate.value=c}})}save_submitHandler(t){var e=document.getElementById("ot-start-clocklet"),i=document.getElementById("ot-end-clocklet"),o=e.value,s=i.value;let r=o.split(":"),c=s.split(":"),f=parseInt(r[0],10),D=parseInt(r[1],10),n=parseInt(c[0],10),d=parseInt(c[1],10);var u=60*(n-f)+(d-D);if(this.minimum_ot_time>u){(0,Q.alertDialog)("This OT cannot be applied as the duration is less than minimum time");return}super.save_submitHandler(t)}onDialogOpen(){if(super.onDialogOpen(),$(".EmployeeUpdated").hide(),$(".HrUpdated").hide(),(0,v.isEmptyOrNull)(this.form.EmployeeUpdatedName.value))$(".EmployeeUpdatedName").hide();else{var t=document.getElementById(this.idPrefix+"EmployeeUpdatedName");$(t).on("click",function(){return P(this,null,function*(){var n=new C(parseInt(this.form.EmployeeUpdated.value));n.loadByIdAndOpenDialog(parseInt(this.form.EmployeeUpdated.value))})})}if((0,v.isEmptyOrNull)(this.form.HrUpdatedName.value))$(".HrUpdatedName").hide();else{var e=document.getElementById(this.idPrefix+"HrUpdatedName");$(e).on("click",function(){return P(this,null,function*(){var n=new C(parseInt(this.form.HrUpdated.value));n.loadByIdAndOpenDialog(parseInt(this.form.HrUpdated.value))})})}var i=".RejectedEmployeeName",o=".ApproveEmployeeName",s=document.getElementById(this.idPrefix+"EmployeeRowId"),r=this,c=document.getElementById(this.idPrefix+"OtDate");if(!l.Authorization.userDefinition.Permissions[E.HumanResources]&&this.isNew()&&(this.form.EmployeeRowId.value=l.Authorization.userDefinition.EmployeeRowID,R.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),A.Retrieve({EntityId:$(s).val()},n=>{r.form.EmployeeName.value=n.Entity.EmployeeName,$(r.form.EmployeeRowId.element).val(l.Authorization.userDefinition.EmployeeRowID.toString()).trigger("change")})),this.isNew()){$(s).on("change",function(){return P(this,null,function*(){if(r.form.EmployeeName.value="",(0,v.isEmptyOrNull)($(s).val())){$(r.form.OtRate.element).val("");return}A.Retrieve({EntityId:$(s).val()},n=>{if(r.form.EmployeeName.value=n.Entity.EmployeeName,r.fixedOtRateOption==!0&&n.Entity.BasicSalary<r.thresholdSalary?r.form.OtRate.value=r.fixedOtRate:$(r.form.OtRate.element).val(""),!((0,v.isEmptyOrNull)($(this).val())||(0,v.isEmptyOrNull)($(c).val())))var d=n.Entity.Id,u=$(c).val().split(/[\/?]/),y=u[2],H=u[0],k=u[1]})})});var f=document.querySelectorAll(".text-bg-success");f.forEach(function(n){$(n).hide()}),$(o).hide();var D=document.querySelectorAll(".text-bg-danger");D.forEach(function(n){$(n).hide()}),$(i).hide(),$(o).hide()}else if(!this.isNew()){if(!l.Authorization.userDefinition.Permissions[E.HumanResources]&&r.form.EmployeeRowId.value!=l.Authorization.userDefinition.EmployeeRowID&&(this.readOnly=!0),r.form.EmployeeRowId.value==l.Authorization.userDefinition.EmployeeRowID){R.EditorUtils.setReadonly(this.form.EmployeeRowId.element,!0),R.EditorUtils.setReadonly(this.form.EmployeeName.element,!0);return}h.Retrieve({EntityId:this.entityId},n=>{var d=n.Entity.EmployeeRowId,u=r.HrApproval=n.Entity.HrStatus,y=r.EmployeeApproval=n.Entity.EmployeeStatus,H=n.Entity.Status;H==0?(0,v.serviceCall)({service:b.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:l.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:d},method:"GET",async:!1,onSuccess:k=>{var K=r.SuperiorPermission=k;if(r.form.EmployeeRowId.value!=l.Authorization.userDefinition.EmployeeRowID&&this.set_readOnly(!0),$(".delete-button").removeClass("disabled"),u==0||y==0)K==!0&&!y&&$(".tool-button").removeClass("hidden"),l.Authorization.userDefinition.Permissions[E.HumanResources]&&!u&&$(".tool-button").removeClass("hidden");else if((u==-1||y==-1||u==1&&y==1)&&($(i).hide(),$(o).hide(),r.form.EmployeeRowId.value==l.Authorization.userDefinition.EmployeeRowID)){var q=document.querySelectorAll(".text-bg-success");q.forEach(function(U){$(U).hide()});var V=document.querySelectorAll(".text-bg-danger");V.forEach(function(U){$(U).hide()})}},onError:k=>{console.log(k.Error)}}):(this.set_readOnly(!0),$(".delete-button").removeClass("disabled"))})}}getToolbarButtons(){var t=this,e=super.getToolbarButtons(),i=document.createElement("style");return i.textContent=`
            .hidden {
      display: none;
    }
            `,document.head.appendChild(i),e.push({title:"Approve Application",cssClass:"text-bg-success p-2 hidden approveApplication",icon:"fa-check text-green",onClick:()=>{(0,v.confirm)("Do you want to approve this application?",()=>{let o={};l.Authorization.userDefinition.Permissions[E.HumanResources]?t.SuperiorPermission?t.EmployeeApproval===2||t.HrApproval===2?t.EmployeeApproval===2?o={HrStatus:1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:t.HrApproval===2&&(o={EmployeeStatus:1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID}):t.HrApproval===1?o={EmployeeStatus:1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID}:t.EmployeeApproval===1?o={HrStatus:1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={HrStatus:1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:t.entityId,Entity:o},s=>{t.loadById(s.EntityId),$(".rejectApplication, .approveApplication").hide()})})}}),e.push({title:"Rejected Application",cssClass:"text-bg-danger p-2 hidden rejectApplication",icon:"fa-times text-red",onClick:()=>{(0,v.confirm)("Do you want to reject this application?",()=>{let o={};l.Authorization.userDefinition.Permissions[E.HumanResources]?t.SuperiorPermission==!0?t.EmployeeApproval==2||t.HrApproval==2?t.EmployeeApproval==2?o={HrStatus:-1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:t.HrApproval==2&&(o={EmployeeStatus:-1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID}):t.HrApproval==0?o={HrStatus:-1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:t.EmployeeApproval==0?o={EmployeeStatus:-1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:-1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={HrStatus:-1,HrUpdated:l.Authorization.userDefinition.EmployeeRowID}:o={EmployeeStatus:-1,EmployeeUpdated:l.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:t.entityId,Entity:o},s=>{t.loadById(s.EntityId),$(".rejectApplication, .approveApplication").hide()})})}}),e}};w(I,"OTApplicationDialog"),I=N([R.Decorators.registerClass("HRMSoftware.OTApplication.OTApplicationDialog")],I);var a=g(O(),1);var S=class extends p.EntityGrid{constructor(t){super(t)}getColumnsKey(){return M.columnsKey}getDialogType(){return I}getRowDefinition(){return m}getService(){return h.baseUrl}createEntityDialog(t,e){let i=super.createEntityDialog(t,e);var o=this;return i.element.on("dialogclose",()=>{o.internalRefresh(),console.log("hahaa")}),i}getQuickFilters(){let t=super.getQuickFilters();return a.Authorization.hasPermission(E.HumanResources)&&(t.push({cssClass:"hidden-xs",field:m.Fields.OccupationName,type:p.Select2Editor,title:"Occupation"}),t.push({cssClass:"hidden-xs",field:m.Fields.JobGradeName,type:p.Select2Editor,title:"Job Grade"}),t.push({cssClass:"hidden-xs",field:m.Fields.DivisionName,type:p.Select2Editor,title:"Division"}),t.push({cssClass:"hidden-xs",field:m.Fields.DepartmentName,type:p.Select2Editor,title:"Department"}),t.push({cssClass:"hidden-xs",field:m.Fields.EmployeeName,type:p.Select2Editor,title:"Name"}),t.push({cssClass:"hidden-xs",field:m.Fields.EmployeeID,type:p.Select2Editor,title:"Employee ID"}),t.push({cssClass:"hidden-xs",field:m.Fields.CostCentreName,type:p.Select2Editor,title:"Cost Centre"}),t.reverse()),t}createQuickFilters(){if(super.createQuickFilters(),a.Authorization.hasPermission(E.HumanResources)){let t=["January","February","March","April","May","June","July","August","September","October","November","December"];L.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.OccupationName).items.push({id:e.Entities[i].Name.toString(),text:e.Entities[i].Name.toString()})}),j.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.JobGradeName).items.push({id:e.Entities[i].Name.toString(),text:e.Entities[i].Name.toString()})}),B.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.DepartmentName).items.push({id:e.Entities[i].Name.toString(),text:e.Entities[i].Name.toString()})}),F.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.DivisionName).items.push({id:e.Entities[i].Name.toString(),text:e.Entities[i].Name.toString()})}),A.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.EmployeeName).items.push({id:e.Entities[i].EmployeeName.toString(),text:e.Entities[i].EmployeeName.toString()}),this.findQuickFilter(p.Select2Editor,m.Fields.EmployeeID).items.push({id:e.Entities[i].EmployeeID.toString(),text:e.Entities[i].EmployeeID.toString()})}),W.List({},e=>{for(var i in e.Entities)this.findQuickFilter(p.Select2Editor,m.Fields.CostCentreName).items.push({id:e.Entities[i].Name.toString(),text:e.Entities[i].Name.toString()})})}}getAddButtonCaption(){return"Apply Over Time Claiming"}getButtons(){var t=super.getButtons(),e=this;return t.push({title:"OT Application Claim Batch Approve",cssClass:"fas fa-hat-wizard text-bg-success approveButton",onClick:i=>{(0,a.confirm)("Do you want to approve all selected applications?",()=>{let o=e.rowSelection.getSelectedAsInt64().map(s=>h.Retrieve({EntityId:s}).then(r=>{let c=r.Entity.EmployeeStatus,f=r.Entity.HrStatus,D=r.Entity.Id,n=r.Entity.EmployeeRowId,d={};return new Promise((u,y)=>{(0,a.serviceCall)({service:b.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:a.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:n},method:"GET",onSuccess:H=>{a.Authorization.userDefinition.Permissions[E.HumanResources]?H?c===2||f===2?c===2?d={HrStatus:1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:f===2&&(d={EmployeeStatus:1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID}):f===1?d={EmployeeStatus:1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID}:c===1?d={HrStatus:1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:d={HrStatus:1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:D,Entity:d}).then(u).catch(y)},onError:y})})}));Promise.all(o).then(()=>{e.internalRefresh()}).catch(s=>{console.error("Error in update operations:",s)})})},separator:!0}),t.push({title:"OT Application Batch Reject",cssClass:"fas fa-hat-wizard text-bg-danger rejectButton",onClick:i=>{(0,a.confirm)("Do you want to reject all selected applications?",()=>{let o=e.rowSelection.getSelectedAsInt64().map(s=>h.Retrieve({EntityId:s}).then(r=>{let c=r.Entity.EmployeeStatus,f=r.Entity.HrStatus,D=r.Entity.Id,n={},d=r.Entity.EmployeeRowId;(0,a.serviceCall)({service:b.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:a.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:d},method:"GET",async:!1,onSuccess:u=>{console.log(u);var y=u;return a.Authorization.userDefinition.Permissions[E.HumanResources]?y==!0?c==2||f==2?c==2?n={HrStatus:-1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:f==2&&(n={EmployeeStatus:-1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID}):f==0?n={HrStatus:-1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:c==0?n={EmployeeStatus:-1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID}:n={EmployeeStatus:-1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:n={HrStatus:-1,HrUpdated:a.Authorization.userDefinition.EmployeeRowID}:n={EmployeeStatus:-1,EmployeeUpdated:a.Authorization.userDefinition.EmployeeRowID},h.Update({EntityId:D,Entity:n})}})}));Promise.all(o).then(()=>{e.internalRefresh()}).catch(s=>{console.error("Error in update operations:",s)})})},separator:!0}),t}onViewSubmit(){this.slickGrid.onHeaderCellRendered.subscribe((i,o)=>{o.column.id==="SelectAll"&&$(o.node).empty().append("<input type='checkbox' id='selectAll'/>")});var t=this,e=this.slickGrid;return e.onSelectedRowsChanged.subscribe(()=>{console.log("haha")}),$(document).on("change","#selectAll",function(){let i=$(this).prop("checked");$(".row-checkbox").prop("checked",i)}),super.onViewSubmit()}createToolbarExtensions(){super.createToolbarExtensions();var t=this;this.rowSelection=new p.GridRowSelectionMixin(this,{selectable:e=>{var i=0,o;for((0,a.serviceCall)({service:b.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:a.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:e.EmployeeRowId},method:"GET",async:!1,onSuccess:r=>{i=1,o=r}});i==0;);let s=a.Authorization.hasPermission(E.HumanResources);if(e.Status==0){if(e.EmployeeRowId==a.Authorization.userDefinition.EmployeeRowID||s&&e.HrStatus==2)return;if(s&&e.HrStatus==0||o&&e.EmployeeStatus==0)return $(".approveButton, .rejectButton").show(),!0}}}),$(document).on("click",".select-item.check-box.no-float",function(){$(".select-item.check-box.no-float").parent().parent().removeClass("highlighted-row"),$(".select-item.check-box.no-float.checked").parent().parent().addClass("highlighted-row")}),$("<style>").prop("type","text/css").html(`
            .slick-row.highlighted-row {
                background-color: #D3E5FF !important;
            }
        `).appendTo("head")}getColumns(){var t=super.getColumns(),e;if(!a.Authorization.hasPermission(E.HumanResources))for(e in t)(t[e].name==m.Fields.EmployeeID||t[e].name==m.Fields.ApprovedBy)&&t.splice(e,1);return t.unshift(p.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection)),t}onViewProcessData(t){return t=super.onViewProcessData(t),$(".approveButton, .rejectButton").hide(),this.toolbar.findButton("column-picker-button").toggle(!1),t}};w(S,"OTApplicationGrid"),S=N([p.Decorators.registerClass("HRMSoftware.OTApplication.OTApplicationGrid")],S);function Y(){(0,_.initFullHeightGridPage)(new S($("#GridDiv")).element)}w(Y,"pageInit");export{Y as default};
//# sourceMappingURL=OTApplicationPage.js.map
