import{C as W,E as P,F as k,G as I,m as M}from"../../../../_chunks/chunk-TCOECVPP.js";import"../../../../_chunks/chunk-F3ZQHHES.js";import"../../../../_chunks/chunk-E5LOGLR4.js";import"../../../../_chunks/chunk-EM5O7OU6.js";import"../../../../_chunks/chunk-JXMDZA3A.js";import"../../../../_chunks/chunk-LLMDZJQJ.js";import{b as F}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as N}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as E,g as S,h as w,j as r,k as U}from"../../../../_chunks/chunk-L3ECGIWB.js";var K=S(U(),1);var O=S(N(),1);var p=S(N(),1);var x=S(U(),1);var g=class extends p.EntityDialog{constructor(){super();this.form=new P(this.idPrefix);var e=this;F.List({},c=>{this.EmployeeData=c.Entities})}getFormKey(){return P.formKey}getRowDefinition(){return k}getService(){return I.baseUrl}onDialogOpen(){super.onDialogOpen(),p.EditorUtils.setReadonly(this.form.Remarks.element,!0);var e=$("#announcement-clocklet"),c=new Date;this.OriginalDocString=JSON.stringify(this.form.UploadDocument.value),this.editButton.hide(),this.applyChangesButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var t=this;if(this.isNew()){var l=document.createElement("link");l.rel="stylesheet",l.href="https://cdn.jsdelivr.net/npm/clocklet@0.3.0/css/clocklet.min.css";var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/clocklet@0.3.0",document.head.appendChild(l),document.head.appendChild(n);var i=$(".fieldset").children().attr("id");let o="PropertyGrid",f="AnnouncementTime",h=i.lastIndexOf(o);if(h!==-1)var d=i.substring(0,h)+f;var s=document.getElementById(d);s.setAttribute("data-clocklet",""),s.setAttribute("id","announcement-clocklet"),s.addEventListener("clocklet.opening",function(A){var y=document.getElementById("announcement-clocklet");y&&(y.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),s.addEventListener("clocklet.closed",function(A){t.GenerateRemarks()}),$(".AnnouncementDateTime").hide(),$(".AnnouncementTime").hide(),e.val("12:00"),t.form.AnnouncementDateTime.value=c.toISOString(),t.SetCallBack()}else this.isNew()||(console.log("haha"),I.Retrieve({EntityId:t.entityId},o=>{p.EditorUtils.setReadonly(t.form.Delayed.element,!0),p.EditorUtils.setReadonly(t.form.Immediate.element,!0),p.EditorUtils.setReadonly(t.form.AnnouncementTime.element,!0),p.EditorUtils.setReadonly(t.form.AnnouncementDateTime.element,!0),t.form.AnnouncementTime.value=o.Entity.AnnouncementDateTime.substring(11,16),t.form.AnnouncementList.value=o.Entity.AnnouncementList,t.form.AnnouncementList.updateInterface(),console.log("haha"),t.AnnouncedDateTime=o.Entity.AnnouncementDateTime;for(let f=0;f<this.form.AnnouncementList.value.length;f++)t.form.EmployeeRowList.value=t.form.EmployeeRowList.value+" , "+this.form.AnnouncementList.value[f].EmployeeRowId.toString();t.OriginalEmployeeList=t.form.EmployeeRowList.value,t.SetCallBack()}))}SearchCallback(){var e=this,c=document.getElementById(this.idPrefix+"OccupationListActual"),t=document.getElementById(this.idPrefix+"DepartmentListActual"),l=document.getElementById(this.idPrefix+"DivisionListActual"),n=document.getElementById(this.idPrefix+"JobGradeListActual"),i=document.getElementById(this.idPrefix+"SectionListActual"),d=$(n).val();let s=[],o=d.split(",");d.length&&o.forEach(a=>{s.push(parseInt(a))});var f=$(l).val();o=f.split(",");let h=[];f.length&&o.forEach(a=>{h.push(parseInt(a))});var A=$(t).val();o=A.split(",");let y=[];A.length&&o.forEach(a=>{y.push(parseInt(a))});var T=$(c).val();o=T.split(",");let L=[];T.length&&o.forEach(a=>{L.push(parseInt(a))});var b=$(i).val();o=b.split(",");let u=[];b.length&&o.forEach(a=>{u.push(parseInt(a))});for(var m in e.EmployeeData){var v=0;for(var H in s)if(e.EmployeeData[m].JobGradeID==s[H]){v=1;break}for(var G in h)if(e.EmployeeData[m].DivisionID==h[G]){v=1;break}for(var _ in y)if(e.EmployeeData[m].DepartmentID==y[_]){v=1;break}for(var j in L)if(e.EmployeeData[m].OccupationID==L[j]){v=1;break}for(var Q in u)if(e.EmployeeData[m].SectionID==u[Q]){v=1;break}if(v==0){let a=[];var B=e.form.EmployeeRowList.value;B!=""?(B.split(",").forEach(R=>{a.push(parseInt(R))}),a=a.filter(R=>R!==e.EmployeeData[m].Id),e.form.EmployeeRowList.value=a.join(",")):e.form.EmployeeRowList.value=""}else{let a=[];var B=e.form.EmployeeRowList.value;B!=""?B.includes(",")?(B.split(",").forEach(X=>{a.push(parseInt(X))}),a.indexOf(e.EmployeeData[m].Id)===-1&&(e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+e.EmployeeData[m].Id.toString())):e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+e.EmployeeData[m].Id.toString():e.form.EmployeeRowList.value=e.EmployeeData[m].Id.toString()}}}BindChangeCallback(){var e=this.form.BindToOccupation.value,c=this.form.BindToDepartment.value,t=this.form.BindToDivision.value,l=this.form.BindToJobGrade.value,n=this.form.BindToSection.value;for(let i=0;i<this.form.AnnouncementList.value.length;i++)this.form.AnnouncementList.value[i].BindToDepartment=c,this.form.AnnouncementList.value[i].BindToDivision=t,this.form.AnnouncementList.value[i].BindToJobGrade=l,this.form.AnnouncementList.value[i].BindToOccupation=e,this.form.AnnouncementList.value[i].BindToSection=n}EmployeeChangeCallback(){var e=[],c=this;this.form.All.value=!1;var t=JSON.stringify(this.form.UploadDocument.value),l=this.form.AnnouncementContent.value;for(let d=0;d<this.form.EmployeeRowList.values.length;d++){var n=new C;n.AnnouncementContent=l,n.UploadDocument=t,n.EmployeeRowId=parseInt(this.form.EmployeeRowList.values[d]),n.BindToDepartment=this.form.BindToDepartment.value,n.BindToDivision=this.form.BindToDivision.value,n.BindToJobGrade=this.form.BindToJobGrade.value,n.BindToSection=this.form.BindToSection.value,n.BindToOccupation=this.form.BindToOccupation.value,n.AnnouncementDateTime=c.AnnouncedDateTime;var i=this.EmployeeData.find(s=>s.Id===parseInt(this.form.EmployeeRowList.values[d]));n.EmployeeID=i.EmployeeID,e.push(n)}this.form.AnnouncementList.value=e,this.form.AnnouncementList.updateInterface()}SetCallBack(){var e=this,c=document.getElementById(this.idPrefix+"Immediate"),t=document.getElementById(this.idPrefix+"Delayed"),l=document.getElementById(this.idPrefix+"AnnouncementContent");$(l).on("change",function(){return r(this,null,function*(){for(let u=0;u<e.form.AnnouncementList.value.length;u++)e.form.AnnouncementList.value[u].AnnouncementContent=e.form.AnnouncementContent.value})}),$(c).on("change",function(){return r(this,null,function*(){e.form.Immediate.value==!0&&e.form.Delayed.value==!0&&(e.form.Delayed.value=!1),e.form.Delayed.value==!0&&e.form.Immediate.value==!1?($(".AnnouncementTime").show(),$(".AnnouncementDateTime").show(),e.GenerateRemarks()):(e.form.Delayed.value==!1&&e.form.Immediate.value==!0,$(".AnnouncementTime").hide(),$(".AnnouncementDateTime").hide(),e.GenerateRemarks())})}),$(t).on("change",function(){return r(this,null,function*(){e.form.Immediate.value==!0&&e.form.Delayed.value==!0&&(e.form.Immediate.value=!1),e.form.Delayed.value==!0&&e.form.Immediate.value==!1?($(".AnnouncementTime").show(),$(".AnnouncementDateTime").show(),e.GenerateRemarks()):(e.form.Delayed.value==!1&&e.form.Immediate.value==!0,$(".AnnouncementTime").hide(),$(".AnnouncementDateTime").hide(),e.GenerateRemarks())})});var n=document.getElementById(this.idPrefix+"OccupationListActual"),i=document.getElementById(this.idPrefix+"DepartmentListActual"),d=document.getElementById(this.idPrefix+"DivisionListActual"),s=document.getElementById(this.idPrefix+"JobGradeListActual"),o=document.getElementById(this.idPrefix+"SectionListActual"),f=document.getElementById(this.idPrefix+"EmployeeRowList"),h=document.getElementById(this.idPrefix+"BindToOccupation"),A=document.getElementById(this.idPrefix+"BindToDepartment"),y=document.getElementById(this.idPrefix+"BindToDivision"),T=document.getElementById(this.idPrefix+"BindToJobGrade"),L=document.getElementById(this.idPrefix+"BindToSection");$(h).on("change",function(){return r(this,null,function*(){e.BindChangeCallback()})}),$(A).on("change",function(){return r(this,null,function*(){e.BindChangeCallback()})}),$(y).on("change",function(){return r(this,null,function*(){e.BindChangeCallback()})}),$(T).on("change",function(){return r(this,null,function*(){e.BindChangeCallback()})}),$(L).on("change",function(){return r(this,null,function*(){e.BindChangeCallback()})}),$(i).on("change",function(){return r(this,null,function*(){e.SearchCallback()})});var b=document.getElementById(this.idPrefix+"All");$(n).on("change",function(){return r(this,null,function*(){e.SearchCallback()})}),$(f).on("change",function(){return r(this,null,function*(){e.EmployeeChangeCallback()})}),$(o).on("change",function(){return r(this,null,function*(){e.SearchCallback()})}),$(d).on("change",function(){return r(this,null,function*(){e.SearchCallback()})}),$(s).on("change",function(){return r(this,null,function*(){e.SearchCallback()})}),$(i).on("change",function(){return r(this,null,function*(){e.SearchCallback()})}),$(b).on("change",function(){return r(this,null,function*(){if(e.form.All.value==!0){let v=[];for(var u in e.EmployeeData){var m=e.form.EmployeeRowList.value;m!=""?m.includes(",")?(m.split(",").forEach(G=>{v.push(parseInt(G))}),v.indexOf(e.EmployeeData[u].Id)===-1&&(e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+e.EmployeeData[u].Id.toString())):e.form.EmployeeRowList.value=e.form.EmployeeRowList.value+" , "+e.EmployeeData[u].Id.toString():e.form.EmployeeRowList.value=e.EmployeeData[u].Id.toString()}}else e.SearchCallback()})})}GenerateRemarks(){var e=this,c="The announcement will be sent at ",t=document.getElementById("announcement-clocklet"),l="";e.form.Immediate.value==!0?l="The announcement will be made to the employee immediately":e.form.Delayed.value==!0?l=c+e.form.AnnouncementDateTime.value+" "+t.value+":00":l="",e.form.Remarks.value=l}save_submitHandler(e){if(this.form.EmployeeRowList.value==""){(0,x.alertDialog)("No employee chosen");return}if(this.form.Remarks.value==""){(0,x.alertDialog)("Invalid settings, please check again");return}super.save_submitHandler(e)}};E(g,"AnnouncementWizardDialog"),g=w([p.Decorators.registerClass("HRMSoftware.Announcement.AnnouncementWizardDialog")],g);var C=class extends M{constructor(){super()}};E(C,"ConcreteAnnouncementSentEditorRow");var D=class extends O.EntityGrid{getColumnsKey(){return W.columnsKey}getDialogType(){return g}getRowDefinition(){return k}getService(){return I.baseUrl}constructor(z){super(z)}getAddButtonCaption(){return"Run Annnouncement Wizard"}};E(D,"AnnouncementWizardGrid"),D=w([O.Decorators.registerClass("HRMSoftware.Announcement.AnnouncementWizardGrid")],D);function q(){(0,K.initFullHeightGridPage)(new D($("#GridDiv")).element)}E(q,"pageInit");export{q as default};
//# sourceMappingURL=AnnouncementWizardPage.js.map
