import{t as j,u as P}from"../../../../_chunks/chunk-N2Z54I7F.js";import{a as k,d as l,e as E}from"../../../../_chunks/chunk-J5U3DV55.js";import"../../../../_chunks/chunk-GHIP3IPF.js";import{d as w}from"../../../../_chunks/chunk-2YJXBIYS.js";import"../../../../_chunks/chunk-GYFJ4L6D.js";import"../../../../_chunks/chunk-T7E74GLF.js";import"../../../../_chunks/chunk-3FMYFY2A.js";import{a as u}from"../../../../_chunks/chunk-OAOSE5IN.js";import"../../../../_chunks/chunk-F3ZQHHES.js";import{l as H}from"../../../../_chunks/chunk-E5LOGLR4.js";import{f as N,j as A,n as b}from"../../../../_chunks/chunk-EM5O7OU6.js";import"../../../../_chunks/chunk-JXMDZA3A.js";import{a as C}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{b as F}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as Q}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as R,g as D,h as v,j as g,k as I}from"../../../../_chunks/chunk-L3ECGIWB.js";var U=D(I(),1);var r=D(Q(),1);var t=D(I(),1);var m=class extends r.EntityGrid{constructor(i){super(i);this.SuperiorOfEmployeeRowIdList=[]}getColumnsKey(){return k.columnsKey}getDialogType(){return P}getRowDefinition(){return l}getService(){return E.baseUrl}getQuickFilters(){let i=super.getQuickFilters();return i.push({cssClass:"hidden-xs",field:l.Fields.OccupationName,type:r.Select2Editor,title:"Occupation"}),i.push({cssClass:"hidden-xs",field:l.Fields.JobGradeName,type:r.Select2Editor,title:"Job Grade"}),i.push({cssClass:"hidden-xs",field:l.Fields.DivisionName,type:r.Select2Editor,title:"Division"}),i.push({cssClass:"hidden-xs",field:l.Fields.DepartmentName,type:r.Select2Editor,title:"Department"}),i.push({cssClass:"hidden-xs",field:l.Fields.EmployeeName,type:r.Select2Editor,title:"Name"}),i.push({cssClass:"hidden-xs",field:l.Fields.EmployeeID,type:r.Select2Editor,title:"Employee ID"}),i.push({cssClass:"hidden-xs",field:l.Fields.CostCentreName,type:r.Select2Editor,title:"Cost Centre"}),i.reverse(),i}createQuickFilters(){super.createQuickFilters();let i=["January","February","March","April","May","June","July","August","September","October","November","December"];b.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.OccupationName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),A.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.JobGradeName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),C.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.DepartmentName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),N.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.DivisionName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})}),F.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.EmployeeName).items.push({id:e.Entities[o].EmployeeName.toString(),text:e.Entities[o].EmployeeName.toString()}),this.findQuickFilter(r.Select2Editor,l.Fields.EmployeeID).items.push({id:e.Entities[o].EmployeeID.toString(),text:e.Entities[o].EmployeeID.toString()})}),H.List({},e=>{for(var o in e.Entities)this.findQuickFilter(r.Select2Editor,l.Fields.CostCentreName).items.push({id:e.Entities[o].Name.toString(),text:e.Entities[o].Name.toString()})})}getButtons(){var i=super.getButtons(),e=this;return i.push({title:"Money Claim Batch Approve",cssClass:"fas fa-hat-wizard text-bg-success approveButton hidden",onClick:o=>{(0,t.confirm)("Do you want to approve all selected applications?",()=>g(this,null,function*(){if(e.rowSelection.getSelectedAsInt64().length==0){(0,t.alertDialog)("Please select at least one application to approve");return}let n=e.rowSelection.getSelectedAsInt64();for(let a of n)try{let s=yield E.Retrieve({EntityId:a}),y=s.Entity.EmployeeStatus,p=s.Entity.HrStatus,f=s.Entity.Id,h=s.Entity.EmployeeRowId,d={},S=e.SuperiorOfEmployeeRowIdList.includes(h);t.Authorization.userDefinition.Permissions[u.HumanResources]?S==!0?y===2||p===2?y===2?d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:p===2&&(d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID}):p===1?d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID}:y===1?d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,HrStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={HrStatus:1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID}:d={EmployeeStatus:1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID},yield E.Update({EntityId:f,Entity:d})}catch(s){console.error(`Error updating application ${a}:`,s)}(0,t.notifyInfo)(`${n.length} records have been approved.`),e.internalRefresh()}))},separator:!0}),i.push({title:"Money Claim Batch Reject",cssClass:"fas fa-hat-wizard text-bg-danger rejectButton hidden",onClick:o=>{if(e.rowSelection.getSelectedAsInt64().length==0){(0,t.alertDialog)("Please select at least one application to reject");return}(0,t.confirm)("Do you want to reject all selected applications?",()=>g(this,null,function*(){let n=e.rowSelection.getSelectedAsInt64();var a=new j;a.dialogOpen(),a.element.on("dialogclose",()=>g(this,null,function*(){var s=window.rejectReason;for(let y of n)try{let p=yield E.Retrieve({EntityId:y}),f=p.Entity.EmployeeStatus,h=p.Entity.HrStatus,d=p.Entity.Id,S=p.Entity.EmployeeRowId,c={},x=yield new Promise((M,B)=>{(0,t.serviceCall)({service:w.baseUrl+"/PermissionToAcknowledge",data:{UserEmployeeRowID:t.Authorization.userDefinition.EmployeeRowID,ApplicantEmployeeRowID:S},method:"GET",onSuccess:M,onError:B})});t.Authorization.userDefinition.Permissions[u.HumanResources]?x==!0?f==2||h==2?f==2?c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:s}:h==2&&(c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:s}):h==0?c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:s}:f==0?c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:s}:c={EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID,HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,SuperiorRejectReason:s,HrRejectReason:s}:c={HrStatus:-1,HrUpdated:t.Authorization.userDefinition.EmployeeRowID,HrRejectReason:s}:c={SuperiorRejectReason:s,EmployeeStatus:-1,EmployeeUpdated:t.Authorization.userDefinition.EmployeeRowID},yield E.Update({EntityId:d,Entity:c})}catch(p){console.error(`Error updating application ${y}:`,p)}(0,t.notifyInfo)(`${n.length} records have been rejected.`),e.internalRefresh()}))}))}}),i}createToolbarExtensions(){super.createToolbarExtensions();var i=this;new Promise((o,n)=>{(0,t.serviceCall)({service:w.baseUrl+"/GetEmployeeUserCanView",data:{EmployeeRowID:t.Authorization.userDefinition.EmployeeRowID,PermissionKey:u.MoneyClaiming},method:"GET",onError:a=>n(a),onSuccess:a=>o(a||[])})}).then(o=>{i.SuperiorOfEmployeeRowIdList=o,i.rowSelection=new r.GridRowSelectionMixin(i,{selectable:n=>{var a=o.includes(n.EmployeeRowId);if(n.EmployeeRowId==t.Authorization.userDefinition.EmployeeRowID||n.Status!=0)return;let s=t.Authorization.hasPermission(u.HumanResources);if(n.Status==0){if(n.EmployeeStatus==2||s&&n.HrStatus==2)return;if(s&&n.HrStatus==0||a&&n.EmployeeStatus==0)return $(".approveButton, .rejectButton").removeClass("hidden"),!0}}})}).catch(o=>{console.error("Error fetching data:",o)}),$(document).on("click",".select-item.check-box.no-float",function(){$(".select-item.check-box.no-float").parent().parent().removeClass("highlighted-row"),$(".select-item.check-box.no-float.checked").parent().parent().addClass("highlighted-row")}),$("<style>").prop("type","text/css").html(`
            .slick-row.highlighted-row {
                background-color: #D3E5FF !important;
            }
        `).appendTo("head")}getColumns(){var i=super.getColumns(),e;if(i.unshift(r.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection)),!t.Authorization.hasPermission(u.HumanResources))for(e in i)(i[e].name==l.Fields.EmployeeID||i[e].name==l.Fields.ApprovedBy)&&i.splice(e,1);return i}onViewSubmit(){return this.slickGrid.onHeaderCellRendered.subscribe((i,e)=>{e.column.id==="SelectAll"&&$(e.node).empty().append("<input type='checkbox' id='selectAll'/>")}),$(document).on("change","#selectAll",function(){let i=$(this).prop("checked");$(".row-checkbox").prop("checked",i)}),super.onViewSubmit()}createEntityDialog(i,e){let o=super.createEntityDialog(i,e);var n=this;return o.element.on("dialogclose",()=>{n.internalRefresh(),console.log("hahaa")}),o}onViewProcessData(i){i=super.onViewProcessData(i);let o=t.Authorization.userDefinition.EmployeeRowID;return i.Entities.every(a=>a.EmployeeRowId===o)?t.Authorization.hasPermission(u.HumanResources)?$(".approveButton, .rejectButton").removeClass("hidden"):$(".approveButton, .rejectButton").addClass("hidden"):$(".approveButton, .rejectButton").removeClass("hidden"),this.toolbar.findButton("column-picker-button").toggle(!1),i}getAddButtonCaption(){return"Apply money claiming"}};R(m,"MoneyClaimApplicationGrid"),m=v([r.Decorators.registerClass("HRMSoftware.MoneyClaimApplication.MoneyClaimApplicationGrid")],m);function L(){(0,U.initFullHeightGridPage)(new m($("#GridDiv")).element)}R(L,"pageInit");export{L as default};
//# sourceMappingURL=MoneyClaimApplicationPage.js.map
