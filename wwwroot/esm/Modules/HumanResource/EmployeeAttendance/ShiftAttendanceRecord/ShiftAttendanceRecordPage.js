import{e as ae,f as W,g as s,h as C}from"../../../../_chunks/chunk-6Z67B4GL.js";import{G as re}from"../../../../_chunks/chunk-TCOECVPP.js";import{$ as X}from"../../../../_chunks/chunk-ZO5M45KF.js";import"../../../../_chunks/chunk-CICJSBLQ.js";import"../../../../_chunks/chunk-KXMTVQGO.js";import"../../../../_chunks/chunk-GYFJ4L6D.js";import"../../../../_chunks/chunk-T7E74GLF.js";import{d as oe}from"../../../../_chunks/chunk-HDHDXEPW.js";import"../../../../_chunks/chunk-BVVXSYMS.js";import"../../../../_chunks/chunk-6XVG2SV4.js";import{a as Y}from"../../../../_chunks/chunk-27W64ILM.js";import"../../../../_chunks/chunk-3NATHMDL.js";import{l as ne}from"../../../../_chunks/chunk-RTQCGMRU.js";import{f as ee,j as te,n as ie}from"../../../../_chunks/chunk-MVZ476J5.js";import"../../../../_chunks/chunk-DMDSRNFC.js";import{a as Z}from"../../../../_chunks/chunk-LLMDZJQJ.js";import{a as Q,b as j}from"../../../../_chunks/chunk-J5PFZI4S.js";import"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as G}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as v,g as I,h as A,j as R,k as J}from"../../../../_chunks/chunk-L3ECGIWB.js";var le=I(J(),1);var l=I(G(),1);var _=I(G(),1);var F=class extends _.EntityDialog{constructor(){super();this.form=new W(this.idPrefix);this.editButton.remove(),this.applyChangesButton.remove();var e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/clocklet@0.3.0/css/clocklet.min.css";var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/clocklet@0.3.0",document.head.appendChild(e),document.head.appendChild(t);var n=$(".fieldset").children().attr("id");let m="PropertyGrid",c="TimeInHour",f="TimeOutHour",u="ShiftStartTimeHour",d="ShiftEndTimeHour",a=n.lastIndexOf(m);if(a!==-1)var S=n.substring(0,a)+c,D=n.substring(0,a)+f,w=n.substring(0,a)+u,h=n.substring(0,a)+d;var b=document.getElementById(S);b.setAttribute("data-clocklet",""),b.setAttribute("id","time-start-clocklet"),b.addEventListener("clocklet.opening",function(p){let o=document.getElementById("time-start-clocklet");o&&(o.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),b.addEventListener("clocklet.closed",function(p){});var g=document.getElementById(D);g.setAttribute("data-clocklet",""),g.setAttribute("id","time-end-clocklet"),g.addEventListener("clocklet.opening",function(p){let o=document.getElementById("time-end-clocklet");o&&(o.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),g.addEventListener("clocklet.closed",function(p){});var r=document.getElementById(w);r.setAttribute("data-clocklet",""),r.setAttribute("id","shift-start-clocklet"),r.addEventListener("clocklet.opening",function(p){let o=document.getElementById("shift-start-clocklet");o&&(o.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),r.addEventListener("clocklet.closed",function(p){});var E=document.getElementById(h);E.setAttribute("data-clocklet",""),E.setAttribute("id","shift-end-clocklet"),E.addEventListener("clocklet.opening",function(p){let o=document.getElementById("shift-end-clocklet");o&&(o.style.zIndex=Number.MAX_SAFE_INTEGER.toString())}),E.addEventListener("clocklet.closed",function(p){})}getFormKey(){return W.formKey}getRowDefinition(){return s}getService(){return C.baseUrl}onDialogOpen(){super.onDialogOpen(),this.isNew()||C.Retrieve({EntityId:this.entityId},e=>{var t=new Date(e.Entity.ShiftStartTime),n=t.getHours().toString().padStart(2,"0"),m=t.getMinutes().toString().padStart(2,"0"),c=`${n}:${m}`,f=document.getElementById("shift-start-clocklet");f.value=c;var u=new Date(e.Entity.ShiftEndTime);n=u.getHours().toString().padStart(2,"0"),m=u.getMinutes().toString().padStart(2,"0"),c=`${n}:${m}`;var d=document.getElementById("shift-end-clocklet");d.value=c;var a=new Date(e.Entity.TimeIn);n=a.getHours().toString().padStart(2,"0"),m=a.getMinutes().toString().padStart(2,"0"),c=`${n}:${m}`;var S=document.getElementById("time-start-clocklet");S.value=c;var D=new Date(e.Entity.TimeOut);n=D.getHours().toString().padStart(2,"0"),m=D.getMinutes().toString().padStart(2,"0"),c=`${n}:${m}`;var w=document.getElementById("time-end-clocklet");w.value=c})}};v(F,"ShiftAttendanceRecordDialog"),F=A([_.Decorators.registerClass("HRMSoftware.EmployeeAttendance.ShiftAttendanceRecordDialog")],F);var se=I(J(),1);var U=I(J(),1);var x=I(G(),1),k=I(J(),1),q=I(G(),1);var B=class extends x.EntityDialog{constructor(){super();this.form=new X(this.idPrefix);var e;j.List({Criteria:x.Criteria.and(e,[[Q.Fields.Retired],"=","0"],[[Q.Fields.Terminated],"=","0"],[[Q.Fields.Resigned],"=","0"])},t=>{this.EmployeeData=t.Entities})}getFormKey(){return X.formKey}getRowDefinition(){return s}getService(){return C.baseUrl}SearchCallback(){var e=this,t=document.getElementById(this.idPrefix+"OccupationList"),n=document.getElementById(this.idPrefix+"DepartmentList"),m=document.getElementById(this.idPrefix+"DivisionList"),c=document.getElementById(this.idPrefix+"JobGradeList"),f=document.getElementById(this.idPrefix+"SectionList");function u(p){let o=$(p).val();return o.length?o.split(",").map(L=>parseInt(L,10)):[]}v(u,"parseListFromElement");let d=u(c),a=u(m),S=u(n),D=u(t),w=u(f),h=new Set(d),b=new Set(a),g=new Set(S),r=new Set(D),E=new Set(w);for(let p of e.EmployeeData){let{JobGradeID:o,DivisionID:L,DepartmentID:M,OccupationID:O,SectionID:N,Id:P}=p;console.log(p);let z=h.has(o)||b.has(L)||g.has(M)||r.has(O)||E.has(N),H=e.form.EmployeeRowListBuffer.value,y=H?H.split(",").map(Number):[];z?y.includes(P)||y.push(P):y=y.filter(K=>K!==P),e.form.EmployeeRowListBuffer.value=y.join(",")}e.form.EmployeeRowList.value=e.form.EmployeeRowListBuffer.value}SearchEmployeeCallback(){var e=this,t=document.getElementById(this.idPrefix+"EmployeeRowListBuffer"),n=$(t).val();let m=n.split(","),c=[];n.length&&m.forEach(a=>{c.push(parseInt(a))});let f=[];var u=e.form.EmployeeRowListBuffer.value;u.split(",").forEach(a=>{f.push(parseInt(a))})}getToolbarButtons(){var e=this,t=super.getToolbarButtons();return $(`#${this.idPrefix}Toolbar`).addClass("ms-auto"),t.push({title:"Generate Shift Attendance Records",cssClass:"text-bg-success p-2 ml-auto",icon:"fas fa-hat-wizard text-green",onClick:()=>{var n=e.form.EmployeeRowList.value;let m=[],c=n.split(",");n.length&&c.forEach(f=>{m.push(parseInt(f))}),e.counter=0,(0,k.confirm)("Are you sure to download the timesheet for these employees?",()=>{console.log(e.EmployeeData.find(d=>d.Id===12)),console.log("hhhaaa");function f(d){return new Promise((a,S)=>{var D="EmployeeRowId="+encodeURIComponent(d)+"&startDateStr="+encodeURIComponent(e.form.startDate.value)+"&endDateStr="+encodeURIComponent(e.form.endDate.value),w=window.location.origin+"/EmployeeAttendance/ShiftAttendanceRecord/GenerateShiftAttendanceTable?"+D,h=new XMLHttpRequest;h.open("GET",w,!0),h.responseType="blob",h.onload=function(){if(h.status===200){var b=h.response;let p=window.URL.createObjectURL(b),o=document.createElement("a");o.style.display="none";var g=e.EmployeeData.find(L=>L.Id==d),r=g.EmployeeName,E=g.EmployeeID;o.href=p,o.download=`Attendance Timesheet ${r} ${E} from ${e.form.startDate.value}-${e.form.endDate.value}.pdf`,o.click(),(0,k.notifySuccess)("Timesheet downloaded"),a()}else(0,k.notifyError)("Error encountered when downloading timesheet PDF"),S(new Error("Download failed"))},h.onerror=()=>S(new Error("Network error")),h.send()})}v(f,"downloadTimesheet");function u(){return R(this,null,function*(){for(let d=0;d<e.form.EmployeeRowList.values.length;d++)yield f(e.form.EmployeeRowList.values[d])})}v(u,"downloadTimesheets"),u()})}}),t}dialogOpen(e){super.dialogOpen();var t=this;(0,k.serviceCall)({service:re.baseUrl+"/GetTodayDateTime",method:"GET",data:{},async:!1,onSuccess:r=>{t.dateString=r,oe.List({},E=>{var p=new Date(t.dateString),o=p.getMonth(),L=p.getFullYear(),M=0;for(var O in E.Entities)if(E.Entities[O].IsActive==1){M=E.Entities[O].PayDay;break}var N=new Date(L,o,M),P=N.getFullYear().toString(),z=(N.getMonth()+1).toString(),H=N.getDate().toString();o=o+1;var y=new Date(L,o,M);y.setDate(y.getDate()+1);var K=y.getFullYear().toString(),ce=(y.getMonth()+1).toString(),de=y.getDate().toString(),me=z.padStart(2,"0")+"/"+H.padStart(2,"0")+"/"+P,ue=ce.padStart(2,"0")+"/"+de.padStart(2,"0")+"/"+K;this.isNew()&&(t.form.startDate.value=me,t.form.endDate.value=ue)})}}),this.saveAndCloseButton.hide(),this.editButton.hide(),this.applyChangesButton.hide(),this.deleteButton.hide(),this.localizationButton.hide(),this.cloneButton.hide(),this.undeleteButton.hide();var n=document.getElementById(this.idPrefix+"PayMonth"),m=document.getElementById(this.idPrefix+"PayYear");let c=new q.Select2Editor($(n)),f=new q.Select2Editor($(m)),u=["January","February","March","April","May","June","July","August","September","October","November","December"];var d=new Date(t.dateString),a=d.getFullYear(),S=d.getMonth();for(let r=0;r<u.length;r++)c.addItem({id:r.toString(),text:u[r].toString()});c.set_value(S.toString());for(let r=-1;r<2;r++)f.addItem({id:(a+r).toString(),text:(a+r).toString()});f.set_value(a.toString());var D=document.getElementById(this.idPrefix+"SectionList"),w=document.getElementById(this.idPrefix+"OccupationList"),h=document.getElementById(this.idPrefix+"DepartmentList"),b=document.getElementById(this.idPrefix+"DivisionList"),g=document.getElementById(this.idPrefix+"JobGradeList");$(`#s2id_${this.idPrefix}EmployeeRowList`).on("click",function(r){return R(this,null,function*(){$(".select2-drop").hide()})}),$(w).on("change",function(){return R(this,null,function*(){t.SearchCallback()})}),$(b).on("change",function(){return R(this,null,function*(){t.SearchCallback()})}),$(g).on("change",function(){return R(this,null,function*(){t.SearchCallback()})}),$(h).on("change",function(){return R(this,null,function*(){t.SearchCallback()})}),$(D).on("change",function(){return R(this,null,function*(){t.SearchCallback()})})}getDialogOptions(){let e=super.getDialogOptions();return e.width=e.width+100,e}};v(B,"ShiftAttendanceDownloaderDialog"),B=A([x.Decorators.registerClass("HRMSoftware.EmployeeAttendance.ShiftAttendanceDownloaderDialog")],B);var T=class extends l.EntityGrid{getColumnsKey(){return ae.columnsKey}getDialogType(){return F}getRowDefinition(){return s}getService(){return C.baseUrl}getButtons(){var i=super.getButtons(),e=this;return i.push({title:"Shift Attendance Record Generator",cssClass:"fas fa-hat-wizard text-bg-success",onClick:t=>{(0,se.confirm)("Do you want to generate Timesheet?",()=>{var n=new B;n.dialogOpen(),n.element.on("dialogclose",function(){e.internalRefresh()})})}}),i}getQuickFilters(){let i=super.getQuickFilters();return U.Authorization.hasPermission(Y.HumanResources)&&(i.push({cssClass:"hidden-xs",field:s.Fields.OccupationName,type:l.Select2Editor,title:"Occupation"}),i.push({cssClass:"hidden-xs",field:s.Fields.JobGradeName,type:l.Select2Editor,title:"Job Grade"}),i.push({cssClass:"hidden-xs",field:s.Fields.DivisionName,type:l.Select2Editor,title:"Division"}),i.push({cssClass:"hidden-xs",field:s.Fields.DepartmentName,type:l.Select2Editor,title:"Department"}),i.push({cssClass:"hidden-xs",field:s.Fields.EmployeeName,type:l.Select2Editor,title:"Name"}),i.push({cssClass:"hidden-xs",field:s.Fields.EmployeeID,type:l.Select2Editor,title:"Employee ID"}),i.push({cssClass:"hidden-xs",field:s.Fields.CostCentreName,type:l.Select2Editor,title:"Cost Centre"}),i.reverse()),i}createQuickFilters(){if(super.createQuickFilters(),U.Authorization.hasPermission(Y.HumanResources)){let i=["January","February","March","April","May","June","July","August","September","October","November","December"];ie.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.OccupationName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),te.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.JobGradeName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),Z.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.DepartmentName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),ee.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.DivisionName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})}),j.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.EmployeeName).items.push({id:e.Entities[t].EmployeeName.toString(),text:e.Entities[t].EmployeeName.toString()}),this.findQuickFilter(l.Select2Editor,s.Fields.EmployeeID).items.push({id:e.Entities[t].EmployeeID.toString(),text:e.Entities[t].EmployeeID.toString()})}),ne.List({},e=>{for(var t in e.Entities)this.findQuickFilter(l.Select2Editor,s.Fields.CostCentreName).items.push({id:e.Entities[t].Name.toString(),text:e.Entities[t].Name.toString()})})}}constructor(i){super(i)}getColumns(){var i=super.getColumns(),e;if(!U.Authorization.hasPermission(Y.HumanResources))for(e in i)(i[e].name=="Employee Id"||i[e].name=="Approved By")&&i.splice(e,1);return i}onViewProcessData(i){return i=super.onViewProcessData(i),this.toolbar.findButton("column-picker-button").toggle(!1),i}};v(T,"ShiftAttendanceRecordGrid"),T=A([l.Decorators.registerClass("HRMSoftware.EmployeeAttendance.ShiftAttendanceRecordGrid")],T);function pe(){(0,le.initFullHeightGridPage)(new T($("#GridDiv")).element)}v(pe,"pageInit");export{pe as default};
//# sourceMappingURL=ShiftAttendanceRecordPage.js.map
