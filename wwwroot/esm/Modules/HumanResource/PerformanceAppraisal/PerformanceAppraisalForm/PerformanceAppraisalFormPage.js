import{a as Fe,b as Re}from"../../../../_chunks/chunk-G6FQBLBG.js";import{a as $e}from"../../../../_chunks/chunk-KAIY64Q4.js";import"../../../../_chunks/chunk-TOBXC2UI.js";import{E as he,F as Z,J as Se,g as ye,h as ue,m as we,n as me,o as C,p as I,w as ve,x as Q}from"../../../../_chunks/chunk-R2HZVO35.js";import{a as fe}from"../../../../_chunks/chunk-27W64ILM.js";import{a as pe}from"../../../../_chunks/chunk-TIB4BNCY.js";import{b as De}from"../../../../_chunks/chunk-BA2LGLQM.js";import{a as Ae}from"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as be}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as E,g as A,h as K,j as F,k as Y}from"../../../../_chunks/chunk-L3ECGIWB.js";var ke=A(Y(),1);var j=A(be(),1);var xe=A(Y(),1);function Ce(){return(0,xe.getRemoteData)("UserData")}E(Ce,"userDefinition");function ge(ee){let J=Ce();return J.Username==="admin"||!!J.Permissions[ee]}E(ge,"hasPermission");var X=A(Ae(),1),L=A(Y(),1);var G=A(be(),1);var R=A(Y(),1);var P=class extends G.EntityDialog{constructor(){super(...arguments);this.form=new me(this.idPrefix)}getFormKey(){return me.formKey}getRowDefinition(){return C}getService(){return I.baseUrl}updateInterface(){super.updateInterface(),this.toolbar.findButton("export-pdf-button").toggle(this.isEditMode())}getID(e){this.formID=e}onDialogOpen(){super.onDialogOpen(),this.dialogTitle="",this.element.closest(".ui-dialog").css("top","2%");let e=$('<div id="form-container"></div>').appendTo(this.element),i=[],a=[],t=[],s=[],l=[],n=[],u=[],f=[],D=[],h=[];Z.List({},v=>F(this,null,function*(){for(let m in v.Entities){let r=v.Entities[m];i.push(r.Id),a.push(r.TemplateName)}yield Se.List({},m=>F(this,null,function*(){for(let r in m.Entities){let d=m.Entities[r];t.push(d.Id),s.push(d.Type)}yield De.List({},r=>F(this,null,function*(){let d={};yield pe.List({},g=>F(this,null,function*(){for(let c in g.Entities){let p=g.Entities[c];d[p.Id]=p.Name}for(let c in r.Entities){let p=r.Entities[c];l.push(p.Id),n.push(p.EmployeeName),u.push(p.Id),f.push(p.EmployeeName);let o=p.DepartmentID,w=d[o]||"Unknown";D.push(o),h.push(w)}let y=[];yield pe.List({},c=>F(this,null,function*(){for(let p in c.Entities){let o=c.Entities[p];y.push(o.Name)}})),this.displayForm(e,i,a,t,s,l,n,u,f,D,h,y)}))}))}))})),this.applyChangesButton.remove(),this.saveAndCloseButton.remove(),this.deleteButton.remove()}displayForm(e,i,a,t,s,l,n,u,f,D,h,v){e.empty(),I.List({Criteria:[[C.Fields.Id],"=",this.formID]},m=>{if(m.Entities.length===0){let r=m.Entities[0],d=`
                    <div class="field-row">
                        <div class="field" style="width: 48%;">
                            <label for="TemplateId" class="field-label">Template:</label>
                            <select id="TemplateId" class="field-select">
                                <option value="">Select Template</option>
                                ${i.map((o,w)=>`<option value="${o}">${a[w]}</option>`).join("")}
                            </select>
                        </div>
                        <div class="field" style="width: 48%;">
                            <label for="AppraisalTypeId" class="field-label">Appraisal Type:</label>
                            <select id="AppraisalTypeId" class="field-select">
                                <option value="">Select Appraisal Type</option>
                                ${t.map((o,w)=>`<option value="${o}">${s[w]}</option>`).join("")}
                            </select>
                        </div>
                    </div>
    
                    <div class="field-row">
                        <div class="field" style="width: 108%;">
                            <label for="TargetList" class="field-label">Target:</label>
                            <div class="field-box">
                                <div class="search-target-container">
                                    <div class="target-close-inline">
                                        <input type="text" id="TargetSearch" class="search-box" placeholder="Search target...">
                                        <span id="clearTargetSearch" class="target-clear-icon fa fa-times"></span>
                                    </div>
                                    <div class="filter-target-close-inline">
                                        <select id="FilterTargetDepartment" class="field-select-filter-target">
                                            <option value="">Filter</option>
                                        </select>
                                        <span id="clearTargetFilter" class="filter-target-clear-icon fa fa-times"></span>
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="selectAll_target" name="selectAll_target">
                                    <label for="selectAll_target" style="font-weight: bold; padding-bottom: 20px;">Select All</label>
                                </div>
                                <div class="target-list-container">
                                    ${u.map((o,w)=>`
                                        <div class="target-list">
                                            <input type="checkbox" id="Target_${o}" name="TargetList" value="${o}">
                                            <label for="Target_${o}" class="target-name">${f[w]}</label>
                                            <label class="depart-name">${h[w]}</label>
                                            <hr style="color: #222222;">
                                        </div>`).join("")}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="new-date-field-row">
                        <div class="field" style="width: 48%;">
                            <label for="StartDate" class="field-label">Start Date:</label>
                            <input type="text" id="StartDate" class="field-select" style="width: 150px;">
                        </div>
                    </div>
                `,g=$('<button><i class="fa fa-save"></i> Save</button>').prependTo(this.element);g.css({position:"relative",border:"1px solid #b1b1b1","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"16px",cursor:"pointer",width:"80px"}),g.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),g.on("click",()=>this.saveData());let y=$('<button><i class="fa fa-times"></i></button>').prependTo(this.element);y.css({position:"absolute",top:"25px",right:"25px",border:"1px solid transparent","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"22px",cursor:"pointer",width:"40px","text-align":"center"}),y.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),y.on("click",()=>{this.dialogClose()}),$(d).appendTo(e);let c=$("#FilterReviwerDepartment");c.empty().append('<option value="">Filter</option>'),v.forEach(o=>{c.append(`<option value="${o.toLowerCase()}">${o}</option>`)});let p=$("#FilterTargetDepartment");p.empty().append('<option value="">Filter</option>'),v.forEach(o=>{p.append(`<option value="${o.toLowerCase()}">${o}</option>`)}),this.initializeDatePickers(),this.applyStyles(e),this.addSelectAllFunctionality("#selectAll_reviewer",'.review-list-container input[type="checkbox"]'),this.addSelectAllFunctionality("#selectAll_target",'.target-list-container input[type="checkbox"]'),this.addSearchFunctionality("#ReviewerSearch","#clearReviewerSearch",'.review-list-container input[type="checkbox"]',n),this.addSearchFunctionality("#TargetSearch","#clearTargetSearch",'.target-list-container input[type="checkbox"]',f),this.addFilterFunctionality("#FilterReviwerDepartment","#clearReviewerFilter",".review-list-container div",h),this.addFilterFunctionality("#FilterTargetDepartment","#clearTargetFilter",".target-list-container div",h)}else{let r=m.Entities[0];Q.List({Criteria:[[ve.Fields.FormId],"=",this.formID]}).then(d=>{if(d.Entities.length>0){let x=function(b){let T=new Date(b),oe=T.getFullYear(),se=String(T.getMonth()+1).padStart(2,"0"),ne=String(T.getDate()).padStart(2,"0"),de=String(T.getHours()).padStart(2,"0"),ce=String(T.getMinutes()).padStart(2,"0"),Te=String(T.getSeconds()).padStart(2,"0");return`${oe}-${se}-${ne} ${de}:${ce}:${Te}`};E(x,"formatDate");let g=r.TemplateId||"",y=r.TemplateName||"",c=r.TypeId||"",p=r.EmployeeRowId||"",o=r.StartDate,w=r.EndDate,M=r.EvaluateStartDate,U=r.EvaluateEndDate,V=r.ApprovalStartDate,k=r.ApprovalEndDate,N=x(o),te=x(w),ae=x(M),ie=x(U),re=x(V),le=x(k),W=`
                                <div class="field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="TemplateId" class="field-label">Template:</label>
                                        <select id="TemplateId" class="field-select read-only" disabled>
                                            <option value="${g}" selected>${y}</option>
                                        </select>
                                    </div>
                                    <div class="field" style="width: 48%;">
                                        <label for="AppraisalTypeId" class="field-label">Appraisal Type:</label>
                                        <select id="AppraisalTypeId" class="field-select">
                                            <option value="">Select Appraisal Type</option>
                                            ${t.map((b,T)=>`<option value="${b}" ${c===b?"selected":""}>${s[T]}</option>`).join("")}
                                        </select>
                                    </div>
                                </div>
                
                                <div class="field-row">
                                    <div class="field" style="width: 100%;">
                                        <label for="TargetList" class="field-label">Target:</label>
                                        <div class="field-box read-only">
                                            <div class="search-target-container read-only">
                                                <div class="target-close-inline read-only">
                                                    <input type="text" id="TargetSearch" class="search-box read-only" placeholder="Search target..." disabled>
                                                    <span id="clearTargetSearch" class="target-clear-icon fa fa-times"></span>
                                                </div>
                                                <div class="filter-target-close-inline read-only">
                                                    <select id="FilterTargetDepartment" class="field-select-filter-target read-only" disabled>
                                                        <option value="">Filter</option>
                                                    </select>
                                                    <span id="clearTargetFilter" class="filter-target-clear-icon fa fa-times"></span>
                                                </div>
                                            </div>
                                            <div>
                                                <input type="checkbox" id="selectAll_target read-only" name="selectAll_target" disabled>
                                                <label for="selectAll_target" style="font-weight: bold; padding-bottom: 20px;">Select All</label>
                                            </div>
                                            <div class="target-list-container read-only">
                                                ${u.map((b,T)=>`
                                                    <div class="target-list">
                                                        <input type="checkbox" id="Target_${b}" name="TargetList" value="${b}" ${p===b?"checked":""} disabled>
                                                        <label for="Target_${b}" class="target-name">${f[T]}</label>
                                                        <hr style="color: #222222;">
                                                    </div>`).join("")}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="StartDate" class="field-label">Start Date:</label>
                                        <input type="text" id="StartDate" class="field-select" style="width: 150px;" value="${N}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="EndDate" class="field-label">End Date:</label>
                                        <input type="text" id="EndDate" class="field-select" style="width: 150px;" value="${te}">
                                    </div>
                                </div>
                                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="ReviewStartDate" class="field-label">Review Start Date:</label>
                                        <input type="text" id="ReviewStartDate" class="field-select" style="width: 150px;" value="${ae}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="ReviewEndDate" class="field-label">Review End Date:</label>
                                        <input type="text" id="ReviewEndDate" class="field-select" style="width: 150px;" value="${ie}">
                                    </div>
                                </div>
                                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="ApprovalStartDate" class="field-label">Approval Start Date:</label>
                                        <input type="text" id="ApprovalStartDate" class="field-select" style="width: 150px;" value="${re}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="ApprovalEndDate" class="field-label">Approval End Date:</label>
                                        <input type="text" id="ApprovalEndDate" class="field-select" style="width: 150px;" value="${le}">
                                    </div>
                                </div>
                            `,H=$("<div></div>").prependTo(this.element),O=$('<button><i class="fa fa-save"></i> Save</button>').appendTo(H),z=$('<button><i class="fa fa-trash"></i> Del</button>').appendTo(H);H.css({display:"inline-block"}),O.css({border:"1px solid #b1b1b1","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"16px",cursor:"pointer",width:"80px",display:"inline-block","margin-right":"5px"}),z.css({border:"1px solid #b1b1b1","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"16px",cursor:"pointer",width:"80px",display:"inline-block"}),O.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),z.hover(function(){$(this).css({"background-color":"red",color:"white"})},function(){$(this).css({"background-color":"white",color:"black"})}),O.on("click",()=>this.updateData()),z.on("click",()=>{(0,R.confirm)("Delete record?",()=>{this.delData()})});let B=$('<button><i class="fa fa-times"></i></button>').prependTo(this.element);B.css({position:"absolute",top:"25px",right:"25px",border:"1px solid transparent","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"22px",cursor:"pointer",width:"40px","text-align":"center"}),B.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),B.on("click",()=>{this.dialogClose()}),$(W).appendTo(e);let q=$("#FilterReviwerDepartment");q.empty().append('<option value="">Filter</option>'),v.forEach(b=>{q.append(`<option value="${b.toLowerCase()}">${b}</option>`)});let S=$("#FilterTargetDepartment");S.empty().append('<option value="">Filter</option>'),v.forEach(b=>{S.append(`<option value="${b.toLowerCase()}">${b}</option>`)}),this.initializeDatePickers(),this.applyStyles(e),this.addSelectAllFunctionality("#selectAll_target",'.target-list-container input[type="checkbox"]'),this.addSearchFunctionality("#TargetSearch","#clearTargetSearch",'.target-list-container input[type="checkbox"]',f),this.addFilterFunctionality("#FilterReviwerDepartment","#clearReviewerFilter",".review-list-container div",h),this.addFilterFunctionality("#FilterTargetDepartment","#clearTargetFilter",".target-list-container div",h),this.scrollToFirstChecked('.review-list-container input[type="checkbox"]','.target-list-container input[type="checkbox"]')}else{let k=function(S){let b=new Date(S),T=b.getFullYear(),oe=String(b.getMonth()+1).padStart(2,"0"),se=String(b.getDate()).padStart(2,"0"),ne=String(b.getHours()).padStart(2,"0"),de=String(b.getMinutes()).padStart(2,"0"),ce=String(b.getSeconds()).padStart(2,"0");return`${T}-${oe}-${se} ${ne}:${de}:${ce}`};E(k,"formatDate");let g=r.TemplateId||"",y=r.TypeId||"",c=r.EmployeeRowId||"",p=r.StartDate,o=r.EndDate,w=r.EvaluateStartDate,M=r.EvaluateEndDate,U=r.ApprovalStartDate,V=r.ApprovalEndDate,x=k(p),N=k(o),te=k(w),ae=k(M),ie=k(U),re=k(V),le=`
                                <div class="field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="TemplateId" class="field-label">Template:</label>
                                        <select id="TemplateId" class="field-select">
                                            <option value="">Select Template</option>
                                            ${i.map((S,b)=>`<option value="${S}" ${g===S?"selected":""}>${a[b]}</option>`).join("")}
                                        </select>
                                    </div>
                                    <div class="field" style="width: 48%;">
                                        <label for="AppraisalTypeId" class="field-label">Appraisal Type:</label>
                                        <select id="AppraisalTypeId" class="field-select">
                                            <option value="">Select Appraisal Type</option>
                                            ${t.map((S,b)=>`<option value="${S}" ${y===S?"selected":""}>${s[b]}</option>`).join("")}
                                        </select>
                                    </div>
                                </div>
                
                                <div class="field-row">
                                    <div class="field" style="width: 100%;">
                                        <label for="TargetList" class="field-label">Target:</label>
                                        <div class="field-box read-only">
                                            <div class="search-target-container read-only">
                                                <div class="target-close-inline read-only">
                                                    <input type="text" id="TargetSearch" class="search-box read-only" placeholder="Search target..." disabled>
                                                    <span id="clearTargetSearch" class="target-clear-icon read-only fa fa-times"></span>
                                                </div>
                                                <div class="filter-target-close-inline">
                                                    <select id="FilterTargetDepartment" class="field-select-filter-target read-only" disabled>
                                                        <option value="">Filter</option>
                                                    </select>
                                                    <span id="clearTargetFilter" class="filter-target-clear-icon read-only fa fa-times"></span>
                                                </div>
                                            </div>
                                            <div>
                                                <input type="checkbox" id="selectAll_target" name="selectAll_target" class="selectAll_target read-only" disabled>
                                                <label for="selectAll_target" style="font-weight: bold; padding-bottom: 20px;">Select All</label>
                                            </div>
                                            <div class="target-list-container read-only">
                                                ${u.map((S,b)=>`
                                                    <div class="target-list">
                                                        <input type="checkbox" id="Target_${S}" name="TargetList" value="${S}" ${c===S?"checked":""} disabled>
                                                        <label for="Target_${S}" class="target-list">${f[b]}</label>
                                                        <hr style="color: #222222;">
                                                    </div>`).join("")}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="StartDate" class="field-label">Start Date:</label>
                                        <input type="text" id="StartDate" class="field-select" style="width: 150px;" value="${x}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="EndDate" class="field-label">End Date:</label>
                                        <input type="text" id="EndDate" class="field-select" style="width: 150px;" value="${N}">
                                    </div>
                                </div>
                                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="ReviewStartDate" class="field-label">Review Start Date:</label>
                                        <input type="text" id="ReviewStartDate" class="field-select" style="width: 150px;" value="${te}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="ReviewEndDate" class="field-label">Review End Date:</label>
                                        <input type="text" id="ReviewEndDate" class="field-select" style="width: 150px;" value="${ae}">
                                    </div>
                                </div>
                                
                                <div class="date-field-row">
                                    <div class="field" style="width: 48%;">
                                        <label for="ApprovalStartDate" class="field-label">Approval Start Date:</label>
                                        <input type="text" id="ApprovalStartDate" class="field-select" style="width: 150px;" value="${ie}">
                                    </div>
                                    <div class="field" style="width: 48%; color: #2f2f2f">
                                        <label for="ApprovalEndDate" class="field-label">Approval End Date:</label>
                                        <input type="text" id="ApprovalEndDate" class="field-select" style="width: 150px;" value="${re}">
                                    </div>
                                </div>
                            `,W=$("<div></div>").prependTo(this.element),H=$('<button><i class="fa fa-save"></i> Save</button>').appendTo(W),O=$('<button><i class="fa fa-trash"></i> Del</button>').appendTo(W);W.css({display:"inline-block"}),H.css({border:"1px solid #b1b1b1","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"16px",cursor:"pointer",width:"80px",display:"inline-block","margin-right":"5px"}),O.css({border:"1px solid #b1b1b1","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"16px",cursor:"pointer",width:"80px",display:"inline-block"}),H.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),O.hover(function(){$(this).css({"background-color":"red",color:"white"})},function(){$(this).css({"background-color":"white",color:"black"})}),H.on("click",()=>this.updateData()),O.on("click",()=>{(0,R.confirm)("Delete record?",()=>{this.delData()})});let z=$('<button><i class="fa fa-times"></i></button>').prependTo(this.element);z.css({position:"absolute",top:"25px",right:"25px",border:"1px solid transparent","background-color":"white",padding:"7px 9px","border-radius":"5px","font-size":"22px",cursor:"pointer",width:"40px","text-align":"center"}),z.hover(function(){$(this).css({"background-color":"gray",color:"black"})},function(){$(this).css({"background-color":"white",color:"black"})}),z.on("click",()=>{this.dialogClose()}),$(le).appendTo(e);let B=$("#FilterReviwerDepartment");B.empty().append('<option value="">Filter</option>'),v.forEach(S=>{B.append(`<option value="${S.toLowerCase()}">${S}</option>`)});let q=$("#FilterTargetDepartment");q.empty().append('<option value="">Filter</option>'),v.forEach(S=>{q.append(`<option value="${S.toLowerCase()}">${S}</option>`)}),this.initializeDatePickers(),this.applyStyles(e),this.addSelectAllFunctionality("#selectAll_reviewer",'.review-list-container input[type="checkbox"]'),this.addSelectAllFunctionality("#selectAll_target",'.target-list-container input[type="checkbox"]'),this.addSearchFunctionality("#ReviewerSearch","#clearReviewerSearch",'.review-list-container input[type="checkbox"]',n),this.addSearchFunctionality("#TargetSearch","#clearTargetSearch",'.target-list-container input[type="checkbox"]',f),this.addFilterFunctionality("#FilterReviwerDepartment","#clearReviewerFilter",".review-list-container div",h),this.addFilterFunctionality("#FilterTargetDepartment","#clearTargetFilter",".target-list-container div",h),this.scrollToFirstChecked('.review-list-container input[type="checkbox"]','.target-list-container input[type="checkbox"]')}})}})}applyStyles(e){e.find(".field").css({"border-radius":"5px","box-sizing":"border-box",display:"inline-block","vertical-align":"top"}),e.find(".field-label").css({"font-weight":"bold",color:"#000000","margin-bottom":"10px",display:"block"}),e.find(".field-select").css({width:"100%",padding:"8px",border:"1px solid #ccc","border-radius":"4px","font-size":"14px","box-sizing":"border-box"}),e.find(".field-row").css({display:"flex","justify-content":"space-between","margin-bottom":"10px",width:"100%"}),e.find(".date-field-row").css({display:"flex","justify-content":"space-between",width:"100%"}),e.find(".new-date-field-row").css({display:"flex","justify-content":"center",width:"48%",margin:"0 auto"}),e.find(".field-box").css({border:"1px solid #ddd","border-radius":"5px",padding:"10px","background-color":"#f9f9f9","overflow-y":"hidden",display:"flex","flex-direction":"column"}),e.find(".target-close-inline").css({position:"relative",display:"inline-block",width:"80%"}),e.find(".search-box").css({width:"100%",padding:"8px",border:"1px solid #ccc","border-radius":"4px","font-size":"14px","margin-bottom":"10px","flex-shrink":"0"}),e.find(".target-clear-icon").css({position:"absolute",right:"10px",top:"40%",transform:"translateY(-50%)",cursor:"pointer","font-size":"16px",color:"red",display:"none","z-index":"1"}),e.find(".target-search-box").css({width:"100%",padding:"8px",border:"1px solid #ccc","border-radius":"4px","font-size":"14px","margin-bottom":"10px","background-color":"darkgray",cursor:"not-allowed","flex-shrink":"0"}),e.find(".filter-target-close-inline").css({position:"relative",display:"inline-block",width:"18%"}),e.find(".field-select-filter-target").css({width:"100%",padding:"8px",border:"1px solid #ccc","border-radius":"4px","font-size":"14px","margin-bottom":"10px","box-sizing":"border-box"}),e.find(".filter-target-clear-icon").css({position:"absolute",right:"20px",top:"25%",cursor:"pointer","font-size":"16px",color:"red","z-index":"1"}),e.find(".target-list-container").css({"flex-grow":"1",height:"200px","overflow-y":"auto"}),e.find(".target-list").css({display:"flex","align-items":"flex-start","margin-bottom":"10px",width:"100%"}),e.find('.target-list input[type="checkbox"]').css({"margin-right":"10px","flex-shrink":"0",width:"20px",height:"20px"}),e.find(".target-name").css({"flex-grow":"1","white-space":"normal","word-wrap":"break-word","margin-right":"10px"}),e.find('input[type="checkbox"]').css({"margin-right":"10px","flex-shrink":"0",width:"20px",height:"20px"}),e.find(".field-box label").css({display:"inline-flex","align-items":"center","font-size":"16px"}),e.find(".read-only").css({"background-color":"darkgray",cursor:"not-allowed"}),e.find('.read-only input[type="checkbox"]').css({cursor:"not-allowed"}),e.find(".depart-name").css({display:"None"})}scrollToFirstChecked(e,i){let a=this.element.find(`${i}:checked`);a.length>0&&setTimeout(()=>{a[0].scrollIntoView({behavior:"smooth",block:"center"})},800)}addSearchFunctionality(e,i,a,t){let s=$(e),l=$(i);function n(){s.val()?l.show():l.hide()}E(n,"updateClearButton"),$(e).on("input",function(){var h;let u=((h=$(this).val())==null?void 0:h.toString().toLowerCase())||"",f=!1,D=new RegExp("\\b"+u+"\\b","i");$(a).each(function(v){let m=t[v]?t[v].toLowerCase():"",r=$(this).closest("div");(m.includes(u)||D.test(m))&&u.length>0?(r.css("background-color","#d1e7fd"),f||(r[0].scrollIntoView({behavior:"smooth",block:"center"}),f=!0)):r.css("background-color","")}),f||$(a).closest("div").css("background-color",""),n()}),l.on("click",function(){s.val("").trigger("input"),l.hide()}),n()}addFilterFunctionality(e,i,a,t){let s=$(e),l=$(i);function n(){s.val()?l.show():l.hide()}E(n,"updateClearButton"),$(s).on("change",function(){var f;let u=((f=$(this).val())==null?void 0:f.toString().toLowerCase())||"";$(a).each(function(D){let h=$(this).closest("div"),v=t[D]?t[D].toLowerCase():"";u===""||v===u?h.show():h.hide()}),n()}),l.on("click",function(){s.val("").trigger("change"),$(a).closest("div").show(),l.hide()}),n()}addSelectAllFunctionality(e,i){let a=$(e);a.on("change",function(){let l=$(this).is(":checked");$(i).filter(":visible").prop("checked",l)}),$(i).on("change",function(){let l=$(i).filter(":visible"),n=l.length===l.filter(":checked").length;a.prop("checked",n)});let t=$(i).filter(":visible"),s=t.length===t.filter(":checked").length;a.prop("checked",s)}initializeDatePickers(){let e=this,i=$("#TemplateId").val()||"";this.element.find("#StartDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(0,0,0,0),$("#StartDate").val($.datepicker.formatDate("yy-mm-dd",t))}}),this.element.find("#EndDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(23,59,59,999),$("#EndDate").val($.datepicker.formatDate("yy-mm-dd",t)+" 23:59:59")}}),this.element.find("#ReviewStartDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(0,0,0,0),$("#ReviewStartDate").val($.datepicker.formatDate("yy-mm-dd",t))}}),this.element.find("#ReviewEndDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(23,59,59,999),$("#ReviewEndDate").val($.datepicker.formatDate("yy-mm-dd",t)+" 23:59:59")}}),this.element.find("#ApprovalStartDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(0,0,0,0),$("#ApprovalStartDate").val($.datepicker.formatDate("yy-mm-dd",t))}}),this.element.find("#ApprovalEndDate").datepicker({dateFormat:"yy-mm-dd",onSelect:function(a){let t=new Date(a);t.setHours(23,59,59,999),$("#ApprovalEndDate").val($.datepicker.formatDate("yy-mm-dd",t)+" 23:59:59")}})}isEmptyOrNull(e){return e==null||e===""}saveData(){let e=[],i=[],a=$("#TemplateId").val()||"",t=$("#AppraisalTypeId").val()||"",s=$("#StartDate").val()||"",l=1,n=4,u="";Z.List({Criteria:[[he.Fields.Id],"=",a]},f=>{let D=new Date(s),v=f.Entities[0].Duration*7,m=new Date(D);m.setDate(D.getDate()+v),m.setHours(23,59,59,999);let r=m.toISOString().slice(0,10)+" 23:59:59",d=new Date(m);d.setDate(m.getDate()+2),d.setHours(0,0,0,0);let g=d.toISOString().slice(0,10)+" 00:00:00.000",y=new Date(d);y.setDate(d.getDate()+v-1),y.setHours(23,59,59,999);let c=y.toISOString().slice(0,10)+" 23:59:59",p=new Date(y);p.setDate(y.getDate()+2),p.setHours(0,0,0,0);let o=p.toISOString().slice(0,10)+" 00:00:00.000",w=new Date(p);w.setDate(p.getDate()+v-1),w.setHours(23,59,59,999);let M=w.toISOString().slice(0,10)+" 23:59:59";for(var U in f.Entities)u=f.Entities[U].TemplateName;let V=[];$('input[name="TargetList"]:checked').each((k,x)=>{let N=$(x).val()||"";V.push(N),e.push({TemplateID:a,TemplateName:u,EmployeeRowID:N,TypeID:t,StartDate:s,EndDate:r,EvaluateStartDate:g,EvaluateEndDate:c,ApprovalStartDate:o,ApprovalEndDate:M,SubmissionStatus:l,ReviewStatus:n})}),this.validateNewForm()&&this.isNew()&&e.forEach(k=>{I.Create({Entity:k}).then(x=>{let N=x.EntityId;setTimeout(()=>{this.dialogClose(),window.location.reload()},1e3)}).catch(x=>{console.error("Error creating form record:",x)})})})}updateData(){let e=[],i=[],a=$("#TemplateId").val()||"",t=$("#AppraisalTypeId").val()||"",s=$("#StartDate").val()||"",l=$("#EndDate").val()||"",n=$("#ReviewStartDate").val()||"",u=$("#ReviewEndDate").val()||"",f=$("#ApprovalStartDate").val()||"",D=$("#ApprovalEndDate").val()||"",h=1,v=4;if(s&&l){let r=new Date(s);if(new Date(l)<r){(0,R.alertDialog)("End date cannot be earlier than the start date.");return}}if(n&&u){let r=new Date(n);if(new Date(u)<r){(0,R.alertDialog)("Review End date cannot be earlier than the Review Start date.");return}}if(f&&D){let r=new Date(f);if(new Date(D)<r){(0,R.alertDialog)("Approval End date cannot be earlier than the Approval Start date.");return}}let m="";I.List({Criteria:[[C.Fields.Id],"=",this.formID]},r=>{m=r.Entities[0].TemplateName,h=r.Entities[0].SubmissionStatus,v=r.Entities[0].ReviewStatus,Z.List({Criteria:[[he.Fields.Id],"=",a]},d=>{if(d.Entities.length>0)for(var g in d.Entities)m=d.Entities[g].TemplateName;let y=[];$('input[name="TargetList"]:checked').each((c,p)=>{let o=$(p).val()||"";y.push(o),e.push({TemplateID:a,TemplateName:m,EmployeeRowID:o,TypeID:t,StartDate:s,EndDate:l,EvaluateStartDate:n,EvaluateEndDate:u,ApprovalStartDate:f,ApprovalEndDate:D,SubmissionStatus:h,ReviewStatus:v})}),console.log("Form data: ",e),this.validateForm()&&I.List({Criteria:[[C.Fields.Id],"=",this.formID]}).then(c=>{c.Entities.length>0?e.forEach(p=>{p.Id=this.formID,I.Update({Entity:p}).then(o=>{console.log("Form updated successfully"),setTimeout(()=>{this.dialogClose(),window.location.reload()},1e3)}).catch(o=>{console.error("Error updating form record:",o)})}):console.log("No form found with the given ID:",this.formID)}).catch(c=>{console.error("Error retrieving form data:",c)})})})}delData(){I.List({Criteria:[[C.Fields.Id],"=",this.formID]},e=>{if(e.Entities.length>0){let i=e.Entities[0];I.Delete({EntityId:i.Id}).then(a=>{console.log("Deleted PerformanceAppraisalForm successfully:",a),ue.List({Criteria:[[ye.Fields.FormId],"=",this.formID]},t=>{ue.Delete({EntityId:t.Entities[0].Id}).then(s=>{console.log(`Deleted PerformanceAppraisalEvaluation ID ${t.Entities[0].Id} successfully.`,s),Q.List({Criteria:[[ve.Fields.FormId],"=",this.formID]},l=>{if(l.Entities.length>0){let n=[];for(let u of l.Entities){let f=Q.Delete({EntityId:u.Id}).then(D=>{console.log(`Deleted PerformanceAppraisalResponse ID ${u.Id} successfully.`,D)}).catch(D=>{console.error(`Error deleting PerformanceAppraisalResponse ID ${u.Id}:`,D)});n.push(f)}Promise.all(n).then(()=>{console.log("All PerformanceAppraisalResponse records have been deleted.")}).catch(u=>{console.error("Error during batch deletion of PerformanceAppraisalResponse records:",u)})}else console.log("No PerformanceAppraisalResponse found with the given formID")}).catch(l=>{console.error("Error fetching PerformanceAppraisalResponse:",l)})}).catch(s=>{console.error(`Error deleting PerformanceAppraisalEvaluation ID ${t.Entities[0].Id}:`,s)})})}).catch(a=>{console.error("Error deleting PerformanceAppraisalForm:",a)})}else console.log("No PerformanceAppraisalForm found with the given formID")}).catch(e=>{console.error("Error fetching PerformanceAppraisalForm:",e)}),setTimeout(()=>{this.dialogClose(),window.location.reload()},1e3)}validateNewForm(){var f,D,h,v;let e=!0,i=!1,a=$("#TemplateId").val()||"";this.isEmptyOrNull(a)?(e=!1,i=!0,$("#TemplateId").addClass("error")):$("#TemplateId").removeClass("error");let t=((f=$("#AppraisalTypeId").val())==null?void 0:f.toString())||"";this.isEmptyOrNull(t)?(e=!1,i=!0,$("#AppraisalTypeId").addClass("error")):$("#AppraisalTypeId").removeClass("error"),$('input[name="TargetList"]:checked').length===0?(e=!1,i=!0,$(".target-list-container").addClass("error")):$(".target-list-container").removeClass("error");let l=((D=$("#StartDate").val())==null?void 0:D.toString())||"";this.isEmptyOrNull(l)?(e=!1,i=!0,$("#StartDate").addClass("error")):$("#StartDate").removeClass("error");let n=((h=$("#ReviewStartDate").val())==null?void 0:h.toString())||"";this.isEmptyOrNull(l)?(e=!1,i=!0,$("#ReviewStartDate").addClass("error")):$("#ReviewStartDate").removeClass("error");let u=((v=$("#ApprovalStartDate").val())==null?void 0:v.toString())||"";if(this.isEmptyOrNull(l)?(e=!1,i=!0,$("#ApprovalStartDate").addClass("error")):$("#ApprovalStartDate").removeClass("error"),i){(0,R.alertDialog)("Please fill in all required fields.");return}return e}validateForm(){var v,m,r,d,g,y,c;let e=!0,i=!1,a=$("#TemplateId").val()||"";this.isEmptyOrNull(a)?(e=!1,i=!0,$("#TemplateId").addClass("error")):$("#TemplateId").removeClass("error");let t=((v=$("#AppraisalTypeId").val())==null?void 0:v.toString())||"";this.isEmptyOrNull(t)?(e=!1,i=!0,$("#AppraisalTypeId").addClass("error")):$("#AppraisalTypeId").removeClass("error"),$('input[name="TargetList"]:checked').length===0?(e=!1,i=!0,$(".target-list-container").addClass("error")):$(".target-list-container").removeClass("error");let l=((m=$("#StartDate").val())==null?void 0:m.toString())||"";this.isEmptyOrNull(l)?(e=!1,i=!0,$("#StartDate").addClass("error")):$("#StartDate").removeClass("error");let n=((r=$("#EndDate").val())==null?void 0:r.toString())||"";this.isEmptyOrNull(n)?(e=!1,i=!0,$("#EndDate").addClass("error")):$("#EndDate").removeClass("error");let u=((d=$("#ReviewStartDate").val())==null?void 0:d.toString())||"";this.isEmptyOrNull(l)?(e=!1,i=!0,$("#ReviewStartDate").addClass("error")):$("#ReviewStartDate").removeClass("error");let f=((g=$("#ReviewEndDate").val())==null?void 0:g.toString())||"";this.isEmptyOrNull(n)?(e=!1,i=!0,$("#ReviewEndDate").addClass("error")):$("#ReviewEndDate").removeClass("error");let D=((y=$("#ApprovalStartDate").val())==null?void 0:y.toString())||"";this.isEmptyOrNull(l)?(e=!1,i=!0,$("#ApprovalStartDate").addClass("error")):$("#ApprovalStartDate").removeClass("error");let h=((c=$("#ApprovalEndDate").val())==null?void 0:c.toString())||"";if(this.isEmptyOrNull(n)?(e=!1,i=!0,$("#ApprovalEndDate").addClass("error")):$("#ApprovalEndDate").removeClass("error"),i){(0,R.alertDialog)("Please fill in all required fields.");return}return e}};E(P,"PerformanceAppraisalFormDialog"),P=K([G.Decorators.panel(),G.Decorators.registerClass("HRMSoftware.PerformanceAppraisal.PerformanceAppraisalFormDialog")],P);var Ee=A(Fe(),1),Ie=A(Re(),1);var _=class extends j.EntityGrid{constructor(e){super(e)}getColumnsKey(){return we.columnsKey}getDialogType(){return P}getRowDefinition(){return C}getService(){return I.baseUrl}onViewProcessData(e){return e=super.onViewProcessData(e),this.toolbar.findButton("column-picker-button").toggle(!1),e}getButtons(){let e=super.getButtons();return e.push(X.ExcelExportHelper.createToolButton({grid:this,service:I.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),e.push(X.PdfExportHelper.createToolButton({grid:this,onViewSubmit:()=>this.onViewSubmit()})),ge(fe.HumanResources)||(e=e.filter(i=>i.cssClass!=="add-button")),e.push({title:"Download PDFs",cssClass:"export-pdf-button",onClick:()=>{this.downloadAllPdfs()}}),e.push({title:"Delete All Records",cssClass:"delete-button",onClick:()=>this.deleteAllRecords()}),e}getColumns(){j.DataGrid.defaultRowHeight=50;let e=super.getColumns();return e.splice(0,0,{field:"Appraisal Form",name:"",format:i=>'<a class="inline-action appraisal-form" title="Appraisal Form"> <i class="fa fa-book"></i></a>',width:12,minWidth:12,maxWidth:12}),e.splice(1,0,{id:"Print Pdf",field:"PDF Form",name:"",cssClass:"align-center",format:i=>{let a=i.item,t='<a class="inline-action pdf-form" data-action="print-pdf" title="PDF"><i class="fa fa-file-pdf" style="color: red;"></i></a>';if(a.ReviewStatus==7)return t},width:36,minWidth:36,maxWidth:36}),ge(fe.HumanResources)&&e.splice(0,0,{id:"Edit",field:"Edit",name:"",cssClass:"align-center",format:i=>`<a class="inline-action edit-link" data-id="${i.item.Id}" title="Edit">
                          <i class="fa fa-pencil" style="color: orange;"></i>
                      </a>`,width:22,minWidth:22,maxWidth:22}),e}onClick(e,i,a){if(super.onClick(e,i,a),!e.isDefaultPrevented()){var t=this.itemAt(i),s=$(e.target);if(s.parent().hasClass("inline-action")&&(s=s.parent()),s.hasClass("appraisal-form")&&(0,L.confirm)("Do you want to fill the performance appraisal form?",()=>{var c=new $e;this.initDialog(c),c.getResponseRowID(t.Id),c.getTemplateID(t.TemplateId),c.getTargetID(t.EmployeeRowId),c.loadEntityAndOpenDialog({ResponseFormID:t.Id,ResponseTemplateID:t.TemplateId,ResponseTargetID:t.EmployeeRowId})}),s.hasClass("pdf-form")){var l={FormId:t.Id,EmployeeId:t.EmployeeId,EmployeeRowId:t.EmployeeRowId},n=new Date,u=n.getFullYear(),f=("0"+(n.getMonth()+1)).slice(-2),D=("0"+n.getDate()).slice(-2),h=("0"+n.getHours()).slice(-2),v=("0"+n.getMinutes()).slice(-2),m=("0"+n.getSeconds()).slice(-2),r=Object.keys(l).map(function(c){return c+"="+encodeURIComponent(l[c])}).join("&"),d=window.location.origin+"/PerformanceAppraisalForm/PdfSharpConvert?"+r,g=new XMLHttpRequest;g.open("GET",d,!0),g.responseType="blob",g.onload=function(){if(g.status===200){var c=g.response;let p=window.URL.createObjectURL(c),o=document.createElement("a");o.style.display="none",o.href=p,o.download=`AppraisalForm_${t.EmployeeId}_${D}${f}${u}_${h}${v}${m}.pdf`,document.body.appendChild(o),o.click()}else g.status!==200&&(0,L.alertDialog)("An error occurred while generating the PDF.")},g.onerror=function(){(0,L.alertDialog)("An error occurred while making the request. Please check your network connection.")},g.send()}if(s.hasClass("edit-link")){var y=new P;this.initDialog(y),y.getID(t.Id),y.loadEntityAndOpenDialog({FormID:t.Id})}}}downloadAllPdfs(){return F(this,null,function*(){var e=this.view.getItems();if(e.length===0){(0,L.alertDialog)("There are no files available to download.");return}else if(e[0].SubmissionStatus!==2){(0,L.alertDialog)("There are no files available to download.");return}var i=new Ee.default,a=new Date,t=a.getFullYear(),s=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2),n=("0"+a.getHours()).slice(-2),u=("0"+a.getMinutes()).slice(-2),f=("0"+a.getSeconds()).slice(-2),D=`AppraisalForms_${t}-${s}-${l}_${n}-${u}-${f}.zip`,h=new Set,v=e.map((m,r)=>F(this,null,function*(){var d=m;if(d.SubmissionStatus==2){var g={FormId:d.Id,EmployeeId:d.EmployeeId,EmployeeRowId:d.EmployeeRowId},y=Object.keys(g).map(w=>w+"="+encodeURIComponent(g[w])).join("&"),c=window.location.origin+"/PerformanceAppraisalForm/PdfSharpConvert?"+y;let o=yield fetch(c);if(o.ok){let w=yield o.blob();var p=`AppraisalForm-${d.EmployeeId}-${d.EmployeeRowId}.pdf`;h.has(p)&&(p=`AppraisalForm-${d.EmployeeId}-${d.EmployeeRowId}-${r}.pdf`),h.add(p),i.file(p,w)}else console.error("Failed to fetch PDF for item",d)}}));yield Promise.all(v),i.generateAsync({type:"blob"}).then(function(m){(0,Ie.saveAs)(m,D)}).catch(function(m){console.error("Failed to generate ZIP:",m)})})}deleteAllRecords(){let e=this.view.getItems().map(i=>i.Id);e.length!==0&&(0,L.confirm)("Are you sure you want to delete all visible records?",()=>{I.DeleteAll({RecordIds:e},i=>{this.refresh()})})}};E(_,"PerformanceAppraisalFormGrid"),_=K([j.Decorators.registerClass("HRMSoftware.PerformanceAppraisal.PerformanceAppraisalFormGrid")],_);function Pe(){(0,ke.initFullHeightGridPage)(new _($("#GridDiv")).element)}E(Pe,"pageInit");export{Pe as default};
//# sourceMappingURL=PerformanceAppraisalFormPage.js.map
