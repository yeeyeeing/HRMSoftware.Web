import{a as T}from"../../../../_chunks/chunk-77WJXJAH.js";import{c as v,f as P,g as i}from"../../../../_chunks/chunk-EUGFEW3M.js";import{a as y}from"../../../../_chunks/chunk-N3LCTBMN.js";import{a as b}from"../../../../_chunks/chunk-K2UT2MVJ.js";import{a as A}from"../../../../_chunks/chunk-DNINIZJD.js";import{c as u,g,k as C}from"../../../../_chunks/chunk-L3ECGIWB.js";var E=g(A(),1),r=g(C(),1),U=g(b(),1);function p(a){var d=new m($("#LoginPanel"));a!=null&&a.isPublicDemo&&(d.form.Username.element.val("admin").attr("placeholder","admin"),d.form.Password.element.val("serenity").attr("placeholder","serenity")),a!=null&&a.activated&&(d.form.Username.value=a.activated,d.form.Password.element.focus())}u(p,"pageInit");var m=class extends E.PropertyPanel{constructor(){super(...arguments);this.form=new v(this.idPrefix)}getFormKey(){return v.formKey}loginClick(){if(this.validateForm()){var o=this.getSaveEntity();(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Account/Login"),request:o,onSuccess:()=>{this.redirectToReturnUrl()},onError:e=>{var s,c,l,t;if(((s=e==null?void 0:e.Error)==null?void 0:s.Code)==="TwoFactorAuthenticationRequired"){var n=e.Error.Arguments.split("|");this.handleTwoFactorAuthentication(o.Username,o.Password,n[1],n[0]);return}if(((c=e==null?void 0:e.Error)==null?void 0:c.Code)==="RedirectUserTo"){window.location.href=e.Error.Arguments;return}if((t=(l=e==null?void 0:e.Error)==null?void 0:l.Message)!=null&&t.length){(0,r.notifyError)(e.Error.Message),this.form.Password.element.focus();return}r.ErrorHandling.showServiceError(e.Error)}})}}redirectToReturnUrl(){var o=(0,r.parseQueryString)(),e=o.returnUrl||o.ReturnUrl;if(e){var n=window.location.hash;n!=null&&n!="#"&&(e+=n),window.location.href=e}else window.location.href=(0,r.resolveUrl)("~/")}handleTwoFactorAuthentication(o,e,n,s){var c=0,l=120,t=null,h=u(()=>{t=new U.PromptDialog({title:"Two Factor Authentication",editorOptions:{maxLength:4},editorType:"Integer",message:s,isHtml:!0,required:!0,validateValue:f=>f>=1e3&&f<=9999?(c++,(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Account/Login"),request:{Username:o,Password:e,TwoFactorGuid:n,TwoFactorCode:f},onSuccess:()=>{this.redirectToReturnUrl()},onError:F=>{if((0,r.notifyError)(F.Error.Message),c>2){(0,r.notifyError)("Code entered is invalid! You can't try more than 3 times!"),t=null;return}h()}}),!0):((0,r.notifyError)("Please enter a valid code!"),!1)}),t.dialogOpen(),t.element.on("dialogclose.me",function(){t!=null&&(t.element.off("dialogclose.me"),t=null)})},"showDialog");function w(){l-=1,t!=null&&t.element.find("span.counter").text(l.toString()),l>=0?setTimeout(w,1e3):t!=null&&t.dialogClose()}u(w,"updateCounter"),h(),window.setTimeout(w,1e3)}renderContents(){let o=this.useIdPrefix(),e=y.Forms.Membership.Login;this.element.empty().append(i(P,{children:[i(T,{}),i("div",{class:"s-Panel p-4",children:[i("h5",{class:"text-center my-4",children:e.LoginToYourAccount}),i("form",{id:o.Form,action:"",children:[i("div",{id:o.PropertyGrid}),i("div",{class:"px-field",children:i("a",{class:"float-end text-decoration-none",href:(0,r.resolveUrl)("~/Account/ForgotPassword"),children:e.ForgotPassword})}),i("div",{class:"px-field",children:i("button",{id:o.LoginButton,type:"submit",class:"btn btn-primary my-3 w-100",onClick:n=>{n.preventDefault(),this.loginClick()},children:e.SignInButton})})]})]}),i("div",{class:"text-center mt-2",children:i("a",{class:"text-decoration-none",href:(0,r.resolveUrl)("~/Account/SignUp"),children:e.SignUpButton})})]}))}};u(m,"LoginPanel");export{p as default};
//# sourceMappingURL=LoginPage.js.map
