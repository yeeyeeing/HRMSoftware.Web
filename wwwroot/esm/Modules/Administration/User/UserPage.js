import{a as R}from"../../../_chunks/chunk-MXCAVYUW.js";import{h as D,j as C,k as U,l as i,m as E}from"../../../_chunks/chunk-3FMYFY2A.js";import"../../../_chunks/chunk-OAOSE5IN.js";import"../../../_chunks/chunk-F3ZQHHES.js";import"../../../_chunks/chunk-E5LOGLR4.js";import"../../../_chunks/chunk-EM5O7OU6.js";import"../../../_chunks/chunk-JXMDZA3A.js";import"../../../_chunks/chunk-LLMDZJQJ.js";import{b as l}from"../../../_chunks/chunk-J5PFZI4S.js";import"../../../_chunks/chunk-K2UT2MVJ.js";import{a as I}from"../../../_chunks/chunk-DNINIZJD.js";import{c as d,g as a,h as v,k as h}from"../../../_chunks/chunk-L3ECGIWB.js";var S=a(h(),1);var P=a(I(),1),g=a(h(),1);var p=a(I(),1),c=a(h(),1),b=a(I(),1);var f=a(h(),1);var n=class extends p.EntityDialog{constructor(){super();this.form=new U(this.idPrefix);this.form.Password.element.attr("autocomplete","new-password"),this.form.Password.change(()=>{p.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value.length<6)return(0,c.format)((0,c.localText)(R.Validation.MinRequiredPasswordLength),6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return(0,c.localText)(R.Validation.PasswordConfirmMismatch)})}getFormKey(){return U.formKey}getIdProperty(){return i.idProperty}getIsActiveProperty(){return i.isActiveProperty}getLocalTextPrefix(){return i.localTextPrefix}getNameProperty(){return i.nameProperty}getService(){return E.baseUrl}getToolbarButtons(){return super.getToolbarButtons()}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}dialogOpen(r){super.dialogOpen(r);var t=this;t.originalOwner=t.form.EmployeeRowID.value;var o=t.form.EmployeeRowID.value,e=document.getElementById(this.idPrefix+"EmployeeRowID");let w=new b.Select2Editor($(e));l.List({},s=>{for(var y in s.Entities)((0,f.isEmptyOrNull)(s.Entities[y].UserRowID)||s.Entities[y].Id==o)&&w.addItem({id:s.Entities[y].Id.toString(),text:s.Entities[y].EmployeeID.toString()});(0,f.isEmptyOrNull)(o)||$(e).val(o.toString()).trigger("change")})}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew())}save_submitHandler(r){var t=this;super.save_submitHandler(r)}onSaveSuccess(r){var t=this;(0,f.isEmptyOrNull)(this.form.EmployeeRowID.value)||l.Retrieve({EntityId:t.form.EmployeeRowID.value},o=>{var e;console.log(o),((e=o.Entity)==null?void 0:e.IsActive)===1&&l.Update({EntityId:t.form.EmployeeRowID.value,Entity:{UserRowID:t.entityId,UserName:t.form.Username.value,CreateUser:!0,UserPassword:t.form.Password.value}})},{async:!0}),t.form.EmployeeRowID.value!=t.originalOwner&&!(0,f.isEmptyOrNull)(t.originalOwner)&&l.Retrieve({EntityId:t.originalOwner},o=>{var e;console.log(o.Entity),((e=o.Entity)==null?void 0:e.IsActive)===1&&l.Update({EntityId:t.originalOwner,Entity:{UserRowID:null,UserName:null,CreateUser:!1,UserPassword:null}})},{async:!0}),super.onSaveSuccess(r)}onDeleteSuccess(r){(0,f.isEmptyOrNull)(this.originalOwner)||l.Update({EntityId:this.originalOwner,Entity:{UserRowID:null,UserName:null,CreateUser:!1,UserPassword:null,GrantHRPrivilege:!1}}),super.onDeleteSuccess(r)}};d(n,"UserDialog"),n=v([p.Decorators.registerClass()],n);var m=class extends P.EntityGrid{getColumnsKey(){return C.columnsKey}getDialogType(){return n}getIdProperty(){return i.idProperty}getIsActiveProperty(){return i.isActiveProperty}getLocalTextPrefix(){return i.localTextPrefix}getService(){return E.baseUrl}constructor(u){super(u)}getDefaultSortBy(){return[i.Fields.Username]}getColumns(){var u=super.getColumns(),r=(0,g.tryFirst)(u,e=>e.field=="ImpersonationToken");r!=null&&(r.format=e=>e.value?`<a target="_blank" href="${(0,g.resolveUrl)("~/Account/ImpersonateAs?token=")}${e.value}"><i class="fa fa-user-secret text-blue"></i></a>`:"");var t=(0,g.tryFirst)(u,e=>e.field==i.Fields.Roles);if(t){var o;D.getLookupAsync().then(e=>{o=e,this.slickGrid.invalidate()}),t.format=e=>{if(!o)return'<i class="fa fa-spinner"></i>';var w=(e.value||[]).map(s=>(o.itemById[s]||{}).RoleName||"");return w.sort(),w.join(", ")}}return u}};d(m,"UserGrid"),m=v([P.Decorators.registerClass()],m);function N(){(0,S.initFullHeightGridPage)(new m($("#GridDiv")).element)}d(N,"pageInit");export{N as default};
//# sourceMappingURL=UserPage.js.map
